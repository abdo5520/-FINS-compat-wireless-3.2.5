<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CompatWireless3.2: drivers/net/wireless/b43/phy_n.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>drivers/net/wireless/b43/phy_n.c</h1><a href="phy__n_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  Broadcom B43 wireless driver</span>
<a name="l00004"></a>00004 <span class="comment">  IEEE 802.11n PHY support</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">  Copyright (c) 2008 Michael Buesch &lt;m@bues.ch&gt;</span>
<a name="l00007"></a>00007 <span class="comment">  Copyright (c) 2010-2011 Rafał Miłecki &lt;zajec5@gmail.com&gt;</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">  This program is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
<a name="l00011"></a>00011 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00012"></a>00012 <span class="comment">  (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment">  GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">  You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment">  along with this program; see the file COPYING.  If not, write to</span>
<a name="l00021"></a>00021 <span class="comment">  the Free Software Foundation, Inc., 51 Franklin Steet, Fifth Floor,</span>
<a name="l00022"></a>00022 <span class="comment">  Boston, MA 02110-1301, USA.</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">*/</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;linux/delay.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;linux/slab.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;linux/types.h&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="b43_8h.html">b43.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="phy__n_8h.html">phy_n.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="tables__nphy_8h.html">tables_nphy.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="radio__2055_8h.html">radio_2055.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="radio__2056_8h.html">radio_2056.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="main_8h.html">main.h</a>&quot;</span>
<a name="l00036"></a><a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">00036</a> 
<a name="l00037"></a><a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">00037</a> <span class="keyword">struct </span><a class="code" href="structnphy__txgains.html">nphy_txgains</a> {
<a name="l00038"></a><a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">00038</a>         u16 <a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">txgm</a>[2];
<a name="l00039"></a><a class="code" href="structnphy__txgains.html#a5d36577ca175aa8dd4d6634c71b8018b">00039</a>         u16 <a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">pga</a>[2];
<a name="l00040"></a>00040         u16 <a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">pad</a>[2];
<a name="l00041"></a>00041         u16 <a class="code" href="structnphy__txgains.html#a5d36577ca175aa8dd4d6634c71b8018b">ipa</a>[2];
<a name="l00042"></a>00042 };
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="structnphy__iqcal__params.html">00044</a> <span class="keyword">struct </span><a class="code" href="structnphy__iqcal__params.html">nphy_iqcal_params</a> {
<a name="l00045"></a><a class="code" href="structnphy__iqcal__params.html#ad17d8f22b98cda85c6ad09477fcc74ae">00045</a>         u16 <a class="code" href="structnphy__iqcal__params.html#ad17d8f22b98cda85c6ad09477fcc74ae">txgm</a>;
<a name="l00046"></a><a class="code" href="structnphy__iqcal__params.html#a989d30fde39833e28c1cee5783e6b3d1">00046</a>         u16 <a class="code" href="structnphy__iqcal__params.html#a989d30fde39833e28c1cee5783e6b3d1">pga</a>;
<a name="l00047"></a><a class="code" href="structnphy__iqcal__params.html#a8241e5f19f9083389c25b49d87090585">00047</a>         u16 <a class="code" href="structnphy__iqcal__params.html#a8241e5f19f9083389c25b49d87090585">pad</a>;
<a name="l00048"></a><a class="code" href="structnphy__iqcal__params.html#afc1a6f2bc2aa1acccfe9c964e3320a8d">00048</a>         u16 <a class="code" href="structnphy__iqcal__params.html#afc1a6f2bc2aa1acccfe9c964e3320a8d">ipa</a>;
<a name="l00049"></a><a class="code" href="structnphy__iqcal__params.html#af0afe4e0e28981ee81cb4db24ca455a9">00049</a>         u16 <a class="code" href="structnphy__iqcal__params.html#af0afe4e0e28981ee81cb4db24ca455a9">cal_gain</a>;
<a name="l00050"></a><a class="code" href="structnphy__iqcal__params.html#a8f68ba606df0f1d7a7b638d5e5f818dc">00050</a>         u16 <a class="code" href="structnphy__iqcal__params.html#a8f68ba606df0f1d7a7b638d5e5f818dc">ncorr</a>[5];
<a name="l00051"></a>00051 };
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="structnphy__iq__est.html">00053</a> <span class="keyword">struct </span><a class="code" href="structnphy__iq__est.html">nphy_iq_est</a> {
<a name="l00054"></a><a class="code" href="structnphy__iq__est.html#ad739211347eaba1d59b8def4d38a027d">00054</a>         s32 <a class="code" href="structnphy__iq__est.html#ad739211347eaba1d59b8def4d38a027d">iq0_prod</a>;
<a name="l00055"></a><a class="code" href="structnphy__iq__est.html#a6eb4c5fcb2613ee70661f9fd20db497d">00055</a>         u32 <a class="code" href="structnphy__iq__est.html#a6eb4c5fcb2613ee70661f9fd20db497d">i0_pwr</a>;
<a name="l00056"></a><a class="code" href="structnphy__iq__est.html#a045646d939baa289ea463fd314d7eef6">00056</a>         u32 <a class="code" href="structnphy__iq__est.html#a045646d939baa289ea463fd314d7eef6">q0_pwr</a>;
<a name="l00057"></a><a class="code" href="structnphy__iq__est.html#aa697168545473bbe76ce4ad890bdd4cb">00057</a>         s32 <a class="code" href="structnphy__iq__est.html#aa697168545473bbe76ce4ad890bdd4cb">iq1_prod</a>;
<a name="l00058"></a><a class="code" href="structnphy__iq__est.html#a120f95083e6c1eb69e3b93871ccd9c13">00058</a>         u32 <a class="code" href="structnphy__iq__est.html#a120f95083e6c1eb69e3b93871ccd9c13">i1_pwr</a>;
<a name="l00059"></a><a class="code" href="structnphy__iq__est.html#a1a0aac340444d6754201a3ea11352d80">00059</a>         u32 <a class="code" href="structnphy__iq__est.html#a1a0aac340444d6754201a3ea11352d80">q1_pwr</a>;
<a name="l00060"></a>00060 };
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884">00062</a> <span class="keyword">enum</span> <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884">b43_nphy_rf_sequence</a> {
<a name="l00063"></a><a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a687bba92ab195b6597b210d2dab0faca">00063</a>         <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a687bba92ab195b6597b210d2dab0faca">B43_RFSEQ_RX2TX</a>,
<a name="l00064"></a><a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884aebb467d28fe77d5b3de37488deba0c2d">00064</a>         <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884aebb467d28fe77d5b3de37488deba0c2d">B43_RFSEQ_TX2RX</a>,
<a name="l00065"></a><a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">00065</a>         <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>,
<a name="l00066"></a><a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a41f9827ee907d73957dc5854aa48a1a6">00066</a>         <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a41f9827ee907d73957dc5854aa48a1a6">B43_RFSEQ_UPDATE_GAINH</a>,
<a name="l00067"></a><a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ac6f57cf3883b08c02bebb92032c417ce">00067</a>         <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ac6f57cf3883b08c02bebb92032c417ce">B43_RFSEQ_UPDATE_GAINL</a>,
<a name="l00068"></a><a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ac3d0d2894c6f20e710421036573bd55f">00068</a>         <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ac3d0d2894c6f20e710421036573bd55f">B43_RFSEQ_UPDATE_GAINU</a>,
<a name="l00069"></a>00069 };
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658e">00071</a> <span class="keyword">enum</span> <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658e">b43_nphy_rssi_type</a> {
<a name="l00072"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaaf7f62cd909edd45fdcf0b2bec9c1337">00072</a>         <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaaf7f62cd909edd45fdcf0b2bec9c1337">B43_NPHY_RSSI_X</a> = 0,
<a name="l00073"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea943e9ddbcfc8d0d6c007d9afa7dafa63">00073</a>         <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea943e9ddbcfc8d0d6c007d9afa7dafa63">B43_NPHY_RSSI_Y</a>,
<a name="l00074"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eac911ea9e301ee207723bfc2aa3cdf1bf">00074</a>         <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eac911ea9e301ee207723bfc2aa3cdf1bf">B43_NPHY_RSSI_Z</a>,
<a name="l00075"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea3d2c48c5361f5f082f86be8cc3cc3430">00075</a>         <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea3d2c48c5361f5f082f86be8cc3cc3430">B43_NPHY_RSSI_PWRDET</a>,
<a name="l00076"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa6cf6d0394400f1a3e7e2c8d4bb6bc56">00076</a>         <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa6cf6d0394400f1a3e7e2c8d4bb6bc56">B43_NPHY_RSSI_TSSI_I</a>,
<a name="l00077"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa33b47acbffff5c9b99140e5bc06dba9">00077</a>         <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa33b47acbffff5c9b99140e5bc06dba9">B43_NPHY_RSSI_TSSI_Q</a>,
<a name="l00078"></a><a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea0e5bcc25f05cea6e3afee93fc84a6809">00078</a>         <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea0e5bcc25f05cea6e3afee93fc84a6809">B43_NPHY_RSSI_TBD</a>,
<a name="l00079"></a>00079 };
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">/* TODO: reorder functions */</span>
<a name="l00082"></a>00082 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00083"></a>00083                                                 <span class="keywordtype">bool</span> enable);
<a name="l00084"></a>00084 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 cmd,
<a name="l00085"></a>00085                                         u8 *events, u8 *delays, u8 length);
<a name="l00086"></a>00086 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00087"></a>00087                                        <span class="keyword">enum</span> <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884">b43_nphy_rf_sequence</a> seq);
<a name="l00088"></a>00088 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a7a9358c4ccb7f2049eae9611b1b2e9c6">b43_nphy_rf_control_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 field,
<a name="l00089"></a>00089                                                 u16 value, u8 core, <span class="keywordtype">bool</span> off);
<a name="l00090"></a>00090 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 field,
<a name="l00091"></a>00091                                                 u16 value, u8 core);
<a name="l00092"></a>00092 <span class="keyword">static</span> <span class="keyword">const</span> u32 *<a class="code" href="phy__n_8c.html#ac9b997a0f7b74f5bcef62e050308b960">b43_nphy_get_ipa_gain_table</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev);
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">00094</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096         <span class="keyword">enum</span> ieee80211_band band = <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>);
<a name="l00097"></a>00097         <span class="keywordflow">return</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>-&gt;<a class="code" href="structb43__phy__n.html#a5688a326492153efc11b08d2c2edae29">ipa2g_on</a> &amp;&amp; band == IEEE80211_BAND_2GHZ) ||
<a name="l00098"></a>00098                 (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>-&gt;<a class="code" href="structb43__phy__n.html#af7d51f073c3731efd4cab4eaea6e7ecb">ipa5g_on</a> &amp;&amp; band == IEEE80211_BAND_5GHZ));
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="phy__n_8c.html#a3445d88d3bfc738bd6edb4a961f8bb95">00101</a> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a3445d88d3bfc738bd6edb4a961f8bb95">b43_nphy_set_rxantenna</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">int</span> antenna)
<a name="l00102"></a>00102 {<span class="comment">//TODO</span>
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="phy__n_8c.html#a18ec4af00ace8ee353f36b835b8a4301">00105</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a18ec4af00ace8ee353f36b835b8a4301">b43_nphy_op_adjust_txpower</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00106"></a>00106 {<span class="comment">//TODO</span>
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="phy__n_8c.html#a50b46643e30db4e9329d2cf66003d75e">00109</a> <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="phy__common_8h.html#a6db3c97c17dd2ad5300b634b7526fd03">b43_txpwr_result</a> <a class="code" href="phy__n_8c.html#a50b46643e30db4e9329d2cf66003d75e">b43_nphy_op_recalc_txpower</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00110"></a>00110                                                         <span class="keywordtype">bool</span> ignore_tssi)
<a name="l00111"></a>00111 {<span class="comment">//TODO</span>
<a name="l00112"></a>00112         <span class="keywordflow">return</span> <a class="code" href="phy__common_8h.html#a6db3c97c17dd2ad5300b634b7526fd03ac688dafff0513e979c11092e64ba76fa">B43_TXPWR_RES_DONE</a>;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="phy__n_8c.html#a8a3c395aa194168166c398b4ed817ece">00115</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a8a3c395aa194168166c398b4ed817ece">b43_chantab_radio_upload</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00116"></a>00116                                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structb43__nphy__channeltab__entry__rev2.html">b43_nphy_channeltab_entry_rev2</a> *e)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#ab254f18c89032e6229e3bd1bfd972350">B2055_PLL_REF</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a01fb15a19ece5fbb38af2fb201723cd6">radio_pll_ref</a>);
<a name="l00119"></a>00119         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a36858889311820837afe21b7c88236df">B2055_RF_PLLMOD0</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a4d3be6da43f07797572dbc37c63c8136">radio_rf_pllmod0</a>);
<a name="l00120"></a>00120         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a9e6e3e207d4bdc11137841387f8d5090">B2055_RF_PLLMOD1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a5508f3be620e31c218184d2b04e0efc2">radio_rf_pllmod1</a>);
<a name="l00121"></a>00121         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a42b921d7746a744b0b8b3389d1ec7b85">B2055_VCO_CAPTAIL</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#ac0fa80ff1d87dcf7155f30d4fa563752">radio_vco_captail</a>);
<a name="l00122"></a>00122         <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>); <span class="comment">/* flush writes */</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a5b761884c0988d7ccc31e4bf86bacc63">B2055_VCO_CAL1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#ab5b1709460d64956ba5bf988df485a27">radio_vco_cal1</a>);
<a name="l00125"></a>00125         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#ad6f0818a9f3b5e997a15aece25dd918f">B2055_VCO_CAL2</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a2f0f24808f6899464762701c29a58772">radio_vco_cal2</a>);
<a name="l00126"></a>00126         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#abc6ff6840ecda9c4a8a1c2b681163cb1">B2055_PLL_LFC1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a8334dd46cdb9f616c6cecfa72bc996cb">radio_pll_lfc1</a>);
<a name="l00127"></a>00127         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a78195df0bf1e1a77fa04da8b35577307">B2055_PLL_LFR1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#acd04c669813622ddc282c72ab1d03ea6">radio_pll_lfr1</a>);
<a name="l00128"></a>00128         <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>); <span class="comment">/* flush writes */</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a76157ef81b9bd5d4f16835e6c3133309">B2055_PLL_LFC2</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a822bb4f38c903c6864f37c00e8963912">radio_pll_lfc2</a>);
<a name="l00131"></a>00131         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#ac69b8822b1ed57c2880cebe24dd19605">B2055_LGBUF_CENBUF</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#ac1e1a0d4c26d12c289daad6c15957cf1">radio_lgbuf_cenbuf</a>);
<a name="l00132"></a>00132         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#ae65b170470a439b67841e9b166c3dd77">B2055_LGEN_TUNE1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a7ae6e6846cb7d61abd53400a54ac4396">radio_lgen_tune1</a>);
<a name="l00133"></a>00133         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#aa034f7b290ab6f740545eed248a07469">B2055_LGEN_TUNE2</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a632ab7b4667c4666698efa7a2f3b429e">radio_lgen_tune2</a>);
<a name="l00134"></a>00134         <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>); <span class="comment">/* flush writes */</span>
<a name="l00135"></a>00135 
<a name="l00136"></a>00136         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a4f6a3eb3d59cf4e7ceca48dc7aa74376">B2055_C1_LGBUF_ATUNE</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#ad6e2efa52b93fa90ae82343347e9e82f">radio_c1_lgbuf_atune</a>);
<a name="l00137"></a>00137         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a73bc11831a2f615d9d6282ce494c9d4b">B2055_C1_LGBUF_GTUNE</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a500007b3ff97936cffefe31f66a54652">radio_c1_lgbuf_gtune</a>);
<a name="l00138"></a>00138         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a0154b81a3141ed50a829a79214f1673a">B2055_C1_RX_RFR1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#ab89b8a42232b8730e3f1fb2c5bfbc41b">radio_c1_rx_rfr1</a>);
<a name="l00139"></a>00139         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a771aad169749c08b3d0226789bc50766">B2055_C1_TX_PGAPADTN</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a27409cc65d008d2bdffa93fe823f8030">radio_c1_tx_pgapadtn</a>);
<a name="l00140"></a>00140         <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>); <span class="comment">/* flush writes */</span>
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a1760284db4f9fc6ab6cdd307bbce3f66">B2055_C1_TX_MXBGTRIM</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a398e264a06aed8d5dd9db26ebaea6559">radio_c1_tx_mxbgtrim</a>);
<a name="l00143"></a>00143         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#ac475e3fa11cbff2a74c25daa21687fcc">B2055_C2_LGBUF_ATUNE</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a0e3d2ac9cc8d3caea0739cd4f9cb87d2">radio_c2_lgbuf_atune</a>);
<a name="l00144"></a>00144         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a51727f442015f612ca177a7116817cf9">B2055_C2_LGBUF_GTUNE</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a6cd3a33d356f6313a084bbdbaec45574">radio_c2_lgbuf_gtune</a>);
<a name="l00145"></a>00145         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#af5e3689ce278fb94c9574306f17d4a2e">B2055_C2_RX_RFR1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#afb6024cb550c4439dc798e1e4319573b">radio_c2_rx_rfr1</a>);
<a name="l00146"></a>00146         <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>); <span class="comment">/* flush writes */</span>
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#af50ea56b934f18206c1f414fcba4f3ff">B2055_C2_TX_PGAPADTN</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a3b09a22c5427dc4b61c9804b1d2bc9e6">radio_c2_tx_pgapadtn</a>);
<a name="l00149"></a>00149         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a1fb143d6d2c7e962ddf16e12bd3c2b94">B2055_C2_TX_MXBGTRIM</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a4c4c63635dc04686ac0fb66813776936">radio_c2_tx_mxbgtrim</a>);
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="phy__n_8c.html#a5d30c6464319d0fbe0127081feeed2cc">00152</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a5d30c6464319d0fbe0127081feeed2cc">b43_chantab_radio_2056_upload</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00153"></a>00153                                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structb43__nphy__channeltab__entry__rev3.html">b43_nphy_channeltab_entry_rev3</a> *e)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aa132c51edff126bd837e9518d5a0dcc2">B2056_SYN_PLL_VCOCAL1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a819089b4cd423788b4982869576a9955">radio_syn_pll_vcocal1</a>);
<a name="l00156"></a>00156         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#ad0edc9b4b6852f360430cf5ab6649589">B2056_SYN_PLL_VCOCAL2</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a10b6a918cb5871e98ebedc16be07d6d0">radio_syn_pll_vcocal2</a>);
<a name="l00157"></a>00157         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a25f21d6890bb1b312da3ebca2598afe7">B2056_SYN_PLL_REFDIV</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a2786bd43b2973a8f96876f9e43b251a1">radio_syn_pll_refdiv</a>);
<a name="l00158"></a>00158         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a3fbe41059b11e0eb0abf0a1583c94734">B2056_SYN_PLL_MMD2</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a6b689f2ac7b55cb68fd75bf8ee5fbe91">radio_syn_pll_mmd2</a>);
<a name="l00159"></a>00159         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a8fb1332ad1692cd934dafc087fb8f4f0">B2056_SYN_PLL_MMD1</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#ad1f571d8701ab2302739458f16de1241">radio_syn_pll_mmd1</a>);
<a name="l00160"></a>00160         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a59fbd2f0e58c628822c77dcde336685a">B2056_SYN_PLL_LOOPFILTER1</a>,
<a name="l00161"></a>00161                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a26e98b41643cca0d958193c14426c772">radio_syn_pll_loopfilter1</a>);
<a name="l00162"></a>00162         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a78bc94d1ba23e57a09d2019b95076252">B2056_SYN_PLL_LOOPFILTER2</a>,
<a name="l00163"></a>00163                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a7d52e6dac4c90e67b97bd1d509384295">radio_syn_pll_loopfilter2</a>);
<a name="l00164"></a>00164         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a30e926d4264614054ea0ff649a1f3799">B2056_SYN_PLL_LOOPFILTER3</a>,
<a name="l00165"></a>00165                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a147c49d6914842bf36cb5c5dbbcad1e1">radio_syn_pll_loopfilter3</a>);
<a name="l00166"></a>00166         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a016218c64e527c92151535e77e378559">B2056_SYN_PLL_LOOPFILTER4</a>,
<a name="l00167"></a>00167                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a1477c17a899df98a607b5707e2f61e88">radio_syn_pll_loopfilter4</a>);
<a name="l00168"></a>00168         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a8277eae88d90fa967257a2505285ebd3">B2056_SYN_PLL_LOOPFILTER5</a>,
<a name="l00169"></a>00169                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a4eb485ca3eecc0b9fd9c75eaf4a64a33">radio_syn_pll_loopfilter5</a>);
<a name="l00170"></a>00170         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a20599c542e417fe4325a8158de364437">B2056_SYN_RESERVED_ADDR27</a>,
<a name="l00171"></a>00171                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#ab51c3a93906e451780272ccc3f81f672">radio_syn_reserved_addr27</a>);
<a name="l00172"></a>00172         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a47f7032e06411f50ef7b158aaccec874">B2056_SYN_RESERVED_ADDR28</a>,
<a name="l00173"></a>00173                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#adc2ca437c44d67af7c9ef2ee216bcd52">radio_syn_reserved_addr28</a>);
<a name="l00174"></a>00174         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a270eafe23e474ca0a8fc4190ed2b437b">B2056_SYN_RESERVED_ADDR29</a>,
<a name="l00175"></a>00175                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a7f514967eb49e73a00aa0849b033412e">radio_syn_reserved_addr29</a>);
<a name="l00176"></a>00176         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a5730b3994bcc8402732a290613e07d79">B2056_SYN_LOGEN_VCOBUF1</a>,
<a name="l00177"></a>00177                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a330ec4adce73ae3ce8df647454569c94">radio_syn_logen_vcobuf1</a>);
<a name="l00178"></a>00178         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a54eb9eea9d7861595b940ed1807c1933">B2056_SYN_LOGEN_MIXER2</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a17b84d25b1dd9ff2888ed6050d8ef52c">radio_syn_logen_mixer2</a>);
<a name="l00179"></a>00179         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#afda17688eafd4e042ca57831d400972f">B2056_SYN_LOGEN_BUF3</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a3d82378fd9838813c3395aff06e00572">radio_syn_logen_buf3</a>);
<a name="l00180"></a>00180         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a71f2144fc506f138c9c5ba175cd6d9c1">B2056_SYN_LOGEN_BUF4</a>, e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#aaffd96f3f7a71b0c474da96351cf12e1">radio_syn_logen_buf4</a>);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#af3d2c469b5ce827e511a01aedc8c86e1">B2056_RX_LNAA_TUNE</a>,
<a name="l00183"></a>00183                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a366f6dd1854ce61fce4cecd76279372c">radio_rx0_lnaa_tune</a>);
<a name="l00184"></a>00184         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#abbcab8d4c129de046a60d6c0d998d6b3">B2056_RX_LNAG_TUNE</a>,
<a name="l00185"></a>00185                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a5c98a1e6a771e5d357f4951be40ec15e">radio_rx0_lnag_tune</a>);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#af0d9ce29038e3e8aedc82ea8c19eb91a">B2056_TX_INTPAA_BOOST_TUNE</a>,
<a name="l00188"></a>00188                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#aae432d059a20c38ae7fe82aab464dee3">radio_tx0_intpaa_boost_tune</a>);
<a name="l00189"></a>00189         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#a5bbd057b81b8141aeafc4412f6a36a5b">B2056_TX_INTPAG_BOOST_TUNE</a>,
<a name="l00190"></a>00190                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a1fb5b3f5c7b1c5c6d19c43f013e5b4af">radio_tx0_intpag_boost_tune</a>);
<a name="l00191"></a>00191         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#a651e6a85c7bd410fb3007184f0a5ba4d">B2056_TX_PADA_BOOST_TUNE</a>,
<a name="l00192"></a>00192                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#af61d606fd33d8fb942a83d35919a3c60">radio_tx0_pada_boost_tune</a>);
<a name="l00193"></a>00193         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#acd030fbe05b8f1ab4b6723a3368e6ac9">B2056_TX_PADG_BOOST_TUNE</a>,
<a name="l00194"></a>00194                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#aa89d266eaf37739a75a25971cf9308f2">radio_tx0_padg_boost_tune</a>);
<a name="l00195"></a>00195         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#ac279fe94352f47797e32b40919e45f46">B2056_TX_PGAA_BOOST_TUNE</a>,
<a name="l00196"></a>00196                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a34ba770b334b65465ac49ff2fb5a129d">radio_tx0_pgaa_boost_tune</a>);
<a name="l00197"></a>00197         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#a953712274d933e9a99243dedfa9c117d">B2056_TX_PGAG_BOOST_TUNE</a>,
<a name="l00198"></a>00198                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a8b9fdc387398c543848a9c413061eca4">radio_tx0_pgag_boost_tune</a>);
<a name="l00199"></a>00199         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#ae9e472228f66056ed86c93d83a1f683d">B2056_TX_MIXA_BOOST_TUNE</a>,
<a name="l00200"></a>00200                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a6fb172544c447e21ae4a4b5d41427508">radio_tx0_mixa_boost_tune</a>);
<a name="l00201"></a>00201         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#a7046de0e384e1d9dbb8f22a9a8921f9c">B2056_TX_MIXG_BOOST_TUNE</a>,
<a name="l00202"></a>00202                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#abd1559a6de0d202cb22abab88df19fb3">radio_tx0_mixg_boost_tune</a>);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#af3d2c469b5ce827e511a01aedc8c86e1">B2056_RX_LNAA_TUNE</a>,
<a name="l00205"></a>00205                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a932259704dabd3dfb7e364100245753d">radio_rx1_lnaa_tune</a>);
<a name="l00206"></a>00206         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#abbcab8d4c129de046a60d6c0d998d6b3">B2056_RX_LNAG_TUNE</a>,
<a name="l00207"></a>00207                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a7d1efb4cb402d2548dc940ab7e3a02fc">radio_rx1_lnag_tune</a>);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#af0d9ce29038e3e8aedc82ea8c19eb91a">B2056_TX_INTPAA_BOOST_TUNE</a>,
<a name="l00210"></a>00210                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a9601d87094faa0519289a3ce0f05a0cc">radio_tx1_intpaa_boost_tune</a>);
<a name="l00211"></a>00211         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#a5bbd057b81b8141aeafc4412f6a36a5b">B2056_TX_INTPAG_BOOST_TUNE</a>,
<a name="l00212"></a>00212                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a1e181807fb041e941ae08f2678d4edb2">radio_tx1_intpag_boost_tune</a>);
<a name="l00213"></a>00213         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#a651e6a85c7bd410fb3007184f0a5ba4d">B2056_TX_PADA_BOOST_TUNE</a>,
<a name="l00214"></a>00214                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a3f3b94e986a5ee8445f96c736d5debac">radio_tx1_pada_boost_tune</a>);
<a name="l00215"></a>00215         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#acd030fbe05b8f1ab4b6723a3368e6ac9">B2056_TX_PADG_BOOST_TUNE</a>,
<a name="l00216"></a>00216                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a95e01f1023ff0e4e08bdc6b33fe3510d">radio_tx1_padg_boost_tune</a>);
<a name="l00217"></a>00217         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#ac279fe94352f47797e32b40919e45f46">B2056_TX_PGAA_BOOST_TUNE</a>,
<a name="l00218"></a>00218                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a90823200570e1f5a384ed97a4ec95fdd">radio_tx1_pgaa_boost_tune</a>);
<a name="l00219"></a>00219         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#a953712274d933e9a99243dedfa9c117d">B2056_TX_PGAG_BOOST_TUNE</a>,
<a name="l00220"></a>00220                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a9c230c3042dcf08fb164442212081d07">radio_tx1_pgag_boost_tune</a>);
<a name="l00221"></a>00221         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#ae9e472228f66056ed86c93d83a1f683d">B2056_TX_MIXA_BOOST_TUNE</a>,
<a name="l00222"></a>00222                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#afbca00e8b8b6c2fa6b63752849d28261">radio_tx1_mixa_boost_tune</a>);
<a name="l00223"></a>00223         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#a7046de0e384e1d9dbb8f22a9a8921f9c">B2056_TX_MIXG_BOOST_TUNE</a>,
<a name="l00224"></a>00224                                         e-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a139470bf73c5f6d19ccc14db0afe8548">radio_tx1_mixg_boost_tune</a>);
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/Radio/2056Setup */</span>
<a name="l00228"></a><a class="code" href="phy__n_8c.html#a2f225716d369af9475fd10796463554b">00228</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a2f225716d369af9475fd10796463554b">b43_radio_2056_setup</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00229"></a>00229                                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structb43__nphy__channeltab__entry__rev3.html">b43_nphy_channeltab_entry_rev3</a> *e)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         <a class="code" href="phy__n_8c.html#a5d30c6464319d0fbe0127081feeed2cc">b43_chantab_radio_2056_upload</a>(dev, e);
<a name="l00234"></a>00234         <span class="comment">/* TODO */</span>
<a name="l00235"></a>00235         udelay(50);
<a name="l00236"></a>00236         <span class="comment">/* VCO calibration */</span>
<a name="l00237"></a>00237         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a4e88e33c49239f061fc4c1d528f5723c">B2056_SYN_PLL_VCOCAL12</a>, 0x00);
<a name="l00238"></a>00238         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#ad86a155fc72ab82f0e38e2396edc6e64">B2056_TX_INTPAA_PA_MISC</a>, 0x38);
<a name="l00239"></a>00239         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#ad86a155fc72ab82f0e38e2396edc6e64">B2056_TX_INTPAA_PA_MISC</a>, 0x18);
<a name="l00240"></a>00240         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#ad86a155fc72ab82f0e38e2396edc6e64">B2056_TX_INTPAA_PA_MISC</a>, 0x38);
<a name="l00241"></a>00241         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#ad86a155fc72ab82f0e38e2396edc6e64">B2056_TX_INTPAA_PA_MISC</a>, 0x39);
<a name="l00242"></a>00242         udelay(300);
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="phy__n_8c.html#a1d0151e58aca856a068d1d5bac20e1ab">00245</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a1d0151e58aca856a068d1d5bac20e1ab">b43_chantab_phy_upload</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00246"></a>00246                                    <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structb43__phy__n__sfo__cfg.html">b43_phy_n_sfo_cfg</a> *e)
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a897dc976f7e5dd1700feec2908ade472">B43_NPHY_BW1A</a>, e-&gt;<a class="code" href="structb43__phy__n__sfo__cfg.html#a48d795861d8a021bd1f8a6632382de9d">phy_bw1a</a>);
<a name="l00249"></a>00249         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a765c012c3466bb28864731b87b80f1de">B43_NPHY_BW2</a>, e-&gt;<a class="code" href="structb43__phy__n__sfo__cfg.html#ad7359463e75a6ccf39c0fc1a504f9f44">phy_bw2</a>);
<a name="l00250"></a>00250         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aa11c9ee4da397f797fcfa2e121bb9c5f">B43_NPHY_BW3</a>, e-&gt;<a class="code" href="structb43__phy__n__sfo__cfg.html#a7c0535ccbd86d74eca408b70271777bc">phy_bw3</a>);
<a name="l00251"></a>00251         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a0e270c62b53956dd1094d6f57c7ec308">B43_NPHY_BW4</a>, e-&gt;<a class="code" href="structb43__phy__n__sfo__cfg.html#ac0b4f37efda7254b89aa19573fa8b1bb">phy_bw4</a>);
<a name="l00252"></a>00252         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#afdbb995b70f62b61e2c07e7ed49b0d92">B43_NPHY_BW5</a>, e-&gt;<a class="code" href="structb43__phy__n__sfo__cfg.html#a15783d6fd5e10879ef67f4cd5ba52ba3">phy_bw5</a>);
<a name="l00253"></a>00253         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae8064d61ae34a13008ba220533f0f02d">B43_NPHY_BW6</a>, e-&gt;<a class="code" href="structb43__phy__n__sfo__cfg.html#a506ab7517e74e575c91c19cf7a2e1acb">phy_bw6</a>);
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxPwrCtrlEnable */</span>
<a name="l00257"></a><a class="code" href="phy__n_8c.html#ac1c706b04878fc7941ee790a91377c13">00257</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ac1c706b04878fc7941ee790a91377c13">b43_nphy_tx_power_ctrl</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> enable)
<a name="l00258"></a>00258 {
<a name="l00259"></a>00259         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l00260"></a>00260         u8 i;
<a name="l00261"></a>00261         u16 bmask, val, tmp;
<a name="l00262"></a>00262         <span class="keyword">enum</span> ieee80211_band band = <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l00265"></a>00265                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         nphy-&gt;<a class="code" href="structb43__phy__n.html#ade415910e4417d729e6e95daf8c08f6f">txpwrctrl</a> = enable;
<a name="l00268"></a>00268         <span class="keywordflow">if</span> (!enable) {
<a name="l00269"></a>00269                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3 &amp;&amp;
<a name="l00270"></a>00270                     (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a7261b7587a69d65667b6dbf746143477">B43_NPHY_TXPCTL_CMD</a>) &amp;
<a name="l00271"></a>00271                      (<a class="code" href="phy__n_8h.html#a9790106475ad3ec4bd981c36ae781eff">B43_NPHY_TXPCTL_CMD_COEFF</a> |
<a name="l00272"></a>00272                       <a class="code" href="phy__n_8h.html#a632299487f241693ed91fe2654c5766a">B43_NPHY_TXPCTL_CMD_HWPCTLEN</a> |
<a name="l00273"></a>00273                       <a class="code" href="phy__n_8h.html#a66731c7783b2a95aa92664a14b01d37a">B43_NPHY_TXPCTL_CMD_PCTLEN</a>))) {
<a name="l00274"></a>00274                         <span class="comment">/* We disable enabled TX pwr ctl, save it&#39;s state */</span>
<a name="l00275"></a>00275                         nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l00276"></a>00276                                                 <a class="code" href="phy__n_8h.html#a935edc6a9c366ff20b5fa8ff13f93ce5">B43_NPHY_C1_TXPCTL_STAT</a>) &amp; 0x7f;
<a name="l00277"></a>00277                         nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l00278"></a>00278                                                 <a class="code" href="phy__n_8h.html#a9eba09c6974a13eb7e328773514f4c2c">B43_NPHY_C2_TXPCTL_STAT</a>) &amp; 0x7f;
<a name="l00279"></a>00279                 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>, 0x6840);
<a name="l00282"></a>00282                 <span class="keywordflow">for</span> (i = 0; i &lt; 84; i++)
<a name="l00283"></a>00283                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>, 0x6C40);
<a name="l00286"></a>00286                 <span class="keywordflow">for</span> (i = 0; i &lt; 84; i++)
<a name="l00287"></a>00287                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289                 tmp = <a class="code" href="phy__n_8h.html#a9790106475ad3ec4bd981c36ae781eff">B43_NPHY_TXPCTL_CMD_COEFF</a> | <a class="code" href="phy__n_8h.html#a632299487f241693ed91fe2654c5766a">B43_NPHY_TXPCTL_CMD_HWPCTLEN</a>;
<a name="l00290"></a>00290                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l00291"></a>00291                         tmp |= <a class="code" href="phy__n_8h.html#a66731c7783b2a95aa92664a14b01d37a">B43_NPHY_TXPCTL_CMD_PCTLEN</a>;
<a name="l00292"></a>00292                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a7261b7587a69d65667b6dbf746143477">B43_NPHY_TXPCTL_CMD</a>, ~tmp);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00295"></a>00295                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, 0x0100);
<a name="l00296"></a>00296                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0x0100);
<a name="l00297"></a>00297                 } <span class="keywordflow">else</span> {
<a name="l00298"></a>00298                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0x4000);
<a name="l00299"></a>00299                 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 2)
<a name="l00302"></a>00302                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a11c29f149a34225fa07821dc05499ba4">B43_NPHY_BPHY_CTL3</a>,
<a name="l00303"></a>00303                                 ~<a class="code" href="phy__n_8h.html#a436836b0c6c70530242c85f1fcd4540d">B43_NPHY_BPHY_CTL3_SCALE</a>, 0x53);
<a name="l00304"></a>00304                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l00305"></a>00305                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a11c29f149a34225fa07821dc05499ba4">B43_NPHY_BPHY_CTL3</a>,
<a name="l00306"></a>00306                                 ~<a class="code" href="phy__n_8h.html#a436836b0c6c70530242c85f1fcd4540d">B43_NPHY_BPHY_CTL3_SCALE</a>, 0x5A);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2 &amp;&amp; dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>)
<a name="l00309"></a>00309                         <a class="code" href="main_8c.html#abbb7dc97d3d48c3504e1c35b366407ad">b43_hf_write</a>(dev, <a class="code" href="main_8c.html#a3f3a1d36e1882927e495fa890efbbe97">b43_hf_read</a>(dev) | <a class="code" href="b43_8h.html#a1c1437bf08622f44b08f28f77d487338">B43_HF_TSSIRPSMW</a>);
<a name="l00310"></a>00310         } <span class="keywordflow">else</span> {
<a name="l00311"></a>00311                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(26, 64), 84,
<a name="l00312"></a>00312                                     nphy-&gt;<a class="code" href="structb43__phy__n.html#a32f16eb28246b7490d21d2545a4e60df">adj_pwr_tbl</a>);
<a name="l00313"></a>00313                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(27, 64), 84,
<a name="l00314"></a>00314                                     nphy-&gt;<a class="code" href="structb43__phy__n.html#a32f16eb28246b7490d21d2545a4e60df">adj_pwr_tbl</a>);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316                 bmask = <a class="code" href="phy__n_8h.html#a9790106475ad3ec4bd981c36ae781eff">B43_NPHY_TXPCTL_CMD_COEFF</a> |
<a name="l00317"></a>00317                         <a class="code" href="phy__n_8h.html#a632299487f241693ed91fe2654c5766a">B43_NPHY_TXPCTL_CMD_HWPCTLEN</a>;
<a name="l00318"></a>00318                 <span class="comment">/* wl does useless check for &quot;enable&quot; param here */</span>
<a name="l00319"></a>00319                 val = <a class="code" href="phy__n_8h.html#a9790106475ad3ec4bd981c36ae781eff">B43_NPHY_TXPCTL_CMD_COEFF</a> | <a class="code" href="phy__n_8h.html#a632299487f241693ed91fe2654c5766a">B43_NPHY_TXPCTL_CMD_HWPCTLEN</a>;
<a name="l00320"></a>00320                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00321"></a>00321                         bmask |= <a class="code" href="phy__n_8h.html#a66731c7783b2a95aa92664a14b01d37a">B43_NPHY_TXPCTL_CMD_PCTLEN</a>;
<a name="l00322"></a>00322                         <span class="keywordflow">if</span> (val)
<a name="l00323"></a>00323                                 val |= <a class="code" href="phy__n_8h.html#a66731c7783b2a95aa92664a14b01d37a">B43_NPHY_TXPCTL_CMD_PCTLEN</a>;
<a name="l00324"></a>00324                 }
<a name="l00325"></a>00325                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a7261b7587a69d65667b6dbf746143477">B43_NPHY_TXPCTL_CMD</a>, ~(bmask), val);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327                 <span class="keywordflow">if</span> (band == IEEE80211_BAND_5GHZ) {
<a name="l00328"></a>00328                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a7261b7587a69d65667b6dbf746143477">B43_NPHY_TXPCTL_CMD</a>,
<a name="l00329"></a>00329                                         ~<a class="code" href="phy__n_8h.html#a4529202a285ac0ac7e85e046377c3070">B43_NPHY_TXPCTL_CMD_INIT</a>, 0x64);
<a name="l00330"></a>00330                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt; 1)
<a name="l00331"></a>00331                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a9e348202e68e3487783dc7495b55c7b3">B43_NPHY_TXPCTL_INIT</a>,
<a name="l00332"></a>00332                                                 ~<a class="code" href="phy__n_8h.html#af8e1201a092b3e6670120d1500449493">B43_NPHY_TXPCTL_INIT_PIDXI1</a>,
<a name="l00333"></a>00333                                                 0x64);
<a name="l00334"></a>00334                 }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00337"></a>00337                         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[0] != 128 &amp;&amp;
<a name="l00338"></a>00338                             nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[1] != 128) {
<a name="l00339"></a>00339                                 <span class="comment">/* Recover TX pwr ctl state */</span>
<a name="l00340"></a>00340                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a7261b7587a69d65667b6dbf746143477">B43_NPHY_TXPCTL_CMD</a>,
<a name="l00341"></a>00341                                                 ~<a class="code" href="phy__n_8h.html#a4529202a285ac0ac7e85e046377c3070">B43_NPHY_TXPCTL_CMD_INIT</a>,
<a name="l00342"></a>00342                                                 nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[0]);
<a name="l00343"></a>00343                                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt; 1)
<a name="l00344"></a>00344                                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev,
<a name="l00345"></a>00345                                                 <a class="code" href="phy__n_8h.html#a9e348202e68e3487783dc7495b55c7b3">B43_NPHY_TXPCTL_INIT</a>,
<a name="l00346"></a>00346                                                 ~0xff, nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[1]);
<a name="l00347"></a>00347                         }
<a name="l00348"></a>00348                 }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00351"></a>00351                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, ~0x100);
<a name="l00352"></a>00352                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, ~0x100);
<a name="l00353"></a>00353                 } <span class="keywordflow">else</span> {
<a name="l00354"></a>00354                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, ~0x4000);
<a name="l00355"></a>00355                 }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 2)
<a name="l00358"></a>00358                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a11c29f149a34225fa07821dc05499ba4">B43_NPHY_BPHY_CTL3</a>, ~0xFF, 0x3b);
<a name="l00359"></a>00359                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l00360"></a>00360                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a11c29f149a34225fa07821dc05499ba4">B43_NPHY_BPHY_CTL3</a>, ~0xFF, 0x40);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2 &amp;&amp; dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>)
<a name="l00363"></a>00363                         <a class="code" href="main_8c.html#abbb7dc97d3d48c3504e1c35b366407ad">b43_hf_write</a>(dev, <a class="code" href="main_8c.html#a3f3a1d36e1882927e495fa890efbbe97">b43_hf_read</a>(dev) &amp; ~<a class="code" href="b43_8h.html#a1c1437bf08622f44b08f28f77d487338">B43_HF_TSSIRPSMW</a>);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365                 <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev)) {
<a name="l00366"></a>00366                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>, ~0x4);
<a name="l00367"></a>00367                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>, ~0x4);
<a name="l00368"></a>00368                 }
<a name="l00369"></a>00369         }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l00372"></a>00372                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxPwrFix */</span>
<a name="l00376"></a><a class="code" href="phy__n_8c.html#a066ab280f4c7812265b2874e4051676c">00376</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a066ab280f4c7812265b2874e4051676c">b43_nphy_tx_power_fix</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00377"></a>00377 {
<a name="l00378"></a>00378         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l00379"></a>00379         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         u8 txpi[2], bbmult, i;
<a name="l00382"></a>00382         u16 tmp, radio_gain, dac_gain;
<a name="l00383"></a>00383         u16 freq = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#abb1fefe6c1dad17ef8a19818669a1d01">channel_freq</a>;
<a name="l00384"></a>00384         u32 txgain;
<a name="l00385"></a>00385         <span class="comment">/* u32 gaintbl; rev3+ */</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l00388"></a>00388                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00391"></a>00391                 txpi[0] = 40;
<a name="l00392"></a>00392                 txpi[1] = 40;
<a name="l00393"></a>00393         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sprom-&gt;revision &lt; 4) {
<a name="l00394"></a>00394                 txpi[0] = 72;
<a name="l00395"></a>00395                 txpi[1] = 72;
<a name="l00396"></a>00396         } <span class="keywordflow">else</span> {
<a name="l00397"></a>00397                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l00398"></a>00398                         txpi[0] = sprom-&gt;txpid2g[0];
<a name="l00399"></a>00399                         txpi[1] = sprom-&gt;txpid2g[1];
<a name="l00400"></a>00400                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freq &gt;= 4900 &amp;&amp; freq &lt; 5100) {
<a name="l00401"></a>00401                         txpi[0] = sprom-&gt;txpid5gl[0];
<a name="l00402"></a>00402                         txpi[1] = sprom-&gt;txpid5gl[1];
<a name="l00403"></a>00403                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freq &gt;= 5100 &amp;&amp; freq &lt; 5500) {
<a name="l00404"></a>00404                         txpi[0] = sprom-&gt;txpid5g[0];
<a name="l00405"></a>00405                         txpi[1] = sprom-&gt;txpid5g[1];
<a name="l00406"></a>00406                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freq &gt;= 5500) {
<a name="l00407"></a>00407                         txpi[0] = sprom-&gt;txpid5gh[0];
<a name="l00408"></a>00408                         txpi[1] = sprom-&gt;txpid5gh[1];
<a name="l00409"></a>00409                 } <span class="keywordflow">else</span> {
<a name="l00410"></a>00410                         txpi[0] = 91;
<a name="l00411"></a>00411                         txpi[1] = 91;
<a name="l00412"></a>00412                 }
<a name="l00413"></a>00413         }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415         <span class="comment">/*</span>
<a name="l00416"></a>00416 <span class="comment">        for (i = 0; i &lt; 2; i++) {</span>
<a name="l00417"></a>00417 <span class="comment">                nphy-&gt;txpwrindex[i].index_internal = txpi[i];</span>
<a name="l00418"></a>00418 <span class="comment">                nphy-&gt;txpwrindex[i].index_internal_save = txpi[i];</span>
<a name="l00419"></a>00419 <span class="comment">        }</span>
<a name="l00420"></a>00420 <span class="comment">        */</span>
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l00423"></a>00423                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00424"></a>00424                         <span class="comment">/* FIXME: support 5GHz */</span>
<a name="l00425"></a>00425                         txgain = <a class="code" href="tables__nphy_8c.html#a5d7f7b5d0eb1540b158d0c1698040b0e">b43_ntab_tx_gain_rev3plus_2ghz</a>[txpi[i]];
<a name="l00426"></a>00426                         radio_gain = (txgain &gt;&gt; 16) &amp; 0x1FFFF;
<a name="l00427"></a>00427                 } <span class="keywordflow">else</span> {
<a name="l00428"></a>00428                         txgain = <a class="code" href="tables__nphy_8c.html#a11dd66959e9a473e3513b9669312f0fc">b43_ntab_tx_gain_rev0_1_2</a>[txpi[i]];
<a name="l00429"></a>00429                         radio_gain = (txgain &gt;&gt; 16) &amp; 0x1FFF;
<a name="l00430"></a>00430                 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432                 dac_gain = (txgain &gt;&gt; 8) &amp; 0x3F;
<a name="l00433"></a>00433                 bbmult = txgain &amp; 0xFF;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00436"></a>00436                         <span class="keywordflow">if</span> (i == 0)
<a name="l00437"></a>00437                                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, 0x0100);
<a name="l00438"></a>00438                         <span class="keywordflow">else</span>
<a name="l00439"></a>00439                                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0x0100);
<a name="l00440"></a>00440                 } <span class="keywordflow">else</span> {
<a name="l00441"></a>00441                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0x4000);
<a name="l00442"></a>00442                 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444                 <span class="keywordflow">if</span> (i == 0)
<a name="l00445"></a>00445                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#afaecb3e915f8d35faba2e20c99624354">B43_NPHY_AFECTL_DACGAIN1</a>, dac_gain);
<a name="l00446"></a>00446                 <span class="keywordflow">else</span>
<a name="l00447"></a>00447                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5ef6eb20496f39c5344acee5522ba980">B43_NPHY_AFECTL_DACGAIN2</a>, dac_gain);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(0x7, 0x110 + i), radio_gain);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451                 tmp = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(0xF, 0x57));
<a name="l00452"></a>00452                 <span class="keywordflow">if</span> (i == 0)
<a name="l00453"></a>00453                         tmp = (tmp &amp; 0x00FF) | (bbmult &lt;&lt; 8);
<a name="l00454"></a>00454                 <span class="keywordflow">else</span>
<a name="l00455"></a>00455                         tmp = (tmp &amp; 0xFF00) | bbmult;
<a name="l00456"></a>00456                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(0xF, 0x57), tmp);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458                 <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev)) {
<a name="l00459"></a>00459                         u32 tmp32;
<a name="l00460"></a>00460                         u16 reg = (i == 0) ?
<a name="l00461"></a>00461                                 <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a> : <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>;
<a name="l00462"></a>00462                         tmp32 = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(26 + i, txpi[i]));
<a name="l00463"></a>00463                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, 0xE00F, (u32) tmp32 &lt;&lt; 4);
<a name="l00464"></a>00464                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, reg, 0x4);
<a name="l00465"></a>00465                 }
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#adf53bb7e9bf71f10b2d0b871a27445c6">B43_NPHY_BPHY_CTL2</a>, ~<a class="code" href="phy__n_8h.html#a8974b11bfadb00aa7296c378cae9f08f">B43_NPHY_BPHY_CTL2_LUT</a>);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l00471"></a>00471                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="phy__n_8c.html#a64d6a4b61bb63123bc20c1b8946e686c">00474</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a64d6a4b61bb63123bc20c1b8946e686c">b43_nphy_tx_gain_table_upload</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="keyword">const</span> u32 *table = NULL;
<a name="l00479"></a>00479 <span class="preprocessor">#if 0</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span>        TODO: b43_ntab_papd_pga_gain_delta_ipa_2*
<a name="l00481"></a>00481         u32 rfpwr_offset;
<a name="l00482"></a>00482         u8 pga_gain;
<a name="l00483"></a>00483         <span class="keywordtype">int</span> i;
<a name="l00484"></a>00484 <span class="preprocessor">#endif</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span>
<a name="l00486"></a>00486         <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00487"></a>00487                 <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev)) {
<a name="l00488"></a>00488                         table = <a class="code" href="phy__n_8c.html#ac9b997a0f7b74f5bcef62e050308b960">b43_nphy_get_ipa_gain_table</a>(dev);
<a name="l00489"></a>00489                 } <span class="keywordflow">else</span> {
<a name="l00490"></a>00490                         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) {
<a name="l00491"></a>00491                                 <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 3)
<a name="l00492"></a>00492                                         table = <a class="code" href="tables__nphy_8c.html#a217255eebd4a50d97bd007e3dd435510">b43_ntab_tx_gain_rev3_5ghz</a>;
<a name="l00493"></a>00493                                 <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 4)
<a name="l00494"></a>00494                                         table = <a class="code" href="tables__nphy_8c.html#afbcb4a9011f2e2b32f2670ad0c2d9a10">b43_ntab_tx_gain_rev4_5ghz</a>;
<a name="l00495"></a>00495                                 <span class="keywordflow">else</span>
<a name="l00496"></a>00496                                         table = <a class="code" href="tables__nphy_8c.html#a0beae01530e45f0c2b14009e60ff3810">b43_ntab_tx_gain_rev5plus_5ghz</a>;
<a name="l00497"></a>00497                         } <span class="keywordflow">else</span> {
<a name="l00498"></a>00498                                 table = <a class="code" href="tables__nphy_8c.html#a5d7f7b5d0eb1540b158d0c1698040b0e">b43_ntab_tx_gain_rev3plus_2ghz</a>;
<a name="l00499"></a>00499                         }
<a name="l00500"></a>00500                 }
<a name="l00501"></a>00501         } <span class="keywordflow">else</span> {
<a name="l00502"></a>00502                 table = <a class="code" href="tables__nphy_8c.html#a11dd66959e9a473e3513b9669312f0fc">b43_ntab_tx_gain_rev0_1_2</a>;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(26, 192), 128, table);
<a name="l00505"></a>00505         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(27, 192), 128, table);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00508"></a>00508 <span class="preprocessor">#if 0</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>                nphy-&gt;gmval = (table[0] &gt;&gt; 16) &amp; 0x7000;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511                 <span class="keywordflow">for</span> (i = 0; i &lt; 128; i++) {
<a name="l00512"></a>00512                         pga_gain = (table[i] &gt;&gt; 24) &amp; 0xF;
<a name="l00513"></a>00513                         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l00514"></a>00514                                 rfpwr_offset = b43_ntab_papd_pga_gain_delta_ipa_2g[pga_gain];
<a name="l00515"></a>00515                         <span class="keywordflow">else</span>
<a name="l00516"></a>00516                                 rfpwr_offset = b43_ntab_papd_pga_gain_delta_ipa_5g[pga_gain];
<a name="l00517"></a>00517                         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(26, 576 + i),
<a name="l00518"></a>00518                                        rfpwr_offset);
<a name="l00519"></a>00519                         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(27, 576 + i),
<a name="l00520"></a>00520                                        rfpwr_offset);
<a name="l00521"></a>00521                 }
<a name="l00522"></a>00522 <span class="preprocessor">#endif</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span>        }
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/Radio/2055Setup */</span>
<a name="l00527"></a><a class="code" href="phy__n_8c.html#acf44bb93018579618a7a644c76af4330">00527</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#acf44bb93018579618a7a644c76af4330">b43_radio_2055_setup</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00528"></a>00528                                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structb43__nphy__channeltab__entry__rev2.html">b43_nphy_channeltab_entry_rev2</a> *e)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <a class="code" href="phy__n_8c.html#a8a3c395aa194168166c398b4ed817ece">b43_chantab_radio_upload</a>(dev, e);
<a name="l00533"></a>00533         udelay(50);
<a name="l00534"></a>00534         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a483c81dde3add05a5eb6ce9e0b287f47">B2055_VCO_CAL10</a>, 0x05);
<a name="l00535"></a>00535         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a483c81dde3add05a5eb6ce9e0b287f47">B2055_VCO_CAL10</a>, 0x45);
<a name="l00536"></a>00536         <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>); <span class="comment">/* flush writes */</span>
<a name="l00537"></a>00537         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a483c81dde3add05a5eb6ce9e0b287f47">B2055_VCO_CAL10</a>, 0x65);
<a name="l00538"></a>00538         udelay(300);
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="phy__n_8c.html#abbb2e301de35825f7daabe4cc0432ed3">00541</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#abbb2e301de35825f7daabe4cc0432ed3">b43_radio_init2055_pre</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l00544"></a>00544                      ~<a class="code" href="phy__n_8h.html#a00f29d2eca89557d3ec1ada2b34913b7">B43_NPHY_RFCTL_CMD_PORFORCE</a>);
<a name="l00545"></a>00545         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l00546"></a>00546                     <a class="code" href="phy__n_8h.html#a3bd6cc35e5f020741ff59f50b37cbd4d">B43_NPHY_RFCTL_CMD_CHIP0PU</a> |
<a name="l00547"></a>00547                     <a class="code" href="phy__n_8h.html#a28b8942b7f9aed8133456bf72da2744b">B43_NPHY_RFCTL_CMD_OEPORFORCE</a>);
<a name="l00548"></a>00548         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l00549"></a>00549                     <a class="code" href="phy__n_8h.html#a00f29d2eca89557d3ec1ada2b34913b7">B43_NPHY_RFCTL_CMD_PORFORCE</a>);
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a><a class="code" href="phy__n_8c.html#a7e116e24a523f393bcabc0b7ff2a6475">00552</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a7e116e24a523f393bcabc0b7ff2a6475">b43_radio_init2055_post</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l00555"></a>00555         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l00556"></a>00556         <span class="keywordtype">int</span> i;
<a name="l00557"></a>00557         u16 val;
<a name="l00558"></a>00558         <span class="keywordtype">bool</span> workaround = <span class="keyword">false</span>;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         <span class="keywordflow">if</span> (sprom-&gt;revision &lt; 4)
<a name="l00561"></a>00561                 workaround = (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a7b61688d8f77fe253308150f344eb259">board_vendor</a> != PCI_VENDOR_ID_BROADCOM
<a name="l00562"></a>00562                               &amp;&amp; dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a8225eee827fd5a0c40849625fbf88330">board_type</a> == 0x46D
<a name="l00563"></a>00563                               &amp;&amp; dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a88860ae223915f56e0ab6eb933369046">board_rev</a> &gt;= 0x41);
<a name="l00564"></a>00564         <span class="keywordflow">else</span>
<a name="l00565"></a>00565                 workaround =
<a name="l00566"></a>00566                         !(sprom-&gt;boardflags2_lo &amp; <a class="code" href="b43_8h.html#ada4bf27576932a4b6a26746b1bae36d4">B43_BFL2_RXBB_INT_REG_DIS</a>);
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#adf217fab896f5f40b6a08e83c887bfdf">B2055_MASTER1</a>, 0xFFF3);
<a name="l00569"></a>00569         <span class="keywordflow">if</span> (workaround) {
<a name="l00570"></a>00570                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#aff7fdfd494fd018aac3b2a720e457629">B2055_C1_RX_BB_REG</a>, 0x7F);
<a name="l00571"></a>00571                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#ac96633dd3d867c4cbe9a7ee360caadfb">B2055_C2_RX_BB_REG</a>, 0x7F);
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a943dd5bf6f53d7050a0e1e0a48ceec20">B2055_RRCCAL_NOPTSEL</a>, 0xFFC0, 0x2C);
<a name="l00574"></a>00574         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a253a6b67e8e9c2ec69ecca3c3b5e4dff">B2055_CAL_MISC</a>, 0x3C);
<a name="l00575"></a>00575         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a253a6b67e8e9c2ec69ecca3c3b5e4dff">B2055_CAL_MISC</a>, 0xFFBE);
<a name="l00576"></a>00576         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#aff6aaf13ba7197a074386070abd783dc">B2055_CAL_LPOCTL</a>, 0x80);
<a name="l00577"></a>00577         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#a253a6b67e8e9c2ec69ecca3c3b5e4dff">B2055_CAL_MISC</a>, 0x1);
<a name="l00578"></a>00578         msleep(1);
<a name="l00579"></a>00579         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#a253a6b67e8e9c2ec69ecca3c3b5e4dff">B2055_CAL_MISC</a>, 0x40);
<a name="l00580"></a>00580         <span class="keywordflow">for</span> (i = 0; i &lt; 200; i++) {
<a name="l00581"></a>00581                 val = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="radio__2055_8h.html#a380822301c9ec4ddcc73ed5fb74fc2f0">B2055_CAL_COUT2</a>);
<a name="l00582"></a>00582                 <span class="keywordflow">if</span> (val &amp; 0x80) {
<a name="l00583"></a>00583                         i = 0;
<a name="l00584"></a>00584                         <span class="keywordflow">break</span>;
<a name="l00585"></a>00585                 }
<a name="l00586"></a>00586                 udelay(10);
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588         <span class="keywordflow">if</span> (i)
<a name="l00589"></a>00589                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;radio post init timeout\n&quot;</span>);
<a name="l00590"></a>00590         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#aff6aaf13ba7197a074386070abd783dc">B2055_CAL_LPOCTL</a>, 0xFF7F);
<a name="l00591"></a>00591         <a class="code" href="phy__common_8c.html#a2efed98acfe2e35f6199b0e608e4a18c">b43_switch_channel</a>(dev, dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a68e5573cadabc1462bb752eefec9c599">channel</a>);
<a name="l00592"></a>00592         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#ac66d582f1bd1d6df6db3ee60eb841265">B2055_C1_RX_BB_LPF</a>, 0x9);
<a name="l00593"></a>00593         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a2692664d713e456b6c6160bd626b862c">B2055_C2_RX_BB_LPF</a>, 0x9);
<a name="l00594"></a>00594         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#a19dbd0b3e177bafd8ee9af05cdd1f87a">B2055_C1_RX_BB_MIDACHP</a>, 0x83);
<a name="l00595"></a>00595         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2055_8h.html#acd9bb232aae7cffaa5be3a1fc773cb2c">B2055_C2_RX_BB_MIDACHP</a>, 0x83);
<a name="l00596"></a>00596         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#ae71e4f3bc26c6481a290138a7e60abd3">B2055_C1_LNA_GAINBST</a>, 0xFFF8, 0x6);
<a name="l00597"></a>00597         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a666580f093fe78d60804b34485c0b2e2">B2055_C2_LNA_GAINBST</a>, 0xFFF8, 0x6);
<a name="l00598"></a>00598         <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#aad6f3e9be30a5f527804da2d4d0415a5">gain_boost</a>) {
<a name="l00599"></a>00599                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#aa0443340b2d59390c82f8673a371e2d4">B2055_C1_RX_RFSPC1</a>, 0x2);
<a name="l00600"></a>00600                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#a3f1991c47b816ddd081ecb38e78e1800">B2055_C2_RX_RFSPC1</a>, 0x2);
<a name="l00601"></a>00601         } <span class="keywordflow">else</span> {
<a name="l00602"></a>00602                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#aa0443340b2d59390c82f8673a371e2d4">B2055_C1_RX_RFSPC1</a>, 0xFFFD);
<a name="l00603"></a>00603                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a3f1991c47b816ddd081ecb38e78e1800">B2055_C2_RX_RFSPC1</a>, 0xFFFD);
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605         udelay(2);
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 <span class="comment">/*</span>
<a name="l00609"></a>00609 <span class="comment"> * Initialize a Broadcom 2055 N-radio</span>
<a name="l00610"></a>00610 <span class="comment"> * http://bcm-v4.sipsolutions.net/802.11/Radio/2055/Init</span>
<a name="l00611"></a>00611 <span class="comment"> */</span>
<a name="l00612"></a><a class="code" href="phy__n_8c.html#a7e95ea4378f8442fe75be6c84f502b90">00612</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a7e95ea4378f8442fe75be6c84f502b90">b43_radio_init2055</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00613"></a>00613 {
<a name="l00614"></a>00614         <a class="code" href="phy__n_8c.html#abbb2e301de35825f7daabe4cc0432ed3">b43_radio_init2055_pre</a>(dev);
<a name="l00615"></a>00615         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#a6c3bdf50bac1e19b0f6e3516750c4331">b43_status</a>(dev) &lt; <a class="code" href="b43_8h.html#abc6126af1d45847bc59afa0aa3216b04add6b34ef5b27600fa828a406e9ef9d8c">B43_STAT_INITIALIZED</a>) {
<a name="l00616"></a>00616                 <span class="comment">/* Follow wl, not specs. Do not force uploading all regs */</span>
<a name="l00617"></a>00617                 <a class="code" href="radio__2055_8c.html#a7dfdd31537684e8ae8ed3ae5d50c5270">b2055_upload_inittab</a>(dev, 0, 0);
<a name="l00618"></a>00618         } <span class="keywordflow">else</span> {
<a name="l00619"></a>00619                 <span class="keywordtype">bool</span> ghz5 = <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ;
<a name="l00620"></a>00620                 <a class="code" href="radio__2055_8c.html#a7dfdd31537684e8ae8ed3ae5d50c5270">b2055_upload_inittab</a>(dev, ghz5, 0);
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622         <a class="code" href="phy__n_8c.html#a7e116e24a523f393bcabc0b7ff2a6475">b43_radio_init2055_post</a>(dev);
<a name="l00623"></a>00623 }
<a name="l00624"></a>00624 
<a name="l00625"></a><a class="code" href="phy__n_8c.html#a7eea318eb87455e354452e7c5f08e2c1">00625</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a7eea318eb87455e354452e7c5f08e2c1">b43_radio_init2056_pre</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00626"></a>00626 {
<a name="l00627"></a>00627         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l00628"></a>00628                      ~<a class="code" href="phy__n_8h.html#a3bd6cc35e5f020741ff59f50b37cbd4d">B43_NPHY_RFCTL_CMD_CHIP0PU</a>);
<a name="l00629"></a>00629         <span class="comment">/* Maybe wl meant to reset and set (order?) RFCTL_CMD_OEPORFORCE? */</span>
<a name="l00630"></a>00630         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l00631"></a>00631                      <a class="code" href="phy__n_8h.html#a28b8942b7f9aed8133456bf72da2744b">B43_NPHY_RFCTL_CMD_OEPORFORCE</a>);
<a name="l00632"></a>00632         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l00633"></a>00633                     ~<a class="code" href="phy__n_8h.html#a28b8942b7f9aed8133456bf72da2744b">B43_NPHY_RFCTL_CMD_OEPORFORCE</a>);
<a name="l00634"></a>00634         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l00635"></a>00635                     <a class="code" href="phy__n_8h.html#a3bd6cc35e5f020741ff59f50b37cbd4d">B43_NPHY_RFCTL_CMD_CHIP0PU</a>);
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a><a class="code" href="phy__n_8c.html#a0077a58b79546f2d34652cdf23194598">00638</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a0077a58b79546f2d34652cdf23194598">b43_radio_init2056_post</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00639"></a>00639 {
<a name="l00640"></a>00640         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2056_8h.html#ad2eaba506d5582ff83587f29634aa7af">B2056_SYN_COM_CTRL</a>, 0xB);
<a name="l00641"></a>00641         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2056_8h.html#a6da9559dc1223a11ad65770e16ce3b6c">B2056_SYN_COM_PU</a>, 0x2);
<a name="l00642"></a>00642         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2056_8h.html#a3d0bbf68ee5830aef1b3b6b4339c53b8">B2056_SYN_COM_RESET</a>, 0x2);
<a name="l00643"></a>00643         msleep(1);
<a name="l00644"></a>00644         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2056_8h.html#a3d0bbf68ee5830aef1b3b6b4339c53b8">B2056_SYN_COM_RESET</a>, ~0x2);
<a name="l00645"></a>00645         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2056_8h.html#a5ff84a301e5d87106674283906f01090">B2056_SYN_PLL_MAST2</a>, ~0xFC);
<a name="l00646"></a>00646         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2056_8h.html#a15adc546d1c0f8525f065110b29aeaa8">B2056_SYN_RCCAL_CTRL0</a>, ~0x1);
<a name="l00647"></a>00647         <span class="comment">/*</span>
<a name="l00648"></a>00648 <span class="comment">        if (nphy-&gt;init_por)</span>
<a name="l00649"></a>00649 <span class="comment">                Call Radio 2056 Recalibrate</span>
<a name="l00650"></a>00650 <span class="comment">        */</span>
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 <span class="comment">/*</span>
<a name="l00654"></a>00654 <span class="comment"> * Initialize a Broadcom 2056 N-radio</span>
<a name="l00655"></a>00655 <span class="comment"> * http://bcm-v4.sipsolutions.net/802.11/Radio/2056/Init</span>
<a name="l00656"></a>00656 <span class="comment"> */</span>
<a name="l00657"></a><a class="code" href="phy__n_8c.html#a40e04897a0dde70374829c1516a01a44">00657</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a40e04897a0dde70374829c1516a01a44">b43_radio_init2056</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00658"></a>00658 {
<a name="l00659"></a>00659         <a class="code" href="phy__n_8c.html#a7eea318eb87455e354452e7c5f08e2c1">b43_radio_init2056_pre</a>(dev);
<a name="l00660"></a>00660         <a class="code" href="radio__2056_8c.html#a1d9dfb5f283b1faf137a1709667f582f">b2056_upload_inittabs</a>(dev, 0, 0);
<a name="l00661"></a>00661         <a class="code" href="phy__n_8c.html#a0077a58b79546f2d34652cdf23194598">b43_radio_init2056_post</a>(dev);
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 <span class="comment">/*</span>
<a name="l00665"></a>00665 <span class="comment"> * Upload the N-PHY tables.</span>
<a name="l00666"></a>00666 <span class="comment"> * http://bcm-v4.sipsolutions.net/802.11/PHY/N/InitTables</span>
<a name="l00667"></a>00667 <span class="comment"> */</span>
<a name="l00668"></a><a class="code" href="phy__n_8c.html#a258051a298be730a8f5fe82dc3ef5cbf">00668</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a258051a298be730a8f5fe82dc3ef5cbf">b43_nphy_tables_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00669"></a>00669 {
<a name="l00670"></a>00670         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3)
<a name="l00671"></a>00671                 <a class="code" href="tables__nphy_8c.html#ab131d6d1473de9591f814f32301d9d35">b43_nphy_rev0_1_2_tables_init</a>(dev);
<a name="l00672"></a>00672         <span class="keywordflow">else</span>
<a name="l00673"></a>00673                 <a class="code" href="tables__nphy_8c.html#a69a8a56521d48c99eaed24b7581df459">b43_nphy_rev3plus_tables_init</a>(dev);
<a name="l00674"></a>00674 }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/PA%20override */</span>
<a name="l00677"></a><a class="code" href="phy__n_8c.html#ac0cc3805151589ed885c1942b35faf8d">00677</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ac0cc3805151589ed885c1942b35faf8d">b43_nphy_pa_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> enable)
<a name="l00678"></a>00678 {
<a name="l00679"></a>00679         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l00680"></a>00680         <span class="keyword">enum</span> ieee80211_band band;
<a name="l00681"></a>00681         u16 tmp;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="keywordflow">if</span> (!enable) {
<a name="l00684"></a>00684                 nphy-&gt;<a class="code" href="structb43__phy__n.html#adace5210b7aa53341ae456955eec40f7">rfctrl_intc1_save</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l00685"></a>00685                                                        <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>);
<a name="l00686"></a>00686                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a7e415ed5b33c78ac12a38b3de572ce90">rfctrl_intc2_save</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l00687"></a>00687                                                        <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>);
<a name="l00688"></a>00688                 band = <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>);
<a name="l00689"></a>00689                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00690"></a>00690                         <span class="keywordflow">if</span> (band == IEEE80211_BAND_5GHZ)
<a name="l00691"></a>00691                                 tmp = 0x600;
<a name="l00692"></a>00692                         <span class="keywordflow">else</span>
<a name="l00693"></a>00693                                 tmp = 0x480;
<a name="l00694"></a>00694                 } <span class="keywordflow">else</span> {
<a name="l00695"></a>00695                         <span class="keywordflow">if</span> (band == IEEE80211_BAND_5GHZ)
<a name="l00696"></a>00696                                 tmp = 0x180;
<a name="l00697"></a>00697                         <span class="keywordflow">else</span>
<a name="l00698"></a>00698                                 tmp = 0x120;
<a name="l00699"></a>00699                 }
<a name="l00700"></a>00700                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, tmp);
<a name="l00701"></a>00701                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, tmp);
<a name="l00702"></a>00702         } <span class="keywordflow">else</span> {
<a name="l00703"></a>00703                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>,
<a name="l00704"></a>00704                                 nphy-&gt;<a class="code" href="structb43__phy__n.html#adace5210b7aa53341ae456955eec40f7">rfctrl_intc1_save</a>);
<a name="l00705"></a>00705                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>,
<a name="l00706"></a>00706                                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a7e415ed5b33c78ac12a38b3de572ce90">rfctrl_intc2_save</a>);
<a name="l00707"></a>00707         }
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxLpFbw */</span>
<a name="l00711"></a><a class="code" href="phy__n_8c.html#ae2674d5daf2af56886be83175b3d2612">00711</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ae2674d5daf2af56886be83175b3d2612">b43_nphy_tx_lp_fbw</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00712"></a>00712 {
<a name="l00713"></a>00713         u16 tmp;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l00716"></a>00716                 <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev)) {
<a name="l00717"></a>00717                         tmp = 4;
<a name="l00718"></a>00718                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6212a704a2cc30f89caa0c8f0130ceb7">B43_NPHY_TXF_40CO_B32S2</a>,
<a name="l00719"></a>00719                               (((((tmp &lt;&lt; 3) | tmp) &lt;&lt; 3) | tmp) &lt;&lt; 3) | tmp);
<a name="l00720"></a>00720                 }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722                 tmp = 1;
<a name="l00723"></a>00723                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a0f79d4998c3d4806efbd22df82d7d833">B43_NPHY_TXF_40CO_B1S2</a>,
<a name="l00724"></a>00724                               (((((tmp &lt;&lt; 3) | tmp) &lt;&lt; 3) | tmp) &lt;&lt; 3) | tmp);
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726 }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/CCA */</span>
<a name="l00729"></a><a class="code" href="phy__n_8c.html#a6c32257664019e72accdf8fd8cfcc065">00729</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a6c32257664019e72accdf8fd8cfcc065">b43_nphy_reset_cca</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731         u16 bbcfg;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733         <a class="code" href="phy__common_8c.html#ac6b943b8d455a3d3f136fd79636755b0">b43_phy_force_clock</a>(dev, 1);
<a name="l00734"></a>00734         bbcfg = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>);
<a name="l00735"></a>00735         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>, bbcfg | <a class="code" href="phy__n_8h.html#ab1be3e8636909fac2e769d37a806edcb">B43_NPHY_BBCFG_RSTCCA</a>);
<a name="l00736"></a>00736         udelay(1);
<a name="l00737"></a>00737         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>, bbcfg &amp; ~<a class="code" href="phy__n_8h.html#ab1be3e8636909fac2e769d37a806edcb">B43_NPHY_BBCFG_RSTCCA</a>);
<a name="l00738"></a>00738         <a class="code" href="phy__common_8c.html#ac6b943b8d455a3d3f136fd79636755b0">b43_phy_force_clock</a>(dev, 0);
<a name="l00739"></a>00739         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>);
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/MIMOConfig */</span>
<a name="l00743"></a><a class="code" href="phy__n_8c.html#a00be45e897bdb9dcaa6bcb8fdda68ddd">00743</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a00be45e897bdb9dcaa6bcb8fdda68ddd">b43_nphy_update_mimo_config</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, s32 preamble)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745         u16 mimocfg = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#af9923a0bb2645a56b4f6ec34d9570cd1">B43_NPHY_MIMOCFG</a>);
<a name="l00746"></a>00746 
<a name="l00747"></a>00747         mimocfg |= <a class="code" href="phy__n_8h.html#a5665b4058b20ba882159b0226a402b61">B43_NPHY_MIMOCFG_AUTO</a>;
<a name="l00748"></a>00748         <span class="keywordflow">if</span> (preamble == 1)
<a name="l00749"></a>00749                 mimocfg |= <a class="code" href="phy__n_8h.html#a5aa1e73c884a7ae8725039702db824c1">B43_NPHY_MIMOCFG_GFMIX</a>;
<a name="l00750"></a>00750         <span class="keywordflow">else</span>
<a name="l00751"></a>00751                 mimocfg &amp;= ~<a class="code" href="phy__n_8h.html#a5aa1e73c884a7ae8725039702db824c1">B43_NPHY_MIMOCFG_GFMIX</a>;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af9923a0bb2645a56b4f6ec34d9570cd1">B43_NPHY_MIMOCFG</a>, mimocfg);
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/Chains */</span>
<a name="l00757"></a><a class="code" href="phy__n_8c.html#a6777340f0e858303be7efbd3980d7507">00757</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a6777340f0e858303be7efbd3980d7507">b43_nphy_update_txrx_chain</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00758"></a>00758 {
<a name="l00759"></a>00759         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761         <span class="keywordtype">bool</span> <span class="keyword">override</span> = <span class="keyword">false</span>;
<a name="l00762"></a>00762         u16 chain = 0x33;
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#abc71488c2bb6e6278f980f9b5a6016f5">txrx_chain</a> == 0) {
<a name="l00765"></a>00765                 chain = 0x11;
<a name="l00766"></a>00766                 <span class="keyword">override</span> = <span class="keyword">true</span>;
<a name="l00767"></a>00767         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#abc71488c2bb6e6278f980f9b5a6016f5">txrx_chain</a> == 1) {
<a name="l00768"></a>00768                 chain = 0x22;
<a name="l00769"></a>00769                 <span class="keyword">override</span> = <span class="keyword">true</span>;
<a name="l00770"></a>00770         }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>,
<a name="l00773"></a>00773                         ~(<a class="code" href="phy__n_8h.html#af2e86a42ab8dea4b81ee8d83319ab078">B43_NPHY_RFSEQCA_TXEN</a> | <a class="code" href="phy__n_8h.html#a593a96031674c3ef6a1a319482401c91">B43_NPHY_RFSEQCA_RXEN</a>),
<a name="l00774"></a>00774                         chain);
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="keywordflow">if</span> (<span class="keyword">override</span>)
<a name="l00777"></a>00777                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>,
<a name="l00778"></a>00778                                 <a class="code" href="phy__n_8h.html#a144db07efc5c82bbeb82a81da8bec682">B43_NPHY_RFSEQMODE_CAOVER</a>);
<a name="l00779"></a>00779         <span class="keywordflow">else</span>
<a name="l00780"></a>00780                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>,
<a name="l00781"></a>00781                                 ~<a class="code" href="phy__n_8h.html#a144db07efc5c82bbeb82a81da8bec682">B43_NPHY_RFSEQMODE_CAOVER</a>);
<a name="l00782"></a>00782 }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RxIqEst */</span>
<a name="l00785"></a><a class="code" href="phy__n_8c.html#a8a3c6ba5b32aaf4b1f6a73c41421a017">00785</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a8a3c6ba5b32aaf4b1f6a73c41421a017">b43_nphy_rx_iq_est</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keyword">struct</span> <a class="code" href="structnphy__iq__est.html">nphy_iq_est</a> *est,
<a name="l00786"></a>00786                                 u16 samps, u8 time, <span class="keywordtype">bool</span> wait)
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788         <span class="keywordtype">int</span> i;
<a name="l00789"></a>00789         u16 tmp;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2174c751a9d35209496f19c1b60f1974">B43_NPHY_IQEST_SAMCNT</a>, samps);
<a name="l00792"></a>00792         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a14f4f9be61adf911697a670edcf0defb">B43_NPHY_IQEST_WT</a>, ~<a class="code" href="phy__n_8h.html#a0e8e08a30c399766dd949c3ff1188958">B43_NPHY_IQEST_WT_VAL</a>, time);
<a name="l00793"></a>00793         <span class="keywordflow">if</span> (wait)
<a name="l00794"></a>00794                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#ae9fd38bcbf1541fe8b4b807f4cba2df9">B43_NPHY_IQEST_CMD</a>, <a class="code" href="phy__n_8h.html#a62b742282b5c51d8f0a1c3610137f112">B43_NPHY_IQEST_CMD_MODE</a>);
<a name="l00795"></a>00795         <span class="keywordflow">else</span>
<a name="l00796"></a>00796                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ae9fd38bcbf1541fe8b4b807f4cba2df9">B43_NPHY_IQEST_CMD</a>, ~<a class="code" href="phy__n_8h.html#a62b742282b5c51d8f0a1c3610137f112">B43_NPHY_IQEST_CMD_MODE</a>);
<a name="l00797"></a>00797 
<a name="l00798"></a>00798         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#ae9fd38bcbf1541fe8b4b807f4cba2df9">B43_NPHY_IQEST_CMD</a>, <a class="code" href="phy__n_8h.html#adeea0962642fbaab8e2116daad0c266e">B43_NPHY_IQEST_CMD_START</a>);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800         <span class="keywordflow">for</span> (i = 1000; i; i--) {
<a name="l00801"></a>00801                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ae9fd38bcbf1541fe8b4b807f4cba2df9">B43_NPHY_IQEST_CMD</a>);
<a name="l00802"></a>00802                 <span class="keywordflow">if</span> (!(tmp &amp; <a class="code" href="phy__n_8h.html#adeea0962642fbaab8e2116daad0c266e">B43_NPHY_IQEST_CMD_START</a>)) {
<a name="l00803"></a>00803                         est-&gt;<a class="code" href="structnphy__iq__est.html#a6eb4c5fcb2613ee70661f9fd20db497d">i0_pwr</a> = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#aaef7164b6f957d33d0f619037f399cd9">B43_NPHY_IQEST_IPACC_HI0</a>) &lt;&lt; 16) |
<a name="l00804"></a>00804                                         <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#af6685b0a043ac65e73ad57bfbcf17225">B43_NPHY_IQEST_IPACC_LO0</a>);
<a name="l00805"></a>00805                         est-&gt;<a class="code" href="structnphy__iq__est.html#a045646d939baa289ea463fd314d7eef6">q0_pwr</a> = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#aaffb824e7fe383a6c5c7122b8f45495d">B43_NPHY_IQEST_QPACC_HI0</a>) &lt;&lt; 16) |
<a name="l00806"></a>00806                                         <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ab9755214066b0a29938566c92a151a0a">B43_NPHY_IQEST_QPACC_LO0</a>);
<a name="l00807"></a>00807                         est-&gt;<a class="code" href="structnphy__iq__est.html#ad739211347eaba1d59b8def4d38a027d">iq0_prod</a> = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a45f80454590f20872ef34716ad3fc00c">B43_NPHY_IQEST_IQACC_HI0</a>) &lt;&lt; 16) |
<a name="l00808"></a>00808                                         <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a0068ce6012b6509fe364e19fad8eab3a">B43_NPHY_IQEST_IQACC_LO0</a>);
<a name="l00809"></a>00809 
<a name="l00810"></a>00810                         est-&gt;<a class="code" href="structnphy__iq__est.html#a120f95083e6c1eb69e3b93871ccd9c13">i1_pwr</a> = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a84a27343114f1b7655d10cdf6fcbb1f9">B43_NPHY_IQEST_IPACC_HI1</a>) &lt;&lt; 16) |
<a name="l00811"></a>00811                                         <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a153b091f15ca503c9201ca2b0edae1c3">B43_NPHY_IQEST_IPACC_LO1</a>);
<a name="l00812"></a>00812                         est-&gt;<a class="code" href="structnphy__iq__est.html#a1a0aac340444d6754201a3ea11352d80">q1_pwr</a> = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#aad7d09536e647b28cf4d0ad9d72eaac0">B43_NPHY_IQEST_QPACC_HI1</a>) &lt;&lt; 16) |
<a name="l00813"></a>00813                                         <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#aaac74b948f95b403184bf304a170793e">B43_NPHY_IQEST_QPACC_LO1</a>);
<a name="l00814"></a>00814                         est-&gt;<a class="code" href="structnphy__iq__est.html#aa697168545473bbe76ce4ad890bdd4cb">iq1_prod</a> = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a0e6c584c2a435d7c1dfa98b104178499">B43_NPHY_IQEST_IQACC_HI1</a>) &lt;&lt; 16) |
<a name="l00815"></a>00815                                         <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a8f549e2bef4eea416766f7cd428f7f2b">B43_NPHY_IQEST_IQACC_LO1</a>);
<a name="l00816"></a>00816                         <span class="keywordflow">return</span>;
<a name="l00817"></a>00817                 }
<a name="l00818"></a>00818                 udelay(10);
<a name="l00819"></a>00819         }
<a name="l00820"></a>00820         memset(est, 0, <span class="keyword">sizeof</span>(*est));
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RxIqCoeffs */</span>
<a name="l00824"></a><a class="code" href="phy__n_8c.html#ab8bb3c5903d644de759c53635e4d869d">00824</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ab8bb3c5903d644de759c53635e4d869d">b43_nphy_rx_iq_coeffs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> write,
<a name="l00825"></a>00825                                         <span class="keyword">struct</span> <a class="code" href="structb43__phy__n__iq__comp.html">b43_phy_n_iq_comp</a> *pcomp)
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827         <span class="keywordflow">if</span> (write) {
<a name="l00828"></a>00828                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a4681571d70d8aeb389cf5ddd335d9d21">B43_NPHY_C1_RXIQ_COMPA0</a>, pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#acb0890802553598a90c568f8b1b399fd">a0</a>);
<a name="l00829"></a>00829                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ab72d780cabf1f03fc67443e2228d18d0">B43_NPHY_C1_RXIQ_COMPB0</a>, pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#aa43508d0b1e112e59c52e73ea7d8b783">b0</a>);
<a name="l00830"></a>00830                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#adfb92d833117819b331cc40951bd7dc0">B43_NPHY_C2_RXIQ_COMPA1</a>, pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#a7b2b1bbcc2b2fc91b3d3b215f5de1140">a1</a>);
<a name="l00831"></a>00831                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a4d7c6c367278f71cb2eb597f787d9698">B43_NPHY_C2_RXIQ_COMPB1</a>, pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#a5f21f62f5a43a6edd053370ba1b96991">b1</a>);
<a name="l00832"></a>00832         } <span class="keywordflow">else</span> {
<a name="l00833"></a>00833                 pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#acb0890802553598a90c568f8b1b399fd">a0</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4681571d70d8aeb389cf5ddd335d9d21">B43_NPHY_C1_RXIQ_COMPA0</a>);
<a name="l00834"></a>00834                 pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#aa43508d0b1e112e59c52e73ea7d8b783">b0</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ab72d780cabf1f03fc67443e2228d18d0">B43_NPHY_C1_RXIQ_COMPB0</a>);
<a name="l00835"></a>00835                 pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#a7b2b1bbcc2b2fc91b3d3b215f5de1140">a1</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#adfb92d833117819b331cc40951bd7dc0">B43_NPHY_C2_RXIQ_COMPA1</a>);
<a name="l00836"></a>00836                 pcomp-&gt;<a class="code" href="structb43__phy__n__iq__comp.html#a5f21f62f5a43a6edd053370ba1b96991">b1</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4d7c6c367278f71cb2eb597f787d9698">B43_NPHY_C2_RXIQ_COMPB1</a>);
<a name="l00837"></a>00837         }
<a name="l00838"></a>00838 }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 <span class="preprocessor">#if 0</span>
<a name="l00841"></a>00841 <span class="preprocessor"></span><span class="comment">/* Ready but not used anywhere */</span>
<a name="l00842"></a>00842 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RxCalPhyCleanup */</span>
<a name="l00843"></a>00843 <span class="keyword">static</span> <span class="keywordtype">void</span> b43_nphy_rx_cal_phy_cleanup(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 core)
<a name="l00844"></a>00844 {
<a name="l00845"></a>00845         u16 *regs = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>-&gt;<a class="code" href="structb43__phy__n.html#aae79baa7ae67780b12ac8054bf491e16">tx_rx_cal_phy_saveregs</a>;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>, regs[0]);
<a name="l00848"></a>00848         <span class="keywordflow">if</span> (core == 0) {
<a name="l00849"></a>00849                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, regs[1]);
<a name="l00850"></a>00850                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, regs[2]);
<a name="l00851"></a>00851         } <span class="keywordflow">else</span> {
<a name="l00852"></a>00852                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, regs[1]);
<a name="l00853"></a>00853                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, regs[2]);
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, regs[3]);
<a name="l00856"></a>00856         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, regs[4]);
<a name="l00857"></a>00857         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a1a3f176d0383816dc05fb52523c85c71">B43_NPHY_RFCTL_RSSIO1</a>, regs[5]);
<a name="l00858"></a>00858         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ab29867b3d0c83b2debd083003efba46c">B43_NPHY_RFCTL_RSSIO2</a>, regs[6]);
<a name="l00859"></a>00859         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6fd43e203878adf4a3e647ef6a755587">B43_NPHY_TXF_40CO_B1S1</a>, regs[7]);
<a name="l00860"></a>00860         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, regs[8]);
<a name="l00861"></a>00861         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>, regs[9]);
<a name="l00862"></a>00862         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>, regs[10]);
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RxCalPhySetup */</span>
<a name="l00866"></a>00866 <span class="keyword">static</span> <span class="keywordtype">void</span> b43_nphy_rx_cal_phy_setup(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 core)
<a name="l00867"></a>00867 {
<a name="l00868"></a>00868         u8 rxval, txval;
<a name="l00869"></a>00869         u16 *regs = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>-&gt;<a class="code" href="structb43__phy__n.html#aae79baa7ae67780b12ac8054bf491e16">tx_rx_cal_phy_saveregs</a>;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871         regs[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>);
<a name="l00872"></a>00872         <span class="keywordflow">if</span> (core == 0) {
<a name="l00873"></a>00873                 regs[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>);
<a name="l00874"></a>00874                 regs[2] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>);
<a name="l00875"></a>00875         } <span class="keywordflow">else</span> {
<a name="l00876"></a>00876                 regs[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>);
<a name="l00877"></a>00877                 regs[2] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>);
<a name="l00878"></a>00878         }
<a name="l00879"></a>00879         regs[3] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>);
<a name="l00880"></a>00880         regs[4] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>);
<a name="l00881"></a>00881         regs[5] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a1a3f176d0383816dc05fb52523c85c71">B43_NPHY_RFCTL_RSSIO1</a>);
<a name="l00882"></a>00882         regs[6] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ab29867b3d0c83b2debd083003efba46c">B43_NPHY_RFCTL_RSSIO2</a>);
<a name="l00883"></a>00883         regs[7] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6fd43e203878adf4a3e647ef6a755587">B43_NPHY_TXF_40CO_B1S1</a>);
<a name="l00884"></a>00884         regs[8] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>);
<a name="l00885"></a>00885         regs[9] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>);
<a name="l00886"></a>00886         regs[10] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>, ~0x0001);
<a name="l00889"></a>00889         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>, ~0x0001);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>,
<a name="l00892"></a>00892                         ~<a class="code" href="phy__n_8h.html#a5d48856b000b2f93acec50736965c937">B43_NPHY_RFSEQCA_RXDIS</a> &amp; 0xFFFF,
<a name="l00893"></a>00893                         ((1 - core) &lt;&lt; <a class="code" href="phy__n_8h.html#a82faf940c7ffe440fb079422ebc7e2f6">B43_NPHY_RFSEQCA_RXDIS_SHIFT</a>));
<a name="l00894"></a>00894         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>, ~<a class="code" href="phy__n_8h.html#af2e86a42ab8dea4b81ee8d83319ab078">B43_NPHY_RFSEQCA_TXEN</a>,
<a name="l00895"></a>00895                         ((1 - core) &lt;&lt; <a class="code" href="phy__n_8h.html#a667948e8ae405dfb287284016b79e7a2">B43_NPHY_RFSEQCA_TXEN_SHIFT</a>));
<a name="l00896"></a>00896         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>, ~<a class="code" href="phy__n_8h.html#a593a96031674c3ef6a1a319482401c91">B43_NPHY_RFSEQCA_RXEN</a>,
<a name="l00897"></a>00897                         (core &lt;&lt; <a class="code" href="phy__n_8h.html#ac6b74ba549b9cdb9a01638dddece2d6d">B43_NPHY_RFSEQCA_RXEN_SHIFT</a>));
<a name="l00898"></a>00898         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>, ~<a class="code" href="phy__n_8h.html#aec8dfa2b41bb07f390ffa526ae9ac86c">B43_NPHY_RFSEQCA_TXDIS</a>,
<a name="l00899"></a>00899                         (core &lt;&lt; <a class="code" href="phy__n_8h.html#a60aba2d7e87693efb4a41f5647746a9e">B43_NPHY_RFSEQCA_TXDIS_SHIFT</a>));
<a name="l00900"></a>00900 
<a name="l00901"></a>00901         <span class="keywordflow">if</span> (core == 0) {
<a name="l00902"></a>00902                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, ~0x0007);
<a name="l00903"></a>00903                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, 0x0007);
<a name="l00904"></a>00904         } <span class="keywordflow">else</span> {
<a name="l00905"></a>00905                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, ~0x0007);
<a name="l00906"></a>00906                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0x0007);
<a name="l00907"></a>00907         }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909         <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(dev, 2, 0, 3);
<a name="l00910"></a>00910         <a class="code" href="phy__n_8c.html#a7a9358c4ccb7f2049eae9611b1b2e9c6">b43_nphy_rf_control_override</a>(dev, 8, 0, 3, <span class="keyword">false</span>);
<a name="l00911"></a>00911         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a687bba92ab195b6597b210d2dab0faca">B43_RFSEQ_RX2TX</a>);
<a name="l00912"></a>00912 
<a name="l00913"></a>00913         <span class="keywordflow">if</span> (core == 0) {
<a name="l00914"></a>00914                 rxval = 1;
<a name="l00915"></a>00915                 txval = 8;
<a name="l00916"></a>00916         } <span class="keywordflow">else</span> {
<a name="l00917"></a>00917                 rxval = 4;
<a name="l00918"></a>00918                 txval = 2;
<a name="l00919"></a>00919         }
<a name="l00920"></a>00920         <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(dev, 1, rxval, (core + 1));
<a name="l00921"></a>00921         <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(dev, 1, txval, (2 - core));
<a name="l00922"></a>00922 }
<a name="l00923"></a>00923 <span class="preprocessor">#endif</span>
<a name="l00924"></a>00924 <span class="preprocessor"></span>
<a name="l00925"></a>00925 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/CalcRxIqComp */</span>
<a name="l00926"></a><a class="code" href="phy__n_8c.html#a69e2e3d7fe343579496da3da88b786a5">00926</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a69e2e3d7fe343579496da3da88b786a5">b43_nphy_calc_rx_iq_comp</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 mask)
<a name="l00927"></a>00927 {
<a name="l00928"></a>00928         <span class="keywordtype">int</span> i;
<a name="l00929"></a>00929         s32 iq;
<a name="l00930"></a>00930         u32 ii;
<a name="l00931"></a>00931         u32 qq;
<a name="l00932"></a>00932         <span class="keywordtype">int</span> iq_nbits, qq_nbits;
<a name="l00933"></a>00933         <span class="keywordtype">int</span> arsh, brsh;
<a name="l00934"></a>00934         u16 tmp, a, b;
<a name="l00935"></a>00935 
<a name="l00936"></a>00936         <span class="keyword">struct </span><a class="code" href="structnphy__iq__est.html">nphy_iq_est</a> est;
<a name="l00937"></a>00937         <span class="keyword">struct </span><a class="code" href="structb43__phy__n__iq__comp.html">b43_phy_n_iq_comp</a> old;
<a name="l00938"></a>00938         <span class="keyword">struct </span><a class="code" href="structb43__phy__n__iq__comp.html">b43_phy_n_iq_comp</a> new = { };
<a name="l00939"></a>00939         <span class="keywordtype">bool</span> error = <span class="keyword">false</span>;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         <span class="keywordflow">if</span> (mask == 0)
<a name="l00942"></a>00942                 <span class="keywordflow">return</span>;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944         <a class="code" href="phy__n_8c.html#ab8bb3c5903d644de759c53635e4d869d">b43_nphy_rx_iq_coeffs</a>(dev, <span class="keyword">false</span>, &amp;old);
<a name="l00945"></a>00945         <a class="code" href="phy__n_8c.html#ab8bb3c5903d644de759c53635e4d869d">b43_nphy_rx_iq_coeffs</a>(dev, <span class="keyword">true</span>, &amp;<span class="keyword">new</span>);
<a name="l00946"></a>00946         <a class="code" href="phy__n_8c.html#a8a3c6ba5b32aaf4b1f6a73c41421a017">b43_nphy_rx_iq_est</a>(dev, &amp;est, 0x4000, 32, <span class="keyword">false</span>);
<a name="l00947"></a>00947         <span class="keyword">new</span> = old;
<a name="l00948"></a>00948 
<a name="l00949"></a>00949         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l00950"></a>00950                 <span class="keywordflow">if</span> (i == 0 &amp;&amp; (mask &amp; 1)) {
<a name="l00951"></a>00951                         iq = est.<a class="code" href="structnphy__iq__est.html#ad739211347eaba1d59b8def4d38a027d">iq0_prod</a>;
<a name="l00952"></a>00952                         ii = est.<a class="code" href="structnphy__iq__est.html#a6eb4c5fcb2613ee70661f9fd20db497d">i0_pwr</a>;
<a name="l00953"></a>00953                         qq = est.<a class="code" href="structnphy__iq__est.html#a045646d939baa289ea463fd314d7eef6">q0_pwr</a>;
<a name="l00954"></a>00954                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1 &amp;&amp; (mask &amp; 2)) {
<a name="l00955"></a>00955                         iq = est.<a class="code" href="structnphy__iq__est.html#aa697168545473bbe76ce4ad890bdd4cb">iq1_prod</a>;
<a name="l00956"></a>00956                         ii = est.<a class="code" href="structnphy__iq__est.html#a120f95083e6c1eb69e3b93871ccd9c13">i1_pwr</a>;
<a name="l00957"></a>00957                         qq = est.<a class="code" href="structnphy__iq__est.html#a1a0aac340444d6754201a3ea11352d80">q1_pwr</a>;
<a name="l00958"></a>00958                 } <span class="keywordflow">else</span> {
<a name="l00959"></a>00959                         <span class="keywordflow">continue</span>;
<a name="l00960"></a>00960                 }
<a name="l00961"></a>00961 
<a name="l00962"></a>00962                 <span class="keywordflow">if</span> (ii + qq &lt; 2) {
<a name="l00963"></a>00963                         error = <span class="keyword">true</span>;
<a name="l00964"></a>00964                         <span class="keywordflow">break</span>;
<a name="l00965"></a>00965                 }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967                 iq_nbits = fls(abs(iq));
<a name="l00968"></a>00968                 qq_nbits = fls(qq);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970                 arsh = iq_nbits - 20;
<a name="l00971"></a>00971                 <span class="keywordflow">if</span> (arsh &gt;= 0) {
<a name="l00972"></a>00972                         a = -((iq &lt;&lt; (30 - iq_nbits)) + (ii &gt;&gt; (1 + arsh)));
<a name="l00973"></a>00973                         tmp = ii &gt;&gt; arsh;
<a name="l00974"></a>00974                 } <span class="keywordflow">else</span> {
<a name="l00975"></a>00975                         a = -((iq &lt;&lt; (30 - iq_nbits)) + (ii &lt;&lt; (-1 - arsh)));
<a name="l00976"></a>00976                         tmp = ii &lt;&lt; -arsh;
<a name="l00977"></a>00977                 }
<a name="l00978"></a>00978                 <span class="keywordflow">if</span> (tmp == 0) {
<a name="l00979"></a>00979                         error = <span class="keyword">true</span>;
<a name="l00980"></a>00980                         <span class="keywordflow">break</span>;
<a name="l00981"></a>00981                 }
<a name="l00982"></a>00982                 a /= tmp;
<a name="l00983"></a>00983 
<a name="l00984"></a>00984                 brsh = qq_nbits - 11;
<a name="l00985"></a>00985                 <span class="keywordflow">if</span> (brsh &gt;= 0) {
<a name="l00986"></a>00986                         b = (qq &lt;&lt; (31 - qq_nbits));
<a name="l00987"></a>00987                         tmp = ii &gt;&gt; brsh;
<a name="l00988"></a>00988                 } <span class="keywordflow">else</span> {
<a name="l00989"></a>00989                         b = (qq &lt;&lt; (31 - qq_nbits));
<a name="l00990"></a>00990                         tmp = ii &lt;&lt; -brsh;
<a name="l00991"></a>00991                 }
<a name="l00992"></a>00992                 <span class="keywordflow">if</span> (tmp == 0) {
<a name="l00993"></a>00993                         error = <span class="keyword">true</span>;
<a name="l00994"></a>00994                         <span class="keywordflow">break</span>;
<a name="l00995"></a>00995                 }
<a name="l00996"></a>00996                 b = int_sqrt(b / tmp - a * a) - (1 &lt;&lt; 10);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998                 <span class="keywordflow">if</span> (i == 0 &amp;&amp; (mask &amp; 0x1)) {
<a name="l00999"></a>00999                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l01000"></a>01000                                 <span class="keyword">new</span>.a0 = a &amp; 0x3FF;
<a name="l01001"></a>01001                                 <span class="keyword">new</span>.b0 = b &amp; 0x3FF;
<a name="l01002"></a>01002                         } <span class="keywordflow">else</span> {
<a name="l01003"></a>01003                                 <span class="keyword">new</span>.a0 = b &amp; 0x3FF;
<a name="l01004"></a>01004                                 <span class="keyword">new</span>.b0 = a &amp; 0x3FF;
<a name="l01005"></a>01005                         }
<a name="l01006"></a>01006                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1 &amp;&amp; (mask &amp; 0x2)) {
<a name="l01007"></a>01007                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l01008"></a>01008                                 <span class="keyword">new</span>.a1 = a &amp; 0x3FF;
<a name="l01009"></a>01009                                 <span class="keyword">new</span>.b1 = b &amp; 0x3FF;
<a name="l01010"></a>01010                         } <span class="keywordflow">else</span> {
<a name="l01011"></a>01011                                 <span class="keyword">new</span>.a1 = b &amp; 0x3FF;
<a name="l01012"></a>01012                                 <span class="keyword">new</span>.b1 = a &amp; 0x3FF;
<a name="l01013"></a>01013                         }
<a name="l01014"></a>01014                 }
<a name="l01015"></a>01015         }
<a name="l01016"></a>01016 
<a name="l01017"></a>01017         <span class="keywordflow">if</span> (error)
<a name="l01018"></a>01018                 <span class="keyword">new</span> = old;
<a name="l01019"></a>01019 
<a name="l01020"></a>01020         <a class="code" href="phy__n_8c.html#ab8bb3c5903d644de759c53635e4d869d">b43_nphy_rx_iq_coeffs</a>(dev, <span class="keyword">true</span>, &amp;<span class="keyword">new</span>);
<a name="l01021"></a>01021 }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxIqWar */</span>
<a name="l01024"></a><a class="code" href="phy__n_8c.html#a1eb9da138ff11999c577f74a3763db7c">01024</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a1eb9da138ff11999c577f74a3763db7c">b43_nphy_tx_iq_workaround</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01025"></a>01025 {
<a name="l01026"></a>01026         u16 array[4];
<a name="l01027"></a>01027         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(0xF, 0x50), 4, array);
<a name="l01028"></a>01028 
<a name="l01029"></a>01029         <a class="code" href="main_8c.html#a28f7e4e0e4386f41d555003b22b2775f">b43_shm_write16</a>(dev, <a class="code" href="b43_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf1176fce48515a37f9be16ac9d71f782">B43_SHM_SHARED</a>, <a class="code" href="b43_8h.html#aa0732768bb3bad1689538d2da69e186a">B43_SHM_SH_NPHY_TXIQW0</a>, array[0]);
<a name="l01030"></a>01030         <a class="code" href="main_8c.html#a28f7e4e0e4386f41d555003b22b2775f">b43_shm_write16</a>(dev, <a class="code" href="b43_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf1176fce48515a37f9be16ac9d71f782">B43_SHM_SHARED</a>, <a class="code" href="b43_8h.html#a2597e8c5afda76ad518582cc3f8f89ca">B43_SHM_SH_NPHY_TXIQW1</a>, array[1]);
<a name="l01031"></a>01031         <a class="code" href="main_8c.html#a28f7e4e0e4386f41d555003b22b2775f">b43_shm_write16</a>(dev, <a class="code" href="b43_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf1176fce48515a37f9be16ac9d71f782">B43_SHM_SHARED</a>, <a class="code" href="b43_8h.html#a60fe3fe30b044d7dc412c925c90ea008">B43_SHM_SH_NPHY_TXIQW2</a>, array[2]);
<a name="l01032"></a>01032         <a class="code" href="main_8c.html#a28f7e4e0e4386f41d555003b22b2775f">b43_shm_write16</a>(dev, <a class="code" href="b43_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf1176fce48515a37f9be16ac9d71f782">B43_SHM_SHARED</a>, <a class="code" href="b43_8h.html#a27aea6c5c2545912d24a39427f64a047">B43_SHM_SH_NPHY_TXIQW3</a>, array[3]);
<a name="l01033"></a>01033 }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/clip-detection */</span>
<a name="l01036"></a><a class="code" href="phy__n_8c.html#af2521e712e8080e9477e517bb95d774f">01036</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#af2521e712e8080e9477e517bb95d774f">b43_nphy_write_clip_detection</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l01037"></a>01037                                           <span class="keyword">const</span> u16 *clip_st)
<a name="l01038"></a>01038 {
<a name="l01039"></a>01039         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a1a5afe3fc058a1fb9a21bdea6b5b045e">B43_NPHY_C1_CLIP1THRES</a>, clip_st[0]);
<a name="l01040"></a>01040         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a251195b0a3f4a04f59c98710b43add26">B43_NPHY_C2_CLIP1THRES</a>, clip_st[1]);
<a name="l01041"></a>01041 }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/clip-detection */</span>
<a name="l01044"></a><a class="code" href="phy__n_8c.html#a0983793c31f96dd76b680507289a0a2c">01044</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a0983793c31f96dd76b680507289a0a2c">b43_nphy_read_clip_detection</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 *clip_st)
<a name="l01045"></a>01045 {
<a name="l01046"></a>01046         clip_st[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a1a5afe3fc058a1fb9a21bdea6b5b045e">B43_NPHY_C1_CLIP1THRES</a>);
<a name="l01047"></a>01047         clip_st[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a251195b0a3f4a04f59c98710b43add26">B43_NPHY_C2_CLIP1THRES</a>);
<a name="l01048"></a>01048 }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/SuperSwitchInit */</span>
<a name="l01051"></a><a class="code" href="phy__n_8c.html#aea9da9c0c084e02347ea120e25bea994">01051</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#aea9da9c0c084e02347ea120e25bea994">b43_nphy_superswitch_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> init)
<a name="l01052"></a>01052 {
<a name="l01053"></a>01053         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l01054"></a>01054                 <span class="keywordflow">if</span> (!init)
<a name="l01055"></a>01055                         <span class="keywordflow">return</span>;
<a name="l01056"></a>01056                 <span class="keywordflow">if</span> (0 <span class="comment">/* FIXME */</span>) {
<a name="l01057"></a>01057                         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(9, 2), 0x211);
<a name="l01058"></a>01058                         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(9, 3), 0x222);
<a name="l01059"></a>01059                         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(9, 8), 0x144);
<a name="l01060"></a>01060                         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(9, 12), 0x188);
<a name="l01061"></a>01061                 }
<a name="l01062"></a>01062         } <span class="keywordflow">else</span> {
<a name="l01063"></a>01063                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#acf7e4296a0b1253ad7e0ff4dac4b7266">B43_NPHY_GPIO_LOOEN</a>, 0);
<a name="l01064"></a>01064                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a04bf8244bdbf2f10c0f54a44c720af1f">B43_NPHY_GPIO_HIOEN</a>, 0);
<a name="l01065"></a>01065 
<a name="l01066"></a>01066                 <span class="keywordflow">switch</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a880bb9d651e18b4cc58ff060ae06b131">bus_type</a>) {
<a name="l01067"></a>01067 <span class="preprocessor">#ifdef CONFIG_B43_BCMA</span>
<a name="l01068"></a>01068 <span class="preprocessor"></span>                <span class="keywordflow">case</span> B43_BUS_BCMA:
<a name="l01069"></a>01069                         bcma_chipco_gpio_control(&amp;dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#af89341f941e94abb2f8ac6e98dd5c101">bdev</a>-&gt;bus-&gt;drv_cc,
<a name="l01070"></a>01070                                                  0xFC00, 0xFC00);
<a name="l01071"></a>01071                         <span class="keywordflow">break</span>;
<a name="l01072"></a>01072 <span class="preprocessor">#endif</span>
<a name="l01073"></a>01073 <span class="preprocessor"></span><span class="preprocessor">#ifdef CONFIG_B43_SSB</span>
<a name="l01074"></a>01074 <span class="preprocessor"></span>                <span class="keywordflow">case</span> <a class="code" href="bus_8h.html#a7d9e1f255fdc367cca560f2be24647f5a6e49471bf473723b618718b72a3dbc91">B43_BUS_SSB</a>:
<a name="l01075"></a>01075                         ssb_chipco_gpio_control(&amp;dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a68f9a4660126ada1510b28be93e1dd0d">sdev</a>-&gt;bus-&gt;chipco,
<a name="l01076"></a>01076                                                 0xFC00, 0xFC00);
<a name="l01077"></a>01077                         <span class="keywordflow">break</span>;
<a name="l01078"></a>01078 <span class="preprocessor">#endif</span>
<a name="l01079"></a>01079 <span class="preprocessor"></span>                }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081                 <a class="code" href="b43_8h.html#a44d913e8694345c005f13a9a95040cd9">b43_write32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>,
<a name="l01082"></a>01082                         <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>) &amp;
<a name="l01083"></a>01083                         ~<a class="code" href="b43_8h.html#a52816f04c2f9e1d01ba77fbd8896bee4">B43_MACCTL_GPOUTSMSK</a>);
<a name="l01084"></a>01084                 <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a27bd7b58dd16202b1c3a4aeca8f5b22d">B43_MMIO_GPIO_MASK</a>,
<a name="l01085"></a>01085                         <a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#a27bd7b58dd16202b1c3a4aeca8f5b22d">B43_MMIO_GPIO_MASK</a>) | 0xFC00);
<a name="l01086"></a>01086                 <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a17b87c360e5abfabeb656ed071a84350">B43_MMIO_GPIO_CONTROL</a>,
<a name="l01087"></a>01087                         <a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#a17b87c360e5abfabeb656ed071a84350">B43_MMIO_GPIO_CONTROL</a>) &amp; ~0xFC00);
<a name="l01088"></a>01088 
<a name="l01089"></a>01089                 <span class="keywordflow">if</span> (init) {
<a name="l01090"></a>01090                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#afa00537732570ad2e6cc75d3743c2724">B43_NPHY_RFCTL_LUT_TRSW_LO1</a>, 0x2D8);
<a name="l01091"></a>01091                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aad32e1ef14df1e5f3f731d249323c098">B43_NPHY_RFCTL_LUT_TRSW_UP1</a>, 0x301);
<a name="l01092"></a>01092                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9ba68b1479c34a39670a3749ab2a3cd8">B43_NPHY_RFCTL_LUT_TRSW_LO2</a>, 0x2D8);
<a name="l01093"></a>01093                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a08aee022d5720230af2a77e55605b321">B43_NPHY_RFCTL_LUT_TRSW_UP2</a>, 0x301);
<a name="l01094"></a>01094                 }
<a name="l01095"></a>01095         }
<a name="l01096"></a>01096 }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/classifier */</span>
<a name="l01099"></a><a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">01099</a> <span class="keyword">static</span> u16 <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 mask, u16 val)
<a name="l01100"></a>01100 {
<a name="l01101"></a>01101         u16 tmp;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ab42cbe711656a02f56a3e58b8fda73c4">core_rev</a> == 16)
<a name="l01104"></a>01104                 <a class="code" href="main_8c.html#a555504fbafc3537b275e563515f7f6d4">b43_mac_suspend</a>(dev);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106         tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4b7359bff684787da0571792adb0caad">B43_NPHY_CLASSCTL</a>);
<a name="l01107"></a>01107         tmp &amp;= (<a class="code" href="phy__n_8h.html#a65744c150ba1ef9cf80bae2ad32729c2">B43_NPHY_CLASSCTL_CCKEN</a> | <a class="code" href="phy__n_8h.html#a6d79952aa0dce488b21df7c13ff56e48">B43_NPHY_CLASSCTL_OFDMEN</a> |
<a name="l01108"></a>01108                 <a class="code" href="phy__n_8h.html#a23a49dd53b769a5720f226ed444fa824">B43_NPHY_CLASSCTL_WAITEDEN</a>);
<a name="l01109"></a>01109         tmp &amp;= ~mask;
<a name="l01110"></a>01110         tmp |= (val &amp; mask);
<a name="l01111"></a>01111         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a4b7359bff684787da0571792adb0caad">B43_NPHY_CLASSCTL</a>, 0xFFF8, tmp);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ab42cbe711656a02f56a3e58b8fda73c4">core_rev</a> == 16)
<a name="l01114"></a>01114                 <a class="code" href="main_8c.html#a9078cc08815f04ffb2ca7d5e7eaf071c">b43_mac_enable</a>(dev);
<a name="l01115"></a>01115 
<a name="l01116"></a>01116         <span class="keywordflow">return</span> tmp;
<a name="l01117"></a>01117 }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/carriersearch */</span>
<a name="l01120"></a><a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">01120</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> enable)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l01123"></a>01123         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01124"></a>01124 
<a name="l01125"></a>01125         <span class="keywordflow">if</span> (enable) {
<a name="l01126"></a>01126                 <span class="keyword">static</span> <span class="keyword">const</span> u16 clip[] = { 0xFFFF, 0xFFFF };
<a name="l01127"></a>01127                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a791576b0eeeae9e2d40b13eaa890a759">deaf_count</a>++ == 0) {
<a name="l01128"></a>01128                         nphy-&gt;<a class="code" href="structb43__phy__n.html#aa9ec540e92c2e9db0ead91dfa098e4e3">classifier_state</a> = <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 0, 0);
<a name="l01129"></a>01129                         <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 0x7, 0);
<a name="l01130"></a>01130                         <a class="code" href="phy__n_8c.html#a0983793c31f96dd76b680507289a0a2c">b43_nphy_read_clip_detection</a>(dev, nphy-&gt;<a class="code" href="structb43__phy__n.html#ad21fe6d54078db6f1184ddb2b6f7684c">clip_state</a>);
<a name="l01131"></a>01131                         <a class="code" href="phy__n_8c.html#af2521e712e8080e9477e517bb95d774f">b43_nphy_write_clip_detection</a>(dev, clip);
<a name="l01132"></a>01132                 }
<a name="l01133"></a>01133                 <a class="code" href="phy__n_8c.html#a6c32257664019e72accdf8fd8cfcc065">b43_nphy_reset_cca</a>(dev);
<a name="l01134"></a>01134         } <span class="keywordflow">else</span> {
<a name="l01135"></a>01135                 <span class="keywordflow">if</span> (--nphy-&gt;<a class="code" href="structb43__phy__n.html#a791576b0eeeae9e2d40b13eaa890a759">deaf_count</a> == 0) {
<a name="l01136"></a>01136                         <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 0x7, nphy-&gt;<a class="code" href="structb43__phy__n.html#aa9ec540e92c2e9db0ead91dfa098e4e3">classifier_state</a>);
<a name="l01137"></a>01137                         <a class="code" href="phy__n_8c.html#af2521e712e8080e9477e517bb95d774f">b43_nphy_write_clip_detection</a>(dev, nphy-&gt;<a class="code" href="structb43__phy__n.html#ad21fe6d54078db6f1184ddb2b6f7684c">clip_state</a>);
<a name="l01138"></a>01138                 }
<a name="l01139"></a>01139         }
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/stop-playback */</span>
<a name="l01143"></a><a class="code" href="phy__n_8c.html#a8c9f021527e4fc603810a194124b299a">01143</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a8c9f021527e4fc603810a194124b299a">b43_nphy_stop_playback</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01144"></a>01144 {
<a name="l01145"></a>01145         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01146"></a>01146         u16 tmp;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01149"></a>01149                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l01150"></a>01150 
<a name="l01151"></a>01151         tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#aae3fea1fe17a39b1d39fe1445d70e78a">B43_NPHY_SAMP_STAT</a>);
<a name="l01152"></a>01152         <span class="keywordflow">if</span> (tmp &amp; 0x1)
<a name="l01153"></a>01153                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a2c61356acfcd1f02fb85161852ced497">B43_NPHY_SAMP_CMD</a>, <a class="code" href="phy__n_8h.html#acc68c5bff5652a05422d7d70013908c4">B43_NPHY_SAMP_CMD_STOP</a>);
<a name="l01154"></a>01154         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tmp &amp; 0x2)
<a name="l01155"></a>01155                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a9a86c85d2b27f7bf67cf77d2c8deae87">B43_NPHY_IQLOCAL_CMDGCTL</a>, 0x7FFF);
<a name="l01156"></a>01156 
<a name="l01157"></a>01157         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a2c61356acfcd1f02fb85161852ced497">B43_NPHY_SAMP_CMD</a>, ~0x0004);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a625b37ed1b681587417124dcf457de7d">bb_mult_save</a> &amp; 0x80000000) {
<a name="l01160"></a>01160                 tmp = nphy-&gt;<a class="code" href="structb43__phy__n.html#a625b37ed1b681587417124dcf457de7d">bb_mult_save</a> &amp; 0xFFFF;
<a name="l01161"></a>01161                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 87), tmp);
<a name="l01162"></a>01162                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a625b37ed1b681587417124dcf457de7d">bb_mult_save</a> = 0;
<a name="l01163"></a>01163         }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01166"></a>01166                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l01167"></a>01167 }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/SpurWar */</span>
<a name="l01170"></a><a class="code" href="phy__n_8c.html#a6342b7c40316db0192a09c3e9cef5997">01170</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a6342b7c40316db0192a09c3e9cef5997">b43_nphy_spur_workaround</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01171"></a>01171 {
<a name="l01172"></a>01172         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01173"></a>01173 
<a name="l01174"></a>01174         u8 channel = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a68e5573cadabc1462bb752eefec9c599">channel</a>;
<a name="l01175"></a>01175         <span class="keywordtype">int</span> tone[2] = { 57, 58 };
<a name="l01176"></a>01176         u32 noise[2] = { 0x3FF, 0x3FF };
<a name="l01177"></a>01177 
<a name="l01178"></a>01178         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3);
<a name="l01179"></a>01179 
<a name="l01180"></a>01180         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01181"></a>01181                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l01182"></a>01182 
<a name="l01183"></a>01183         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a0b6d681eba10557660e59cc1dbe5a506">gband_spurwar_en</a>) {
<a name="l01184"></a>01184                 <span class="comment">/* TODO: N PHY Adjust Analog Pfbw (7) */</span>
<a name="l01185"></a>01185                 <span class="keywordflow">if</span> (channel == 11 &amp;&amp; dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>)
<a name="l01186"></a>01186                         ; <span class="comment">/* TODO: N PHY Adjust Min Noise Var(2, tone, noise)*/</span>
<a name="l01187"></a>01187                 else
<a name="l01188"></a>01188                         ; <span class="comment">/* TODO: N PHY Adjust Min Noise Var(0, NULL, NULL)*/</span>
<a name="l01189"></a>01189                 <span class="comment">/* TODO: N PHY Adjust CRS Min Power (0x1E) */</span>
<a name="l01190"></a>01190         }
<a name="l01191"></a>01191 
<a name="l01192"></a>01192         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a66dd2d789c1445fb4640fdac403c18d7">aband_spurwar_en</a>) {
<a name="l01193"></a>01193                 <span class="keywordflow">if</span> (channel == 54) {
<a name="l01194"></a>01194                         tone[0] = 0x20;
<a name="l01195"></a>01195                         noise[0] = 0x25F;
<a name="l01196"></a>01196                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel == 38 || channel == 102 || channel == 118) {
<a name="l01197"></a>01197                         <span class="keywordflow">if</span> (0 <span class="comment">/* FIXME */</span>) {
<a name="l01198"></a>01198                                 tone[0] = 0x20;
<a name="l01199"></a>01199                                 noise[0] = 0x21F;
<a name="l01200"></a>01200                         } <span class="keywordflow">else</span> {
<a name="l01201"></a>01201                                 tone[0] = 0;
<a name="l01202"></a>01202                                 noise[0] = 0;
<a name="l01203"></a>01203                         }
<a name="l01204"></a>01204                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel == 134) {
<a name="l01205"></a>01205                         tone[0] = 0x20;
<a name="l01206"></a>01206                         noise[0] = 0x21F;
<a name="l01207"></a>01207                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel == 151) {
<a name="l01208"></a>01208                         tone[0] = 0x10;
<a name="l01209"></a>01209                         noise[0] = 0x23F;
<a name="l01210"></a>01210                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel == 153 || channel == 161) {
<a name="l01211"></a>01211                         tone[0] = 0x30;
<a name="l01212"></a>01212                         noise[0] = 0x23F;
<a name="l01213"></a>01213                 } <span class="keywordflow">else</span> {
<a name="l01214"></a>01214                         tone[0] = 0;
<a name="l01215"></a>01215                         noise[0] = 0;
<a name="l01216"></a>01216                 }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218                 <span class="keywordflow">if</span> (!tone[0] &amp;&amp; !noise[0])
<a name="l01219"></a>01219                         ; <span class="comment">/* TODO: N PHY Adjust Min Noise Var(1, tone, noise)*/</span>
<a name="l01220"></a>01220                 else
<a name="l01221"></a>01221                         ; <span class="comment">/* TODO: N PHY Adjust Min Noise Var(0, NULL, NULL)*/</span>
<a name="l01222"></a>01222         }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01225"></a>01225                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l01226"></a>01226 }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/AdjustLnaGainTbl */</span>
<a name="l01229"></a><a class="code" href="phy__n_8c.html#aedc9df634a8ab9088ec0e44f05b92036">01229</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#aedc9df634a8ab9088ec0e44f05b92036">b43_nphy_adjust_lna_gain_table</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01230"></a>01230 {
<a name="l01231"></a>01231         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233         u8 i;
<a name="l01234"></a>01234         s16 tmp;
<a name="l01235"></a>01235         u16 data[4];
<a name="l01236"></a>01236         s16 gain[2];
<a name="l01237"></a>01237         u16 minmax[2];
<a name="l01238"></a>01238         <span class="keyword">static</span> <span class="keyword">const</span> u16 lna_gain[4] = { -2, 10, 19, 25 };
<a name="l01239"></a>01239 
<a name="l01240"></a>01240         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01241"></a>01241                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l01242"></a>01242 
<a name="l01243"></a>01243         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#aad6f3e9be30a5f527804da2d4d0415a5">gain_boost</a>) {
<a name="l01244"></a>01244                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l01245"></a>01245                         gain[0] = 6;
<a name="l01246"></a>01246                         gain[1] = 6;
<a name="l01247"></a>01247                 } <span class="keywordflow">else</span> {
<a name="l01248"></a>01248                         tmp = 40370 - 315 * dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a68e5573cadabc1462bb752eefec9c599">channel</a>;
<a name="l01249"></a>01249                         gain[0] = ((tmp &gt;&gt; 13) + ((tmp &gt;&gt; 12) &amp; 1));
<a name="l01250"></a>01250                         tmp = 23242 - 224 * dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a68e5573cadabc1462bb752eefec9c599">channel</a>;
<a name="l01251"></a>01251                         gain[1] = ((tmp &gt;&gt; 13) + ((tmp &gt;&gt; 12) &amp; 1));
<a name="l01252"></a>01252                 }
<a name="l01253"></a>01253         } <span class="keywordflow">else</span> {
<a name="l01254"></a>01254                 gain[0] = 0;
<a name="l01255"></a>01255                 gain[1] = 0;
<a name="l01256"></a>01256         }
<a name="l01257"></a>01257 
<a name="l01258"></a>01258         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l01259"></a>01259                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a5d6d36922d60a8c969fa402ff6b0cb94">elna_gain_config</a>) {
<a name="l01260"></a>01260                         data[0] = 19 + gain[i];
<a name="l01261"></a>01261                         data[1] = 25 + gain[i];
<a name="l01262"></a>01262                         data[2] = 25 + gain[i];
<a name="l01263"></a>01263                         data[3] = 25 + gain[i];
<a name="l01264"></a>01264                 } <span class="keywordflow">else</span> {
<a name="l01265"></a>01265                         data[0] = lna_gain[0] + gain[i];
<a name="l01266"></a>01266                         data[1] = lna_gain[1] + gain[i];
<a name="l01267"></a>01267                         data[2] = lna_gain[2] + gain[i];
<a name="l01268"></a>01268                         data[3] = lna_gain[3] + gain[i];
<a name="l01269"></a>01269                 }
<a name="l01270"></a>01270                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(i, 8), 4, data);
<a name="l01271"></a>01271 
<a name="l01272"></a>01272                 minmax[i] = 23 + gain[i];
<a name="l01273"></a>01273         }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a458d76db51456cc9be2efaaa21c16039">B43_NPHY_C1_MINMAX_GAIN</a>, ~<a class="code" href="phy__n_8h.html#a559952c8e031f3767a0e2ab31acee711">B43_NPHY_C1_MINGAIN</a>,
<a name="l01276"></a>01276                                 minmax[0] &lt;&lt; <a class="code" href="phy__n_8h.html#a018d77987f6014780a3c7d8df4ae3e74">B43_NPHY_C1_MINGAIN_SHIFT</a>);
<a name="l01277"></a>01277         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a4b254d157e11c81f22cc1316b1d2f23f">B43_NPHY_C2_MINMAX_GAIN</a>, ~<a class="code" href="phy__n_8h.html#a9dbf54f587fa9c51aebe1348a6de2153">B43_NPHY_C2_MINGAIN</a>,
<a name="l01278"></a>01278                                 minmax[1] &lt;&lt; <a class="code" href="phy__n_8h.html#ad7750079951bc2d1b83f5e4bc980fbf0">B43_NPHY_C2_MINGAIN_SHIFT</a>);
<a name="l01279"></a>01279 
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01281"></a>01281                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l01282"></a>01282 }
<a name="l01283"></a>01283 
<a name="l01284"></a>01284 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/WorkaroundsGainCtrl */</span>
<a name="l01285"></a><a class="code" href="phy__n_8c.html#a40b4092938059596760c4ff2fb00073c">01285</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a40b4092938059596760c4ff2fb00073c">b43_nphy_gain_ctrl_workarounds</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01286"></a>01286 {
<a name="l01287"></a>01287         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01288"></a>01288         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l01289"></a>01289 
<a name="l01290"></a>01290         <span class="comment">/* PHY rev 0, 1, 2 */</span>
<a name="l01291"></a>01291         u8 i, j;
<a name="l01292"></a>01292         u8 code;
<a name="l01293"></a>01293         u16 tmp;
<a name="l01294"></a>01294         u8 rfseq_events[3] = { 6, 8, 7 };
<a name="l01295"></a>01295         u8 rfseq_delays[3] = { 10, 30, 1 };
<a name="l01296"></a>01296 
<a name="l01297"></a>01297         <span class="comment">/* PHY rev &gt;= 3 */</span>
<a name="l01298"></a>01298         <span class="keywordtype">bool</span> ghz5;
<a name="l01299"></a>01299         <span class="keywordtype">bool</span> ext_lna;
<a name="l01300"></a>01300         u16 rssi_gain;
<a name="l01301"></a>01301         <span class="keyword">struct </span><a class="code" href="structnphy__gain__ctl__workaround__entry.html">nphy_gain_ctl_workaround_entry</a> *e;
<a name="l01302"></a>01302         u8 lpf_gain[6] = { 0x00, 0x06, 0x0C, 0x12, 0x12, 0x12 };
<a name="l01303"></a>01303         u8 lpf_bits[6] = { 0, 1, 2, 3, 3, 3 };
<a name="l01304"></a>01304 
<a name="l01305"></a>01305         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l01306"></a>01306                 <span class="comment">/* Prepare values */</span>
<a name="l01307"></a>01307                 ghz5 = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4b8bd10881c97f75766db020cbe1b65e">B43_NPHY_BANDCTL</a>)
<a name="l01308"></a>01308                         &amp; <a class="code" href="phy__n_8h.html#a671f78da741559b0530d0bea34f19de0">B43_NPHY_BANDCTL_5GHZ</a>;
<a name="l01309"></a>01309                 ext_lna = sprom-&gt;boardflags_lo &amp; <a class="code" href="b43_8h.html#a0d9d8affb2af07eb01d6097c34c56eee">B43_BFL_EXTLNA</a>;
<a name="l01310"></a>01310                 e = <a class="code" href="tables__nphy_8c.html#a17871b40cf7d04c9892142f0e734b177">b43_nphy_get_gain_ctl_workaround_ent</a>(dev, ghz5, ext_lna);
<a name="l01311"></a>01311                 <span class="keywordflow">if</span> (ghz5 &amp;&amp; dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 5)
<a name="l01312"></a>01312                         rssi_gain = 0x90;
<a name="l01313"></a>01313                 <span class="keywordflow">else</span>
<a name="l01314"></a>01314                         rssi_gain = 0x50;
<a name="l01315"></a>01315 
<a name="l01316"></a>01316                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6818054af126c8a2cdac5b45d5d71a8a">B43_NPHY_RXCTL</a>, 0x0040);
<a name="l01317"></a>01317 
<a name="l01318"></a>01318                 <span class="comment">/* Set Clip 2 detect */</span>
<a name="l01319"></a>01319                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a505d816d396a708e8e043038790596e2">B43_NPHY_C1_CGAINI</a>,
<a name="l01320"></a>01320                                 <a class="code" href="phy__n_8h.html#a0b17f8fbe582a3d1cc902aabfd232b65">B43_NPHY_C1_CGAINI_CL2DETECT</a>);
<a name="l01321"></a>01321                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a112f1bb87154546a8c385bffbc7f496b">B43_NPHY_C2_CGAINI</a>,
<a name="l01322"></a>01322                                 <a class="code" href="phy__n_8h.html#a075e02a6c8e30ca0e5f7dd2b0ec307cf">B43_NPHY_C2_CGAINI_CL2DETECT</a>);
<a name="l01323"></a>01323 
<a name="l01324"></a>01324                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#a64cae7469d5bbff8574cac44437ee69b">B2056_RX_BIASPOLE_LNAG1_IDAC</a>,
<a name="l01325"></a>01325                                 0x17);
<a name="l01326"></a>01326                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#a64cae7469d5bbff8574cac44437ee69b">B2056_RX_BIASPOLE_LNAG1_IDAC</a>,
<a name="l01327"></a>01327                                 0x17);
<a name="l01328"></a>01328                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#a6cceed828a2c806ad1405502528b8296">B2056_RX_LNAG2_IDAC</a>, 0xF0);
<a name="l01329"></a>01329                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#a6cceed828a2c806ad1405502528b8296">B2056_RX_LNAG2_IDAC</a>, 0xF0);
<a name="l01330"></a>01330                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#af6c6251fa2c550024676698a9981831b">B2056_RX_RSSI_POLE</a>, 0x00);
<a name="l01331"></a>01331                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#af6c6251fa2c550024676698a9981831b">B2056_RX_RSSI_POLE</a>, 0x00);
<a name="l01332"></a>01332                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#a4221815d9cfff8af186126a64413c859">B2056_RX_RSSI_GAIN</a>,
<a name="l01333"></a>01333                                 rssi_gain);
<a name="l01334"></a>01334                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#a4221815d9cfff8af186126a64413c859">B2056_RX_RSSI_GAIN</a>,
<a name="l01335"></a>01335                                 rssi_gain);
<a name="l01336"></a>01336                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#ad523f45a7922952cf6fe2cc91c538563">B2056_RX_BIASPOLE_LNAA1_IDAC</a>,
<a name="l01337"></a>01337                                 0x17);
<a name="l01338"></a>01338                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#ad523f45a7922952cf6fe2cc91c538563">B2056_RX_BIASPOLE_LNAA1_IDAC</a>,
<a name="l01339"></a>01339                                 0x17);
<a name="l01340"></a>01340                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#a6d89357ad52586e0c20d8b4ae23455dd">B2056_RX_LNAA2_IDAC</a>, 0xFF);
<a name="l01341"></a>01341                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#a6d89357ad52586e0c20d8b4ae23455dd">B2056_RX_LNAA2_IDAC</a>, 0xFF);
<a name="l01342"></a>01342 
<a name="l01343"></a>01343                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(0, 8), 4, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a17fcb7aca0cca9bfa81c8698362d540c">lna1_gain</a>);
<a name="l01344"></a>01344                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(1, 8), 4, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a17fcb7aca0cca9bfa81c8698362d540c">lna1_gain</a>);
<a name="l01345"></a>01345                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(0, 16), 4, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a96f9edddd1804a0cfe642da47a7c4c4e">lna2_gain</a>);
<a name="l01346"></a>01346                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(1, 16), 4, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a96f9edddd1804a0cfe642da47a7c4c4e">lna2_gain</a>);
<a name="l01347"></a>01347                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(0, 32), 10, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#ab2878c9e716d3b642d68b153f717f05c">gain_db</a>);
<a name="l01348"></a>01348                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(1, 32), 10, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#ab2878c9e716d3b642d68b153f717f05c">gain_db</a>);
<a name="l01349"></a>01349                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(2, 32), 10, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#ad8c7e571638a03c8aa75ab6e29ec1111">gain_bits</a>);
<a name="l01350"></a>01350                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(3, 32), 10, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#ad8c7e571638a03c8aa75ab6e29ec1111">gain_bits</a>);
<a name="l01351"></a>01351                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(0, 0x40), 6, lpf_gain);
<a name="l01352"></a>01352                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(1, 0x40), 6, lpf_gain);
<a name="l01353"></a>01353                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(2, 0x40), 6, lpf_bits);
<a name="l01354"></a>01354                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(3, 0x40), 6, lpf_bits);
<a name="l01355"></a>01355 
<a name="l01356"></a>01356                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af53e857748ac20fd5685b10b0e77d97c">B43_NPHY_C1_INITGAIN</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a5e242c7731c36bf6106af6c5d53e640f">init_gain</a>);
<a name="l01357"></a>01357                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x2A7, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a5e242c7731c36bf6106af6c5d53e640f">init_gain</a>);
<a name="l01358"></a>01358                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x106), 2,
<a name="l01359"></a>01359                                         e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#aab8ddcea7784b8547669f987f51686bc">rfseq_init</a>);
<a name="l01360"></a>01360                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af53e857748ac20fd5685b10b0e77d97c">B43_NPHY_C1_INITGAIN</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a5e242c7731c36bf6106af6c5d53e640f">init_gain</a>);
<a name="l01361"></a>01361 
<a name="l01362"></a>01362                 <span class="comment">/* TODO: check defines. Do not match variables names */</span>
<a name="l01363"></a>01363                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a8085acf6e0b2199c8b89513ffcfe9fbb">B43_NPHY_C1_CLIP1_MEDGAIN</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#ab8a2f139bd439cb40106c890850b78a8">cliphi_gain</a>);
<a name="l01364"></a>01364                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x2A9, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#ab8a2f139bd439cb40106c890850b78a8">cliphi_gain</a>);
<a name="l01365"></a>01365                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aa6e0cd78fc2e961f76e9dfb58bfa5e5b">B43_NPHY_C1_CLIP2_GAIN</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#af112acf46a7cec3447ff89c402945914">clipmd_gain</a>);
<a name="l01366"></a>01366                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x2AB, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#af112acf46a7cec3447ff89c402945914">clipmd_gain</a>);
<a name="l01367"></a>01367                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a253d6e1c0ed65a84f49ff03b99b8a2ce">B43_NPHY_C2_CLIP1_HIGAIN</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#aeb6b0206bd779137f69cfba0ff3cae5a">cliplo_gain</a>);
<a name="l01368"></a>01368                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x2AD, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#aeb6b0206bd779137f69cfba0ff3cae5a">cliplo_gain</a>);
<a name="l01369"></a>01369 
<a name="l01370"></a>01370                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, 0x27D, 0xFF00, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#abd55c9bccdf8d64e05ab03bb3f5ecbaf">crsmin</a>);
<a name="l01371"></a>01371                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, 0x280, 0xFF00, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a82d23c33e8a166a411295d2a35b57eff">crsminl</a>);
<a name="l01372"></a>01372                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, 0x283, 0xFF00, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a4fe492e7b528d6ed19f252d215af3110">crsminu</a>);
<a name="l01373"></a>01373                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aeb0038ee93b68030b1c70f01e8d9fd03">B43_NPHY_C1_NBCLIPTHRES</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a97db82a789d43c5ee3025a15a1235d00">nbclip</a>);
<a name="l01374"></a>01374                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2a539ee6a1edee883dc1f44d9d612497">B43_NPHY_C2_NBCLIPTHRES</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a97db82a789d43c5ee3025a15a1235d00">nbclip</a>);
<a name="l01375"></a>01375                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a1ff9a14edd0344609607f9ee4d7d75b2">B43_NPHY_C1_CLIPWBTHRES</a>,
<a name="l01376"></a>01376                                 ~<a class="code" href="phy__n_8h.html#a17d87b9f81467e38c441b82dfac4bbd5">B43_NPHY_C1_CLIPWBTHRES_CLIP2</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a50108f8cc52b4d6c9af7ac0695195ac7">wlclip</a>);
<a name="l01377"></a>01377                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a7a716829efea1449ebbe3a3b1b6716c1">B43_NPHY_C2_CLIPWBTHRES</a>,
<a name="l01378"></a>01378                                 ~<a class="code" href="phy__n_8h.html#a74aaeb99097d9576c26442625394c7ac">B43_NPHY_C2_CLIPWBTHRES_CLIP2</a>, e-&gt;<a class="code" href="structnphy__gain__ctl__workaround__entry.html#a50108f8cc52b4d6c9af7ac0695195ac7">wlclip</a>);
<a name="l01379"></a>01379                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af710e51027de22f3a98fc3c8cf2e00bc">B43_NPHY_CCK_SHIFTB_REF</a>, 0x809C);
<a name="l01380"></a>01380         } <span class="keywordflow">else</span> {
<a name="l01381"></a>01381                 <span class="comment">/* Set Clip 2 detect */</span>
<a name="l01382"></a>01382                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a505d816d396a708e8e043038790596e2">B43_NPHY_C1_CGAINI</a>,
<a name="l01383"></a>01383                                 <a class="code" href="phy__n_8h.html#a0b17f8fbe582a3d1cc902aabfd232b65">B43_NPHY_C1_CGAINI_CL2DETECT</a>);
<a name="l01384"></a>01384                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a112f1bb87154546a8c385bffbc7f496b">B43_NPHY_C2_CGAINI</a>,
<a name="l01385"></a>01385                                 <a class="code" href="phy__n_8h.html#a075e02a6c8e30ca0e5f7dd2b0ec307cf">B43_NPHY_C2_CGAINI_CL2DETECT</a>);
<a name="l01386"></a>01386 
<a name="l01387"></a>01387                 <span class="comment">/* Set narrowband clip threshold */</span>
<a name="l01388"></a>01388                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aeb0038ee93b68030b1c70f01e8d9fd03">B43_NPHY_C1_NBCLIPTHRES</a>, 0x84);
<a name="l01389"></a>01389                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2a539ee6a1edee883dc1f44d9d612497">B43_NPHY_C2_NBCLIPTHRES</a>, 0x84);
<a name="l01390"></a>01390 
<a name="l01391"></a>01391                 <span class="keywordflow">if</span> (!dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>) {
<a name="l01392"></a>01392                         <span class="comment">/* Set dwell lengths */</span>
<a name="l01393"></a>01393                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a0ec31618b4b6c9b39e5f4a38bbc39f61">B43_NPHY_CLIP1_NBDWELL_LEN</a>, 0x002B);
<a name="l01394"></a>01394                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a744d72707997edd50b32b33ac5a796b3">B43_NPHY_CLIP2_NBDWELL_LEN</a>, 0x002B);
<a name="l01395"></a>01395                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a0f92035003c10f3a1f11b3a5dc49c9b6">B43_NPHY_W1CLIP1_DWELL_LEN</a>, 0x0009);
<a name="l01396"></a>01396                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a45fb7f767aa368c0bf072d4697abedec">B43_NPHY_W1CLIP2_DWELL_LEN</a>, 0x0009);
<a name="l01397"></a>01397                 }
<a name="l01398"></a>01398 
<a name="l01399"></a>01399                 <span class="comment">/* Set wideband clip 2 threshold */</span>
<a name="l01400"></a>01400                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a1ff9a14edd0344609607f9ee4d7d75b2">B43_NPHY_C1_CLIPWBTHRES</a>,
<a name="l01401"></a>01401                                 ~<a class="code" href="phy__n_8h.html#a17d87b9f81467e38c441b82dfac4bbd5">B43_NPHY_C1_CLIPWBTHRES_CLIP2</a>,
<a name="l01402"></a>01402                                 21);
<a name="l01403"></a>01403                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a7a716829efea1449ebbe3a3b1b6716c1">B43_NPHY_C2_CLIPWBTHRES</a>,
<a name="l01404"></a>01404                                 ~<a class="code" href="phy__n_8h.html#a74aaeb99097d9576c26442625394c7ac">B43_NPHY_C2_CLIPWBTHRES_CLIP2</a>,
<a name="l01405"></a>01405                                 21);
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                 <span class="keywordflow">if</span> (!dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>) {
<a name="l01408"></a>01408                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a505d816d396a708e8e043038790596e2">B43_NPHY_C1_CGAINI</a>,
<a name="l01409"></a>01409                                 ~<a class="code" href="phy__n_8h.html#a2e350ade0e3ee54a5e29326782aa7ffe">B43_NPHY_C1_CGAINI_GAINBKOFF</a>, 0x1);
<a name="l01410"></a>01410                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a112f1bb87154546a8c385bffbc7f496b">B43_NPHY_C2_CGAINI</a>,
<a name="l01411"></a>01411                                 ~<a class="code" href="phy__n_8h.html#a2fd882100b49eb08c94e98c16a06db3c">B43_NPHY_C2_CGAINI_GAINBKOFF</a>, 0x1);
<a name="l01412"></a>01412                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ae1f15e999a04834662dc729091d28806">B43_NPHY_C1_CCK_CGAINI</a>,
<a name="l01413"></a>01413                                 ~<a class="code" href="phy__n_8h.html#a648cd174ef7d6de859e4b5d9c1cc0865">B43_NPHY_C1_CCK_CGAINI_GAINBKOFF</a>, 0x1);
<a name="l01414"></a>01414                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ab3c7bab3a4883b2935de2ba363aec174">B43_NPHY_C2_CCK_CGAINI</a>,
<a name="l01415"></a>01415                                 ~<a class="code" href="phy__n_8h.html#aeecad2cdae3c191232d5104cf95ae469">B43_NPHY_C2_CCK_CGAINI_GAINBKOFF</a>, 0x1);
<a name="l01416"></a>01416                 }
<a name="l01417"></a>01417 
<a name="l01418"></a>01418                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af710e51027de22f3a98fc3c8cf2e00bc">B43_NPHY_CCK_SHIFTB_REF</a>, 0x809C);
<a name="l01419"></a>01419 
<a name="l01420"></a>01420                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#aad6f3e9be30a5f527804da2d4d0415a5">gain_boost</a>) {
<a name="l01421"></a>01421                         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ &amp;&amp;
<a name="l01422"></a>01422                             dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>)
<a name="l01423"></a>01423                                 code = 4;
<a name="l01424"></a>01424                         <span class="keywordflow">else</span>
<a name="l01425"></a>01425                                 code = 5;
<a name="l01426"></a>01426                 } <span class="keywordflow">else</span> {
<a name="l01427"></a>01427                         code = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a> ? 6 : 7;
<a name="l01428"></a>01428                 }
<a name="l01429"></a>01429 
<a name="l01430"></a>01430                 <span class="comment">/* Set HPVGA2 index */</span>
<a name="l01431"></a>01431                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#af53e857748ac20fd5685b10b0e77d97c">B43_NPHY_C1_INITGAIN</a>,
<a name="l01432"></a>01432                                 ~<a class="code" href="phy__n_8h.html#a08e21c5540bdf7e5d769ddb3d52f8d38">B43_NPHY_C1_INITGAIN_HPVGA2</a>,
<a name="l01433"></a>01433                                 code &lt;&lt; <a class="code" href="phy__n_8h.html#abda6e5cbc35c7bfcc4fa9855cd116eb2">B43_NPHY_C1_INITGAIN_HPVGA2_SHIFT</a>);
<a name="l01434"></a>01434                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#aa5e6ea5fa93fe971bd205d4d07b09dea">B43_NPHY_C2_INITGAIN</a>,
<a name="l01435"></a>01435                                 ~<a class="code" href="phy__n_8h.html#a0634e51ff1d6cd7ce87f1bc05a832718">B43_NPHY_C2_INITGAIN_HPVGA2</a>,
<a name="l01436"></a>01436                                 code &lt;&lt; <a class="code" href="phy__n_8h.html#a4068fe353cd61084442cc76c891ec24d">B43_NPHY_C2_INITGAIN_HPVGA2_SHIFT</a>);
<a name="l01437"></a>01437 
<a name="l01438"></a>01438                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>, 0x1D06);
<a name="l01439"></a>01439                 <span class="comment">/* specs say about 2 loops, but wl does 4 */</span>
<a name="l01440"></a>01440                 <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l01441"></a>01441                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>,
<a name="l01442"></a>01442                                                         (code &lt;&lt; 8 | 0x7C));
<a name="l01443"></a>01443 
<a name="l01444"></a>01444                 <a class="code" href="phy__n_8c.html#aedc9df634a8ab9088ec0e44f05b92036">b43_nphy_adjust_lna_gain_table</a>(dev);
<a name="l01445"></a>01445 
<a name="l01446"></a>01446                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a5d6d36922d60a8c969fa402ff6b0cb94">elna_gain_config</a>) {
<a name="l01447"></a>01447                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>, 0x0808);
<a name="l01448"></a>01448                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x0);
<a name="l01449"></a>01449                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x1);
<a name="l01450"></a>01450                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x1);
<a name="l01451"></a>01451                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x1);
<a name="l01452"></a>01452 
<a name="l01453"></a>01453                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>, 0x0C08);
<a name="l01454"></a>01454                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x0);
<a name="l01455"></a>01455                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x1);
<a name="l01456"></a>01456                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x1);
<a name="l01457"></a>01457                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, 0x1);
<a name="l01458"></a>01458 
<a name="l01459"></a>01459                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>, 0x1D06);
<a name="l01460"></a>01460                         <span class="comment">/* specs say about 2 loops, but wl does 4 */</span>
<a name="l01461"></a>01461                         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l01462"></a>01462                                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>,
<a name="l01463"></a>01463                                                         (code &lt;&lt; 8 | 0x74));
<a name="l01464"></a>01464                 }
<a name="l01465"></a>01465 
<a name="l01466"></a>01466                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 2) {
<a name="l01467"></a>01467                         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l01468"></a>01468                                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>,
<a name="l01469"></a>01469                                                 (0x0400 * i) + 0x0020);
<a name="l01470"></a>01470                                 <span class="keywordflow">for</span> (j = 0; j &lt; 21; j++) {
<a name="l01471"></a>01471                                         tmp = j * (i &lt; 2 ? 3 : 1);
<a name="l01472"></a>01472                                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev,
<a name="l01473"></a>01473                                                 <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>, tmp);
<a name="l01474"></a>01474                                 }
<a name="l01475"></a>01475                         }
<a name="l01476"></a>01476                 }
<a name="l01477"></a>01477 
<a name="l01478"></a>01478                 <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(dev, 5,
<a name="l01479"></a>01479                                 rfseq_events, rfseq_delays, 3);
<a name="l01480"></a>01480                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a696be334410c820528016663000e7907">B43_NPHY_OVER_DGAIN1</a>,
<a name="l01481"></a>01481                         ~<a class="code" href="phy__n_8h.html#a39d302c8d4dcbb0f0562f56421618bfe">B43_NPHY_OVER_DGAIN_CCKDGECV</a> &amp; 0xFFFF,
<a name="l01482"></a>01482                         0x5A &lt;&lt; <a class="code" href="phy__n_8h.html#a8a9745ca548b0934a9c6e248a2dbfb7f">B43_NPHY_OVER_DGAIN_CCKDGECV_SHIFT</a>);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l01485"></a>01485                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>(0xC5D),
<a name="l01486"></a>01486                                         0xFF80, 4);
<a name="l01487"></a>01487         }
<a name="l01488"></a>01488 }
<a name="l01489"></a>01489 
<a name="l01490"></a><a class="code" href="phy__n_8c.html#ab6aee00cd45b5335c14ebdb98e810e57">01490</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ab6aee00cd45b5335c14ebdb98e810e57">b43_nphy_workarounds_rev3plus</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01491"></a>01491 {
<a name="l01492"></a>01492         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01493"></a>01493         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495         <span class="comment">/* TX to RX */</span>
<a name="l01496"></a>01496         u8 tx2rx_events[9] = { 0x4, 0x3, 0x6, 0x5, 0x2, 0x1, 0x8, 0x1F };
<a name="l01497"></a>01497         u8 tx2rx_delays[9] = { 8, 4, 2, 2, 4, 4, 6, 1 };
<a name="l01498"></a>01498         <span class="comment">/* RX to TX */</span>
<a name="l01499"></a>01499         u8 rx2tx_events_ipa[9] = { 0x0, 0x1, 0x2, 0x8, 0x5, 0x6, 0xF, 0x3,
<a name="l01500"></a>01500                                         0x1F };
<a name="l01501"></a>01501         u8 rx2tx_delays_ipa[9] = { 8, 6, 6, 4, 4, 16, 43, 1, 1 };
<a name="l01502"></a>01502         u8 rx2tx_events[9] = { 0x0, 0x1, 0x2, 0x8, 0x5, 0x6, 0x3, 0x4, 0x1F };
<a name="l01503"></a>01503         u8 rx2tx_delays[9] = { 8, 6, 6, 4, 4, 18, 42, 1, 1 };
<a name="l01504"></a>01504 
<a name="l01505"></a>01505         u16 tmp16;
<a name="l01506"></a>01506         u32 tmp32;
<a name="l01507"></a>01507 
<a name="l01508"></a>01508         tmp32 = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(30, 0));
<a name="l01509"></a>01509         tmp32 &amp;= 0xffffff;
<a name="l01510"></a>01510         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(30, 0), tmp32);
<a name="l01511"></a>01511 
<a name="l01512"></a>01512         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a336b898a4a6373a06c697f4466cee12e">B43_NPHY_PHASETR_A0</a>, 0x0125);
<a name="l01513"></a>01513         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7fa74debb02a42721da381637d7a84fb">B43_NPHY_PHASETR_A1</a>, 0x01B3);
<a name="l01514"></a>01514         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#acf3e1e552652f6796b4234be7256ecbd">B43_NPHY_PHASETR_A2</a>, 0x0105);
<a name="l01515"></a>01515         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a685683099ba2e8044d3de8b7e878dc93">B43_NPHY_PHASETR_B0</a>, 0x016E);
<a name="l01516"></a>01516         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad392cec2e3ae269af26a61276ec21def">B43_NPHY_PHASETR_B1</a>, 0x00CD);
<a name="l01517"></a>01517         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae4bee104f2b09e501ac1bdb652035c61">B43_NPHY_PHASETR_B2</a>, 0x0020);
<a name="l01518"></a>01518 
<a name="l01519"></a>01519         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aeefc1678d3fb40228056455a6159a907">B43_NPHY_C2_CLIP1_MEDGAIN</a>, 0x000C);
<a name="l01520"></a>01520         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x2AE, 0x000C);
<a name="l01521"></a>01521 
<a name="l01522"></a>01522         <span class="comment">/* TX to RX */</span>
<a name="l01523"></a>01523         <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(dev, 1, tx2rx_events, tx2rx_delays, 9);
<a name="l01524"></a>01524 
<a name="l01525"></a>01525         <span class="comment">/* RX to TX */</span>
<a name="l01526"></a>01526         <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev))
<a name="l01527"></a>01527                 <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(dev, 1, rx2tx_events_ipa,
<a name="l01528"></a>01528                                          rx2tx_delays_ipa, 9);
<a name="l01529"></a>01529         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#ac92acc324b014cfb0791d91a1fef8da2">hw_phyrxchain</a> != 3 &amp;&amp;
<a name="l01530"></a>01530             nphy-&gt;<a class="code" href="structb43__phy__n.html#ac92acc324b014cfb0791d91a1fef8da2">hw_phyrxchain</a> != nphy-&gt;<a class="code" href="structb43__phy__n.html#ab50731a12f58edf85b38a18b323415ee">hw_phytxchain</a>) {
<a name="l01531"></a>01531                 <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev)) {
<a name="l01532"></a>01532                         rx2tx_delays[5] = 59;
<a name="l01533"></a>01533                         rx2tx_delays[6] = 1;
<a name="l01534"></a>01534                         rx2tx_events[7] = 0x1F;
<a name="l01535"></a>01535                 }
<a name="l01536"></a>01536                 <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(dev, 1, rx2tx_events, rx2tx_delays, 9);
<a name="l01537"></a>01537         }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539         tmp16 = (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) ?
<a name="l01540"></a>01540                 0x2 : 0x9C40;
<a name="l01541"></a>01541         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6db1270094928e2c054a6c636f4fd0df">B43_NPHY_ENDROP_TLEN</a>, tmp16);
<a name="l01542"></a>01542 
<a name="l01543"></a>01543         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, 0x294, 0xF0FF, 0x0700);
<a name="l01544"></a>01544 
<a name="l01545"></a>01545         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(16, 3), 0x18D);
<a name="l01546"></a>01546         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(16, 127), 0x18D);
<a name="l01547"></a>01547 
<a name="l01548"></a>01548         <a class="code" href="phy__n_8c.html#a40b4092938059596760c4ff2fb00073c">b43_nphy_gain_ctrl_workarounds</a>(dev);
<a name="l01549"></a>01549 
<a name="l01550"></a>01550         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(8, 0), 2);
<a name="l01551"></a>01551         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(8, 16), 2);
<a name="l01552"></a>01552 
<a name="l01553"></a>01553         <span class="comment">/* TODO */</span>
<a name="l01554"></a>01554 
<a name="l01555"></a>01555         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#ac980ace29b08979098ad84d1d5f4cb6c">B2056_RX_MIXA_MAST_BIAS</a>, 0x00);
<a name="l01556"></a>01556         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#ac980ace29b08979098ad84d1d5f4cb6c">B2056_RX_MIXA_MAST_BIAS</a>, 0x00);
<a name="l01557"></a>01557         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#a48de15bb4f254f7ce4915e3e944742c7">B2056_RX_MIXA_BIAS_MAIN</a>, 0x06);
<a name="l01558"></a>01558         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#a48de15bb4f254f7ce4915e3e944742c7">B2056_RX_MIXA_BIAS_MAIN</a>, 0x06);
<a name="l01559"></a>01559         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#ae4bbee5e58a9234980db7c48e4c7278c">B2056_RX_MIXA_BIAS_AUX</a>, 0x07);
<a name="l01560"></a>01560         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#ae4bbee5e58a9234980db7c48e4c7278c">B2056_RX_MIXA_BIAS_AUX</a>, 0x07);
<a name="l01561"></a>01561         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#abf53eb6b5937df3a5d2b91add1d61ea5">B2056_RX_MIXA_LOB_BIAS</a>, 0x88);
<a name="l01562"></a>01562         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#abf53eb6b5937df3a5d2b91add1d61ea5">B2056_RX_MIXA_LOB_BIAS</a>, 0x88);
<a name="l01563"></a>01563         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#af62c2a27286bb9a4c4720175f321fc8d">B2056_RX0</a> | <a class="code" href="radio__2056_8h.html#a58169de81321d514c7d95b91c80c8b53">B2056_RX_MIXG_CMFB_IDAC</a>, 0x00);
<a name="l01564"></a>01564         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#aed172d5be007a37b85d1c3dc46b7c09b">B2056_RX1</a> | <a class="code" href="radio__2056_8h.html#a58169de81321d514c7d95b91c80c8b53">B2056_RX_MIXG_CMFB_IDAC</a>, 0x00);
<a name="l01565"></a>01565 
<a name="l01566"></a>01566         <span class="comment">/* N PHY WAR TX Chain Update with hw_phytxchain as argument */</span>
<a name="l01567"></a>01567 
<a name="l01568"></a>01568         <span class="keywordflow">if</span> ((sprom-&gt;boardflags2_lo &amp; <a class="code" href="b43_8h.html#ab05f2415d3fb2306927fe209f03a9aae">B43_BFL2_APLL_WAR</a> &amp;&amp;
<a name="l01569"></a>01569              <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) ||
<a name="l01570"></a>01570             (sprom-&gt;boardflags2_lo &amp; <a class="code" href="b43_8h.html#afd04b9f21557441cbf9fa86e54a624b1">B43_BFL2_GPLL_WAR</a> &amp;&amp;
<a name="l01571"></a>01571              <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ))
<a name="l01572"></a>01572                 tmp32 = 0x00088888;
<a name="l01573"></a>01573         <span class="keywordflow">else</span>
<a name="l01574"></a>01574                 tmp32 = 0x88888888;
<a name="l01575"></a>01575         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(30, 1), tmp32);
<a name="l01576"></a>01576         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(30, 2), tmp32);
<a name="l01577"></a>01577         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(30, 3), tmp32);
<a name="l01578"></a>01578 
<a name="l01579"></a>01579         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 4 &amp;&amp;
<a name="l01580"></a>01580                 <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) {
<a name="l01581"></a>01581                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a474349f672ae8b49b896492569e2ecaf">B2056_TX0</a> | <a class="code" href="radio__2056_8h.html#a621fee41436a601ef33ced5f58bb9a53">B2056_TX_GMBB_IDAC</a>,
<a name="l01582"></a>01582                                 0x70);
<a name="l01583"></a>01583                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="radio__2056_8h.html#a407831f793fafb714bfc044e7bf8af6c">B2056_TX1</a> | <a class="code" href="radio__2056_8h.html#a621fee41436a601ef33ced5f58bb9a53">B2056_TX_GMBB_IDAC</a>,
<a name="l01584"></a>01584                                 0x70);
<a name="l01585"></a>01585         }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x224, 0x039C);
<a name="l01588"></a>01588         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x225, 0x0357);
<a name="l01589"></a>01589         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x226, 0x0317);
<a name="l01590"></a>01590         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x227, 0x02D7);
<a name="l01591"></a>01591         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x228, 0x039C);
<a name="l01592"></a>01592         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x229, 0x0357);
<a name="l01593"></a>01593         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x22A, 0x0317);
<a name="l01594"></a>01594         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x22B, 0x02D7);
<a name="l01595"></a>01595         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x22C, 0x039C);
<a name="l01596"></a>01596         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x22D, 0x0357);
<a name="l01597"></a>01597         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x22E, 0x0317);
<a name="l01598"></a>01598         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, 0x22F, 0x02D7);
<a name="l01599"></a>01599 }
<a name="l01600"></a>01600 
<a name="l01601"></a><a class="code" href="phy__n_8c.html#a5467e99b33988099d68eece3feb1b576">01601</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a5467e99b33988099d68eece3feb1b576">b43_nphy_workarounds_rev1_2</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01602"></a>01602 {
<a name="l01603"></a>01603         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l01604"></a>01604         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l01605"></a>01605         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01606"></a>01606 
<a name="l01607"></a>01607         u8 events1[7] = { 0x0, 0x1, 0x2, 0x8, 0x4, 0x5, 0x3 };
<a name="l01608"></a>01608         u8 delays1[7] = { 0x8, 0x6, 0x6, 0x2, 0x4, 0x3C, 0x1 };
<a name="l01609"></a>01609 
<a name="l01610"></a>01610         u8 events2[7] = { 0x0, 0x3, 0x5, 0x4, 0x2, 0x1, 0x8 };
<a name="l01611"></a>01611         u8 delays2[7] = { 0x8, 0x6, 0x2, 0x4, 0x4, 0x6, 0x1 };
<a name="l01612"></a>01612 
<a name="l01613"></a>01613         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ &amp;&amp;
<a name="l01614"></a>01614             nphy-&gt;<a class="code" href="structb43__phy__n.html#ae1e52d40950a017afee9a46e913276ec">band5g_pwrgain</a>) {
<a name="l01615"></a>01615                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#acc650c04a1532a83c09b8f22c0704108">B2055_C1_TX_RF_SPARE</a>, ~0x8);
<a name="l01616"></a>01616                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a9761b3ca85f23640739db7962eb0a859">B2055_C2_TX_RF_SPARE</a>, ~0x8);
<a name="l01617"></a>01617         } <span class="keywordflow">else</span> {
<a name="l01618"></a>01618                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#acc650c04a1532a83c09b8f22c0704108">B2055_C1_TX_RF_SPARE</a>, 0x8);
<a name="l01619"></a>01619                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#a9761b3ca85f23640739db7962eb0a859">B2055_C2_TX_RF_SPARE</a>, 0x8);
<a name="l01620"></a>01620         }
<a name="l01621"></a>01621 
<a name="l01622"></a>01622         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x00), 0x000A);
<a name="l01623"></a>01623         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x10), 0x000A);
<a name="l01624"></a>01624         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x02), 0xCDAA);
<a name="l01625"></a>01625         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x12), 0xCDAA);
<a name="l01626"></a>01626 
<a name="l01627"></a>01627         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l01628"></a>01628                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x08), 0x0000);
<a name="l01629"></a>01629                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x18), 0x0000);
<a name="l01630"></a>01630                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x07), 0x7AAB);
<a name="l01631"></a>01631                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x17), 0x7AAB);
<a name="l01632"></a>01632                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x06), 0x0800);
<a name="l01633"></a>01633                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 0x16), 0x0800);
<a name="l01634"></a>01634         }
<a name="l01635"></a>01635 
<a name="l01636"></a>01636         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#afa00537732570ad2e6cc75d3743c2724">B43_NPHY_RFCTL_LUT_TRSW_LO1</a>, 0x2D8);
<a name="l01637"></a>01637         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aad32e1ef14df1e5f3f731d249323c098">B43_NPHY_RFCTL_LUT_TRSW_UP1</a>, 0x301);
<a name="l01638"></a>01638         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9ba68b1479c34a39670a3749ab2a3cd8">B43_NPHY_RFCTL_LUT_TRSW_LO2</a>, 0x2D8);
<a name="l01639"></a>01639         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a08aee022d5720230af2a77e55605b321">B43_NPHY_RFCTL_LUT_TRSW_UP2</a>, 0x301);
<a name="l01640"></a>01640 
<a name="l01641"></a>01641         <span class="keywordflow">if</span> (sprom-&gt;boardflags2_lo &amp; <a class="code" href="b43_8h.html#a64a703575ed8c290a99aa2d8cbe4e50b">B43_BFL2_SKWRKFEM_BRD</a> &amp;&amp;
<a name="l01642"></a>01642             dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a8225eee827fd5a0c40849625fbf88330">board_type</a> == 0x8B) {
<a name="l01643"></a>01643                 delays1[0] = 0x1;
<a name="l01644"></a>01644                 delays1[5] = 0x14;
<a name="l01645"></a>01645         }
<a name="l01646"></a>01646         <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(dev, 0, events1, delays1, 7);
<a name="l01647"></a>01647         <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(dev, 1, events2, delays2, 7);
<a name="l01648"></a>01648 
<a name="l01649"></a>01649         <a class="code" href="phy__n_8c.html#a40b4092938059596760c4ff2fb00073c">b43_nphy_gain_ctrl_workarounds</a>(dev);
<a name="l01650"></a>01650 
<a name="l01651"></a>01651         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l01652"></a>01652                 <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6818054af126c8a2cdac5b45d5d71a8a">B43_NPHY_RXCTL</a>) &amp; 0x2)
<a name="l01653"></a>01653                         <a class="code" href="main_8c.html#abbb7dc97d3d48c3504e1c35b366407ad">b43_hf_write</a>(dev, <a class="code" href="main_8c.html#a3f3a1d36e1882927e495fa890efbbe97">b43_hf_read</a>(dev) |
<a name="l01654"></a>01654                                         <a class="code" href="b43_8h.html#a7ae1cd217496ab6cbb62e963d21bbe58">B43_HF_MLADVW</a>);
<a name="l01655"></a>01655         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 2) {
<a name="l01656"></a>01656                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a02f16467f71b1cbeafb6868ea1615676">B43_NPHY_CRSCHECK2</a>, 0);
<a name="l01657"></a>01657                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2f448d1c6a214ca6c6c2e547dcb42e3c">B43_NPHY_CRSCHECK3</a>, 0);
<a name="l01658"></a>01658         }
<a name="l01659"></a>01659 
<a name="l01660"></a>01660         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l01661"></a>01661                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a3fa03eeacfadb0eee66339ca8a469d37">B43_NPHY_SCRAM_SIGCTL</a>,
<a name="l01662"></a>01662                                 ~<a class="code" href="phy__n_8h.html#afc3932aca77f2f3c60ac91ca5537d77b">B43_NPHY_SCRAM_SIGCTL_SCM</a>);
<a name="l01663"></a>01663 
<a name="l01664"></a>01664         <span class="comment">/* Set phase track alpha and beta */</span>
<a name="l01665"></a>01665         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a336b898a4a6373a06c697f4466cee12e">B43_NPHY_PHASETR_A0</a>, 0x125);
<a name="l01666"></a>01666         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7fa74debb02a42721da381637d7a84fb">B43_NPHY_PHASETR_A1</a>, 0x1B3);
<a name="l01667"></a>01667         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#acf3e1e552652f6796b4234be7256ecbd">B43_NPHY_PHASETR_A2</a>, 0x105);
<a name="l01668"></a>01668         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a685683099ba2e8044d3de8b7e878dc93">B43_NPHY_PHASETR_B0</a>, 0x16E);
<a name="l01669"></a>01669         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad392cec2e3ae269af26a61276ec21def">B43_NPHY_PHASETR_B1</a>, 0xCD);
<a name="l01670"></a>01670         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae4bee104f2b09e501ac1bdb652035c61">B43_NPHY_PHASETR_B2</a>, 0x20);
<a name="l01671"></a>01671 
<a name="l01672"></a>01672         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a6ec26f9652eacbc13b2e556ab4561092">B43_NPHY_PIL_DW1</a>,
<a name="l01673"></a>01673                         ~<a class="code" href="phy__n_8h.html#a1f16a193ac634f4707f23f55d376a3bb">B43_NPHY_PIL_DW_64QAM</a> &amp; 0xFFFF);
<a name="l01674"></a>01674         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a579965efd7456a73bd21206005040264">B43_NPHY_TXF_20CO_S2B1</a>, 0xB5);
<a name="l01675"></a>01675         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ac492cf975bf62a0672c5f91967437c6b">B43_NPHY_TXF_20CO_S2B2</a>, 0xA4);
<a name="l01676"></a>01676         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a0a1455fa54304a8b8f5e80884ec2ee41">B43_NPHY_TXF_20CO_S2B3</a>, 0x00);
<a name="l01677"></a>01677 
<a name="l01678"></a>01678         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 2)
<a name="l01679"></a>01679                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a82a71496427c5b9117830520b0c9e214">B43_NPHY_FINERX2_CGC</a>,
<a name="l01680"></a>01680                                 <a class="code" href="phy__n_8h.html#a1dcc4ee3580c8610d2f5cc5768df9d15">B43_NPHY_FINERX2_CGC_DECGC</a>);
<a name="l01681"></a>01681 }
<a name="l01682"></a>01682 
<a name="l01683"></a>01683 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/Workarounds */</span>
<a name="l01684"></a><a class="code" href="phy__n_8c.html#ac92598032afa700b66c977e9d4d897b5">01684</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ac92598032afa700b66c977e9d4d897b5">b43_nphy_workarounds</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01685"></a>01685 {
<a name="l01686"></a>01686         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l01687"></a>01687         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01688"></a>01688 
<a name="l01689"></a>01689         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ)
<a name="l01690"></a>01690                 <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 1, 0);
<a name="l01691"></a>01691         <span class="keywordflow">else</span>
<a name="l01692"></a>01692                 <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 1, 1);
<a name="l01693"></a>01693 
<a name="l01694"></a>01694         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01695"></a>01695                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l01696"></a>01696 
<a name="l01697"></a>01697         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#ab079ffefe8946a2a687e1fc63e14654c">B43_NPHY_IQFLIP</a>,
<a name="l01698"></a>01698                     <a class="code" href="phy__n_8h.html#a9daa413bd0d0159d001c9b768f1fc920">B43_NPHY_IQFLIP_ADC1</a> | <a class="code" href="phy__n_8h.html#abbcbad5453a7000190d6d13e7414e311">B43_NPHY_IQFLIP_ADC2</a>);
<a name="l01699"></a>01699 
<a name="l01700"></a>01700         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l01701"></a>01701                 <a class="code" href="phy__n_8c.html#ab6aee00cd45b5335c14ebdb98e810e57">b43_nphy_workarounds_rev3plus</a>(dev);
<a name="l01702"></a>01702         <span class="keywordflow">else</span>
<a name="l01703"></a>01703                 <a class="code" href="phy__n_8c.html#a5467e99b33988099d68eece3feb1b576">b43_nphy_workarounds_rev1_2</a>(dev);
<a name="l01704"></a>01704 
<a name="l01705"></a>01705         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01706"></a>01706                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l01707"></a>01707 }
<a name="l01708"></a>01708 
<a name="l01709"></a>01709 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/LoadSampleTable */</span>
<a name="l01710"></a><a class="code" href="phy__n_8c.html#a9117dfc9b03d09233cb4d92e7ec12abe">01710</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a9117dfc9b03d09233cb4d92e7ec12abe">b43_nphy_load_samples</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l01711"></a>01711                                         <span class="keyword">struct</span> <a class="code" href="structb43__c32.html">b43_c32</a> *samples, u16 len) {
<a name="l01712"></a>01712         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01713"></a>01713         u16 i;
<a name="l01714"></a>01714         u32 *data;
<a name="l01715"></a>01715 
<a name="l01716"></a>01716         data = kzalloc(len * <span class="keyword">sizeof</span>(u32), GFP_KERNEL);
<a name="l01717"></a>01717         <span class="keywordflow">if</span> (!data) {
<a name="l01718"></a>01718                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;allocation for samples loading failed\n&quot;</span>);
<a name="l01719"></a>01719                 <span class="keywordflow">return</span> -ENOMEM;
<a name="l01720"></a>01720         }
<a name="l01721"></a>01721         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01722"></a>01722                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l01723"></a>01723 
<a name="l01724"></a>01724         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
<a name="l01725"></a>01725                 data[i] = (samples[i].<a class="code" href="structb43__c32.html#ab47f254a0fc1ee38b6d118738077138e">i</a> &amp; 0x3FF &lt;&lt; 10);
<a name="l01726"></a>01726                 data[i] |= samples[i].<a class="code" href="structb43__c32.html#ac21b7ccdee5b9384f710601c7df89714">q</a> &amp; 0x3FF;
<a name="l01727"></a>01727         }
<a name="l01728"></a>01728         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a177934380ab5730e8c3ef3bb355aa103">B43_NTAB32</a>(17, 0), len, data);
<a name="l01729"></a>01729 
<a name="l01730"></a>01730         kfree(data);
<a name="l01731"></a>01731         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01732"></a>01732                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l01733"></a>01733         <span class="keywordflow">return</span> 0;
<a name="l01734"></a>01734 }
<a name="l01735"></a>01735 
<a name="l01736"></a>01736 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/GenLoadSamples */</span>
<a name="l01737"></a><a class="code" href="phy__n_8c.html#a93963744b23ae98744e3de32bd94c707">01737</a> <span class="keyword">static</span> u16 <a class="code" href="phy__n_8c.html#a93963744b23ae98744e3de32bd94c707">b43_nphy_gen_load_samples</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u32 freq, u16 max,
<a name="l01738"></a>01738                                         <span class="keywordtype">bool</span> test)
<a name="l01739"></a>01739 {
<a name="l01740"></a>01740         <span class="keywordtype">int</span> i;
<a name="l01741"></a>01741         u16 bw, len, rot, angle;
<a name="l01742"></a>01742         <span class="keyword">struct </span><a class="code" href="structb43__c32.html">b43_c32</a> *samples;
<a name="l01743"></a>01743 
<a name="l01744"></a>01744 
<a name="l01745"></a>01745         bw = (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>) ? 40 : 20;
<a name="l01746"></a>01746         len = bw &lt;&lt; 3;
<a name="l01747"></a>01747 
<a name="l01748"></a>01748         <span class="keywordflow">if</span> (test) {
<a name="l01749"></a>01749                 <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>) &amp; <a class="code" href="phy__n_8h.html#a3464d851712f3c1b48288d2f0e0086bc">B43_NPHY_BBCFG_RSTRX</a>)
<a name="l01750"></a>01750                         bw = 82;
<a name="l01751"></a>01751                 <span class="keywordflow">else</span>
<a name="l01752"></a>01752                         bw = 80;
<a name="l01753"></a>01753 
<a name="l01754"></a>01754                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>)
<a name="l01755"></a>01755                         bw &lt;&lt;= 1;
<a name="l01756"></a>01756 
<a name="l01757"></a>01757                 len = bw &lt;&lt; 1;
<a name="l01758"></a>01758         }
<a name="l01759"></a>01759 
<a name="l01760"></a>01760         samples = kcalloc(len, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structb43__c32.html">b43_c32</a>), GFP_KERNEL);
<a name="l01761"></a>01761         <span class="keywordflow">if</span> (!samples) {
<a name="l01762"></a>01762                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;allocation for samples generation failed\n&quot;</span>);
<a name="l01763"></a>01763                 <span class="keywordflow">return</span> 0;
<a name="l01764"></a>01764         }
<a name="l01765"></a>01765         rot = (((freq * 36) / bw) &lt;&lt; 16) / 100;
<a name="l01766"></a>01766         angle = 0;
<a name="l01767"></a>01767 
<a name="l01768"></a>01768         <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
<a name="l01769"></a>01769                 samples[i] = <a class="code" href="phy__common_8c.html#a8928a3e5490bd5d09726a0498fcd04a2">b43_cordic</a>(angle);
<a name="l01770"></a>01770                 angle += rot;
<a name="l01771"></a>01771                 samples[i].<a class="code" href="structb43__c32.html#ac21b7ccdee5b9384f710601c7df89714">q</a> = <a class="code" href="phy__common_8h.html#afe132d9e607d2c95173c76dc66603691">CORDIC_CONVERT</a>(samples[i].<a class="code" href="structb43__c32.html#ac21b7ccdee5b9384f710601c7df89714">q</a> * max);
<a name="l01772"></a>01772                 samples[i].<a class="code" href="structb43__c32.html#ab47f254a0fc1ee38b6d118738077138e">i</a> = <a class="code" href="phy__common_8h.html#afe132d9e607d2c95173c76dc66603691">CORDIC_CONVERT</a>(samples[i].i * max);
<a name="l01773"></a>01773         }
<a name="l01774"></a>01774 
<a name="l01775"></a>01775         i = <a class="code" href="phy__n_8c.html#a9117dfc9b03d09233cb4d92e7ec12abe">b43_nphy_load_samples</a>(dev, samples, len);
<a name="l01776"></a>01776         kfree(samples);
<a name="l01777"></a>01777         <span class="keywordflow">return</span> (i &lt; 0) ? 0 : len;
<a name="l01778"></a>01778 }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RunSamples */</span>
<a name="l01781"></a><a class="code" href="phy__n_8c.html#a3fa62797735d6ea3ea0cc45691c205ce">01781</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a3fa62797735d6ea3ea0cc45691c205ce">b43_nphy_run_samples</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 samps, u16 loops,
<a name="l01782"></a>01782                                         u16 wait, <span class="keywordtype">bool</span> iqmode, <span class="keywordtype">bool</span> dac_test)
<a name="l01783"></a>01783 {
<a name="l01784"></a>01784         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01785"></a>01785         <span class="keywordtype">int</span> i;
<a name="l01786"></a>01786         u16 seq_mode;
<a name="l01787"></a>01787         u32 tmp;
<a name="l01788"></a>01788 
<a name="l01789"></a>01789         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01790"></a>01790                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">true</span>);
<a name="l01791"></a>01791 
<a name="l01792"></a>01792         <span class="keywordflow">if</span> ((nphy-&gt;<a class="code" href="structb43__phy__n.html#a625b37ed1b681587417124dcf457de7d">bb_mult_save</a> &amp; 0x80000000) == 0) {
<a name="l01793"></a>01793                 tmp = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 87));
<a name="l01794"></a>01794                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a625b37ed1b681587417124dcf457de7d">bb_mult_save</a> = (tmp &amp; 0xFFFF) | 0x80000000;
<a name="l01795"></a>01795         }
<a name="l01796"></a>01796 
<a name="l01797"></a>01797         <span class="keywordflow">if</span> (!dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>)
<a name="l01798"></a>01798                 tmp = 0x6464;
<a name="l01799"></a>01799         <span class="keywordflow">else</span>
<a name="l01800"></a>01800                 tmp = 0x4747;
<a name="l01801"></a>01801         <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 87), tmp);
<a name="l01802"></a>01802 
<a name="l01803"></a>01803         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01804"></a>01804                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">false</span>);
<a name="l01805"></a>01805 
<a name="l01806"></a>01806         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6e47bd8699e2b6d744caeddf2bdc7e69">B43_NPHY_SAMP_DEPCNT</a>, (samps - 1));
<a name="l01807"></a>01807 
<a name="l01808"></a>01808         <span class="keywordflow">if</span> (loops != 0xFFFF)
<a name="l01809"></a>01809                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#afd952d45ef1e364efe057d67c0916e79">B43_NPHY_SAMP_LOOPCNT</a>, (loops - 1));
<a name="l01810"></a>01810         <span class="keywordflow">else</span>
<a name="l01811"></a>01811                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#afd952d45ef1e364efe057d67c0916e79">B43_NPHY_SAMP_LOOPCNT</a>, loops);
<a name="l01812"></a>01812 
<a name="l01813"></a>01813         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a516a3621659736da6f3012bd988ea635">B43_NPHY_SAMP_WAITCNT</a>, wait);
<a name="l01814"></a>01814 
<a name="l01815"></a>01815         seq_mode = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>);
<a name="l01816"></a>01816 
<a name="l01817"></a>01817         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>, <a class="code" href="phy__n_8h.html#a144db07efc5c82bbeb82a81da8bec682">B43_NPHY_RFSEQMODE_CAOVER</a>);
<a name="l01818"></a>01818         <span class="keywordflow">if</span> (iqmode) {
<a name="l01819"></a>01819                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a9a86c85d2b27f7bf67cf77d2c8deae87">B43_NPHY_IQLOCAL_CMDGCTL</a>, 0x7FFF);
<a name="l01820"></a>01820                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a9a86c85d2b27f7bf67cf77d2c8deae87">B43_NPHY_IQLOCAL_CMDGCTL</a>, 0x8000);
<a name="l01821"></a>01821         } <span class="keywordflow">else</span> {
<a name="l01822"></a>01822                 <span class="keywordflow">if</span> (dac_test)
<a name="l01823"></a>01823                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2c61356acfcd1f02fb85161852ced497">B43_NPHY_SAMP_CMD</a>, 5);
<a name="l01824"></a>01824                 <span class="keywordflow">else</span>
<a name="l01825"></a>01825                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2c61356acfcd1f02fb85161852ced497">B43_NPHY_SAMP_CMD</a>, 1);
<a name="l01826"></a>01826         }
<a name="l01827"></a>01827         <span class="keywordflow">for</span> (i = 0; i &lt; 100; i++) {
<a name="l01828"></a>01828                 <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a93c852215e900b66092f7eaefdb4cc6a">B43_NPHY_RFSEQST</a>) &amp; 1) {
<a name="l01829"></a>01829                         i = 0;
<a name="l01830"></a>01830                         <span class="keywordflow">break</span>;
<a name="l01831"></a>01831                 }
<a name="l01832"></a>01832                 udelay(10);
<a name="l01833"></a>01833         }
<a name="l01834"></a>01834         <span class="keywordflow">if</span> (i)
<a name="l01835"></a>01835                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;run samples timeout\n&quot;</span>);
<a name="l01836"></a>01836 
<a name="l01837"></a>01837         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>, seq_mode);
<a name="l01838"></a>01838 }
<a name="l01839"></a>01839 
<a name="l01840"></a>01840 <span class="comment">/*</span>
<a name="l01841"></a>01841 <span class="comment"> * Transmits a known value for LO calibration</span>
<a name="l01842"></a>01842 <span class="comment"> * http://bcm-v4.sipsolutions.net/802.11/PHY/N/TXTone</span>
<a name="l01843"></a>01843 <span class="comment"> */</span>
<a name="l01844"></a><a class="code" href="phy__n_8c.html#a1cc412bbff4d1073f5fafc67ecb8d6dd">01844</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a1cc412bbff4d1073f5fafc67ecb8d6dd">b43_nphy_tx_tone</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u32 freq, u16 max_val,
<a name="l01845"></a>01845                                 <span class="keywordtype">bool</span> iqmode, <span class="keywordtype">bool</span> dac_test)
<a name="l01846"></a>01846 {
<a name="l01847"></a>01847         u16 samp = <a class="code" href="phy__n_8c.html#a93963744b23ae98744e3de32bd94c707">b43_nphy_gen_load_samples</a>(dev, freq, max_val, dac_test);
<a name="l01848"></a>01848         <span class="keywordflow">if</span> (samp == 0)
<a name="l01849"></a>01849                 <span class="keywordflow">return</span> -1;
<a name="l01850"></a>01850         <a class="code" href="phy__n_8c.html#a3fa62797735d6ea3ea0cc45691c205ce">b43_nphy_run_samples</a>(dev, samp, 0xFFFF, 0, iqmode, dac_test);
<a name="l01851"></a>01851         <span class="keywordflow">return</span> 0;
<a name="l01852"></a>01852 }
<a name="l01853"></a>01853 
<a name="l01854"></a>01854 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxPwrCtrlCoefSetup */</span>
<a name="l01855"></a><a class="code" href="phy__n_8c.html#a6ca84b077cdfbd885a692d440b82b6d4">01855</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a6ca84b077cdfbd885a692d440b82b6d4">b43_nphy_tx_pwr_ctrl_coef_setup</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01856"></a>01856 {
<a name="l01857"></a>01857         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01858"></a>01858         <span class="keywordtype">int</span> i, j;
<a name="l01859"></a>01859         u32 tmp;
<a name="l01860"></a>01860         u32 cur_real, cur_imag, real_part, imag_part;
<a name="l01861"></a>01861 
<a name="l01862"></a>01862         u16 buffer[7];
<a name="l01863"></a>01863 
<a name="l01864"></a>01864         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01865"></a>01865                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">true</span>);
<a name="l01866"></a>01866 
<a name="l01867"></a>01867         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 80), 7, buffer);
<a name="l01868"></a>01868 
<a name="l01869"></a>01869         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l01870"></a>01870                 tmp = ((buffer[i * 2] &amp; 0x3FF) &lt;&lt; 10) |
<a name="l01871"></a>01871                         (buffer[i * 2 + 1] &amp; 0x3FF);
<a name="l01872"></a>01872                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>,
<a name="l01873"></a>01873                                 (((i + 26) &lt;&lt; 10) | 320));
<a name="l01874"></a>01874                 <span class="keywordflow">for</span> (j = 0; j &lt; 128; j++) {
<a name="l01875"></a>01875                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a563a61b8fa108f81c3b8bf557dbdd2ee">B43_NPHY_TABLE_DATAHI</a>,
<a name="l01876"></a>01876                                         ((tmp &gt;&gt; 16) &amp; 0xFFFF));
<a name="l01877"></a>01877                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>,
<a name="l01878"></a>01878                                         (tmp &amp; 0xFFFF));
<a name="l01879"></a>01879                 }
<a name="l01880"></a>01880         }
<a name="l01881"></a>01881 
<a name="l01882"></a>01882         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l01883"></a>01883                 tmp = buffer[5 + i];
<a name="l01884"></a>01884                 real_part = (tmp &gt;&gt; 8) &amp; 0xFF;
<a name="l01885"></a>01885                 imag_part = (tmp &amp; 0xFF);
<a name="l01886"></a>01886                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7962479a136a54370d2c2ce11fd8d599">B43_NPHY_TABLE_ADDR</a>,
<a name="l01887"></a>01887                                 (((i + 26) &lt;&lt; 10) | 448));
<a name="l01888"></a>01888 
<a name="l01889"></a>01889                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l01890"></a>01890                         cur_real = real_part;
<a name="l01891"></a>01891                         cur_imag = imag_part;
<a name="l01892"></a>01892                         tmp = ((cur_real &amp; 0xFF) &lt;&lt; 8) | (cur_imag &amp; 0xFF);
<a name="l01893"></a>01893                 }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895                 <span class="keywordflow">for</span> (j = 0; j &lt; 128; j++) {
<a name="l01896"></a>01896                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3) {
<a name="l01897"></a>01897                                 cur_real = (real_part * <a class="code" href="tables__nphy_8c.html#a018b785805cc95811ef9e4f11355869b">loscale</a>[j] + 128) &gt;&gt; 8;
<a name="l01898"></a>01898                                 cur_imag = (imag_part * <a class="code" href="tables__nphy_8c.html#a018b785805cc95811ef9e4f11355869b">loscale</a>[j] + 128) &gt;&gt; 8;
<a name="l01899"></a>01899                                 tmp = ((cur_real &amp; 0xFF) &lt;&lt; 8) |
<a name="l01900"></a>01900                                         (cur_imag &amp; 0xFF);
<a name="l01901"></a>01901                         }
<a name="l01902"></a>01902                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a563a61b8fa108f81c3b8bf557dbdd2ee">B43_NPHY_TABLE_DATAHI</a>,
<a name="l01903"></a>01903                                         ((tmp &gt;&gt; 16) &amp; 0xFFFF));
<a name="l01904"></a>01904                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a5bf82a8c4946c2da7e01f28c08217fc8">B43_NPHY_TABLE_DATALO</a>,
<a name="l01905"></a>01905                                         (tmp &amp; 0xFFFF));
<a name="l01906"></a>01906                 }
<a name="l01907"></a>01907         }
<a name="l01908"></a>01908 
<a name="l01909"></a>01909         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l01910"></a>01910                 <a class="code" href="main_8c.html#a28f7e4e0e4386f41d555003b22b2775f">b43_shm_write16</a>(dev, <a class="code" href="b43_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf1176fce48515a37f9be16ac9d71f782">B43_SHM_SHARED</a>,
<a name="l01911"></a>01911                                 <a class="code" href="b43_8h.html#aac5489abdcbefbb65baee3a595c275c5">B43_SHM_SH_NPHY_TXPWR_INDX0</a>, 0xFFFF);
<a name="l01912"></a>01912                 <a class="code" href="main_8c.html#a28f7e4e0e4386f41d555003b22b2775f">b43_shm_write16</a>(dev, <a class="code" href="b43_8h.html#a06fc87d81c62e9abb8790b6e5713c55baf1176fce48515a37f9be16ac9d71f782">B43_SHM_SHARED</a>,
<a name="l01913"></a>01913                                 <a class="code" href="b43_8h.html#a4376b7915076e83cf5d36bfb73efb513">B43_SHM_SH_NPHY_TXPWR_INDX1</a>, 0xFFFF);
<a name="l01914"></a>01914         }
<a name="l01915"></a>01915 
<a name="l01916"></a>01916         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01917"></a>01917                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">false</span>);
<a name="l01918"></a>01918 }
<a name="l01919"></a>01919 
<a name="l01920"></a>01920 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/SetRfSeq */</span>
<a name="l01921"></a><a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">01921</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a4f16307665bc4a82055e3e1a442ae0b1">b43_nphy_set_rf_sequence</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 cmd,
<a name="l01922"></a>01922                                         u8 *events, u8 *delays, u8 length)
<a name="l01923"></a>01923 {
<a name="l01924"></a>01924         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l01925"></a>01925         u8 i;
<a name="l01926"></a>01926         u8 end = (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) ? 0x1F : 0x0F;
<a name="l01927"></a>01927         u16 offset1 = cmd &lt;&lt; 4;
<a name="l01928"></a>01928         u16 offset2 = offset1 + 0x80;
<a name="l01929"></a>01929 
<a name="l01930"></a>01930         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01931"></a>01931                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">true</span>);
<a name="l01932"></a>01932 
<a name="l01933"></a>01933         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(7, offset1), length, events);
<a name="l01934"></a>01934         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(7, offset2), length, delays);
<a name="l01935"></a>01935 
<a name="l01936"></a>01936         <span class="keywordflow">for</span> (i = length; i &lt; 16; i++) {
<a name="l01937"></a>01937                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(7, offset1 + i), end);
<a name="l01938"></a>01938                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#ae4a1ec7778834cd8090df0fd5372101e">B43_NTAB8</a>(7, offset2 + i), 1);
<a name="l01939"></a>01939         }
<a name="l01940"></a>01940 
<a name="l01941"></a>01941         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l01942"></a>01942                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">false</span>);
<a name="l01943"></a>01943 }
<a name="l01944"></a>01944 
<a name="l01945"></a>01945 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/ForceRFSeq */</span>
<a name="l01946"></a><a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">01946</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l01947"></a>01947                                        <span class="keyword">enum</span> <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884">b43_nphy_rf_sequence</a> seq)
<a name="l01948"></a>01948 {
<a name="l01949"></a>01949         <span class="keyword">static</span> <span class="keyword">const</span> u16 trigger[] = {
<a name="l01950"></a>01950                 [<a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a687bba92ab195b6597b210d2dab0faca">B43_RFSEQ_RX2TX</a>]               = <a class="code" href="phy__n_8h.html#ad1ee5d65e7384018fb6912e78308f8d4">B43_NPHY_RFSEQTR_RX2TX</a>,
<a name="l01951"></a>01951                 [<a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884aebb467d28fe77d5b3de37488deba0c2d">B43_RFSEQ_TX2RX</a>]               = <a class="code" href="phy__n_8h.html#a79d21b6580cee02d2b20ee644c10abb5">B43_NPHY_RFSEQTR_TX2RX</a>,
<a name="l01952"></a>01952                 [<a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>]            = <a class="code" href="phy__n_8h.html#adc0f6a10894d35dd30f088c5a98356c6">B43_NPHY_RFSEQTR_RST2RX</a>,
<a name="l01953"></a>01953                 [<a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a41f9827ee907d73957dc5854aa48a1a6">B43_RFSEQ_UPDATE_GAINH</a>]        = <a class="code" href="phy__n_8h.html#a6d13b65a082768ca648ce1884bb4ac34">B43_NPHY_RFSEQTR_UPGH</a>,
<a name="l01954"></a>01954                 [<a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ac6f57cf3883b08c02bebb92032c417ce">B43_RFSEQ_UPDATE_GAINL</a>]        = <a class="code" href="phy__n_8h.html#a800e7600e877f99fc15543d271f8798c">B43_NPHY_RFSEQTR_UPGL</a>,
<a name="l01955"></a>01955                 [<a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ac3d0d2894c6f20e710421036573bd55f">B43_RFSEQ_UPDATE_GAINU</a>]        = <a class="code" href="phy__n_8h.html#a190a90322dc3fe0789b0d4d2357d817d">B43_NPHY_RFSEQTR_UPGU</a>,
<a name="l01956"></a>01956         };
<a name="l01957"></a>01957         <span class="keywordtype">int</span> i;
<a name="l01958"></a>01958         u16 seq_mode = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>);
<a name="l01959"></a>01959 
<a name="l01960"></a>01960         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(seq &gt;= ARRAY_SIZE(trigger));
<a name="l01961"></a>01961 
<a name="l01962"></a>01962         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>,
<a name="l01963"></a>01963                     <a class="code" href="phy__n_8h.html#a144db07efc5c82bbeb82a81da8bec682">B43_NPHY_RFSEQMODE_CAOVER</a> | <a class="code" href="phy__n_8h.html#ac69768a474e6af51fb163bd98e8aab80">B43_NPHY_RFSEQMODE_TROVER</a>);
<a name="l01964"></a>01964         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#ad6200f0bcacd434739f2c4d3dba8b458">B43_NPHY_RFSEQTR</a>, trigger[seq]);
<a name="l01965"></a>01965         <span class="keywordflow">for</span> (i = 0; i &lt; 200; i++) {
<a name="l01966"></a>01966                 <span class="keywordflow">if</span> (!(<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a93c852215e900b66092f7eaefdb4cc6a">B43_NPHY_RFSEQST</a>) &amp; trigger[seq]))
<a name="l01967"></a>01967                         <span class="keywordflow">goto</span> ok;
<a name="l01968"></a>01968                 msleep(1);
<a name="l01969"></a>01969         }
<a name="l01970"></a>01970         <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;RF sequence status timeout\n&quot;</span>);
<a name="l01971"></a>01971 ok:
<a name="l01972"></a>01972         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>, seq_mode);
<a name="l01973"></a>01973 }
<a name="l01974"></a>01974 
<a name="l01975"></a>01975 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RFCtrlOverride */</span>
<a name="l01976"></a><a class="code" href="phy__n_8c.html#a7a9358c4ccb7f2049eae9611b1b2e9c6">01976</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a7a9358c4ccb7f2049eae9611b1b2e9c6">b43_nphy_rf_control_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 field,
<a name="l01977"></a>01977                                                 u16 value, u8 core, <span class="keywordtype">bool</span> off)
<a name="l01978"></a>01978 {
<a name="l01979"></a>01979         <span class="keywordtype">int</span> i;
<a name="l01980"></a>01980         u8 index = fls(field);
<a name="l01981"></a>01981         u8 addr, en_addr, val_addr;
<a name="l01982"></a>01982         <span class="comment">/* we expect only one bit set */</span>
<a name="l01983"></a>01983         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(field &amp; (~(1 &lt;&lt; (index - 1))));
<a name="l01984"></a>01984 
<a name="l01985"></a>01985         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l01986"></a>01986                 <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structnphy__rf__control__override__rev3.html">nphy_rf_control_override_rev3</a> *rf_ctrl;
<a name="l01987"></a>01987                 <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l01988"></a>01988                         <span class="keywordflow">if</span> (index == 0 || index == 16) {
<a name="l01989"></a>01989                                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>,
<a name="l01990"></a>01990                                         <span class="stringliteral">&quot;Unsupported RF Ctrl Override call\n&quot;</span>);
<a name="l01991"></a>01991                                 <span class="keywordflow">return</span>;
<a name="l01992"></a>01992                         }
<a name="l01993"></a>01993 
<a name="l01994"></a>01994                         rf_ctrl = &amp;<a class="code" href="tables__nphy_8c.html#a0369ffc40c092784d3b56c27a03ea721">tbl_rf_control_override_rev3</a>[index - 1];
<a name="l01995"></a>01995                         en_addr = <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>((i == 0) ?
<a name="l01996"></a>01996                                 rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev3.html#a5f6a583ba8cba5e311ec51c27d4e9557">en_addr0</a> : rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev3.html#a47d23933d0430cf33921098e85e72665">en_addr1</a>);
<a name="l01997"></a>01997                         val_addr = <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>((i == 0) ?
<a name="l01998"></a>01998                                 rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev3.html#adb51ff033ce171b2c76e9ffa911ff33e">val_addr0</a> : rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev3.html#ad4f65b17fcb2a80cd8ba0befbb8c34f1">val_addr1</a>);
<a name="l01999"></a>01999 
<a name="l02000"></a>02000                         <span class="keywordflow">if</span> (off) {
<a name="l02001"></a>02001                                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, en_addr, ~(field));
<a name="l02002"></a>02002                                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, val_addr,
<a name="l02003"></a>02003                                                 ~(rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev3.html#a81d86ec60b1502f7fbe6b20a1ae26a65">val_mask</a>));
<a name="l02004"></a>02004                         } <span class="keywordflow">else</span> {
<a name="l02005"></a>02005                                 <span class="keywordflow">if</span> (core == 0 || ((1 &lt;&lt; core) &amp; i) != 0) {
<a name="l02006"></a>02006                                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, en_addr, field);
<a name="l02007"></a>02007                                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, val_addr,
<a name="l02008"></a>02008                                                 ~(rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev3.html#a81d86ec60b1502f7fbe6b20a1ae26a65">val_mask</a>),
<a name="l02009"></a>02009                                                 (value &lt;&lt; rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev3.html#a62b0e8d052af4ce388ee117a83a17e37">val_shift</a>));
<a name="l02010"></a>02010                                 }
<a name="l02011"></a>02011                         }
<a name="l02012"></a>02012                 }
<a name="l02013"></a>02013         } <span class="keywordflow">else</span> {
<a name="l02014"></a>02014                 <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structnphy__rf__control__override__rev2.html">nphy_rf_control_override_rev2</a> *rf_ctrl;
<a name="l02015"></a>02015                 <span class="keywordflow">if</span> (off) {
<a name="l02016"></a>02016                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, ~(field));
<a name="l02017"></a>02017                         value = 0;
<a name="l02018"></a>02018                 } <span class="keywordflow">else</span> {
<a name="l02019"></a>02019                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, field);
<a name="l02020"></a>02020                 }
<a name="l02021"></a>02021 
<a name="l02022"></a>02022                 <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l02023"></a>02023                         <span class="keywordflow">if</span> (index &lt;= 1 || index == 16) {
<a name="l02024"></a>02024                                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>,
<a name="l02025"></a>02025                                         <span class="stringliteral">&quot;Unsupported RF Ctrl Override call\n&quot;</span>);
<a name="l02026"></a>02026                                 <span class="keywordflow">return</span>;
<a name="l02027"></a>02027                         }
<a name="l02028"></a>02028 
<a name="l02029"></a>02029                         <span class="keywordflow">if</span> (index == 2 || index == 10 ||
<a name="l02030"></a>02030                             (index &gt;= 13 &amp;&amp; index &lt;= 15)) {
<a name="l02031"></a>02031                                 core = 1;
<a name="l02032"></a>02032                         }
<a name="l02033"></a>02033 
<a name="l02034"></a>02034                         rf_ctrl = &amp;<a class="code" href="tables__nphy_8c.html#aa6c578a7a628b48092f473422d9ad851">tbl_rf_control_override_rev2</a>[index - 2];
<a name="l02035"></a>02035                         addr = <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>((i == 0) ?
<a name="l02036"></a>02036                                 rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev2.html#aae2e27edf08f4291997ef3219c1b5a99">addr0</a> : rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev2.html#a8890d66c9276fa36e0f8deea6ba5618d">addr1</a>);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038                         <span class="keywordflow">if</span> ((core &amp; (1 &lt;&lt; i)) != 0)
<a name="l02039"></a>02039                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, addr, ~(rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev2.html#acd857266ee263fcfd012562950d4e922">bmask</a>),
<a name="l02040"></a>02040                                                 (value &lt;&lt; rf_ctrl-&gt;<a class="code" href="structnphy__rf__control__override__rev2.html#ab39af125f6c41540883d7b05ab7c50ff">shift</a>));
<a name="l02041"></a>02041 
<a name="l02042"></a>02042                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, 0x1);
<a name="l02043"></a>02043                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l02044"></a>02044                                         <a class="code" href="phy__n_8h.html#a82a4d0ce218c6b51f85b73786948b9ba">B43_NPHY_RFCTL_CMD_START</a>);
<a name="l02045"></a>02045                         udelay(1);
<a name="l02046"></a>02046                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, 0xFFFE);
<a name="l02047"></a>02047                 }
<a name="l02048"></a>02048         }
<a name="l02049"></a>02049 }
<a name="l02050"></a>02050 
<a name="l02051"></a>02051 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RFCtrlIntcOverride */</span>
<a name="l02052"></a><a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">02052</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 field,
<a name="l02053"></a>02053                                                 u16 value, u8 core)
<a name="l02054"></a>02054 {
<a name="l02055"></a>02055         u8 i, j;
<a name="l02056"></a>02056         u16 reg, tmp, val;
<a name="l02057"></a>02057 
<a name="l02058"></a>02058         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3);
<a name="l02059"></a>02059         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(field &gt; 4);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l02062"></a>02062                 <span class="keywordflow">if</span> ((core == 1 &amp;&amp; i == 1) || (core == 2 &amp;&amp; !i))
<a name="l02063"></a>02063                         <span class="keywordflow">continue</span>;
<a name="l02064"></a>02064 
<a name="l02065"></a>02065                 reg = (i == 0) ?
<a name="l02066"></a>02066                         <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a> : <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>;
<a name="l02067"></a>02067                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, reg, 0xFBFF);
<a name="l02068"></a>02068 
<a name="l02069"></a>02069                 <span class="keywordflow">switch</span> (field) {
<a name="l02070"></a>02070                 <span class="keywordflow">case</span> 0:
<a name="l02071"></a>02071                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, reg, 0);
<a name="l02072"></a>02072                         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>);
<a name="l02073"></a>02073                         <span class="keywordflow">break</span>;
<a name="l02074"></a>02074                 <span class="keywordflow">case</span> 1:
<a name="l02075"></a>02075                         <span class="keywordflow">if</span> (!i) {
<a name="l02076"></a>02076                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>,
<a name="l02077"></a>02077                                                 0xFC3F, (value &lt;&lt; 6));
<a name="l02078"></a>02078                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a6fd43e203878adf4a3e647ef6a755587">B43_NPHY_TXF_40CO_B1S1</a>,
<a name="l02079"></a>02079                                                 0xFFFE, 1);
<a name="l02080"></a>02080                                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l02081"></a>02081                                                 <a class="code" href="phy__n_8h.html#a82a4d0ce218c6b51f85b73786948b9ba">B43_NPHY_RFCTL_CMD_START</a>);
<a name="l02082"></a>02082                                 <span class="keywordflow">for</span> (j = 0; j &lt; 100; j++) {
<a name="l02083"></a>02083                                         <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>) &amp; <a class="code" href="phy__n_8h.html#a82a4d0ce218c6b51f85b73786948b9ba">B43_NPHY_RFCTL_CMD_START</a>) {
<a name="l02084"></a>02084                                                 j = 0;
<a name="l02085"></a>02085                                                 <span class="keywordflow">break</span>;
<a name="l02086"></a>02086                                         }
<a name="l02087"></a>02087                                         udelay(10);
<a name="l02088"></a>02088                                 }
<a name="l02089"></a>02089                                 <span class="keywordflow">if</span> (j)
<a name="l02090"></a>02090                                         <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>,
<a name="l02091"></a>02091                                                 <span class="stringliteral">&quot;intc override timeout\n&quot;</span>);
<a name="l02092"></a>02092                                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a6fd43e203878adf4a3e647ef6a755587">B43_NPHY_TXF_40CO_B1S1</a>,
<a name="l02093"></a>02093                                                 0xFFFE);
<a name="l02094"></a>02094                         } <span class="keywordflow">else</span> {
<a name="l02095"></a>02095                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>,
<a name="l02096"></a>02096                                                 0xFC3F, (value &lt;&lt; 6));
<a name="l02097"></a>02097                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>,
<a name="l02098"></a>02098                                                 0xFFFE, 1);
<a name="l02099"></a>02099                                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l02100"></a>02100                                                 <a class="code" href="phy__n_8h.html#a44de891e9565791251a7fd7658244680">B43_NPHY_RFCTL_CMD_RXTX</a>);
<a name="l02101"></a>02101                                 <span class="keywordflow">for</span> (j = 0; j &lt; 100; j++) {
<a name="l02102"></a>02102                                         <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>) &amp; <a class="code" href="phy__n_8h.html#a44de891e9565791251a7fd7658244680">B43_NPHY_RFCTL_CMD_RXTX</a>) {
<a name="l02103"></a>02103                                                 j = 0;
<a name="l02104"></a>02104                                                 <span class="keywordflow">break</span>;
<a name="l02105"></a>02105                                         }
<a name="l02106"></a>02106                                         udelay(10);
<a name="l02107"></a>02107                                 }
<a name="l02108"></a>02108                                 <span class="keywordflow">if</span> (j)
<a name="l02109"></a>02109                                         <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>,
<a name="l02110"></a>02110                                                 <span class="stringliteral">&quot;intc override timeout\n&quot;</span>);
<a name="l02111"></a>02111                                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>,
<a name="l02112"></a>02112                                                 0xFFFE);
<a name="l02113"></a>02113                         }
<a name="l02114"></a>02114                         <span class="keywordflow">break</span>;
<a name="l02115"></a>02115                 <span class="keywordflow">case</span> 2:
<a name="l02116"></a>02116                         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) {
<a name="l02117"></a>02117                                 tmp = 0x0020;
<a name="l02118"></a>02118                                 val = value &lt;&lt; 5;
<a name="l02119"></a>02119                         } <span class="keywordflow">else</span> {
<a name="l02120"></a>02120                                 tmp = 0x0010;
<a name="l02121"></a>02121                                 val = value &lt;&lt; 4;
<a name="l02122"></a>02122                         }
<a name="l02123"></a>02123                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, ~tmp, val);
<a name="l02124"></a>02124                         <span class="keywordflow">break</span>;
<a name="l02125"></a>02125                 <span class="keywordflow">case</span> 3:
<a name="l02126"></a>02126                         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) {
<a name="l02127"></a>02127                                 tmp = 0x0001;
<a name="l02128"></a>02128                                 val = value;
<a name="l02129"></a>02129                         } <span class="keywordflow">else</span> {
<a name="l02130"></a>02130                                 tmp = 0x0004;
<a name="l02131"></a>02131                                 val = value &lt;&lt; 2;
<a name="l02132"></a>02132                         }
<a name="l02133"></a>02133                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, ~tmp, val);
<a name="l02134"></a>02134                         <span class="keywordflow">break</span>;
<a name="l02135"></a>02135                 <span class="keywordflow">case</span> 4:
<a name="l02136"></a>02136                         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) {
<a name="l02137"></a>02137                                 tmp = 0x0002;
<a name="l02138"></a>02138                                 val = value &lt;&lt; 1;
<a name="l02139"></a>02139                         } <span class="keywordflow">else</span> {
<a name="l02140"></a>02140                                 tmp = 0x0008;
<a name="l02141"></a>02141                                 val = value &lt;&lt; 3;
<a name="l02142"></a>02142                         }
<a name="l02143"></a>02143                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, ~tmp, val);
<a name="l02144"></a>02144                         <span class="keywordflow">break</span>;
<a name="l02145"></a>02145                 }
<a name="l02146"></a>02146         }
<a name="l02147"></a>02147 }
<a name="l02148"></a>02148 
<a name="l02149"></a>02149 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/BPHYInit */</span>
<a name="l02150"></a><a class="code" href="phy__n_8c.html#add8cb2b248ac9565dd44b37a57c64afe">02150</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#add8cb2b248ac9565dd44b37a57c64afe">b43_nphy_bphy_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02151"></a>02151 {
<a name="l02152"></a>02152         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l02153"></a>02153         u16 val;
<a name="l02154"></a>02154 
<a name="l02155"></a>02155         val = 0x1E1F;
<a name="l02156"></a>02156         <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
<a name="l02157"></a>02157                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a2a482ed6edac070e663a29c870d21609">B43_PHY_N_BMODE</a>(0x88 + i), val);
<a name="l02158"></a>02158                 val -= 0x202;
<a name="l02159"></a>02159         }
<a name="l02160"></a>02160         val = 0x3E3F;
<a name="l02161"></a>02161         <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
<a name="l02162"></a>02162                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a2a482ed6edac070e663a29c870d21609">B43_PHY_N_BMODE</a>(0x98 + i), val);
<a name="l02163"></a>02163                 val -= 0x202;
<a name="l02164"></a>02164         }
<a name="l02165"></a>02165         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a2a482ed6edac070e663a29c870d21609">B43_PHY_N_BMODE</a>(0x38), 0x668);
<a name="l02166"></a>02166 }
<a name="l02167"></a>02167 
<a name="l02168"></a>02168 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/ScaleOffsetRssi */</span>
<a name="l02169"></a><a class="code" href="phy__n_8c.html#ab79bb947e55a8cb8929b62856fd3eaf3">02169</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ab79bb947e55a8cb8929b62856fd3eaf3">b43_nphy_scale_offset_rssi</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 scale,
<a name="l02170"></a>02170                                         s8 offset, u8 core, u8 rail,
<a name="l02171"></a>02171                                         <span class="keyword">enum</span> <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658e">b43_nphy_rssi_type</a> type)
<a name="l02172"></a>02172 {
<a name="l02173"></a>02173         u16 tmp;
<a name="l02174"></a>02174         <span class="keywordtype">bool</span> core1or5 = (core == 1) || (core == 5);
<a name="l02175"></a>02175         <span class="keywordtype">bool</span> core2or5 = (core == 2) || (core == 5);
<a name="l02176"></a>02176 
<a name="l02177"></a>02177         offset = clamp_val(offset, -32, 31);
<a name="l02178"></a>02178         tmp = ((scale &amp; 0x3F) &lt;&lt; 8) | (offset &amp; 0x3F);
<a name="l02179"></a>02179 
<a name="l02180"></a>02180         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eac911ea9e301ee207723bfc2aa3cdf1bf">B43_NPHY_RSSI_Z</a>))
<a name="l02181"></a>02181                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aaab6a3cafdb589842d337aa3189ed626">B43_NPHY_RSSIMC_0I_RSSI_Z</a>, tmp);
<a name="l02182"></a>02182         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eac911ea9e301ee207723bfc2aa3cdf1bf">B43_NPHY_RSSI_Z</a>))
<a name="l02183"></a>02183                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6a7e7df8574c312e490634d206df8fc3">B43_NPHY_RSSIMC_0Q_RSSI_Z</a>, tmp);
<a name="l02184"></a>02184         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eac911ea9e301ee207723bfc2aa3cdf1bf">B43_NPHY_RSSI_Z</a>))
<a name="l02185"></a>02185                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae9874483e08bec1e35cf084be9763d84">B43_NPHY_RSSIMC_1I_RSSI_Z</a>, tmp);
<a name="l02186"></a>02186         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eac911ea9e301ee207723bfc2aa3cdf1bf">B43_NPHY_RSSI_Z</a>))
<a name="l02187"></a>02187                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a547988cf771fd29a1840b2ff72a07d7b">B43_NPHY_RSSIMC_1Q_RSSI_Z</a>, tmp);
<a name="l02188"></a>02188 
<a name="l02189"></a>02189         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaaf7f62cd909edd45fdcf0b2bec9c1337">B43_NPHY_RSSI_X</a>))
<a name="l02190"></a>02190                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6621ffc5d55f7370227681d19c53820c">B43_NPHY_RSSIMC_0I_RSSI_X</a>, tmp);
<a name="l02191"></a>02191         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaaf7f62cd909edd45fdcf0b2bec9c1337">B43_NPHY_RSSI_X</a>))
<a name="l02192"></a>02192                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2d92187e2575791ce1471a8e0b277b5e">B43_NPHY_RSSIMC_0Q_RSSI_X</a>, tmp);
<a name="l02193"></a>02193         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaaf7f62cd909edd45fdcf0b2bec9c1337">B43_NPHY_RSSI_X</a>))
<a name="l02194"></a>02194                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a3b407730c31853a04fa4205a53b64e2b">B43_NPHY_RSSIMC_1I_RSSI_X</a>, tmp);
<a name="l02195"></a>02195         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaaf7f62cd909edd45fdcf0b2bec9c1337">B43_NPHY_RSSI_X</a>))
<a name="l02196"></a>02196                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9ecf8f76c494e98ef682d5ccbbed2467">B43_NPHY_RSSIMC_1Q_RSSI_X</a>, tmp);
<a name="l02197"></a>02197 
<a name="l02198"></a>02198         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea943e9ddbcfc8d0d6c007d9afa7dafa63">B43_NPHY_RSSI_Y</a>))
<a name="l02199"></a>02199                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad3fee3e8b0e3f5126c402cc240f155b3">B43_NPHY_RSSIMC_0I_RSSI_Y</a>, tmp);
<a name="l02200"></a>02200         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea943e9ddbcfc8d0d6c007d9afa7dafa63">B43_NPHY_RSSI_Y</a>))
<a name="l02201"></a>02201                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a55a8f99f322db46ea7fef4871d1ebb8b">B43_NPHY_RSSIMC_0Q_RSSI_Y</a>, tmp);
<a name="l02202"></a>02202         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea943e9ddbcfc8d0d6c007d9afa7dafa63">B43_NPHY_RSSI_Y</a>))
<a name="l02203"></a>02203                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af461be6b6a1f2b910bc32a93a67b27c0">B43_NPHY_RSSIMC_1I_RSSI_Y</a>, tmp);
<a name="l02204"></a>02204         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea943e9ddbcfc8d0d6c007d9afa7dafa63">B43_NPHY_RSSI_Y</a>))
<a name="l02205"></a>02205                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aa3fec39e0ac7696304bfe4af9d514adf">B43_NPHY_RSSIMC_1Q_RSSI_Y</a>, tmp);
<a name="l02206"></a>02206 
<a name="l02207"></a>02207         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea0e5bcc25f05cea6e3afee93fc84a6809">B43_NPHY_RSSI_TBD</a>))
<a name="l02208"></a>02208                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a10a389ef294b7c1fa11a58094a1ed719">B43_NPHY_RSSIMC_0I_TBD</a>, tmp);
<a name="l02209"></a>02209         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea0e5bcc25f05cea6e3afee93fc84a6809">B43_NPHY_RSSI_TBD</a>))
<a name="l02210"></a>02210                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a4512e7325f7df18867ab2cf08c7ffa7d">B43_NPHY_RSSIMC_0Q_TBD</a>, tmp);
<a name="l02211"></a>02211         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea0e5bcc25f05cea6e3afee93fc84a6809">B43_NPHY_RSSI_TBD</a>))
<a name="l02212"></a>02212                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a50c2ff981d04af754531edefa6976e43">B43_NPHY_RSSIMC_1I_TBD</a>, tmp);
<a name="l02213"></a>02213         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea0e5bcc25f05cea6e3afee93fc84a6809">B43_NPHY_RSSI_TBD</a>))
<a name="l02214"></a>02214                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ab159dc8d1eacb5c00840241656e13885">B43_NPHY_RSSIMC_1Q_TBD</a>, tmp);
<a name="l02215"></a>02215 
<a name="l02216"></a>02216         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea3d2c48c5361f5f082f86be8cc3cc3430">B43_NPHY_RSSI_PWRDET</a>))
<a name="l02217"></a>02217                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ac42ac23bff74c3545b1e2c16c914abe5">B43_NPHY_RSSIMC_0I_PWRDET</a>, tmp);
<a name="l02218"></a>02218         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea3d2c48c5361f5f082f86be8cc3cc3430">B43_NPHY_RSSI_PWRDET</a>))
<a name="l02219"></a>02219                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a4a7026d22451dad8f5f6652f2329e3b8">B43_NPHY_RSSIMC_0Q_PWRDET</a>, tmp);
<a name="l02220"></a>02220         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 0) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea3d2c48c5361f5f082f86be8cc3cc3430">B43_NPHY_RSSI_PWRDET</a>))
<a name="l02221"></a>02221                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a593066c2bbf8e53c5a43817fe9d33766">B43_NPHY_RSSIMC_1I_PWRDET</a>, tmp);
<a name="l02222"></a>02222         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (rail == 1) &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea3d2c48c5361f5f082f86be8cc3cc3430">B43_NPHY_RSSI_PWRDET</a>))
<a name="l02223"></a>02223                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#abea36e4d555ecb154e1001011174835f">B43_NPHY_RSSIMC_1Q_PWRDET</a>, tmp);
<a name="l02224"></a>02224 
<a name="l02225"></a>02225         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa6cf6d0394400f1a3e7e2c8d4bb6bc56">B43_NPHY_RSSI_TSSI_I</a>))
<a name="l02226"></a>02226                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a202f9b4813670c560ec5f944aeec8138">B43_NPHY_RSSIMC_0I_TSSI</a>, tmp);
<a name="l02227"></a>02227         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa6cf6d0394400f1a3e7e2c8d4bb6bc56">B43_NPHY_RSSI_TSSI_I</a>))
<a name="l02228"></a>02228                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a581108438a71b14faea65c73683a7489">B43_NPHY_RSSIMC_1I_TSSI</a>, tmp);
<a name="l02229"></a>02229 
<a name="l02230"></a>02230         <span class="keywordflow">if</span> (core1or5 &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa33b47acbffff5c9b99140e5bc06dba9">B43_NPHY_RSSI_TSSI_Q</a>))
<a name="l02231"></a>02231                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af126416b263286d6a6c7e656970d5c12">B43_NPHY_RSSIMC_0Q_TSSI</a>, tmp);
<a name="l02232"></a>02232         <span class="keywordflow">if</span> (core2or5 &amp;&amp; (type == <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaa33b47acbffff5c9b99140e5bc06dba9">B43_NPHY_RSSI_TSSI_Q</a>))
<a name="l02233"></a>02233                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a407218d0e05acc23d809100ed87060b1">B43_NPHY_RSSIMC_1Q_TSSI</a>, tmp);
<a name="l02234"></a>02234 }
<a name="l02235"></a>02235 
<a name="l02236"></a><a class="code" href="phy__n_8c.html#a470a670aae7f12f8dd594d2827289752">02236</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a470a670aae7f12f8dd594d2827289752">b43_nphy_rev2_rssi_select</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 code, u8 type)
<a name="l02237"></a>02237 {
<a name="l02238"></a>02238         u16 val;
<a name="l02239"></a>02239 
<a name="l02240"></a>02240         <span class="keywordflow">if</span> (type &lt; 3)
<a name="l02241"></a>02241                 val = 0;
<a name="l02242"></a>02242         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 6)
<a name="l02243"></a>02243                 val = 1;
<a name="l02244"></a>02244         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 3)
<a name="l02245"></a>02245                 val = 2;
<a name="l02246"></a>02246         <span class="keywordflow">else</span>
<a name="l02247"></a>02247                 val = 3;
<a name="l02248"></a>02248 
<a name="l02249"></a>02249         val = (val &lt;&lt; 12) | (val &lt;&lt; 14);
<a name="l02250"></a>02250         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, 0x0FFF, val);
<a name="l02251"></a>02251         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, 0x0FFF, val);
<a name="l02252"></a>02252 
<a name="l02253"></a>02253         <span class="keywordflow">if</span> (type &lt; 3) {
<a name="l02254"></a>02254                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a1a3f176d0383816dc05fb52523c85c71">B43_NPHY_RFCTL_RSSIO1</a>, 0xFFCF,
<a name="l02255"></a>02255                                 (type + 1) &lt;&lt; 4);
<a name="l02256"></a>02256                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ab29867b3d0c83b2debd083003efba46c">B43_NPHY_RFCTL_RSSIO2</a>, 0xFFCF,
<a name="l02257"></a>02257                                 (type + 1) &lt;&lt; 4);
<a name="l02258"></a>02258         }
<a name="l02259"></a>02259 
<a name="l02260"></a>02260         <span class="keywordflow">if</span> (code == 0) {
<a name="l02261"></a>02261                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, ~0x3000);
<a name="l02262"></a>02262                 <span class="keywordflow">if</span> (type &lt; 3) {
<a name="l02263"></a>02263                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l02264"></a>02264                                 ~(<a class="code" href="phy__n_8h.html#a4bd8fb6c795e6b16cfa3d3230d43d6d5">B43_NPHY_RFCTL_CMD_RXEN</a> |
<a name="l02265"></a>02265                                   <a class="code" href="phy__n_8h.html#ae5598eb1b66430b28a97d8406f5cc3a6">B43_NPHY_RFCTL_CMD_CORESEL</a>));
<a name="l02266"></a>02266                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>,
<a name="l02267"></a>02267                                 ~(0x1 &lt;&lt; 12 |
<a name="l02268"></a>02268                                   0x1 &lt;&lt; 5 |
<a name="l02269"></a>02269                                   0x1 &lt;&lt; 1 |
<a name="l02270"></a>02270                                   0x1));
<a name="l02271"></a>02271                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l02272"></a>02272                                 ~<a class="code" href="phy__n_8h.html#a82a4d0ce218c6b51f85b73786948b9ba">B43_NPHY_RFCTL_CMD_START</a>);
<a name="l02273"></a>02273                         udelay(20);
<a name="l02274"></a>02274                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, ~0x1);
<a name="l02275"></a>02275                 }
<a name="l02276"></a>02276         } <span class="keywordflow">else</span> {
<a name="l02277"></a>02277                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0x3000);
<a name="l02278"></a>02278                 <span class="keywordflow">if</span> (type &lt; 3) {
<a name="l02279"></a>02279                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l02280"></a>02280                                 ~(<a class="code" href="phy__n_8h.html#a4bd8fb6c795e6b16cfa3d3230d43d6d5">B43_NPHY_RFCTL_CMD_RXEN</a> |
<a name="l02281"></a>02281                                   <a class="code" href="phy__n_8h.html#ae5598eb1b66430b28a97d8406f5cc3a6">B43_NPHY_RFCTL_CMD_CORESEL</a>),
<a name="l02282"></a>02282                                 (<a class="code" href="phy__n_8h.html#a4bd8fb6c795e6b16cfa3d3230d43d6d5">B43_NPHY_RFCTL_CMD_RXEN</a> |
<a name="l02283"></a>02283                                  code &lt;&lt; <a class="code" href="phy__n_8h.html#ae3d88d9b5c4524275f128992abb19919">B43_NPHY_RFCTL_CMD_CORESEL_SHIFT</a>));
<a name="l02284"></a>02284                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>,
<a name="l02285"></a>02285                                 (0x1 &lt;&lt; 12 |
<a name="l02286"></a>02286                                   0x1 &lt;&lt; 5 |
<a name="l02287"></a>02287                                   0x1 &lt;&lt; 1 |
<a name="l02288"></a>02288                                   0x1));
<a name="l02289"></a>02289                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l02290"></a>02290                                 <a class="code" href="phy__n_8h.html#a82a4d0ce218c6b51f85b73786948b9ba">B43_NPHY_RFCTL_CMD_START</a>);
<a name="l02291"></a>02291                         udelay(20);
<a name="l02292"></a>02292                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, ~0x1);
<a name="l02293"></a>02293                 }
<a name="l02294"></a>02294         }
<a name="l02295"></a>02295 }
<a name="l02296"></a>02296 
<a name="l02297"></a><a class="code" href="phy__n_8c.html#a0001b90761125df24b7a4789f5fd7ed0">02297</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a0001b90761125df24b7a4789f5fd7ed0">b43_nphy_rev3_rssi_select</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 code, u8 type)
<a name="l02298"></a>02298 {
<a name="l02299"></a>02299         u8 i;
<a name="l02300"></a>02300         u16 reg, val;
<a name="l02301"></a>02301 
<a name="l02302"></a>02302         <span class="keywordflow">if</span> (code == 0) {
<a name="l02303"></a>02303                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, 0xFDFF);
<a name="l02304"></a>02304                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0xFDFF);
<a name="l02305"></a>02305                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, 0xFCFF);
<a name="l02306"></a>02306                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, 0xFCFF);
<a name="l02307"></a>02307                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a3b2fc942b23f2b812c053291d3abcf47">B43_NPHY_TXF_40CO_B1S0</a>, 0xFFDF);
<a name="l02308"></a>02308                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ac57132a07e9f60937a0b38e6b8dc600a">B43_NPHY_TXF_40CO_B32S1</a>, 0xFFDF);
<a name="l02309"></a>02309                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#aad32e1ef14df1e5f3f731d249323c098">B43_NPHY_RFCTL_LUT_TRSW_UP1</a>, 0xFFC3);
<a name="l02310"></a>02310                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a08aee022d5720230af2a77e55605b321">B43_NPHY_RFCTL_LUT_TRSW_UP2</a>, 0xFFC3);
<a name="l02311"></a>02311         } <span class="keywordflow">else</span> {
<a name="l02312"></a>02312                 <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l02313"></a>02313                         <span class="keywordflow">if</span> ((code == 1 &amp;&amp; i == 1) || (code == 2 &amp;&amp; !i))
<a name="l02314"></a>02314                                 <span class="keywordflow">continue</span>;
<a name="l02315"></a>02315 
<a name="l02316"></a>02316                         reg = (i == 0) ?
<a name="l02317"></a>02317                                 <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a> : <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>;
<a name="l02318"></a>02318                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, 0xFDFF, 0x0200);
<a name="l02319"></a>02319 
<a name="l02320"></a>02320                         <span class="keywordflow">if</span> (type &lt; 3) {
<a name="l02321"></a>02321                                 reg = (i == 0) ?
<a name="l02322"></a>02322                                         <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a> :
<a name="l02323"></a>02323                                         <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>;
<a name="l02324"></a>02324                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, 0xFCFF, 0);
<a name="l02325"></a>02325 
<a name="l02326"></a>02326                                 reg = (i == 0) ?
<a name="l02327"></a>02327                                         <a class="code" href="phy__n_8h.html#aad32e1ef14df1e5f3f731d249323c098">B43_NPHY_RFCTL_LUT_TRSW_UP1</a> :
<a name="l02328"></a>02328                                         <a class="code" href="phy__n_8h.html#a08aee022d5720230af2a77e55605b321">B43_NPHY_RFCTL_LUT_TRSW_UP2</a>;
<a name="l02329"></a>02329                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, 0xFFC3, 0);
<a name="l02330"></a>02330 
<a name="l02331"></a>02331                                 <span class="keywordflow">if</span> (type == 0)
<a name="l02332"></a>02332                                         val = (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) ? 4 : 8;
<a name="l02333"></a>02333                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 1)
<a name="l02334"></a>02334                                         val = 16;
<a name="l02335"></a>02335                                 <span class="keywordflow">else</span>
<a name="l02336"></a>02336                                         val = 32;
<a name="l02337"></a>02337                                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, reg, val);
<a name="l02338"></a>02338 
<a name="l02339"></a>02339                                 reg = (i == 0) ?
<a name="l02340"></a>02340                                         <a class="code" href="phy__n_8h.html#a3b2fc942b23f2b812c053291d3abcf47">B43_NPHY_TXF_40CO_B1S0</a> :
<a name="l02341"></a>02341                                         <a class="code" href="phy__n_8h.html#ac57132a07e9f60937a0b38e6b8dc600a">B43_NPHY_TXF_40CO_B32S1</a>;
<a name="l02342"></a>02342                                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, reg, 0x0020);
<a name="l02343"></a>02343                         } <span class="keywordflow">else</span> {
<a name="l02344"></a>02344                                 <span class="keywordflow">if</span> (type == 6)
<a name="l02345"></a>02345                                         val = 0x0100;
<a name="l02346"></a>02346                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 3)
<a name="l02347"></a>02347                                         val = 0x0200;
<a name="l02348"></a>02348                                 <span class="keywordflow">else</span>
<a name="l02349"></a>02349                                         val = 0x0300;
<a name="l02350"></a>02350 
<a name="l02351"></a>02351                                 reg = (i == 0) ?
<a name="l02352"></a>02352                                         <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a> :
<a name="l02353"></a>02353                                         <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>;
<a name="l02354"></a>02354 
<a name="l02355"></a>02355                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, 0xFCFF, val);
<a name="l02356"></a>02356                                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, reg, 0xF3FF, val &lt;&lt; 2);
<a name="l02357"></a>02357 
<a name="l02358"></a>02358                                 <span class="keywordflow">if</span> (type != 3 &amp;&amp; type != 6) {
<a name="l02359"></a>02359                                         <span class="keyword">enum</span> ieee80211_band band =
<a name="l02360"></a>02360                                                 <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>);
<a name="l02361"></a>02361 
<a name="l02362"></a>02362                                         <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev))
<a name="l02363"></a>02363                                                 val = (band == IEEE80211_BAND_5GHZ) ? 0xC : 0xE;
<a name="l02364"></a>02364                                         <span class="keywordflow">else</span>
<a name="l02365"></a>02365                                                 val = 0x11;
<a name="l02366"></a>02366                                         reg = (i == 0) ? 0x2000 : 0x3000;
<a name="l02367"></a>02367                                         reg |= <a class="code" href="radio__2055_8h.html#a83b9418c196b82474482f82a0a265145">B2055_PADDRV</a>;
<a name="l02368"></a>02368                                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, reg, val);
<a name="l02369"></a>02369 
<a name="l02370"></a>02370                                         reg = (i == 0) ?
<a name="l02371"></a>02371                                                 <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a> :
<a name="l02372"></a>02372                                                 <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>;
<a name="l02373"></a>02373                                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, reg, 0x0200);
<a name="l02374"></a>02374                                 }
<a name="l02375"></a>02375                         }
<a name="l02376"></a>02376                 }
<a name="l02377"></a>02377         }
<a name="l02378"></a>02378 }
<a name="l02379"></a>02379 
<a name="l02380"></a>02380 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RSSISel */</span>
<a name="l02381"></a><a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">02381</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 code, u8 type)
<a name="l02382"></a>02382 {
<a name="l02383"></a>02383         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l02384"></a>02384                 <a class="code" href="phy__n_8c.html#a0001b90761125df24b7a4789f5fd7ed0">b43_nphy_rev3_rssi_select</a>(dev, code, type);
<a name="l02385"></a>02385         <span class="keywordflow">else</span>
<a name="l02386"></a>02386                 <a class="code" href="phy__n_8c.html#a470a670aae7f12f8dd594d2827289752">b43_nphy_rev2_rssi_select</a>(dev, code, type);
<a name="l02387"></a>02387 }
<a name="l02388"></a>02388 
<a name="l02389"></a>02389 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/SetRssi2055Vcm */</span>
<a name="l02390"></a><a class="code" href="phy__n_8c.html#a8f1b6affe289409207488acbede25202">02390</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a8f1b6affe289409207488acbede25202">b43_nphy_set_rssi_2055_vcm</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 type, u8 *buf)
<a name="l02391"></a>02391 {
<a name="l02392"></a>02392         <span class="keywordtype">int</span> i;
<a name="l02393"></a>02393         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l02394"></a>02394                 <span class="keywordflow">if</span> (type == 2) {
<a name="l02395"></a>02395                         <span class="keywordflow">if</span> (i == 0) {
<a name="l02396"></a>02396                                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a5181ba0b30fd57c5e76bd86c0e7c59bf">B2055_C1_B0NB_RSSIVCM</a>,
<a name="l02397"></a>02397                                                   0xFC, buf[0]);
<a name="l02398"></a>02398                                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#af0f6f810749159f7320753a0a50a2117">B2055_C1_RX_BB_RSSICTL5</a>,
<a name="l02399"></a>02399                                                   0xFC, buf[1]);
<a name="l02400"></a>02400                         } <span class="keywordflow">else</span> {
<a name="l02401"></a>02401                                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#ad58e1719ee0b3654a48d5ded2c08c678">B2055_C2_B0NB_RSSIVCM</a>,
<a name="l02402"></a>02402                                                   0xFC, buf[2 * i]);
<a name="l02403"></a>02403                                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a67b1396956fd3020401aaea64e715c15">B2055_C2_RX_BB_RSSICTL5</a>,
<a name="l02404"></a>02404                                                   0xFC, buf[2 * i + 1]);
<a name="l02405"></a>02405                         }
<a name="l02406"></a>02406                 } <span class="keywordflow">else</span> {
<a name="l02407"></a>02407                         <span class="keywordflow">if</span> (i == 0)
<a name="l02408"></a>02408                                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#af0f6f810749159f7320753a0a50a2117">B2055_C1_RX_BB_RSSICTL5</a>,
<a name="l02409"></a>02409                                                   0xF3, buf[0] &lt;&lt; 2);
<a name="l02410"></a>02410                         <span class="keywordflow">else</span>
<a name="l02411"></a>02411                                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a67b1396956fd3020401aaea64e715c15">B2055_C2_RX_BB_RSSICTL5</a>,
<a name="l02412"></a>02412                                                   0xF3, buf[2 * i + 1] &lt;&lt; 2);
<a name="l02413"></a>02413                 }
<a name="l02414"></a>02414         }
<a name="l02415"></a>02415 }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/PollRssi */</span>
<a name="l02418"></a><a class="code" href="phy__n_8c.html#a6c27f18a8f0ae8b8c20c4d9a4ee14472">02418</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a6c27f18a8f0ae8b8c20c4d9a4ee14472">b43_nphy_poll_rssi</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 type, s32 *buf,
<a name="l02419"></a>02419                                 u8 nsamp)
<a name="l02420"></a>02420 {
<a name="l02421"></a>02421         <span class="keywordtype">int</span> i;
<a name="l02422"></a>02422         <span class="keywordtype">int</span> out;
<a name="l02423"></a>02423         u16 save_regs_phy[9];
<a name="l02424"></a>02424         u16 s[2];
<a name="l02425"></a>02425 
<a name="l02426"></a>02426         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l02427"></a>02427                 save_regs_phy[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l02428"></a>02428                                                 <a class="code" href="phy__n_8h.html#aad32e1ef14df1e5f3f731d249323c098">B43_NPHY_RFCTL_LUT_TRSW_UP1</a>);
<a name="l02429"></a>02429                 save_regs_phy[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l02430"></a>02430                                                 <a class="code" href="phy__n_8h.html#a08aee022d5720230af2a77e55605b321">B43_NPHY_RFCTL_LUT_TRSW_UP2</a>);
<a name="l02431"></a>02431                 save_regs_phy[2] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>);
<a name="l02432"></a>02432                 save_regs_phy[3] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>);
<a name="l02433"></a>02433                 save_regs_phy[4] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>);
<a name="l02434"></a>02434                 save_regs_phy[5] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>);
<a name="l02435"></a>02435                 save_regs_phy[6] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a3b2fc942b23f2b812c053291d3abcf47">B43_NPHY_TXF_40CO_B1S0</a>);
<a name="l02436"></a>02436                 save_regs_phy[7] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ac57132a07e9f60937a0b38e6b8dc600a">B43_NPHY_TXF_40CO_B32S1</a>);
<a name="l02437"></a>02437                 save_regs_phy[8] = 0;
<a name="l02438"></a>02438         } <span class="keywordflow">else</span> {
<a name="l02439"></a>02439                 save_regs_phy[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>);
<a name="l02440"></a>02440                 save_regs_phy[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>);
<a name="l02441"></a>02441                 save_regs_phy[2] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>);
<a name="l02442"></a>02442                 save_regs_phy[3] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>);
<a name="l02443"></a>02443                 save_regs_phy[4] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>);
<a name="l02444"></a>02444                 save_regs_phy[5] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a1a3f176d0383816dc05fb52523c85c71">B43_NPHY_RFCTL_RSSIO1</a>);
<a name="l02445"></a>02445                 save_regs_phy[6] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ab29867b3d0c83b2debd083003efba46c">B43_NPHY_RFCTL_RSSIO2</a>);
<a name="l02446"></a>02446                 save_regs_phy[7] = 0;
<a name="l02447"></a>02447                 save_regs_phy[8] = 0;
<a name="l02448"></a>02448         }
<a name="l02449"></a>02449 
<a name="l02450"></a>02450         <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 5, type);
<a name="l02451"></a>02451 
<a name="l02452"></a>02452         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l02453"></a>02453                 save_regs_phy[8] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#af5bf1e194f58ca80a786fe3fea1eccf0">B43_NPHY_GPIO_SEL</a>);
<a name="l02454"></a>02454                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af5bf1e194f58ca80a786fe3fea1eccf0">B43_NPHY_GPIO_SEL</a>, 5);
<a name="l02455"></a>02455         }
<a name="l02456"></a>02456 
<a name="l02457"></a>02457         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l02458"></a>02458                 buf[i] = 0;
<a name="l02459"></a>02459 
<a name="l02460"></a>02460         <span class="keywordflow">for</span> (i = 0; i &lt; nsamp; i++) {
<a name="l02461"></a>02461                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l02462"></a>02462                         s[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ae7da57c8a863e242747c1fd3bdffeb38">B43_NPHY_GPIO_LOOUT</a>);
<a name="l02463"></a>02463                         s[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a43f3af1788049219f2b29f0ce95619c5">B43_NPHY_GPIO_HIOUT</a>);
<a name="l02464"></a>02464                 } <span class="keywordflow">else</span> {
<a name="l02465"></a>02465                         s[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a96d153ee542355ae51976c4aa663cf82">B43_NPHY_RSSI1</a>);
<a name="l02466"></a>02466                         s[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a9b6943c5a595c922a90a47a21af40e60">B43_NPHY_RSSI2</a>);
<a name="l02467"></a>02467                 }
<a name="l02468"></a>02468 
<a name="l02469"></a>02469                 buf[0] += ((s8)((s[0] &amp; 0x3F) &lt;&lt; 2)) &gt;&gt; 2;
<a name="l02470"></a>02470                 buf[1] += ((s8)(((s[0] &gt;&gt; 8) &amp; 0x3F) &lt;&lt; 2)) &gt;&gt; 2;
<a name="l02471"></a>02471                 buf[2] += ((s8)((s[1] &amp; 0x3F) &lt;&lt; 2)) &gt;&gt; 2;
<a name="l02472"></a>02472                 buf[3] += ((s8)(((s[1] &gt;&gt; 8) &amp; 0x3F) &lt;&lt; 2)) &gt;&gt; 2;
<a name="l02473"></a>02473         }
<a name="l02474"></a>02474         out = (buf[0] &amp; 0xFF) &lt;&lt; 24 | (buf[1] &amp; 0xFF) &lt;&lt; 16 |
<a name="l02475"></a>02475                 (buf[2] &amp; 0xFF) &lt;&lt; 8 | (buf[3] &amp; 0xFF);
<a name="l02476"></a>02476 
<a name="l02477"></a>02477         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l02478"></a>02478                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af5bf1e194f58ca80a786fe3fea1eccf0">B43_NPHY_GPIO_SEL</a>, save_regs_phy[8]);
<a name="l02479"></a>02479 
<a name="l02480"></a>02480         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l02481"></a>02481                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aad32e1ef14df1e5f3f731d249323c098">B43_NPHY_RFCTL_LUT_TRSW_UP1</a>,
<a name="l02482"></a>02482                                 save_regs_phy[0]);
<a name="l02483"></a>02483                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a08aee022d5720230af2a77e55605b321">B43_NPHY_RFCTL_LUT_TRSW_UP2</a>,
<a name="l02484"></a>02484                                 save_regs_phy[1]);
<a name="l02485"></a>02485                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, save_regs_phy[2]);
<a name="l02486"></a>02486                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, save_regs_phy[3]);
<a name="l02487"></a>02487                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, save_regs_phy[4]);
<a name="l02488"></a>02488                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, save_regs_phy[5]);
<a name="l02489"></a>02489                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a3b2fc942b23f2b812c053291d3abcf47">B43_NPHY_TXF_40CO_B1S0</a>, save_regs_phy[6]);
<a name="l02490"></a>02490                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ac57132a07e9f60937a0b38e6b8dc600a">B43_NPHY_TXF_40CO_B32S1</a>, save_regs_phy[7]);
<a name="l02491"></a>02491         } <span class="keywordflow">else</span> {
<a name="l02492"></a>02492                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, save_regs_phy[0]);
<a name="l02493"></a>02493                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, save_regs_phy[1]);
<a name="l02494"></a>02494                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, save_regs_phy[2]);
<a name="l02495"></a>02495                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>, save_regs_phy[3]);
<a name="l02496"></a>02496                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, save_regs_phy[4]);
<a name="l02497"></a>02497                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a1a3f176d0383816dc05fb52523c85c71">B43_NPHY_RFCTL_RSSIO1</a>, save_regs_phy[5]);
<a name="l02498"></a>02498                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ab29867b3d0c83b2debd083003efba46c">B43_NPHY_RFCTL_RSSIO2</a>, save_regs_phy[6]);
<a name="l02499"></a>02499         }
<a name="l02500"></a>02500 
<a name="l02501"></a>02501         <span class="keywordflow">return</span> out;
<a name="l02502"></a>02502 }
<a name="l02503"></a>02503 
<a name="l02504"></a>02504 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RSSICal */</span>
<a name="l02505"></a><a class="code" href="phy__n_8c.html#a1bde8b04b2fc9d9242d4e3b65c471931">02505</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a1bde8b04b2fc9d9242d4e3b65c471931">b43_nphy_rev2_rssi_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 type)
<a name="l02506"></a>02506 {
<a name="l02507"></a>02507         <span class="keywordtype">int</span> i, j;
<a name="l02508"></a>02508         u8 state[4];
<a name="l02509"></a>02509         u8 code, val;
<a name="l02510"></a>02510         u16 <span class="keyword">class</span>, <span class="keyword">override</span>;
<a name="l02511"></a>02511         u8 regs_save_radio[2];
<a name="l02512"></a>02512         u16 regs_save_phy[2];
<a name="l02513"></a>02513 
<a name="l02514"></a>02514         s8 offset[4];
<a name="l02515"></a>02515         u8 core;
<a name="l02516"></a>02516         u8 rail;
<a name="l02517"></a>02517 
<a name="l02518"></a>02518         u16 clip_state[2];
<a name="l02519"></a>02519         u16 clip_off[2] = { 0xFFFF, 0xFFFF };
<a name="l02520"></a>02520         s32 results_min[4] = { };
<a name="l02521"></a>02521         u8 vcm_final[4] = { };
<a name="l02522"></a>02522         s32 results[4][4] = { };
<a name="l02523"></a>02523         s32 miniq[4][2] = { };
<a name="l02524"></a>02524 
<a name="l02525"></a>02525         <span class="keywordflow">if</span> (type == 2) {
<a name="l02526"></a>02526                 code = 0;
<a name="l02527"></a>02527                 val = 6;
<a name="l02528"></a>02528         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type &lt; 2) {
<a name="l02529"></a>02529                 code = 25;
<a name="l02530"></a>02530                 val = 4;
<a name="l02531"></a>02531         } <span class="keywordflow">else</span> {
<a name="l02532"></a>02532                 <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(1);
<a name="l02533"></a>02533                 <span class="keywordflow">return</span>;
<a name="l02534"></a>02534         }
<a name="l02535"></a>02535 
<a name="l02536"></a>02536         <span class="keyword">class </span>= <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 0, 0);
<a name="l02537"></a>02537         <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 7, 4);
<a name="l02538"></a>02538         <a class="code" href="phy__n_8c.html#a0983793c31f96dd76b680507289a0a2c">b43_nphy_read_clip_detection</a>(dev, clip_state);
<a name="l02539"></a>02539         <a class="code" href="phy__n_8c.html#af2521e712e8080e9477e517bb95d774f">b43_nphy_write_clip_detection</a>(dev, clip_off);
<a name="l02540"></a>02540 
<a name="l02541"></a>02541         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;wl) == IEEE80211_BAND_5GHZ)
<a name="l02542"></a>02542                 <span class="keyword">override</span> = 0x140;
<a name="l02543"></a>02543         <span class="keywordflow">else</span>
<a name="l02544"></a>02544                 <span class="keyword">override</span> = 0x110;
<a name="l02545"></a>02545 
<a name="l02546"></a>02546         regs_save_phy[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>);
<a name="l02547"></a>02547         regs_save_radio[0] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a4615c4616de355a075a52205f587c268">B2055_C1_PD_RXTX</a>);
<a name="l02548"></a>02548         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, <span class="keyword">override</span>);
<a name="l02549"></a>02549         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#a4615c4616de355a075a52205f587c268">B2055_C1_PD_RXTX</a>, val);
<a name="l02550"></a>02550 
<a name="l02551"></a>02551         regs_save_phy[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>);
<a name="l02552"></a>02552         regs_save_radio[1] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#abca0595eb7874ead7739d8e1bf5d7ff4">B2055_C2_PD_RXTX</a>);
<a name="l02553"></a>02553         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, <span class="keyword">override</span>);
<a name="l02554"></a>02554         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#abca0595eb7874ead7739d8e1bf5d7ff4">B2055_C2_PD_RXTX</a>, val);
<a name="l02555"></a>02555 
<a name="l02556"></a>02556         state[0] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a685cfc1cc2583d6730b757a2e426d18f">B2055_C1_PD_RSSIMISC</a>) &amp; 0x07;
<a name="l02557"></a>02557         state[1] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a83e512e53206fae4872e24c9a67130ee">B2055_C2_PD_RSSIMISC</a>) &amp; 0x07;
<a name="l02558"></a>02558         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a685cfc1cc2583d6730b757a2e426d18f">B2055_C1_PD_RSSIMISC</a>, 0xF8);
<a name="l02559"></a>02559         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a83e512e53206fae4872e24c9a67130ee">B2055_C2_PD_RSSIMISC</a>, 0xF8);
<a name="l02560"></a>02560         state[2] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a0da3f74a4960cd82afaa844b2fd67870">B2055_C1_SP_RSSI</a>) &amp; 0x07;
<a name="l02561"></a>02561         state[3] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a098f065418f040116ff39665abc3ae89">B2055_C2_SP_RSSI</a>) &amp; 0x07;
<a name="l02562"></a>02562 
<a name="l02563"></a>02563         <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 5, type);
<a name="l02564"></a>02564         <a class="code" href="phy__n_8c.html#ab79bb947e55a8cb8929b62856fd3eaf3">b43_nphy_scale_offset_rssi</a>(dev, 0, 0, 5, 0, type);
<a name="l02565"></a>02565         <a class="code" href="phy__n_8c.html#ab79bb947e55a8cb8929b62856fd3eaf3">b43_nphy_scale_offset_rssi</a>(dev, 0, 0, 5, 1, type);
<a name="l02566"></a>02566 
<a name="l02567"></a>02567         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l02568"></a>02568                 u8 tmp[4];
<a name="l02569"></a>02569                 <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++)
<a name="l02570"></a>02570                         tmp[j] = i;
<a name="l02571"></a>02571                 <span class="keywordflow">if</span> (type != 1)
<a name="l02572"></a>02572                         <a class="code" href="phy__n_8c.html#a8f1b6affe289409207488acbede25202">b43_nphy_set_rssi_2055_vcm</a>(dev, type, tmp);
<a name="l02573"></a>02573                 <a class="code" href="phy__n_8c.html#a6c27f18a8f0ae8b8c20c4d9a4ee14472">b43_nphy_poll_rssi</a>(dev, type, results[i], 8);
<a name="l02574"></a>02574                 <span class="keywordflow">if</span> (type &lt; 2)
<a name="l02575"></a>02575                         <span class="keywordflow">for</span> (j = 0; j &lt; 2; j++)
<a name="l02576"></a>02576                                 miniq[i][j] = min(results[i][2 * j],
<a name="l02577"></a>02577                                                 results[i][2 * j + 1]);
<a name="l02578"></a>02578         }
<a name="l02579"></a>02579 
<a name="l02580"></a>02580         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l02581"></a>02581                 s32 mind = 40;
<a name="l02582"></a>02582                 u8 minvcm = 0;
<a name="l02583"></a>02583                 s32 minpoll = 249;
<a name="l02584"></a>02584                 s32 curr;
<a name="l02585"></a>02585                 <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++) {
<a name="l02586"></a>02586                         <span class="keywordflow">if</span> (type == 2)
<a name="l02587"></a>02587                                 curr = abs(results[j][i]);
<a name="l02588"></a>02588                         <span class="keywordflow">else</span>
<a name="l02589"></a>02589                                 curr = abs(miniq[j][i / 2] - code * 8);
<a name="l02590"></a>02590 
<a name="l02591"></a>02591                         <span class="keywordflow">if</span> (curr &lt; mind) {
<a name="l02592"></a>02592                                 mind = curr;
<a name="l02593"></a>02593                                 minvcm = j;
<a name="l02594"></a>02594                         }
<a name="l02595"></a>02595 
<a name="l02596"></a>02596                         <span class="keywordflow">if</span> (results[j][i] &lt; minpoll)
<a name="l02597"></a>02597                                 minpoll = results[j][i];
<a name="l02598"></a>02598                 }
<a name="l02599"></a>02599                 results_min[i] = minpoll;
<a name="l02600"></a>02600                 vcm_final[i] = minvcm;
<a name="l02601"></a>02601         }
<a name="l02602"></a>02602 
<a name="l02603"></a>02603         <span class="keywordflow">if</span> (type != 1)
<a name="l02604"></a>02604                 <a class="code" href="phy__n_8c.html#a8f1b6affe289409207488acbede25202">b43_nphy_set_rssi_2055_vcm</a>(dev, type, vcm_final);
<a name="l02605"></a>02605 
<a name="l02606"></a>02606         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l02607"></a>02607                 offset[i] = (code * 8) - results[vcm_final[i]][i];
<a name="l02608"></a>02608 
<a name="l02609"></a>02609                 <span class="keywordflow">if</span> (offset[i] &lt; 0)
<a name="l02610"></a>02610                         offset[i] = -((abs(offset[i]) + 4) / 8);
<a name="l02611"></a>02611                 <span class="keywordflow">else</span>
<a name="l02612"></a>02612                         offset[i] = (offset[i] + 4) / 8;
<a name="l02613"></a>02613 
<a name="l02614"></a>02614                 <span class="keywordflow">if</span> (results_min[i] == 248)
<a name="l02615"></a>02615                         offset[i] = code - 32;
<a name="l02616"></a>02616 
<a name="l02617"></a>02617                 core = (i / 2) ? 2 : 1;
<a name="l02618"></a>02618                 rail = (i % 2) ? 1 : 0;
<a name="l02619"></a>02619 
<a name="l02620"></a>02620                 <a class="code" href="phy__n_8c.html#ab79bb947e55a8cb8929b62856fd3eaf3">b43_nphy_scale_offset_rssi</a>(dev, 0, offset[i], core, rail,
<a name="l02621"></a>02621                                                 type);
<a name="l02622"></a>02622         }
<a name="l02623"></a>02623 
<a name="l02624"></a>02624         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a685cfc1cc2583d6730b757a2e426d18f">B2055_C1_PD_RSSIMISC</a>, 0xF8, state[0]);
<a name="l02625"></a>02625         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a83e512e53206fae4872e24c9a67130ee">B2055_C2_PD_RSSIMISC</a>, 0xF8, state[1]);
<a name="l02626"></a>02626 
<a name="l02627"></a>02627         <span class="keywordflow">switch</span> (state[2]) {
<a name="l02628"></a>02628         <span class="keywordflow">case</span> 1:
<a name="l02629"></a>02629                 <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 1, 2);
<a name="l02630"></a>02630                 <span class="keywordflow">break</span>;
<a name="l02631"></a>02631         <span class="keywordflow">case</span> 4:
<a name="l02632"></a>02632                 <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 1, 0);
<a name="l02633"></a>02633                 <span class="keywordflow">break</span>;
<a name="l02634"></a>02634         <span class="keywordflow">case</span> 2:
<a name="l02635"></a>02635                 <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 1, 1);
<a name="l02636"></a>02636                 <span class="keywordflow">break</span>;
<a name="l02637"></a>02637         <span class="keywordflow">default</span>:
<a name="l02638"></a>02638                 <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 1, 1);
<a name="l02639"></a>02639                 <span class="keywordflow">break</span>;
<a name="l02640"></a>02640         }
<a name="l02641"></a>02641 
<a name="l02642"></a>02642         <span class="keywordflow">switch</span> (state[3]) {
<a name="l02643"></a>02643         <span class="keywordflow">case</span> 1:
<a name="l02644"></a>02644                 <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 2, 2);
<a name="l02645"></a>02645                 <span class="keywordflow">break</span>;
<a name="l02646"></a>02646         <span class="keywordflow">case</span> 4:
<a name="l02647"></a>02647                 <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 2, 0);
<a name="l02648"></a>02648                 <span class="keywordflow">break</span>;
<a name="l02649"></a>02649         <span class="keywordflow">default</span>:
<a name="l02650"></a>02650                 <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 2, 1);
<a name="l02651"></a>02651                 <span class="keywordflow">break</span>;
<a name="l02652"></a>02652         }
<a name="l02653"></a>02653 
<a name="l02654"></a>02654         <a class="code" href="phy__n_8c.html#a337ffa4475bcad733390b7a72c9adaa4">b43_nphy_rssi_select</a>(dev, 0, type);
<a name="l02655"></a>02655 
<a name="l02656"></a>02656         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, regs_save_phy[0]);
<a name="l02657"></a>02657         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#a4615c4616de355a075a52205f587c268">B2055_C1_PD_RXTX</a>, regs_save_radio[0]);
<a name="l02658"></a>02658         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, regs_save_phy[1]);
<a name="l02659"></a>02659         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#abca0595eb7874ead7739d8e1bf5d7ff4">B2055_C2_PD_RXTX</a>, regs_save_radio[1]);
<a name="l02660"></a>02660 
<a name="l02661"></a>02661         <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 7, <span class="keyword">class</span>);
<a name="l02662"></a>02662         <a class="code" href="phy__n_8c.html#af2521e712e8080e9477e517bb95d774f">b43_nphy_write_clip_detection</a>(dev, clip_state);
<a name="l02663"></a>02663         <span class="comment">/* Specs don&#39;t say about reset here, but it makes wl and b43 dumps</span>
<a name="l02664"></a>02664 <span class="comment">           identical, it really seems wl performs this */</span>
<a name="l02665"></a>02665         <a class="code" href="phy__n_8c.html#a6c32257664019e72accdf8fd8cfcc065">b43_nphy_reset_cca</a>(dev);
<a name="l02666"></a>02666 }
<a name="l02667"></a>02667 
<a name="l02668"></a>02668 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RSSICalRev3 */</span>
<a name="l02669"></a><a class="code" href="phy__n_8c.html#a74e90da42dd8bd1c7535f24492de5451">02669</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a74e90da42dd8bd1c7535f24492de5451">b43_nphy_rev3_rssi_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02670"></a>02670 {
<a name="l02671"></a>02671         <span class="comment">/* TODO */</span>
<a name="l02672"></a>02672 }
<a name="l02673"></a>02673 
<a name="l02674"></a>02674 <span class="comment">/*</span>
<a name="l02675"></a>02675 <span class="comment"> * RSSI Calibration</span>
<a name="l02676"></a>02676 <span class="comment"> * http://bcm-v4.sipsolutions.net/802.11/PHY/N/RSSICal</span>
<a name="l02677"></a>02677 <span class="comment"> */</span>
<a name="l02678"></a><a class="code" href="phy__n_8c.html#a9bdd435b8fff6a47e9191795d8a752ee">02678</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a9bdd435b8fff6a47e9191795d8a752ee">b43_nphy_rssi_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02679"></a>02679 {
<a name="l02680"></a>02680         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l02681"></a>02681                 <a class="code" href="phy__n_8c.html#a74e90da42dd8bd1c7535f24492de5451">b43_nphy_rev3_rssi_cal</a>(dev);
<a name="l02682"></a>02682         } <span class="keywordflow">else</span> {
<a name="l02683"></a>02683                 <a class="code" href="phy__n_8c.html#a1bde8b04b2fc9d9242d4e3b65c471931">b43_nphy_rev2_rssi_cal</a>(dev, <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eac911ea9e301ee207723bfc2aa3cdf1bf">B43_NPHY_RSSI_Z</a>);
<a name="l02684"></a>02684                 <a class="code" href="phy__n_8c.html#a1bde8b04b2fc9d9242d4e3b65c471931">b43_nphy_rev2_rssi_cal</a>(dev, <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658eaaf7f62cd909edd45fdcf0b2bec9c1337">B43_NPHY_RSSI_X</a>);
<a name="l02685"></a>02685                 <a class="code" href="phy__n_8c.html#a1bde8b04b2fc9d9242d4e3b65c471931">b43_nphy_rev2_rssi_cal</a>(dev, <a class="code" href="phy__n_8c.html#a6aa623b01f9d2899f30006e1c591658ea943e9ddbcfc8d0d6c007d9afa7dafa63">B43_NPHY_RSSI_Y</a>);
<a name="l02686"></a>02686         }
<a name="l02687"></a>02687 }
<a name="l02688"></a>02688 
<a name="l02689"></a>02689 <span class="comment">/*</span>
<a name="l02690"></a>02690 <span class="comment"> * Restore RSSI Calibration</span>
<a name="l02691"></a>02691 <span class="comment"> * http://bcm-v4.sipsolutions.net/802.11/PHY/N/RestoreRssiCal</span>
<a name="l02692"></a>02692 <span class="comment"> */</span>
<a name="l02693"></a><a class="code" href="phy__n_8c.html#a71e6561ff9751df6bb4816479832f165">02693</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a71e6561ff9751df6bb4816479832f165">b43_nphy_restore_rssi_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02694"></a>02694 {
<a name="l02695"></a>02695         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l02696"></a>02696 
<a name="l02697"></a>02697         u16 *rssical_radio_regs = NULL;
<a name="l02698"></a>02698         u16 *rssical_phy_regs = NULL;
<a name="l02699"></a>02699 
<a name="l02700"></a>02700         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l02701"></a>02701                 <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#a91e3a284dc3a04e75a6822e97e11155a">rssical_chanspec_2G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>)
<a name="l02702"></a>02702                         <span class="keywordflow">return</span>;
<a name="l02703"></a>02703                 rssical_radio_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a120a3e4a30bc37debd84ef4b28f9d3ef">rssical_cache</a>.<a class="code" href="structb43__phy__n__rssical__cache.html#ab671886e0394c8bf904bc796abba1c84">rssical_radio_regs_2G</a>;
<a name="l02704"></a>02704                 rssical_phy_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a120a3e4a30bc37debd84ef4b28f9d3ef">rssical_cache</a>.<a class="code" href="structb43__phy__n__rssical__cache.html#a3f35182c81b67f17bd758c8f8842a038">rssical_phy_regs_2G</a>;
<a name="l02705"></a>02705         } <span class="keywordflow">else</span> {
<a name="l02706"></a>02706                 <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#a0ca1eb5820f10e0db317b76f22ffc71c">rssical_chanspec_5G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>)
<a name="l02707"></a>02707                         <span class="keywordflow">return</span>;
<a name="l02708"></a>02708                 rssical_radio_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a120a3e4a30bc37debd84ef4b28f9d3ef">rssical_cache</a>.<a class="code" href="structb43__phy__n__rssical__cache.html#a3bf2b442123e860bf13980c3410d34e0">rssical_radio_regs_5G</a>;
<a name="l02709"></a>02709                 rssical_phy_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a120a3e4a30bc37debd84ef4b28f9d3ef">rssical_cache</a>.<a class="code" href="structb43__phy__n__rssical__cache.html#a426f681466c24916a8bb00eb1b1c51ad">rssical_phy_regs_5G</a>;
<a name="l02710"></a>02710         }
<a name="l02711"></a>02711 
<a name="l02712"></a>02712         <span class="comment">/* TODO use some definitions */</span>
<a name="l02713"></a>02713         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, 0x602B, 0xE3, rssical_radio_regs[0]);
<a name="l02714"></a>02714         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, 0x702B, 0xE3, rssical_radio_regs[1]);
<a name="l02715"></a>02715 
<a name="l02716"></a>02716         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aaab6a3cafdb589842d337aa3189ed626">B43_NPHY_RSSIMC_0I_RSSI_Z</a>, rssical_phy_regs[0]);
<a name="l02717"></a>02717         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6a7e7df8574c312e490634d206df8fc3">B43_NPHY_RSSIMC_0Q_RSSI_Z</a>, rssical_phy_regs[1]);
<a name="l02718"></a>02718         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae9874483e08bec1e35cf084be9763d84">B43_NPHY_RSSIMC_1I_RSSI_Z</a>, rssical_phy_regs[2]);
<a name="l02719"></a>02719         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a547988cf771fd29a1840b2ff72a07d7b">B43_NPHY_RSSIMC_1Q_RSSI_Z</a>, rssical_phy_regs[3]);
<a name="l02720"></a>02720 
<a name="l02721"></a>02721         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6621ffc5d55f7370227681d19c53820c">B43_NPHY_RSSIMC_0I_RSSI_X</a>, rssical_phy_regs[4]);
<a name="l02722"></a>02722         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2d92187e2575791ce1471a8e0b277b5e">B43_NPHY_RSSIMC_0Q_RSSI_X</a>, rssical_phy_regs[5]);
<a name="l02723"></a>02723         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a3b407730c31853a04fa4205a53b64e2b">B43_NPHY_RSSIMC_1I_RSSI_X</a>, rssical_phy_regs[6]);
<a name="l02724"></a>02724         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9ecf8f76c494e98ef682d5ccbbed2467">B43_NPHY_RSSIMC_1Q_RSSI_X</a>, rssical_phy_regs[7]);
<a name="l02725"></a>02725 
<a name="l02726"></a>02726         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad3fee3e8b0e3f5126c402cc240f155b3">B43_NPHY_RSSIMC_0I_RSSI_Y</a>, rssical_phy_regs[8]);
<a name="l02727"></a>02727         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a55a8f99f322db46ea7fef4871d1ebb8b">B43_NPHY_RSSIMC_0Q_RSSI_Y</a>, rssical_phy_regs[9]);
<a name="l02728"></a>02728         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af461be6b6a1f2b910bc32a93a67b27c0">B43_NPHY_RSSIMC_1I_RSSI_Y</a>, rssical_phy_regs[10]);
<a name="l02729"></a>02729         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aa3fec39e0ac7696304bfe4af9d514adf">B43_NPHY_RSSIMC_1Q_RSSI_Y</a>, rssical_phy_regs[11]);
<a name="l02730"></a>02730 }
<a name="l02731"></a>02731 
<a name="l02732"></a>02732 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/GetIpaGainTbl */</span>
<a name="l02733"></a><a class="code" href="phy__n_8c.html#ac9b997a0f7b74f5bcef62e050308b960">02733</a> <span class="keyword">static</span> <span class="keyword">const</span> u32 *<a class="code" href="phy__n_8c.html#ac9b997a0f7b74f5bcef62e050308b960">b43_nphy_get_ipa_gain_table</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02734"></a>02734 {
<a name="l02735"></a>02735         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l02736"></a>02736                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 6) {
<a name="l02737"></a>02737                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 47162)
<a name="l02738"></a>02738                                 <span class="keywordflow">return</span> <a class="code" href="tables__nphy_8c.html#a28790dde3144200405bb04b652f48f64">txpwrctrl_tx_gain_ipa_rev5</a>;
<a name="l02739"></a>02739                         <span class="keywordflow">return</span> <a class="code" href="tables__nphy_8c.html#a2d1424cd60149bba763b83791e2ab049">txpwrctrl_tx_gain_ipa_rev6</a>;
<a name="l02740"></a>02740                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 5) {
<a name="l02741"></a>02741                         <span class="keywordflow">return</span> <a class="code" href="tables__nphy_8c.html#a28790dde3144200405bb04b652f48f64">txpwrctrl_tx_gain_ipa_rev5</a>;
<a name="l02742"></a>02742                 } <span class="keywordflow">else</span> {
<a name="l02743"></a>02743                         <span class="keywordflow">return</span> <a class="code" href="tables__nphy_8c.html#a12e86746c49e238c89b213e4b2ba8359">txpwrctrl_tx_gain_ipa</a>;
<a name="l02744"></a>02744                 }
<a name="l02745"></a>02745         } <span class="keywordflow">else</span> {
<a name="l02746"></a>02746                 <span class="keywordflow">return</span> <a class="code" href="tables__nphy_8c.html#aa900d58ae708eaaacaf8965586750b62">txpwrctrl_tx_gain_ipa_5g</a>;
<a name="l02747"></a>02747         }
<a name="l02748"></a>02748 }
<a name="l02749"></a>02749 
<a name="l02750"></a>02750 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxCalRadioSetup */</span>
<a name="l02751"></a><a class="code" href="phy__n_8c.html#a9a47051adfde74dafe3e2816f9f467d7">02751</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a9a47051adfde74dafe3e2816f9f467d7">b43_nphy_tx_cal_radio_setup</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02752"></a>02752 {
<a name="l02753"></a>02753         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l02754"></a>02754         u16 *save = nphy-&gt;<a class="code" href="structb43__phy__n.html#a8ee2e56ca9ab1435ddcfe790f7e734c9">tx_rx_cal_radio_saveregs</a>;
<a name="l02755"></a>02755         u16 tmp;
<a name="l02756"></a>02756         u8 offset, i;
<a name="l02757"></a>02757 
<a name="l02758"></a>02758         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l02759"></a>02759             <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l02760"></a>02760                 tmp = (i == 0) ? 0x2000 : 0x3000;
<a name="l02761"></a>02761                 offset = i * 11;
<a name="l02762"></a>02762 
<a name="l02763"></a>02763                 save[offset + 0] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#addad78f3f21c389a452d50b236904e4e">B2055_CAL_RVARCTL</a>);
<a name="l02764"></a>02764                 save[offset + 1] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#aff6aaf13ba7197a074386070abd783dc">B2055_CAL_LPOCTL</a>);
<a name="l02765"></a>02765                 save[offset + 2] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a027268ed3a6984ca904f29d8a6d3f18e">B2055_CAL_TS</a>);
<a name="l02766"></a>02766                 save[offset + 3] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a417915b0e22e9de2bd3a0dfaa9b4ebf8">B2055_CAL_RCCALRTS</a>);
<a name="l02767"></a>02767                 save[offset + 4] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a6c22132ca1651b22d4ed5a23441b3b1d">B2055_CAL_RCALRTS</a>);
<a name="l02768"></a>02768                 save[offset + 5] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a83b9418c196b82474482f82a0a265145">B2055_PADDRV</a>);
<a name="l02769"></a>02769                 save[offset + 6] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a92e6621ced03fa6cf8e01ae483033bb7">B2055_XOCTL1</a>);
<a name="l02770"></a>02770                 save[offset + 7] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#ad4f4cc9def1ccd44ac21796d23f09a7f">B2055_XOCTL2</a>);
<a name="l02771"></a>02771                 save[offset + 8] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a94b2836456b9b852e6301eaf3ca31f07">B2055_XOREGUL</a>);
<a name="l02772"></a>02772                 save[offset + 9] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#af2f0b842da271224747bb4c649394254">B2055_XOMISC</a>);
<a name="l02773"></a>02773                 save[offset + 10] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#abc6ff6840ecda9c4a8a1c2b681163cb1">B2055_PLL_LFC1</a>);
<a name="l02774"></a>02774 
<a name="l02775"></a>02775                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) {
<a name="l02776"></a>02776                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#addad78f3f21c389a452d50b236904e4e">B2055_CAL_RVARCTL</a>, 0x0A);
<a name="l02777"></a>02777                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#aff6aaf13ba7197a074386070abd783dc">B2055_CAL_LPOCTL</a>, 0x40);
<a name="l02778"></a>02778                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a027268ed3a6984ca904f29d8a6d3f18e">B2055_CAL_TS</a>, 0x55);
<a name="l02779"></a>02779                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a417915b0e22e9de2bd3a0dfaa9b4ebf8">B2055_CAL_RCCALRTS</a>, 0);
<a name="l02780"></a>02780                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a6c22132ca1651b22d4ed5a23441b3b1d">B2055_CAL_RCALRTS</a>, 0);
<a name="l02781"></a>02781                         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#af7d51f073c3731efd4cab4eaea6e7ecb">ipa5g_on</a>) {
<a name="l02782"></a>02782                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a83b9418c196b82474482f82a0a265145">B2055_PADDRV</a>, 4);
<a name="l02783"></a>02783                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a92e6621ced03fa6cf8e01ae483033bb7">B2055_XOCTL1</a>, 1);
<a name="l02784"></a>02784                         } <span class="keywordflow">else</span> {
<a name="l02785"></a>02785                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a83b9418c196b82474482f82a0a265145">B2055_PADDRV</a>, 0);
<a name="l02786"></a>02786                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a92e6621ced03fa6cf8e01ae483033bb7">B2055_XOCTL1</a>, 0x2F);
<a name="l02787"></a>02787                         }
<a name="l02788"></a>02788                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#ad4f4cc9def1ccd44ac21796d23f09a7f">B2055_XOCTL2</a>, 0);
<a name="l02789"></a>02789                 } <span class="keywordflow">else</span> {
<a name="l02790"></a>02790                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#addad78f3f21c389a452d50b236904e4e">B2055_CAL_RVARCTL</a>, 0x06);
<a name="l02791"></a>02791                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#aff6aaf13ba7197a074386070abd783dc">B2055_CAL_LPOCTL</a>, 0x40);
<a name="l02792"></a>02792                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a027268ed3a6984ca904f29d8a6d3f18e">B2055_CAL_TS</a>, 0x55);
<a name="l02793"></a>02793                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a417915b0e22e9de2bd3a0dfaa9b4ebf8">B2055_CAL_RCCALRTS</a>, 0);
<a name="l02794"></a>02794                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a6c22132ca1651b22d4ed5a23441b3b1d">B2055_CAL_RCALRTS</a>, 0);
<a name="l02795"></a>02795                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a92e6621ced03fa6cf8e01ae483033bb7">B2055_XOCTL1</a>, 0);
<a name="l02796"></a>02796                         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a5688a326492153efc11b08d2c2edae29">ipa2g_on</a>) {
<a name="l02797"></a>02797                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a83b9418c196b82474482f82a0a265145">B2055_PADDRV</a>, 6);
<a name="l02798"></a>02798                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#ad4f4cc9def1ccd44ac21796d23f09a7f">B2055_XOCTL2</a>,
<a name="l02799"></a>02799                                         (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 5) ? 0x11 : 0x01);
<a name="l02800"></a>02800                         } <span class="keywordflow">else</span> {
<a name="l02801"></a>02801                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a83b9418c196b82474482f82a0a265145">B2055_PADDRV</a>, 0);
<a name="l02802"></a>02802                                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#ad4f4cc9def1ccd44ac21796d23f09a7f">B2055_XOCTL2</a>, 0);
<a name="l02803"></a>02803                         }
<a name="l02804"></a>02804                 }
<a name="l02805"></a>02805                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#a94b2836456b9b852e6301eaf3ca31f07">B2055_XOREGUL</a>, 0);
<a name="l02806"></a>02806                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#af2f0b842da271224747bb4c649394254">B2055_XOMISC</a>, 0);
<a name="l02807"></a>02807                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, tmp | <a class="code" href="radio__2055_8h.html#abc6ff6840ecda9c4a8a1c2b681163cb1">B2055_PLL_LFC1</a>, 0);
<a name="l02808"></a>02808             }
<a name="l02809"></a>02809         } <span class="keywordflow">else</span> {
<a name="l02810"></a>02810                 save[0] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a55e95e3554fa1319138a0b316a09c662">B2055_C1_TX_RF_IQCAL1</a>);
<a name="l02811"></a>02811                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#a55e95e3554fa1319138a0b316a09c662">B2055_C1_TX_RF_IQCAL1</a>, 0x29);
<a name="l02812"></a>02812 
<a name="l02813"></a>02813                 save[1] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a5167c3f860eb0b0b11945e932550e79d">B2055_C1_TX_RF_IQCAL2</a>);
<a name="l02814"></a>02814                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#a5167c3f860eb0b0b11945e932550e79d">B2055_C1_TX_RF_IQCAL2</a>, 0x54);
<a name="l02815"></a>02815 
<a name="l02816"></a>02816                 save[2] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a4bdf26c61a0edc7f0882870a04a89bc3">B2055_C2_TX_RF_IQCAL1</a>);
<a name="l02817"></a>02817                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#a4bdf26c61a0edc7f0882870a04a89bc3">B2055_C2_TX_RF_IQCAL1</a>, 0x29);
<a name="l02818"></a>02818 
<a name="l02819"></a>02819                 save[3] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#aa906911c32198bcf9a5e1991ea98991e">B2055_C2_TX_RF_IQCAL2</a>);
<a name="l02820"></a>02820                 <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#aa906911c32198bcf9a5e1991ea98991e">B2055_C2_TX_RF_IQCAL2</a>, 0x54);
<a name="l02821"></a>02821 
<a name="l02822"></a>02822                 save[3] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#a3dbde5ab1e79bb075734dbc45da63abe">B2055_C1_PWRDET_RXTX</a>);
<a name="l02823"></a>02823                 save[4] = <a class="code" href="phy__common_8h.html#a9a64ab2645598c7f0f5540311b76efbf">b43_radio_read16</a>(dev, <a class="code" href="radio__2055_8h.html#ad34cc49c952de31cd0a98c994b4c878b">B2055_C2_PWRDET_RXTX</a>);
<a name="l02824"></a>02824 
<a name="l02825"></a>02825                 <span class="keywordflow">if</span> (!(<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4b8bd10881c97f75766db020cbe1b65e">B43_NPHY_BANDCTL</a>) &amp;
<a name="l02826"></a>02826                     <a class="code" href="phy__n_8h.html#a671f78da741559b0530d0bea34f19de0">B43_NPHY_BANDCTL_5GHZ</a>)) {
<a name="l02827"></a>02827                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#a3dbde5ab1e79bb075734dbc45da63abe">B2055_C1_PWRDET_RXTX</a>, 0x04);
<a name="l02828"></a>02828                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#ad34cc49c952de31cd0a98c994b4c878b">B2055_C2_PWRDET_RXTX</a>, 0x04);
<a name="l02829"></a>02829                 } <span class="keywordflow">else</span> {
<a name="l02830"></a>02830                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#a3dbde5ab1e79bb075734dbc45da63abe">B2055_C1_PWRDET_RXTX</a>, 0x20);
<a name="l02831"></a>02831                         <a class="code" href="phy__common_8h.html#afb96ec591cb2ebd3580fb3074db0e3a0">b43_radio_write16</a>(dev, <a class="code" href="radio__2055_8h.html#ad34cc49c952de31cd0a98c994b4c878b">B2055_C2_PWRDET_RXTX</a>, 0x20);
<a name="l02832"></a>02832                 }
<a name="l02833"></a>02833 
<a name="l02834"></a>02834                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l02835"></a>02835                         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#ad44e114491a353743678e74dc9deb291">B2055_C1_TX_BB_MXGM</a>, 0x20);
<a name="l02836"></a>02836                         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="radio__2055_8h.html#a88729256d386e05a3fc07e80ed345b88">B2055_C2_TX_BB_MXGM</a>, 0x20);
<a name="l02837"></a>02837                 } <span class="keywordflow">else</span> {
<a name="l02838"></a>02838                         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#ad44e114491a353743678e74dc9deb291">B2055_C1_TX_BB_MXGM</a>, ~0x20);
<a name="l02839"></a>02839                         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a88729256d386e05a3fc07e80ed345b88">B2055_C2_TX_BB_MXGM</a>, ~0x20);
<a name="l02840"></a>02840                 }
<a name="l02841"></a>02841         }
<a name="l02842"></a>02842 }
<a name="l02843"></a>02843 
<a name="l02844"></a>02844 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/IqCalGainParams */</span>
<a name="l02845"></a><a class="code" href="phy__n_8c.html#a08d214f0a773f77aaa89aaaeeb66edf5">02845</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a08d214f0a773f77aaa89aaaeeb66edf5">b43_nphy_iq_cal_gain_params</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 core,
<a name="l02846"></a>02846                                         <span class="keyword">struct</span> <a class="code" href="structnphy__txgains.html">nphy_txgains</a> target,
<a name="l02847"></a>02847                                         <span class="keyword">struct</span> <a class="code" href="structnphy__iqcal__params.html">nphy_iqcal_params</a> *params)
<a name="l02848"></a>02848 {
<a name="l02849"></a>02849         <span class="keywordtype">int</span> i, j, indx;
<a name="l02850"></a>02850         u16 gain;
<a name="l02851"></a>02851 
<a name="l02852"></a>02852         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l02853"></a>02853                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#ad17d8f22b98cda85c6ad09477fcc74ae">txgm</a> = target.<a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">txgm</a>[core];
<a name="l02854"></a>02854                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#a989d30fde39833e28c1cee5783e6b3d1">pga</a> = target.<a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">pga</a>[core];
<a name="l02855"></a>02855                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#a8241e5f19f9083389c25b49d87090585">pad</a> = target.<a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">pad</a>[core];
<a name="l02856"></a>02856                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#afc1a6f2bc2aa1acccfe9c964e3320a8d">ipa</a> = target.<a class="code" href="structnphy__txgains.html#a5d36577ca175aa8dd4d6634c71b8018b">ipa</a>[core];
<a name="l02857"></a>02857                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#af0afe4e0e28981ee81cb4db24ca455a9">cal_gain</a> = (params-&gt;<a class="code" href="structnphy__iqcal__params.html#ad17d8f22b98cda85c6ad09477fcc74ae">txgm</a> &lt;&lt; 12) | (params-&gt;<a class="code" href="structnphy__iqcal__params.html#a989d30fde39833e28c1cee5783e6b3d1">pga</a> &lt;&lt; 8) |
<a name="l02858"></a>02858                                         (params-&gt;<a class="code" href="structnphy__iqcal__params.html#a8241e5f19f9083389c25b49d87090585">pad</a> &lt;&lt; 4) | (params-&gt;<a class="code" href="structnphy__iqcal__params.html#afc1a6f2bc2aa1acccfe9c964e3320a8d">ipa</a>);
<a name="l02859"></a>02859                 <span class="keywordflow">for</span> (j = 0; j &lt; 5; j++)
<a name="l02860"></a>02860                         params-&gt;<a class="code" href="structnphy__iqcal__params.html#a8f68ba606df0f1d7a7b638d5e5f818dc">ncorr</a>[j] = 0x79;
<a name="l02861"></a>02861         } <span class="keywordflow">else</span> {
<a name="l02862"></a>02862                 gain = (target.<a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">pad</a>[core]) | (target.<a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">pga</a>[core] &lt;&lt; 4) |
<a name="l02863"></a>02863                         (target.<a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">txgm</a>[core] &lt;&lt; 8);
<a name="l02864"></a>02864 
<a name="l02865"></a>02865                 indx = (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) ?
<a name="l02866"></a>02866                         1 : 0;
<a name="l02867"></a>02867                 <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++)
<a name="l02868"></a>02868                         <span class="keywordflow">if</span> (<a class="code" href="tables__nphy_8c.html#af51876f6c694d4e88cbbc2fac183dd24">tbl_iqcal_gainparams</a>[indx][i][0] == gain)
<a name="l02869"></a>02869                                 <span class="keywordflow">break</span>;
<a name="l02870"></a>02870                 i = min(i, 8);
<a name="l02871"></a>02871 
<a name="l02872"></a>02872                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#ad17d8f22b98cda85c6ad09477fcc74ae">txgm</a> = <a class="code" href="tables__nphy_8c.html#af51876f6c694d4e88cbbc2fac183dd24">tbl_iqcal_gainparams</a>[indx][i][1];
<a name="l02873"></a>02873                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#a989d30fde39833e28c1cee5783e6b3d1">pga</a> = <a class="code" href="tables__nphy_8c.html#af51876f6c694d4e88cbbc2fac183dd24">tbl_iqcal_gainparams</a>[indx][i][2];
<a name="l02874"></a>02874                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#a8241e5f19f9083389c25b49d87090585">pad</a> = <a class="code" href="tables__nphy_8c.html#af51876f6c694d4e88cbbc2fac183dd24">tbl_iqcal_gainparams</a>[indx][i][3];
<a name="l02875"></a>02875                 params-&gt;<a class="code" href="structnphy__iqcal__params.html#af0afe4e0e28981ee81cb4db24ca455a9">cal_gain</a> = (params-&gt;<a class="code" href="structnphy__iqcal__params.html#ad17d8f22b98cda85c6ad09477fcc74ae">txgm</a> &lt;&lt; 7) | (params-&gt;<a class="code" href="structnphy__iqcal__params.html#a989d30fde39833e28c1cee5783e6b3d1">pga</a> &lt;&lt; 4) |
<a name="l02876"></a>02876                                         (params-&gt;<a class="code" href="structnphy__iqcal__params.html#a8241e5f19f9083389c25b49d87090585">pad</a> &lt;&lt; 2);
<a name="l02877"></a>02877                 <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++)
<a name="l02878"></a>02878                         params-&gt;<a class="code" href="structnphy__iqcal__params.html#a8f68ba606df0f1d7a7b638d5e5f818dc">ncorr</a>[j] = <a class="code" href="tables__nphy_8c.html#af51876f6c694d4e88cbbc2fac183dd24">tbl_iqcal_gainparams</a>[indx][i][4 + j];
<a name="l02879"></a>02879         }
<a name="l02880"></a>02880 }
<a name="l02881"></a>02881 
<a name="l02882"></a>02882 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/UpdateTxCalLadder */</span>
<a name="l02883"></a><a class="code" href="phy__n_8c.html#a978dd06e225c286a0be7f02d485fc148">02883</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a978dd06e225c286a0be7f02d485fc148">b43_nphy_update_tx_cal_ladder</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 core)
<a name="l02884"></a>02884 {
<a name="l02885"></a>02885         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l02886"></a>02886         <span class="keywordtype">int</span> i;
<a name="l02887"></a>02887         u16 scale, entry;
<a name="l02888"></a>02888 
<a name="l02889"></a>02889         u16 tmp = nphy-&gt;<a class="code" href="structb43__phy__n.html#ac75903d9cf35b3bf1599c7787216ea79">txcal_bbmult</a>;
<a name="l02890"></a>02890         <span class="keywordflow">if</span> (core == 0)
<a name="l02891"></a>02891                 tmp &gt;&gt;= 8;
<a name="l02892"></a>02892         tmp &amp;= 0xff;
<a name="l02893"></a>02893 
<a name="l02894"></a>02894         <span class="keywordflow">for</span> (i = 0; i &lt; 18; i++) {
<a name="l02895"></a>02895                 scale = (<a class="code" href="tables__nphy_8c.html#ae54f5dcc35467e34e65ca81534a3bf9d">ladder_lo</a>[i].<a class="code" href="structnphy__txiqcal__ladder.html#a0ff55ab26e1c5e428405d8f0bb941da5">percent</a> * tmp) / 100;
<a name="l02896"></a>02896                 entry = ((scale &amp; 0xFF) &lt;&lt; 8) | <a class="code" href="tables__nphy_8c.html#ae54f5dcc35467e34e65ca81534a3bf9d">ladder_lo</a>[i].<a class="code" href="structnphy__txiqcal__ladder.html#a801ec4d2077c205135d020793bb2fb7d">g_env</a>;
<a name="l02897"></a>02897                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, i), entry);
<a name="l02898"></a>02898 
<a name="l02899"></a>02899                 scale = (<a class="code" href="tables__nphy_8c.html#a8cb023538afbcae88f3bcc1d341f5c3b">ladder_iq</a>[i].<a class="code" href="structnphy__txiqcal__ladder.html#a0ff55ab26e1c5e428405d8f0bb941da5">percent</a> * tmp) / 100;
<a name="l02900"></a>02900                 entry = ((scale &amp; 0xFF) &lt;&lt; 8) | <a class="code" href="tables__nphy_8c.html#a8cb023538afbcae88f3bcc1d341f5c3b">ladder_iq</a>[i].<a class="code" href="structnphy__txiqcal__ladder.html#a801ec4d2077c205135d020793bb2fb7d">g_env</a>;
<a name="l02901"></a>02901                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, i + 32), entry);
<a name="l02902"></a>02902         }
<a name="l02903"></a>02903 }
<a name="l02904"></a>02904 
<a name="l02905"></a>02905 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/ExtPaSetTxDigiFilts */</span>
<a name="l02906"></a><a class="code" href="phy__n_8c.html#a4fc9d39737c09f40ae3feeaa429a075a">02906</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a4fc9d39737c09f40ae3feeaa429a075a">b43_nphy_ext_pa_set_tx_dig_filters</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02907"></a>02907 {
<a name="l02908"></a>02908         <span class="keywordtype">int</span> i;
<a name="l02909"></a>02909         <span class="keywordflow">for</span> (i = 0; i &lt; 15; i++)
<a name="l02910"></a>02910                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>(0x2C5 + i),
<a name="l02911"></a>02911                                 <a class="code" href="tables__nphy_8c.html#af9d4a424b89ac898f91afd1d2ca35bd2">tbl_tx_filter_coef_rev4</a>[2][i]);
<a name="l02912"></a>02912 }
<a name="l02913"></a>02913 
<a name="l02914"></a>02914 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/IpaSetTxDigiFilts */</span>
<a name="l02915"></a><a class="code" href="phy__n_8c.html#a10594fc970e9f17806ae634df9040faa">02915</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a10594fc970e9f17806ae634df9040faa">b43_nphy_int_pa_set_tx_dig_filters</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02916"></a>02916 {
<a name="l02917"></a>02917         <span class="keywordtype">int</span> i, j;
<a name="l02918"></a>02918         <span class="comment">/* B43_NPHY_TXF_20CO_S0A1, B43_NPHY_TXF_40CO_S0A1, unknown */</span>
<a name="l02919"></a>02919         <span class="keyword">static</span> <span class="keyword">const</span> u16 offset[] = { 0x186, 0x195, 0x2C5 };
<a name="l02920"></a>02920 
<a name="l02921"></a>02921         <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++)
<a name="l02922"></a>02922                 <span class="keywordflow">for</span> (j = 0; j &lt; 15; j++)
<a name="l02923"></a>02923                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>(offset[i] + j),
<a name="l02924"></a>02924                                         <a class="code" href="tables__nphy_8c.html#af9d4a424b89ac898f91afd1d2ca35bd2">tbl_tx_filter_coef_rev4</a>[i][j]);
<a name="l02925"></a>02925 
<a name="l02926"></a>02926         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>) {
<a name="l02927"></a>02927                 <span class="keywordflow">for</span> (j = 0; j &lt; 15; j++)
<a name="l02928"></a>02928                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>(offset[0] + j),
<a name="l02929"></a>02929                                         <a class="code" href="tables__nphy_8c.html#af9d4a424b89ac898f91afd1d2ca35bd2">tbl_tx_filter_coef_rev4</a>[3][j]);
<a name="l02930"></a>02930         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) {
<a name="l02931"></a>02931                 <span class="keywordflow">for</span> (j = 0; j &lt; 15; j++)
<a name="l02932"></a>02932                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>(offset[0] + j),
<a name="l02933"></a>02933                                         <a class="code" href="tables__nphy_8c.html#af9d4a424b89ac898f91afd1d2ca35bd2">tbl_tx_filter_coef_rev4</a>[5][j]);
<a name="l02934"></a>02934         }
<a name="l02935"></a>02935 
<a name="l02936"></a>02936         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a68e5573cadabc1462bb752eefec9c599">channel</a> == 14)
<a name="l02937"></a>02937                 <span class="keywordflow">for</span> (j = 0; j &lt; 15; j++)
<a name="l02938"></a>02938                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#a6942e5d1ad5b0ba1dab347e0a21a0c80">B43_PHY_N</a>(offset[0] + j),
<a name="l02939"></a>02939                                         <a class="code" href="tables__nphy_8c.html#af9d4a424b89ac898f91afd1d2ca35bd2">tbl_tx_filter_coef_rev4</a>[6][j]);
<a name="l02940"></a>02940 }
<a name="l02941"></a>02941 
<a name="l02942"></a>02942 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/GetTxGain */</span>
<a name="l02943"></a><a class="code" href="phy__n_8c.html#a5be8c8872b549c2f1e532cb45e4e8f99">02943</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structnphy__txgains.html">nphy_txgains</a> <a class="code" href="phy__n_8c.html#a5be8c8872b549c2f1e532cb45e4e8f99">b43_nphy_get_tx_gains</a>(struct <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02944"></a>02944 {
<a name="l02945"></a>02945         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l02946"></a>02946 
<a name="l02947"></a>02947         u16 curr_gain[2];
<a name="l02948"></a>02948         <span class="keyword">struct </span><a class="code" href="structnphy__txgains.html">nphy_txgains</a> target;
<a name="l02949"></a>02949         <span class="keyword">const</span> u32 *table = NULL;
<a name="l02950"></a>02950 
<a name="l02951"></a>02951         <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#ade415910e4417d729e6e95daf8c08f6f">txpwrctrl</a>) {
<a name="l02952"></a>02952                 <span class="keywordtype">int</span> i;
<a name="l02953"></a>02953 
<a name="l02954"></a>02954                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l02955"></a>02955                         <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">true</span>);
<a name="l02956"></a>02956                 <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x110), 2, curr_gain);
<a name="l02957"></a>02957                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l02958"></a>02958                         <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">false</span>);
<a name="l02959"></a>02959 
<a name="l02960"></a>02960                 <span class="keywordflow">for</span> (i = 0; i &lt; 2; ++i) {
<a name="l02961"></a>02961                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l02962"></a>02962                                 target.<a class="code" href="structnphy__txgains.html#a5d36577ca175aa8dd4d6634c71b8018b">ipa</a>[i] = curr_gain[i] &amp; 0x000F;
<a name="l02963"></a>02963                                 target.<a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">pad</a>[i] = (curr_gain[i] &amp; 0x00F0) &gt;&gt; 4;
<a name="l02964"></a>02964                                 target.<a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">pga</a>[i] = (curr_gain[i] &amp; 0x0F00) &gt;&gt; 8;
<a name="l02965"></a>02965                                 target.<a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">txgm</a>[i] = (curr_gain[i] &amp; 0x7000) &gt;&gt; 12;
<a name="l02966"></a>02966                         } <span class="keywordflow">else</span> {
<a name="l02967"></a>02967                                 target.<a class="code" href="structnphy__txgains.html#a5d36577ca175aa8dd4d6634c71b8018b">ipa</a>[i] = curr_gain[i] &amp; 0x0003;
<a name="l02968"></a>02968                                 target.<a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">pad</a>[i] = (curr_gain[i] &amp; 0x000C) &gt;&gt; 2;
<a name="l02969"></a>02969                                 target.<a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">pga</a>[i] = (curr_gain[i] &amp; 0x0070) &gt;&gt; 4;
<a name="l02970"></a>02970                                 target.<a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">txgm</a>[i] = (curr_gain[i] &amp; 0x0380) &gt;&gt; 7;
<a name="l02971"></a>02971                         }
<a name="l02972"></a>02972                 }
<a name="l02973"></a>02973         } <span class="keywordflow">else</span> {
<a name="l02974"></a>02974                 <span class="keywordtype">int</span> i;
<a name="l02975"></a>02975                 u16 index[2];
<a name="l02976"></a>02976                 index[0] = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a935edc6a9c366ff20b5fa8ff13f93ce5">B43_NPHY_C1_TXPCTL_STAT</a>) &amp;
<a name="l02977"></a>02977                         <a class="code" href="phy__n_8h.html#a217e41afdbec644d892e85cac7b61d47">B43_NPHY_TXPCTL_STAT_BIDX</a>) &gt;&gt;
<a name="l02978"></a>02978                         <a class="code" href="phy__n_8h.html#aa3c47c34e3b03040bb5efe9fb596d9ac">B43_NPHY_TXPCTL_STAT_BIDX_SHIFT</a>;
<a name="l02979"></a>02979                 index[1] = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a9eba09c6974a13eb7e328773514f4c2c">B43_NPHY_C2_TXPCTL_STAT</a>) &amp;
<a name="l02980"></a>02980                         <a class="code" href="phy__n_8h.html#a217e41afdbec644d892e85cac7b61d47">B43_NPHY_TXPCTL_STAT_BIDX</a>) &gt;&gt;
<a name="l02981"></a>02981                         <a class="code" href="phy__n_8h.html#aa3c47c34e3b03040bb5efe9fb596d9ac">B43_NPHY_TXPCTL_STAT_BIDX_SHIFT</a>;
<a name="l02982"></a>02982 
<a name="l02983"></a>02983                 <span class="keywordflow">for</span> (i = 0; i &lt; 2; ++i) {
<a name="l02984"></a>02984                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l02985"></a>02985                                 <span class="keyword">enum</span> ieee80211_band band =
<a name="l02986"></a>02986                                         <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>);
<a name="l02987"></a>02987 
<a name="l02988"></a>02988                                 <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev)) {
<a name="l02989"></a>02989                                         table = <a class="code" href="phy__n_8c.html#ac9b997a0f7b74f5bcef62e050308b960">b43_nphy_get_ipa_gain_table</a>(dev);
<a name="l02990"></a>02990                                 } <span class="keywordflow">else</span> {
<a name="l02991"></a>02991                                         <span class="keywordflow">if</span> (band == IEEE80211_BAND_5GHZ) {
<a name="l02992"></a>02992                                                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 3)
<a name="l02993"></a>02993                                                         table = <a class="code" href="tables__nphy_8c.html#a217255eebd4a50d97bd007e3dd435510">b43_ntab_tx_gain_rev3_5ghz</a>;
<a name="l02994"></a>02994                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 4)
<a name="l02995"></a>02995                                                         table = <a class="code" href="tables__nphy_8c.html#afbcb4a9011f2e2b32f2670ad0c2d9a10">b43_ntab_tx_gain_rev4_5ghz</a>;
<a name="l02996"></a>02996                                                 <span class="keywordflow">else</span>
<a name="l02997"></a>02997                                                         table = <a class="code" href="tables__nphy_8c.html#a0beae01530e45f0c2b14009e60ff3810">b43_ntab_tx_gain_rev5plus_5ghz</a>;
<a name="l02998"></a>02998                                         } <span class="keywordflow">else</span> {
<a name="l02999"></a>02999                                                 table = <a class="code" href="tables__nphy_8c.html#a5d7f7b5d0eb1540b158d0c1698040b0e">b43_ntab_tx_gain_rev3plus_2ghz</a>;
<a name="l03000"></a>03000                                         }
<a name="l03001"></a>03001                                 }
<a name="l03002"></a>03002 
<a name="l03003"></a>03003                                 target.<a class="code" href="structnphy__txgains.html#a5d36577ca175aa8dd4d6634c71b8018b">ipa</a>[i] = (table[index[i]] &gt;&gt; 16) &amp; 0xF;
<a name="l03004"></a>03004                                 target.<a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">pad</a>[i] = (table[index[i]] &gt;&gt; 20) &amp; 0xF;
<a name="l03005"></a>03005                                 target.<a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">pga</a>[i] = (table[index[i]] &gt;&gt; 24) &amp; 0xF;
<a name="l03006"></a>03006                                 target.<a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">txgm</a>[i] = (table[index[i]] &gt;&gt; 28) &amp; 0xF;
<a name="l03007"></a>03007                         } <span class="keywordflow">else</span> {
<a name="l03008"></a>03008                                 table = <a class="code" href="tables__nphy_8c.html#a11dd66959e9a473e3513b9669312f0fc">b43_ntab_tx_gain_rev0_1_2</a>;
<a name="l03009"></a>03009 
<a name="l03010"></a>03010                                 target.<a class="code" href="structnphy__txgains.html#a5d36577ca175aa8dd4d6634c71b8018b">ipa</a>[i] = (table[index[i]] &gt;&gt; 16) &amp; 0x3;
<a name="l03011"></a>03011                                 target.<a class="code" href="structnphy__txgains.html#a39fe9ebb27bb8126bdd2296819b0075e">pad</a>[i] = (table[index[i]] &gt;&gt; 18) &amp; 0x3;
<a name="l03012"></a>03012                                 target.<a class="code" href="structnphy__txgains.html#a59be3064d4c4279cee013d1f83229be5">pga</a>[i] = (table[index[i]] &gt;&gt; 20) &amp; 0x7;
<a name="l03013"></a>03013                                 target.<a class="code" href="structnphy__txgains.html#ab28436c100f2e86a02b8c912ecb9576c">txgm</a>[i] = (table[index[i]] &gt;&gt; 23) &amp; 0x7;
<a name="l03014"></a>03014                         }
<a name="l03015"></a>03015                 }
<a name="l03016"></a>03016         }
<a name="l03017"></a>03017 
<a name="l03018"></a>03018         <span class="keywordflow">return</span> target;
<a name="l03019"></a>03019 }
<a name="l03020"></a>03020 
<a name="l03021"></a>03021 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxCalPhyCleanup */</span>
<a name="l03022"></a><a class="code" href="phy__n_8c.html#a0ee9a27930a3bf920d0435b0cc172610">03022</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a0ee9a27930a3bf920d0435b0cc172610">b43_nphy_tx_cal_phy_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l03023"></a>03023 {
<a name="l03024"></a>03024         u16 *regs = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>-&gt;<a class="code" href="structb43__phy__n.html#aae79baa7ae67780b12ac8054bf491e16">tx_rx_cal_phy_saveregs</a>;
<a name="l03025"></a>03025 
<a name="l03026"></a>03026         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03027"></a>03027                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, regs[0]);
<a name="l03028"></a>03028                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, regs[1]);
<a name="l03029"></a>03029                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, regs[2]);
<a name="l03030"></a>03030                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, regs[3]);
<a name="l03031"></a>03031                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>, regs[4]);
<a name="l03032"></a>03032                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 3), regs[5]);
<a name="l03033"></a>03033                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 19), regs[6]);
<a name="l03034"></a>03034                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, regs[7]);
<a name="l03035"></a>03035                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, regs[8]);
<a name="l03036"></a>03036                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>, regs[9]);
<a name="l03037"></a>03037                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>, regs[10]);
<a name="l03038"></a>03038                 <a class="code" href="phy__n_8c.html#a6c32257664019e72accdf8fd8cfcc065">b43_nphy_reset_cca</a>(dev);
<a name="l03039"></a>03039         } <span class="keywordflow">else</span> {
<a name="l03040"></a>03040                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, 0x0FFF, regs[0]);
<a name="l03041"></a>03041                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, 0x0FFF, regs[1]);
<a name="l03042"></a>03042                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, regs[2]);
<a name="l03043"></a>03043                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 2), regs[3]);
<a name="l03044"></a>03044                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 18), regs[4]);
<a name="l03045"></a>03045                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, regs[5]);
<a name="l03046"></a>03046                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, regs[6]);
<a name="l03047"></a>03047         }
<a name="l03048"></a>03048 }
<a name="l03049"></a>03049 
<a name="l03050"></a>03050 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/TxCalPhySetup */</span>
<a name="l03051"></a><a class="code" href="phy__n_8c.html#a24227ac7781023c1a6d645e928724344">03051</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a24227ac7781023c1a6d645e928724344">b43_nphy_tx_cal_phy_setup</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l03052"></a>03052 {
<a name="l03053"></a>03053         u16 *regs = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>-&gt;<a class="code" href="structb43__phy__n.html#aae79baa7ae67780b12ac8054bf491e16">tx_rx_cal_phy_saveregs</a>;
<a name="l03054"></a>03054         u16 tmp;
<a name="l03055"></a>03055 
<a name="l03056"></a>03056         regs[0] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>);
<a name="l03057"></a>03057         regs[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>);
<a name="l03058"></a>03058         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03059"></a>03059                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, 0xF0FF, 0x0A00);
<a name="l03060"></a>03060                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, 0xF0FF, 0x0A00);
<a name="l03061"></a>03061 
<a name="l03062"></a>03062                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>);
<a name="l03063"></a>03063                 regs[2] = tmp;
<a name="l03064"></a>03064                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, tmp | 0x0600);
<a name="l03065"></a>03065 
<a name="l03066"></a>03066                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>);
<a name="l03067"></a>03067                 regs[3] = tmp;
<a name="l03068"></a>03068                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, tmp | 0x0600);
<a name="l03069"></a>03069 
<a name="l03070"></a>03070                 regs[4] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>);
<a name="l03071"></a>03071                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>,
<a name="l03072"></a>03072                              ~<a class="code" href="phy__n_8h.html#a3464d851712f3c1b48288d2f0e0086bc">B43_NPHY_BBCFG_RSTRX</a> &amp; 0xFFFF);
<a name="l03073"></a>03073 
<a name="l03074"></a>03074                 tmp = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 3));
<a name="l03075"></a>03075                 regs[5] = tmp;
<a name="l03076"></a>03076                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 3), 0);
<a name="l03077"></a>03077 
<a name="l03078"></a>03078                 tmp = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 19));
<a name="l03079"></a>03079                 regs[6] = tmp;
<a name="l03080"></a>03080                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 19), 0);
<a name="l03081"></a>03081                 regs[7] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>);
<a name="l03082"></a>03082                 regs[8] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>);
<a name="l03083"></a>03083 
<a name="l03084"></a>03084                 <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(dev, 2, 1, 3);
<a name="l03085"></a>03085                 <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(dev, 1, 2, 1);
<a name="l03086"></a>03086                 <a class="code" href="phy__n_8c.html#af460dfa130fc5a67d3447dc2f4890b55">b43_nphy_rf_control_intc_override</a>(dev, 1, 8, 2);
<a name="l03087"></a>03087 
<a name="l03088"></a>03088                 regs[9] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>);
<a name="l03089"></a>03089                 regs[10] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>);
<a name="l03090"></a>03090                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>, ~0x0001);
<a name="l03091"></a>03091                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>, ~0x0001);
<a name="l03092"></a>03092         } <span class="keywordflow">else</span> {
<a name="l03093"></a>03093                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, 0x0FFF, 0xA000);
<a name="l03094"></a>03094                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, 0x0FFF, 0xA000);
<a name="l03095"></a>03095                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>);
<a name="l03096"></a>03096                 regs[2] = tmp;
<a name="l03097"></a>03097                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, tmp | 0x3000);
<a name="l03098"></a>03098                 tmp = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 2));
<a name="l03099"></a>03099                 regs[3] = tmp;
<a name="l03100"></a>03100                 tmp |= 0x2000;
<a name="l03101"></a>03101                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 2), tmp);
<a name="l03102"></a>03102                 tmp = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 18));
<a name="l03103"></a>03103                 regs[4] = tmp;
<a name="l03104"></a>03104                 tmp |= 0x2000;
<a name="l03105"></a>03105                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(8, 18), tmp);
<a name="l03106"></a>03106                 regs[5] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>);
<a name="l03107"></a>03107                 regs[6] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>);
<a name="l03108"></a>03108                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ)
<a name="l03109"></a>03109                         tmp = 0x0180;
<a name="l03110"></a>03110                 <span class="keywordflow">else</span>
<a name="l03111"></a>03111                         tmp = 0x0120;
<a name="l03112"></a>03112                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, tmp);
<a name="l03113"></a>03113                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, tmp);
<a name="l03114"></a>03114         }
<a name="l03115"></a>03115 }
<a name="l03116"></a>03116 
<a name="l03117"></a>03117 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/SaveCal */</span>
<a name="l03118"></a><a class="code" href="phy__n_8c.html#aacb2d7aa12e4b923f2e6a07e0df4edd5">03118</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#aacb2d7aa12e4b923f2e6a07e0df4edd5">b43_nphy_save_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l03119"></a>03119 {
<a name="l03120"></a>03120         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03121"></a>03121 
<a name="l03122"></a>03122         <span class="keyword">struct </span><a class="code" href="structb43__phy__n__iq__comp.html">b43_phy_n_iq_comp</a> *rxcal_coeffs = NULL;
<a name="l03123"></a>03123         u16 *txcal_radio_regs = NULL;
<a name="l03124"></a>03124         <span class="keyword">struct </span><a class="code" href="structb43__chanspec.html">b43_chanspec</a> *iqcal_chanspec;
<a name="l03125"></a>03125         u16 *table = NULL;
<a name="l03126"></a>03126 
<a name="l03127"></a>03127         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l03128"></a>03128                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l03129"></a>03129 
<a name="l03130"></a>03130         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l03131"></a>03131                 rxcal_coeffs = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ab2556ed977df80dc8d54bf40b592dc3c">rxcal_coeffs_2G</a>;
<a name="l03132"></a>03132                 txcal_radio_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#aa42a13ecb442b59ea78c5a9608380a34">txcal_radio_regs_2G</a>;
<a name="l03133"></a>03133                 iqcal_chanspec = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#ae55ff2aa0739885791ef955bf754986f">iqcal_chanspec_2G</a>;
<a name="l03134"></a>03134                 table = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ae2b99bef8a24aa0ad06f37a424f747c3">txcal_coeffs_2G</a>;
<a name="l03135"></a>03135         } <span class="keywordflow">else</span> {
<a name="l03136"></a>03136                 rxcal_coeffs = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#a30d6e4b2820746c1117536cac61fa0db">rxcal_coeffs_5G</a>;
<a name="l03137"></a>03137                 txcal_radio_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#a1841a1943f85aaf477f645b6712e6fa7">txcal_radio_regs_5G</a>;
<a name="l03138"></a>03138                 iqcal_chanspec = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#ad5784cb411a6ff3bcf860909d4596057">iqcal_chanspec_5G</a>;
<a name="l03139"></a>03139                 table = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ad812b4b38aa91998ba6427be8e14c1d9">txcal_coeffs_5G</a>;
<a name="l03140"></a>03140         }
<a name="l03141"></a>03141 
<a name="l03142"></a>03142         <a class="code" href="phy__n_8c.html#ab8bb3c5903d644de759c53635e4d869d">b43_nphy_rx_iq_coeffs</a>(dev, <span class="keyword">false</span>, rxcal_coeffs);
<a name="l03143"></a>03143         <span class="comment">/* TODO use some definitions */</span>
<a name="l03144"></a>03144         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03145"></a>03145                 txcal_radio_regs[0] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x2021);
<a name="l03146"></a>03146                 txcal_radio_regs[1] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x2022);
<a name="l03147"></a>03147                 txcal_radio_regs[2] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x3021);
<a name="l03148"></a>03148                 txcal_radio_regs[3] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x3022);
<a name="l03149"></a>03149                 txcal_radio_regs[4] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x2023);
<a name="l03150"></a>03150                 txcal_radio_regs[5] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x2024);
<a name="l03151"></a>03151                 txcal_radio_regs[6] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x3023);
<a name="l03152"></a>03152                 txcal_radio_regs[7] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x3024);
<a name="l03153"></a>03153         } <span class="keywordflow">else</span> {
<a name="l03154"></a>03154                 txcal_radio_regs[0] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x8B);
<a name="l03155"></a>03155                 txcal_radio_regs[1] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0xBA);
<a name="l03156"></a>03156                 txcal_radio_regs[2] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0x8D);
<a name="l03157"></a>03157                 txcal_radio_regs[3] = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, 0xBC);
<a name="l03158"></a>03158         }
<a name="l03159"></a>03159         iqcal_chanspec-&gt;<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a> = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#abb1fefe6c1dad17ef8a19818669a1d01">channel_freq</a>;
<a name="l03160"></a>03160         iqcal_chanspec-&gt;<a class="code" href="structb43__chanspec.html#a4446dfa9b560cb09d835ff75fa417b58">channel_type</a> = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82402ff096b084b3602fbc3147cc66f4">channel_type</a>;
<a name="l03161"></a>03161         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 80), 8, table);
<a name="l03162"></a>03162 
<a name="l03163"></a>03163         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l03164"></a>03164                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l03165"></a>03165 }
<a name="l03166"></a>03166 
<a name="l03167"></a>03167 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RestoreCal */</span>
<a name="l03168"></a><a class="code" href="phy__n_8c.html#a76427934c7ee26e8fdebe40d63a58fa9">03168</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a76427934c7ee26e8fdebe40d63a58fa9">b43_nphy_restore_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l03169"></a>03169 {
<a name="l03170"></a>03170         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03171"></a>03171 
<a name="l03172"></a>03172         u16 coef[4];
<a name="l03173"></a>03173         u16 *loft = NULL;
<a name="l03174"></a>03174         u16 *table = NULL;
<a name="l03175"></a>03175 
<a name="l03176"></a>03176         <span class="keywordtype">int</span> i;
<a name="l03177"></a>03177         u16 *txcal_radio_regs = NULL;
<a name="l03178"></a>03178         <span class="keyword">struct </span><a class="code" href="structb43__phy__n__iq__comp.html">b43_phy_n_iq_comp</a> *rxcal_coeffs = NULL;
<a name="l03179"></a>03179 
<a name="l03180"></a>03180         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l03181"></a>03181                 <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#ae55ff2aa0739885791ef955bf754986f">iqcal_chanspec_2G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>)
<a name="l03182"></a>03182                         <span class="keywordflow">return</span>;
<a name="l03183"></a>03183                 table = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ae2b99bef8a24aa0ad06f37a424f747c3">txcal_coeffs_2G</a>;
<a name="l03184"></a>03184                 loft = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ae2b99bef8a24aa0ad06f37a424f747c3">txcal_coeffs_2G</a>[5];
<a name="l03185"></a>03185         } <span class="keywordflow">else</span> {
<a name="l03186"></a>03186                 <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#ad5784cb411a6ff3bcf860909d4596057">iqcal_chanspec_5G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>)
<a name="l03187"></a>03187                         <span class="keywordflow">return</span>;
<a name="l03188"></a>03188                 table = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ad812b4b38aa91998ba6427be8e14c1d9">txcal_coeffs_5G</a>;
<a name="l03189"></a>03189                 loft = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ad812b4b38aa91998ba6427be8e14c1d9">txcal_coeffs_5G</a>[5];
<a name="l03190"></a>03190         }
<a name="l03191"></a>03191 
<a name="l03192"></a>03192         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 80), 4, table);
<a name="l03193"></a>03193 
<a name="l03194"></a>03194         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l03195"></a>03195                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03196"></a>03196                         table[i] = coef[i];
<a name="l03197"></a>03197                 <span class="keywordflow">else</span>
<a name="l03198"></a>03198                         coef[i] = 0;
<a name="l03199"></a>03199         }
<a name="l03200"></a>03200 
<a name="l03201"></a>03201         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 88), 4, coef);
<a name="l03202"></a>03202         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 85), 2, loft);
<a name="l03203"></a>03203         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 93), 2, loft);
<a name="l03204"></a>03204 
<a name="l03205"></a>03205         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l03206"></a>03206                 <a class="code" href="phy__n_8c.html#a1eb9da138ff11999c577f74a3763db7c">b43_nphy_tx_iq_workaround</a>(dev);
<a name="l03207"></a>03207 
<a name="l03208"></a>03208         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l03209"></a>03209                 txcal_radio_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#aa42a13ecb442b59ea78c5a9608380a34">txcal_radio_regs_2G</a>;
<a name="l03210"></a>03210                 rxcal_coeffs = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#ab2556ed977df80dc8d54bf40b592dc3c">rxcal_coeffs_2G</a>;
<a name="l03211"></a>03211         } <span class="keywordflow">else</span> {
<a name="l03212"></a>03212                 txcal_radio_regs = nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#a1841a1943f85aaf477f645b6712e6fa7">txcal_radio_regs_5G</a>;
<a name="l03213"></a>03213                 rxcal_coeffs = &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a69981970495b8dc77e0cc0f265cc0b8c">cal_cache</a>.<a class="code" href="structb43__phy__n__cal__cache.html#a30d6e4b2820746c1117536cac61fa0db">rxcal_coeffs_5G</a>;
<a name="l03214"></a>03214         }
<a name="l03215"></a>03215 
<a name="l03216"></a>03216         <span class="comment">/* TODO use some definitions */</span>
<a name="l03217"></a>03217         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03218"></a>03218                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x2021, txcal_radio_regs[0]);
<a name="l03219"></a>03219                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x2022, txcal_radio_regs[1]);
<a name="l03220"></a>03220                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x3021, txcal_radio_regs[2]);
<a name="l03221"></a>03221                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x3022, txcal_radio_regs[3]);
<a name="l03222"></a>03222                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x2023, txcal_radio_regs[4]);
<a name="l03223"></a>03223                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x2024, txcal_radio_regs[5]);
<a name="l03224"></a>03224                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x3023, txcal_radio_regs[6]);
<a name="l03225"></a>03225                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x3024, txcal_radio_regs[7]);
<a name="l03226"></a>03226         } <span class="keywordflow">else</span> {
<a name="l03227"></a>03227                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x8B, txcal_radio_regs[0]);
<a name="l03228"></a>03228                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0xBA, txcal_radio_regs[1]);
<a name="l03229"></a>03229                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x8D, txcal_radio_regs[2]);
<a name="l03230"></a>03230                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0xBC, txcal_radio_regs[3]);
<a name="l03231"></a>03231         }
<a name="l03232"></a>03232         <a class="code" href="phy__n_8c.html#ab8bb3c5903d644de759c53635e4d869d">b43_nphy_rx_iq_coeffs</a>(dev, <span class="keyword">true</span>, rxcal_coeffs);
<a name="l03233"></a>03233 }
<a name="l03234"></a>03234 
<a name="l03235"></a>03235 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/CalTxIqlo */</span>
<a name="l03236"></a><a class="code" href="phy__n_8c.html#a6da65f8c0878d53f63e804f34c65e796">03236</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a6da65f8c0878d53f63e804f34c65e796">b43_nphy_cal_tx_iq_lo</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l03237"></a>03237                                 <span class="keyword">struct</span> <a class="code" href="structnphy__txgains.html">nphy_txgains</a> target,
<a name="l03238"></a>03238                                 <span class="keywordtype">bool</span> full, <span class="keywordtype">bool</span> mphase)
<a name="l03239"></a>03239 {
<a name="l03240"></a>03240         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03241"></a>03241         <span class="keywordtype">int</span> i;
<a name="l03242"></a>03242         <span class="keywordtype">int</span> error = 0;
<a name="l03243"></a>03243         <span class="keywordtype">int</span> freq;
<a name="l03244"></a>03244         <span class="keywordtype">bool</span> avoid = <span class="keyword">false</span>;
<a name="l03245"></a>03245         u8 length;
<a name="l03246"></a>03246         u16 tmp, core, type, count, max, numb, last = 0, cmd;
<a name="l03247"></a>03247         <span class="keyword">const</span> u16 *table;
<a name="l03248"></a>03248         <span class="keywordtype">bool</span> phy6or5x;
<a name="l03249"></a>03249 
<a name="l03250"></a>03250         u16 buffer[11];
<a name="l03251"></a>03251         u16 diq_start = 0;
<a name="l03252"></a>03252         u16 save[2];
<a name="l03253"></a>03253         u16 gain[2];
<a name="l03254"></a>03254         <span class="keyword">struct </span><a class="code" href="structnphy__iqcal__params.html">nphy_iqcal_params</a> params[2];
<a name="l03255"></a>03255         <span class="keywordtype">bool</span> updated[2] = { };
<a name="l03256"></a>03256 
<a name="l03257"></a>03257         <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">true</span>);
<a name="l03258"></a>03258 
<a name="l03259"></a>03259         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 4) {
<a name="l03260"></a>03260                 avoid = nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>;
<a name="l03261"></a>03261                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a> = 0;
<a name="l03262"></a>03262         }
<a name="l03263"></a>03263 
<a name="l03264"></a>03264         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x110), 2, save);
<a name="l03265"></a>03265 
<a name="l03266"></a>03266         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l03267"></a>03267                 <a class="code" href="phy__n_8c.html#a08d214f0a773f77aaa89aaaeeb66edf5">b43_nphy_iq_cal_gain_params</a>(dev, i, target, &amp;params[i]);
<a name="l03268"></a>03268                 gain[i] = params[i].<a class="code" href="structnphy__iqcal__params.html#af0afe4e0e28981ee81cb4db24ca455a9">cal_gain</a>;
<a name="l03269"></a>03269         }
<a name="l03270"></a>03270 
<a name="l03271"></a>03271         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x110), 2, gain);
<a name="l03272"></a>03272 
<a name="l03273"></a>03273         <a class="code" href="phy__n_8c.html#a9a47051adfde74dafe3e2816f9f467d7">b43_nphy_tx_cal_radio_setup</a>(dev);
<a name="l03274"></a>03274         <a class="code" href="phy__n_8c.html#a24227ac7781023c1a6d645e928724344">b43_nphy_tx_cal_phy_setup</a>(dev);
<a name="l03275"></a>03275 
<a name="l03276"></a>03276         phy6or5x = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 6 ||
<a name="l03277"></a>03277                 (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 5 &amp;&amp; nphy-&gt;<a class="code" href="structb43__phy__n.html#a5688a326492153efc11b08d2c2edae29">ipa2g_on</a> &amp;&amp;
<a name="l03278"></a>03278                 <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ);
<a name="l03279"></a>03279         <span class="keywordflow">if</span> (phy6or5x) {
<a name="l03280"></a>03280                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>) {
<a name="l03281"></a>03281                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 0), 18,
<a name="l03282"></a>03282                                         <a class="code" href="tables__nphy_8c.html#a3c92e4ffec9faf9d3834393a95ac1b70">tbl_tx_iqlo_cal_loft_ladder_40</a>);
<a name="l03283"></a>03283                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 32), 18,
<a name="l03284"></a>03284                                         <a class="code" href="tables__nphy_8c.html#a82796911a283a51a48ae85c00ba392bd">tbl_tx_iqlo_cal_iqimb_ladder_40</a>);
<a name="l03285"></a>03285                 } <span class="keywordflow">else</span> {
<a name="l03286"></a>03286                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 0), 18,
<a name="l03287"></a>03287                                         <a class="code" href="tables__nphy_8c.html#a0b22974f691b6fbb7f725c042f808fb2">tbl_tx_iqlo_cal_loft_ladder_20</a>);
<a name="l03288"></a>03288                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 32), 18,
<a name="l03289"></a>03289                                         <a class="code" href="tables__nphy_8c.html#a5cf4ad28848794ccfbf7a01b50dc3a41">tbl_tx_iqlo_cal_iqimb_ladder_20</a>);
<a name="l03290"></a>03290                 }
<a name="l03291"></a>03291         }
<a name="l03292"></a>03292 
<a name="l03293"></a>03293         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9a86c85d2b27f7bf67cf77d2c8deae87">B43_NPHY_IQLOCAL_CMDGCTL</a>, 0x8AA9);
<a name="l03294"></a>03294 
<a name="l03295"></a>03295         <span class="keywordflow">if</span> (!dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a>)
<a name="l03296"></a>03296                 freq = 2500;
<a name="l03297"></a>03297         <span class="keywordflow">else</span>
<a name="l03298"></a>03298                 freq = 5000;
<a name="l03299"></a>03299 
<a name="l03300"></a>03300         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a18b2e61ce434d595b80dd648931b42f7">mphase_cal_phase_id</a> &gt; 2)
<a name="l03301"></a>03301                 <a class="code" href="phy__n_8c.html#a3fa62797735d6ea3ea0cc45691c205ce">b43_nphy_run_samples</a>(dev, (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#ab7ff653947b7bb5c2f924c1126b8d570">is_40mhz</a> ? 40 : 20) * 8,
<a name="l03302"></a>03302                                         0xFFFF, 0, <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l03303"></a>03303         <span class="keywordflow">else</span>
<a name="l03304"></a>03304                 error = <a class="code" href="phy__n_8c.html#a1cc412bbff4d1073f5fafc67ecb8d6dd">b43_nphy_tx_tone</a>(dev, freq, 250, <span class="keyword">true</span>, <span class="keyword">false</span>);
<a name="l03305"></a>03305 
<a name="l03306"></a>03306         <span class="keywordflow">if</span> (error == 0) {
<a name="l03307"></a>03307                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a18b2e61ce434d595b80dd648931b42f7">mphase_cal_phase_id</a> &gt; 2) {
<a name="l03308"></a>03308                         table = nphy-&gt;<a class="code" href="structb43__phy__n.html#a3492f360b2a703672bece9eaadba5b10">mphase_txcal_bestcoeffs</a>;
<a name="l03309"></a>03309                         length = 11;
<a name="l03310"></a>03310                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3)
<a name="l03311"></a>03311                                 length -= 2;
<a name="l03312"></a>03312                 } <span class="keywordflow">else</span> {
<a name="l03313"></a>03313                         <span class="keywordflow">if</span> (!full &amp;&amp; nphy-&gt;<a class="code" href="structb43__phy__n.html#a30b465a24b33176fd84f47b1fc383d12">txiqlocal_coeffsvalid</a>) {
<a name="l03314"></a>03314                                 table = nphy-&gt;<a class="code" href="structb43__phy__n.html#a86581223afe1a22695f7acb84665b389">txiqlocal_bestc</a>;
<a name="l03315"></a>03315                                 length = 11;
<a name="l03316"></a>03316                                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3)
<a name="l03317"></a>03317                                         length -= 2;
<a name="l03318"></a>03318                         } <span class="keywordflow">else</span> {
<a name="l03319"></a>03319                                 full = <span class="keyword">true</span>;
<a name="l03320"></a>03320                                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03321"></a>03321                                         table = <a class="code" href="tables__nphy_8c.html#ad28aa1ce85c351168f799cf9f35bad2f">tbl_tx_iqlo_cal_startcoefs_nphyrev3</a>;
<a name="l03322"></a>03322                                         length = <a class="code" href="tables__nphy_8h.html#a7f817fbf6213a44afe19ff1e60d7fe31">B43_NTAB_TX_IQLO_CAL_STARTCOEFS_REV3</a>;
<a name="l03323"></a>03323                                 } <span class="keywordflow">else</span> {
<a name="l03324"></a>03324                                         table = <a class="code" href="tables__nphy_8c.html#a9a2d90e92067cdaff056035c880e2a9f">tbl_tx_iqlo_cal_startcoefs</a>;
<a name="l03325"></a>03325                                         length = <a class="code" href="tables__nphy_8h.html#abf5bc5d2bceb308d28964c1c3aeeb19d">B43_NTAB_TX_IQLO_CAL_STARTCOEFS</a>;
<a name="l03326"></a>03326                                 }
<a name="l03327"></a>03327                         }
<a name="l03328"></a>03328                 }
<a name="l03329"></a>03329 
<a name="l03330"></a>03330                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 64), length, table);
<a name="l03331"></a>03331 
<a name="l03332"></a>03332                 <span class="keywordflow">if</span> (full) {
<a name="l03333"></a>03333                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03334"></a>03334                                 max = <a class="code" href="tables__nphy_8h.html#a6906fff331c3d25142d4822eeea758b8">B43_NTAB_TX_IQLO_CAL_CMDS_FULLCAL_REV3</a>;
<a name="l03335"></a>03335                         <span class="keywordflow">else</span>
<a name="l03336"></a>03336                                 max = <a class="code" href="tables__nphy_8h.html#a03cf9a109b87902408e954864eb3b4d0">B43_NTAB_TX_IQLO_CAL_CMDS_FULLCAL</a>;
<a name="l03337"></a>03337                 } <span class="keywordflow">else</span> {
<a name="l03338"></a>03338                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03339"></a>03339                                 max = <a class="code" href="tables__nphy_8h.html#aa09605d4166668f18aea9c2414c3b5b6">B43_NTAB_TX_IQLO_CAL_CMDS_RECAL_REV3</a>;
<a name="l03340"></a>03340                         <span class="keywordflow">else</span>
<a name="l03341"></a>03341                                 max = <a class="code" href="tables__nphy_8h.html#a98da54bf4dd91c5747d10d3e0f40efa4">B43_NTAB_TX_IQLO_CAL_CMDS_RECAL</a>;
<a name="l03342"></a>03342                 }
<a name="l03343"></a>03343 
<a name="l03344"></a>03344                 <span class="keywordflow">if</span> (mphase) {
<a name="l03345"></a>03345                         count = nphy-&gt;<a class="code" href="structb43__phy__n.html#a5c6ea6ef42428864dca29de094432784">mphase_txcal_cmdidx</a>;
<a name="l03346"></a>03346                         numb = min(max,
<a name="l03347"></a>03347                                 (u16)(count + nphy-&gt;<a class="code" href="structb43__phy__n.html#a919aa410eccdc54c6cba49470ed01823">mphase_txcal_numcmds</a>));
<a name="l03348"></a>03348                 } <span class="keywordflow">else</span> {
<a name="l03349"></a>03349                         count = 0;
<a name="l03350"></a>03350                         numb = max;
<a name="l03351"></a>03351                 }
<a name="l03352"></a>03352 
<a name="l03353"></a>03353                 <span class="keywordflow">for</span> (; count &lt; numb; count++) {
<a name="l03354"></a>03354                         <span class="keywordflow">if</span> (full) {
<a name="l03355"></a>03355                                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03356"></a>03356                                         cmd = <a class="code" href="tables__nphy_8c.html#a30663f20f07015392d50665481b433bd">tbl_tx_iqlo_cal_cmds_fullcal_nphyrev3</a>[count];
<a name="l03357"></a>03357                                 <span class="keywordflow">else</span>
<a name="l03358"></a>03358                                         cmd = <a class="code" href="tables__nphy_8c.html#a57870f19c1c418487cec10f2eaa17828">tbl_tx_iqlo_cal_cmds_fullcal</a>[count];
<a name="l03359"></a>03359                         } <span class="keywordflow">else</span> {
<a name="l03360"></a>03360                                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03361"></a>03361                                         cmd = <a class="code" href="tables__nphy_8c.html#a1a8191ca615e3f7a182835cfd59ab39f">tbl_tx_iqlo_cal_cmds_recal_nphyrev3</a>[count];
<a name="l03362"></a>03362                                 <span class="keywordflow">else</span>
<a name="l03363"></a>03363                                         cmd = <a class="code" href="tables__nphy_8c.html#a2fb112796955aee3e9f6cb46103e0478">tbl_tx_iqlo_cal_cmds_recal</a>[count];
<a name="l03364"></a>03364                         }
<a name="l03365"></a>03365 
<a name="l03366"></a>03366                         core = (cmd &amp; 0x3000) &gt;&gt; 12;
<a name="l03367"></a>03367                         type = (cmd &amp; 0x0F00) &gt;&gt; 8;
<a name="l03368"></a>03368 
<a name="l03369"></a>03369                         <span class="keywordflow">if</span> (phy6or5x &amp;&amp; updated[core] == 0) {
<a name="l03370"></a>03370                                 <a class="code" href="phy__n_8c.html#a978dd06e225c286a0be7f02d485fc148">b43_nphy_update_tx_cal_ladder</a>(dev, core);
<a name="l03371"></a>03371                                 updated[core] = 1;
<a name="l03372"></a>03372                         }
<a name="l03373"></a>03373 
<a name="l03374"></a>03374                         tmp = (params[core].<a class="code" href="structnphy__iqcal__params.html#a8f68ba606df0f1d7a7b638d5e5f818dc">ncorr</a>[type] &lt;&lt; 8) | 0x66;
<a name="l03375"></a>03375                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a1339ab595ea39e0a34b79b212c41f164">B43_NPHY_IQLOCAL_CMDNNUM</a>, tmp);
<a name="l03376"></a>03376 
<a name="l03377"></a>03377                         <span class="keywordflow">if</span> (type == 1 || type == 3 || type == 4) {
<a name="l03378"></a>03378                                 buffer[0] = <a class="code" href="tables__nphy_8c.html#a4ad66e5a56fe64a8561b21a0e8893744">b43_ntab_read</a>(dev,
<a name="l03379"></a>03379                                                 <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 69 + core));
<a name="l03380"></a>03380                                 diq_start = buffer[0];
<a name="l03381"></a>03381                                 buffer[0] = 0;
<a name="l03382"></a>03382                                 <a class="code" href="tables__nphy_8c.html#a2a81a91ae24223624eb236a2889fefbf">b43_ntab_write</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 69 + core),
<a name="l03383"></a>03383                                                 0);
<a name="l03384"></a>03384                         }
<a name="l03385"></a>03385 
<a name="l03386"></a>03386                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af6b70d331be36098b58dab7d69581288">B43_NPHY_IQLOCAL_CMD</a>, cmd);
<a name="l03387"></a>03387                         <span class="keywordflow">for</span> (i = 0; i &lt; 2000; i++) {
<a name="l03388"></a>03388                                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#af6b70d331be36098b58dab7d69581288">B43_NPHY_IQLOCAL_CMD</a>);
<a name="l03389"></a>03389                                 <span class="keywordflow">if</span> (tmp &amp; 0xC000)
<a name="l03390"></a>03390                                         <span class="keywordflow">break</span>;
<a name="l03391"></a>03391                                 udelay(10);
<a name="l03392"></a>03392                         }
<a name="l03393"></a>03393 
<a name="l03394"></a>03394                         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 96), length,
<a name="l03395"></a>03395                                                 buffer);
<a name="l03396"></a>03396                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 64), length,
<a name="l03397"></a>03397                                                 buffer);
<a name="l03398"></a>03398 
<a name="l03399"></a>03399                         <span class="keywordflow">if</span> (type == 1 || type == 3 || type == 4)
<a name="l03400"></a>03400                                 buffer[0] = diq_start;
<a name="l03401"></a>03401                 }
<a name="l03402"></a>03402 
<a name="l03403"></a>03403                 <span class="keywordflow">if</span> (mphase)
<a name="l03404"></a>03404                         nphy-&gt;<a class="code" href="structb43__phy__n.html#a5c6ea6ef42428864dca29de094432784">mphase_txcal_cmdidx</a> = (numb &gt;= max) ? 0 : numb;
<a name="l03405"></a>03405 
<a name="l03406"></a>03406                 last = (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3) ? 6 : 7;
<a name="l03407"></a>03407 
<a name="l03408"></a>03408                 <span class="keywordflow">if</span> (!mphase || nphy-&gt;<a class="code" href="structb43__phy__n.html#a18b2e61ce434d595b80dd648931b42f7">mphase_cal_phase_id</a> == last) {
<a name="l03409"></a>03409                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 96), 4, buffer);
<a name="l03410"></a>03410                         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 80), 4, buffer);
<a name="l03411"></a>03411                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3) {
<a name="l03412"></a>03412                                 buffer[0] = 0;
<a name="l03413"></a>03413                                 buffer[1] = 0;
<a name="l03414"></a>03414                                 buffer[2] = 0;
<a name="l03415"></a>03415                                 buffer[3] = 0;
<a name="l03416"></a>03416                         }
<a name="l03417"></a>03417                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 88), 4,
<a name="l03418"></a>03418                                                 buffer);
<a name="l03419"></a>03419                         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 101), 2,
<a name="l03420"></a>03420                                                 buffer);
<a name="l03421"></a>03421                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 85), 2,
<a name="l03422"></a>03422                                                 buffer);
<a name="l03423"></a>03423                         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 93), 2,
<a name="l03424"></a>03424                                                 buffer);
<a name="l03425"></a>03425                         length = 11;
<a name="l03426"></a>03426                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3)
<a name="l03427"></a>03427                                 length -= 2;
<a name="l03428"></a>03428                         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 96), length,
<a name="l03429"></a>03429                                                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a86581223afe1a22695f7acb84665b389">txiqlocal_bestc</a>);
<a name="l03430"></a>03430                         nphy-&gt;<a class="code" href="structb43__phy__n.html#a30b465a24b33176fd84f47b1fc383d12">txiqlocal_coeffsvalid</a> = <span class="keyword">true</span>;
<a name="l03431"></a>03431                         nphy-&gt;<a class="code" href="structb43__phy__n.html#af8ed363b395749b735b70281c000a154">txiqlocal_chanspec</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a> =
<a name="l03432"></a>03432                                                         dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#abb1fefe6c1dad17ef8a19818669a1d01">channel_freq</a>;
<a name="l03433"></a>03433                         nphy-&gt;<a class="code" href="structb43__phy__n.html#af8ed363b395749b735b70281c000a154">txiqlocal_chanspec</a>.<a class="code" href="structb43__chanspec.html#a4446dfa9b560cb09d835ff75fa417b58">channel_type</a> =
<a name="l03434"></a>03434                                                         dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82402ff096b084b3602fbc3147cc66f4">channel_type</a>;
<a name="l03435"></a>03435                 } <span class="keywordflow">else</span> {
<a name="l03436"></a>03436                         length = 11;
<a name="l03437"></a>03437                         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3)
<a name="l03438"></a>03438                                 length -= 2;
<a name="l03439"></a>03439                         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 96), length,
<a name="l03440"></a>03440                                                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a3492f360b2a703672bece9eaadba5b10">mphase_txcal_bestcoeffs</a>);
<a name="l03441"></a>03441                 }
<a name="l03442"></a>03442 
<a name="l03443"></a>03443                 <a class="code" href="phy__n_8c.html#a8c9f021527e4fc603810a194124b299a">b43_nphy_stop_playback</a>(dev);
<a name="l03444"></a>03444                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9a86c85d2b27f7bf67cf77d2c8deae87">B43_NPHY_IQLOCAL_CMDGCTL</a>, 0);
<a name="l03445"></a>03445         }
<a name="l03446"></a>03446 
<a name="l03447"></a>03447         <a class="code" href="phy__n_8c.html#a0ee9a27930a3bf920d0435b0cc172610">b43_nphy_tx_cal_phy_cleanup</a>(dev);
<a name="l03448"></a>03448         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x110), 2, save);
<a name="l03449"></a>03449 
<a name="l03450"></a>03450         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2 &amp;&amp; (!mphase || nphy-&gt;<a class="code" href="structb43__phy__n.html#a18b2e61ce434d595b80dd648931b42f7">mphase_cal_phase_id</a> == last))
<a name="l03451"></a>03451                 <a class="code" href="phy__n_8c.html#a1eb9da138ff11999c577f74a3763db7c">b43_nphy_tx_iq_workaround</a>(dev);
<a name="l03452"></a>03452 
<a name="l03453"></a>03453         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 4)
<a name="l03454"></a>03454                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a> = avoid;
<a name="l03455"></a>03455 
<a name="l03456"></a>03456         <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">false</span>);
<a name="l03457"></a>03457 
<a name="l03458"></a>03458         <span class="keywordflow">return</span> error;
<a name="l03459"></a>03459 }
<a name="l03460"></a>03460 
<a name="l03461"></a>03461 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/ReapplyTxCalCoeffs */</span>
<a name="l03462"></a><a class="code" href="phy__n_8c.html#a2752d765042313e7ba2d0a3f2bea6305">03462</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a2752d765042313e7ba2d0a3f2bea6305">b43_nphy_reapply_tx_cal_coeffs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l03463"></a>03463 {
<a name="l03464"></a>03464         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03465"></a>03465         u8 i;
<a name="l03466"></a>03466         u16 buffer[7];
<a name="l03467"></a>03467         <span class="keywordtype">bool</span> equal = <span class="keyword">true</span>;
<a name="l03468"></a>03468 
<a name="l03469"></a>03469         <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#a30b465a24b33176fd84f47b1fc383d12">txiqlocal_coeffsvalid</a> ||
<a name="l03470"></a>03470             nphy-&gt;<a class="code" href="structb43__phy__n.html#af8ed363b395749b735b70281c000a154">txiqlocal_chanspec</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a> != dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#abb1fefe6c1dad17ef8a19818669a1d01">channel_freq</a> ||
<a name="l03471"></a>03471             nphy-&gt;<a class="code" href="structb43__phy__n.html#af8ed363b395749b735b70281c000a154">txiqlocal_chanspec</a>.<a class="code" href="structb43__chanspec.html#a4446dfa9b560cb09d835ff75fa417b58">channel_type</a> != dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82402ff096b084b3602fbc3147cc66f4">channel_type</a>)
<a name="l03472"></a>03472                 <span class="keywordflow">return</span>;
<a name="l03473"></a>03473 
<a name="l03474"></a>03474         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 80), 7, buffer);
<a name="l03475"></a>03475         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l03476"></a>03476                 <span class="keywordflow">if</span> (buffer[i] != nphy-&gt;<a class="code" href="structb43__phy__n.html#a86581223afe1a22695f7acb84665b389">txiqlocal_bestc</a>[i]) {
<a name="l03477"></a>03477                         equal = <span class="keyword">false</span>;
<a name="l03478"></a>03478                         <span class="keywordflow">break</span>;
<a name="l03479"></a>03479                 }
<a name="l03480"></a>03480         }
<a name="l03481"></a>03481 
<a name="l03482"></a>03482         <span class="keywordflow">if</span> (!equal) {
<a name="l03483"></a>03483                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 80), 4,
<a name="l03484"></a>03484                                         nphy-&gt;<a class="code" href="structb43__phy__n.html#a86581223afe1a22695f7acb84665b389">txiqlocal_bestc</a>);
<a name="l03485"></a>03485                 <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l03486"></a>03486                         buffer[i] = 0;
<a name="l03487"></a>03487                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 88), 4,
<a name="l03488"></a>03488                                         buffer);
<a name="l03489"></a>03489                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 85), 2,
<a name="l03490"></a>03490                                         &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a86581223afe1a22695f7acb84665b389">txiqlocal_bestc</a>[5]);
<a name="l03491"></a>03491                 <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(15, 93), 2,
<a name="l03492"></a>03492                                         &amp;nphy-&gt;<a class="code" href="structb43__phy__n.html#a86581223afe1a22695f7acb84665b389">txiqlocal_bestc</a>[5]);
<a name="l03493"></a>03493         }
<a name="l03494"></a>03494 }
<a name="l03495"></a>03495 
<a name="l03496"></a>03496 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/CalRxIqRev2 */</span>
<a name="l03497"></a><a class="code" href="phy__n_8c.html#a1eaecef2d6242be41fa2110258d06e9e">03497</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a1eaecef2d6242be41fa2110258d06e9e">b43_nphy_rev2_cal_rx_iq</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l03498"></a>03498                         <span class="keyword">struct</span> <a class="code" href="structnphy__txgains.html">nphy_txgains</a> target, u8 type, <span class="keywordtype">bool</span> debug)
<a name="l03499"></a>03499 {
<a name="l03500"></a>03500         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03501"></a>03501         <span class="keywordtype">int</span> i, j, index;
<a name="l03502"></a>03502         u8 rfctl[2];
<a name="l03503"></a>03503         u8 afectl_core;
<a name="l03504"></a>03504         u16 tmp[6];
<a name="l03505"></a>03505         u16 uninitialized_var(cur_hpf1), uninitialized_var(cur_hpf2), cur_lna;
<a name="l03506"></a>03506         u32 real, imag;
<a name="l03507"></a>03507         <span class="keyword">enum</span> ieee80211_band band;
<a name="l03508"></a>03508 
<a name="l03509"></a>03509         u8 use;
<a name="l03510"></a>03510         u16 cur_hpf;
<a name="l03511"></a>03511         u16 lna[3] = { 3, 3, 1 };
<a name="l03512"></a>03512         u16 hpf1[3] = { 7, 2, 0 };
<a name="l03513"></a>03513         u16 hpf2[3] = { 2, 0, 0 };
<a name="l03514"></a>03514         u32 power[3] = { };
<a name="l03515"></a>03515         u16 gain_save[2];
<a name="l03516"></a>03516         u16 cal_gain[2];
<a name="l03517"></a>03517         <span class="keyword">struct </span><a class="code" href="structnphy__iqcal__params.html">nphy_iqcal_params</a> cal_params[2];
<a name="l03518"></a>03518         <span class="keyword">struct </span><a class="code" href="structnphy__iq__est.html">nphy_iq_est</a> est;
<a name="l03519"></a>03519         <span class="keywordtype">int</span> ret = 0;
<a name="l03520"></a>03520         <span class="keywordtype">bool</span> playtone = <span class="keyword">true</span>;
<a name="l03521"></a>03521         <span class="keywordtype">int</span> desired = 13;
<a name="l03522"></a>03522 
<a name="l03523"></a>03523         <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 1);
<a name="l03524"></a>03524 
<a name="l03525"></a>03525         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l03526"></a>03526                 <a class="code" href="phy__n_8c.html#a2752d765042313e7ba2d0a3f2bea6305">b43_nphy_reapply_tx_cal_coeffs</a>(dev);
<a name="l03527"></a>03527         <a class="code" href="tables__nphy_8c.html#a3b8ab9b2d95165e2492e89a0bd23f431">b43_ntab_read_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x110), 2, gain_save);
<a name="l03528"></a>03528         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l03529"></a>03529                 <a class="code" href="phy__n_8c.html#a08d214f0a773f77aaa89aaaeeb66edf5">b43_nphy_iq_cal_gain_params</a>(dev, i, target, &amp;cal_params[i]);
<a name="l03530"></a>03530                 cal_gain[i] = cal_params[i].<a class="code" href="structnphy__iqcal__params.html#af0afe4e0e28981ee81cb4db24ca455a9">cal_gain</a>;
<a name="l03531"></a>03531         }
<a name="l03532"></a>03532         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x110), 2, cal_gain);
<a name="l03533"></a>03533 
<a name="l03534"></a>03534         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l03535"></a>03535                 <span class="keywordflow">if</span> (i == 0) {
<a name="l03536"></a>03536                         rfctl[0] = <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>;
<a name="l03537"></a>03537                         rfctl[1] = <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>;
<a name="l03538"></a>03538                         afectl_core = <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>;
<a name="l03539"></a>03539                 } <span class="keywordflow">else</span> {
<a name="l03540"></a>03540                         rfctl[0] = <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>;
<a name="l03541"></a>03541                         rfctl[1] = <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>;
<a name="l03542"></a>03542                         afectl_core = <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>;
<a name="l03543"></a>03543                 }
<a name="l03544"></a>03544 
<a name="l03545"></a>03545                 tmp[1] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>);
<a name="l03546"></a>03546                 tmp[2] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, afectl_core);
<a name="l03547"></a>03547                 tmp[3] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>);
<a name="l03548"></a>03548                 tmp[4] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, rfctl[0]);
<a name="l03549"></a>03549                 tmp[5] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, rfctl[1]);
<a name="l03550"></a>03550 
<a name="l03551"></a>03551                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>,
<a name="l03552"></a>03552                                 ~<a class="code" href="phy__n_8h.html#a5d48856b000b2f93acec50736965c937">B43_NPHY_RFSEQCA_RXDIS</a> &amp; 0xFFFF,
<a name="l03553"></a>03553                                 ((1 - i) &lt;&lt; <a class="code" href="phy__n_8h.html#a82faf940c7ffe440fb079422ebc7e2f6">B43_NPHY_RFSEQCA_RXDIS_SHIFT</a>));
<a name="l03554"></a>03554                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>, ~<a class="code" href="phy__n_8h.html#af2e86a42ab8dea4b81ee8d83319ab078">B43_NPHY_RFSEQCA_TXEN</a>,
<a name="l03555"></a>03555                                 (1 - i));
<a name="l03556"></a>03556                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, afectl_core, 0x0006);
<a name="l03557"></a>03557                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0x0006);
<a name="l03558"></a>03558 
<a name="l03559"></a>03559                 band = <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>);
<a name="l03560"></a>03560 
<a name="l03561"></a>03561                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a0edf215002bd4dacbe778ac6c833bae7">rxcalparams</a> &amp; 0xFF000000) {
<a name="l03562"></a>03562                         <span class="keywordflow">if</span> (band == IEEE80211_BAND_5GHZ)
<a name="l03563"></a>03563                                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[0], 0x140);
<a name="l03564"></a>03564                         <span class="keywordflow">else</span>
<a name="l03565"></a>03565                                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[0], 0x110);
<a name="l03566"></a>03566                 } <span class="keywordflow">else</span> {
<a name="l03567"></a>03567                         <span class="keywordflow">if</span> (band == IEEE80211_BAND_5GHZ)
<a name="l03568"></a>03568                                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[0], 0x180);
<a name="l03569"></a>03569                         <span class="keywordflow">else</span>
<a name="l03570"></a>03570                                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[0], 0x120);
<a name="l03571"></a>03571                 }
<a name="l03572"></a>03572 
<a name="l03573"></a>03573                 <span class="keywordflow">if</span> (band == IEEE80211_BAND_5GHZ)
<a name="l03574"></a>03574                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[1], 0x148);
<a name="l03575"></a>03575                 <span class="keywordflow">else</span>
<a name="l03576"></a>03576                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[1], 0x114);
<a name="l03577"></a>03577 
<a name="l03578"></a>03578                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a0edf215002bd4dacbe778ac6c833bae7">rxcalparams</a> &amp; 0x10000) {
<a name="l03579"></a>03579                         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a3294b132c094eee7a4630869ec0fe6ef">B2055_C1_GENSPARE2</a>, 0xFC,
<a name="l03580"></a>03580                                         (i + 1));
<a name="l03581"></a>03581                         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#a4e0a6868f839ffa00837cdc612826bdc">B2055_C2_GENSPARE2</a>, 0xFC,
<a name="l03582"></a>03582                                         (2 - i));
<a name="l03583"></a>03583                 }
<a name="l03584"></a>03584 
<a name="l03585"></a>03585                 <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++) {
<a name="l03586"></a>03586                         <span class="keywordflow">if</span> (j &lt; 3) {
<a name="l03587"></a>03587                                 cur_lna = lna[j];
<a name="l03588"></a>03588                                 cur_hpf1 = hpf1[j];
<a name="l03589"></a>03589                                 cur_hpf2 = hpf2[j];
<a name="l03590"></a>03590                         } <span class="keywordflow">else</span> {
<a name="l03591"></a>03591                                 <span class="keywordflow">if</span> (power[1] &gt; 10000) {
<a name="l03592"></a>03592                                         use = 1;
<a name="l03593"></a>03593                                         cur_hpf = cur_hpf1;
<a name="l03594"></a>03594                                         index = 2;
<a name="l03595"></a>03595                                 } <span class="keywordflow">else</span> {
<a name="l03596"></a>03596                                         <span class="keywordflow">if</span> (power[0] &gt; 10000) {
<a name="l03597"></a>03597                                                 use = 1;
<a name="l03598"></a>03598                                                 cur_hpf = cur_hpf1;
<a name="l03599"></a>03599                                                 index = 1;
<a name="l03600"></a>03600                                         } <span class="keywordflow">else</span> {
<a name="l03601"></a>03601                                                 index = 0;
<a name="l03602"></a>03602                                                 use = 2;
<a name="l03603"></a>03603                                                 cur_hpf = cur_hpf2;
<a name="l03604"></a>03604                                         }
<a name="l03605"></a>03605                                 }
<a name="l03606"></a>03606                                 cur_lna = lna[index];
<a name="l03607"></a>03607                                 cur_hpf1 = hpf1[index];
<a name="l03608"></a>03608                                 cur_hpf2 = hpf2[index];
<a name="l03609"></a>03609                                 cur_hpf += desired - hweight32(power[index]);
<a name="l03610"></a>03610                                 cur_hpf = clamp_val(cur_hpf, 0, 10);
<a name="l03611"></a>03611                                 <span class="keywordflow">if</span> (use == 1)
<a name="l03612"></a>03612                                         cur_hpf1 = cur_hpf;
<a name="l03613"></a>03613                                 <span class="keywordflow">else</span>
<a name="l03614"></a>03614                                         cur_hpf2 = cur_hpf;
<a name="l03615"></a>03615                         }
<a name="l03616"></a>03616 
<a name="l03617"></a>03617                         tmp[0] = ((cur_hpf2 &lt;&lt; 8) | (cur_hpf1 &lt;&lt; 4) |
<a name="l03618"></a>03618                                         (cur_lna &lt;&lt; 2));
<a name="l03619"></a>03619                         <a class="code" href="phy__n_8c.html#a7a9358c4ccb7f2049eae9611b1b2e9c6">b43_nphy_rf_control_override</a>(dev, 0x400, tmp[0], 3,
<a name="l03620"></a>03620                                                                         <span class="keyword">false</span>);
<a name="l03621"></a>03621                         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>);
<a name="l03622"></a>03622                         <a class="code" href="phy__n_8c.html#a8c9f021527e4fc603810a194124b299a">b43_nphy_stop_playback</a>(dev);
<a name="l03623"></a>03623 
<a name="l03624"></a>03624                         <span class="keywordflow">if</span> (playtone) {
<a name="l03625"></a>03625                                 ret = <a class="code" href="phy__n_8c.html#a1cc412bbff4d1073f5fafc67ecb8d6dd">b43_nphy_tx_tone</a>(dev, 4000,
<a name="l03626"></a>03626                                                 (nphy-&gt;<a class="code" href="structb43__phy__n.html#a0edf215002bd4dacbe778ac6c833bae7">rxcalparams</a> &amp; 0xFFFF),
<a name="l03627"></a>03627                                                 <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l03628"></a>03628                                 playtone = <span class="keyword">false</span>;
<a name="l03629"></a>03629                         } <span class="keywordflow">else</span> {
<a name="l03630"></a>03630                                 <a class="code" href="phy__n_8c.html#a3fa62797735d6ea3ea0cc45691c205ce">b43_nphy_run_samples</a>(dev, 160, 0xFFFF, 0,
<a name="l03631"></a>03631                                                         <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l03632"></a>03632                         }
<a name="l03633"></a>03633 
<a name="l03634"></a>03634                         <span class="keywordflow">if</span> (ret == 0) {
<a name="l03635"></a>03635                                 <span class="keywordflow">if</span> (j &lt; 3) {
<a name="l03636"></a>03636                                         <a class="code" href="phy__n_8c.html#a8a3c6ba5b32aaf4b1f6a73c41421a017">b43_nphy_rx_iq_est</a>(dev, &amp;est, 1024, 32,
<a name="l03637"></a>03637                                                                         <span class="keyword">false</span>);
<a name="l03638"></a>03638                                         <span class="keywordflow">if</span> (i == 0) {
<a name="l03639"></a>03639                                                 real = est.<a class="code" href="structnphy__iq__est.html#a6eb4c5fcb2613ee70661f9fd20db497d">i0_pwr</a>;
<a name="l03640"></a>03640                                                 imag = est.<a class="code" href="structnphy__iq__est.html#a045646d939baa289ea463fd314d7eef6">q0_pwr</a>;
<a name="l03641"></a>03641                                         } <span class="keywordflow">else</span> {
<a name="l03642"></a>03642                                                 real = est.<a class="code" href="structnphy__iq__est.html#a120f95083e6c1eb69e3b93871ccd9c13">i1_pwr</a>;
<a name="l03643"></a>03643                                                 imag = est.<a class="code" href="structnphy__iq__est.html#a1a0aac340444d6754201a3ea11352d80">q1_pwr</a>;
<a name="l03644"></a>03644                                         }
<a name="l03645"></a>03645                                         power[i] = ((real + imag) / 1024) + 1;
<a name="l03646"></a>03646                                 } <span class="keywordflow">else</span> {
<a name="l03647"></a>03647                                         <a class="code" href="phy__n_8c.html#a69e2e3d7fe343579496da3da88b786a5">b43_nphy_calc_rx_iq_comp</a>(dev, 1 &lt;&lt; i);
<a name="l03648"></a>03648                                 }
<a name="l03649"></a>03649                                 <a class="code" href="phy__n_8c.html#a8c9f021527e4fc603810a194124b299a">b43_nphy_stop_playback</a>(dev);
<a name="l03650"></a>03650                         }
<a name="l03651"></a>03651 
<a name="l03652"></a>03652                         <span class="keywordflow">if</span> (ret != 0)
<a name="l03653"></a>03653                                 <span class="keywordflow">break</span>;
<a name="l03654"></a>03654                 }
<a name="l03655"></a>03655 
<a name="l03656"></a>03656                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a3294b132c094eee7a4630869ec0fe6ef">B2055_C1_GENSPARE2</a>, 0xFC);
<a name="l03657"></a>03657                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="radio__2055_8h.html#a4e0a6868f839ffa00837cdc612826bdc">B2055_C2_GENSPARE2</a>, 0xFC);
<a name="l03658"></a>03658                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[1], tmp[5]);
<a name="l03659"></a>03659                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, rfctl[0], tmp[4]);
<a name="l03660"></a>03660                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, tmp[3]);
<a name="l03661"></a>03661                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, afectl_core, tmp[2]);
<a name="l03662"></a>03662                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>, tmp[1]);
<a name="l03663"></a>03663 
<a name="l03664"></a>03664                 <span class="keywordflow">if</span> (ret != 0)
<a name="l03665"></a>03665                         <span class="keywordflow">break</span>;
<a name="l03666"></a>03666         }
<a name="l03667"></a>03667 
<a name="l03668"></a>03668         <a class="code" href="phy__n_8c.html#a7a9358c4ccb7f2049eae9611b1b2e9c6">b43_nphy_rf_control_override</a>(dev, 0x400, 0, 3, <span class="keyword">true</span>);
<a name="l03669"></a>03669         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>);
<a name="l03670"></a>03670         <a class="code" href="tables__nphy_8c.html#a3e226f2de9b9f1bd73a5af6357e412b1">b43_ntab_write_bulk</a>(dev, <a class="code" href="tables__nphy_8h.html#a46469f39d8e754c1bc03359abe38b698">B43_NTAB16</a>(7, 0x110), 2, gain_save);
<a name="l03671"></a>03671 
<a name="l03672"></a>03672         <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, 0);
<a name="l03673"></a>03673 
<a name="l03674"></a>03674         <span class="keywordflow">return</span> ret;
<a name="l03675"></a>03675 }
<a name="l03676"></a>03676 
<a name="l03677"></a><a class="code" href="phy__n_8c.html#a39c5a4172b228202acb6847c18aa4560">03677</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a39c5a4172b228202acb6847c18aa4560">b43_nphy_rev3_cal_rx_iq</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l03678"></a>03678                         <span class="keyword">struct</span> <a class="code" href="structnphy__txgains.html">nphy_txgains</a> target, u8 type, <span class="keywordtype">bool</span> debug)
<a name="l03679"></a>03679 {
<a name="l03680"></a>03680         <span class="keywordflow">return</span> -1;
<a name="l03681"></a>03681 }
<a name="l03682"></a>03682 
<a name="l03683"></a>03683 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/CalRxIq */</span>
<a name="l03684"></a><a class="code" href="phy__n_8c.html#a50c1ebf9f10c38162fad689b6373ae83">03684</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a50c1ebf9f10c38162fad689b6373ae83">b43_nphy_cal_rx_iq</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l03685"></a>03685                         <span class="keyword">struct</span> <a class="code" href="structnphy__txgains.html">nphy_txgains</a> target, u8 type, <span class="keywordtype">bool</span> debug)
<a name="l03686"></a>03686 {
<a name="l03687"></a>03687         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03688"></a>03688                 <span class="keywordflow">return</span> <a class="code" href="phy__n_8c.html#a39c5a4172b228202acb6847c18aa4560">b43_nphy_rev3_cal_rx_iq</a>(dev, target, type, debug);
<a name="l03689"></a>03689         <span class="keywordflow">else</span>
<a name="l03690"></a>03690                 <span class="keywordflow">return</span> <a class="code" href="phy__n_8c.html#a1eaecef2d6242be41fa2110258d06e9e">b43_nphy_rev2_cal_rx_iq</a>(dev, target, type, debug);
<a name="l03691"></a>03691 }
<a name="l03692"></a>03692 
<a name="l03693"></a>03693 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/RxCoreSetState */</span>
<a name="l03694"></a><a class="code" href="phy__n_8c.html#ac42fa11d3629a096464b02a845c8e2f8">03694</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ac42fa11d3629a096464b02a845c8e2f8">b43_nphy_set_rx_core_state</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 mask)
<a name="l03695"></a>03695 {
<a name="l03696"></a>03696         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l03697"></a>03697         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03698"></a>03698         <span class="comment">/* u16 buf[16]; it&#39;s rev3+ */</span>
<a name="l03699"></a>03699 
<a name="l03700"></a>03700         nphy-&gt;<a class="code" href="structb43__phy__n.html#a1c39895a1fdc8e53e42a01f6492ca397">phyrxchain</a> = mask;
<a name="l03701"></a>03701 
<a name="l03702"></a>03702         <span class="keywordflow">if</span> (0 <span class="comment">/* FIXME clk */</span>)
<a name="l03703"></a>03703                 <span class="keywordflow">return</span>;
<a name="l03704"></a>03704 
<a name="l03705"></a>03705         <a class="code" href="main_8c.html#a555504fbafc3537b275e563515f7f6d4">b43_mac_suspend</a>(dev);
<a name="l03706"></a>03706 
<a name="l03707"></a>03707         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l03708"></a>03708                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">true</span>);
<a name="l03709"></a>03709 
<a name="l03710"></a>03710         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#ac25a35107355505e9df862e35e987f50">B43_NPHY_RFSEQCA</a>, ~<a class="code" href="phy__n_8h.html#a593a96031674c3ef6a1a319482401c91">B43_NPHY_RFSEQCA_RXEN</a>,
<a name="l03711"></a>03711                         (mask &amp; 0x3) &lt;&lt; <a class="code" href="phy__n_8h.html#ac6b74ba549b9cdb9a01638dddece2d6d">B43_NPHY_RFSEQCA_RXEN_SHIFT</a>);
<a name="l03712"></a>03712 
<a name="l03713"></a>03713         <span class="keywordflow">if</span> ((mask &amp; 0x3) != 0x3) {
<a name="l03714"></a>03714                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2dc822dc5dadd696827d578e309ccec3">B43_NPHY_HPANT_SWTHRES</a>, 1);
<a name="l03715"></a>03715                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03716"></a>03716                         <span class="comment">/* TODO */</span>
<a name="l03717"></a>03717                 }
<a name="l03718"></a>03718         } <span class="keywordflow">else</span> {
<a name="l03719"></a>03719                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a2dc822dc5dadd696827d578e309ccec3">B43_NPHY_HPANT_SWTHRES</a>, 0x1E);
<a name="l03720"></a>03720                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03721"></a>03721                         <span class="comment">/* TODO */</span>
<a name="l03722"></a>03722                 }
<a name="l03723"></a>03723         }
<a name="l03724"></a>03724 
<a name="l03725"></a>03725         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>);
<a name="l03726"></a>03726 
<a name="l03727"></a>03727         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a>)
<a name="l03728"></a>03728                 <a class="code" href="phy__n_8c.html#ab6fd470f24e0116b4006c2c03e9608a5">b43_nphy_stay_in_carrier_search</a>(dev, <span class="keyword">false</span>);
<a name="l03729"></a>03729 
<a name="l03730"></a>03730         <a class="code" href="main_8c.html#a9078cc08815f04ffb2ca7d5e7eaf071c">b43_mac_enable</a>(dev);
<a name="l03731"></a>03731 }
<a name="l03732"></a>03732 
<a name="l03733"></a>03733 <span class="comment">/*</span>
<a name="l03734"></a>03734 <span class="comment"> * Init N-PHY</span>
<a name="l03735"></a>03735 <span class="comment"> * http://bcm-v4.sipsolutions.net/802.11/PHY/Init/N</span>
<a name="l03736"></a>03736 <span class="comment"> */</span>
<a name="l03737"></a><a class="code" href="phy__n_8c.html#acd2b4f77da0652a9d605446e65cce61d">03737</a> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#acd2b4f77da0652a9d605446e65cce61d">b43_phy_initn</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l03738"></a>03738 {
<a name="l03739"></a>03739         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l03740"></a>03740         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l03741"></a>03741         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03742"></a>03742         u8 tx_pwr_state;
<a name="l03743"></a>03743         <span class="keyword">struct </span><a class="code" href="structnphy__txgains.html">nphy_txgains</a> target;
<a name="l03744"></a>03744         u16 tmp;
<a name="l03745"></a>03745         <span class="keyword">enum</span> ieee80211_band tmp2;
<a name="l03746"></a>03746         <span class="keywordtype">bool</span> do_rssi_cal;
<a name="l03747"></a>03747 
<a name="l03748"></a>03748         u16 clip[2];
<a name="l03749"></a>03749         <span class="keywordtype">bool</span> do_cal = <span class="keyword">false</span>;
<a name="l03750"></a>03750 
<a name="l03751"></a>03751         <span class="keywordflow">if</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) &amp;&amp;
<a name="l03752"></a>03752            (sprom-&gt;boardflags_lo &amp; <a class="code" href="b43_8h.html#a0d9d8affb2af07eb01d6097c34c56eee">B43_BFL_EXTLNA</a>) &amp;&amp;
<a name="l03753"></a>03753            (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)) {
<a name="l03754"></a>03754                 <span class="keywordflow">switch</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a880bb9d651e18b4cc58ff060ae06b131">bus_type</a>) {
<a name="l03755"></a>03755 <span class="preprocessor">#ifdef CONFIG_B43_BCMA</span>
<a name="l03756"></a>03756 <span class="preprocessor"></span>                <span class="keywordflow">case</span> B43_BUS_BCMA:
<a name="l03757"></a>03757                         bcma_cc_set32(&amp;dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#af89341f941e94abb2f8ac6e98dd5c101">bdev</a>-&gt;bus-&gt;drv_cc,
<a name="l03758"></a>03758                                       BCMA_CC_CHIPCTL, 0x40);
<a name="l03759"></a>03759                         <span class="keywordflow">break</span>;
<a name="l03760"></a>03760 <span class="preprocessor">#endif</span>
<a name="l03761"></a>03761 <span class="preprocessor"></span><span class="preprocessor">#ifdef CONFIG_B43_SSB</span>
<a name="l03762"></a>03762 <span class="preprocessor"></span>                <span class="keywordflow">case</span> <a class="code" href="bus_8h.html#a7d9e1f255fdc367cca560f2be24647f5a6e49471bf473723b618718b72a3dbc91">B43_BUS_SSB</a>:
<a name="l03763"></a>03763                         chipco_set32(&amp;dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a68f9a4660126ada1510b28be93e1dd0d">sdev</a>-&gt;bus-&gt;chipco,
<a name="l03764"></a>03764                                      SSB_CHIPCO_CHIPCTL, 0x40);
<a name="l03765"></a>03765                         <span class="keywordflow">break</span>;
<a name="l03766"></a>03766 <span class="preprocessor">#endif</span>
<a name="l03767"></a>03767 <span class="preprocessor"></span>                }
<a name="l03768"></a>03768         }
<a name="l03769"></a>03769         nphy-&gt;<a class="code" href="structb43__phy__n.html#a791576b0eeeae9e2d40b13eaa890a759">deaf_count</a> = 0;
<a name="l03770"></a>03770         <a class="code" href="phy__n_8c.html#a258051a298be730a8f5fe82dc3ef5cbf">b43_nphy_tables_init</a>(dev);
<a name="l03771"></a>03771         nphy-&gt;<a class="code" href="structb43__phy__n.html#a386b4cca14483d7c0885584368f88c0c">crsminpwr_adjusted</a> = <span class="keyword">false</span>;
<a name="l03772"></a>03772         nphy-&gt;<a class="code" href="structb43__phy__n.html#a2fa07cbc94668e180f5bf6cabeedd443">noisevars_adjusted</a> = <span class="keyword">false</span>;
<a name="l03773"></a>03773 
<a name="l03774"></a>03774         <span class="comment">/* Clear all overrides */</span>
<a name="l03775"></a>03775         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03776"></a>03776                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6fd43e203878adf4a3e647ef6a755587">B43_NPHY_TXF_40CO_B1S1</a>, 0);
<a name="l03777"></a>03777                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, 0);
<a name="l03778"></a>03778                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a3b2fc942b23f2b812c053291d3abcf47">B43_NPHY_TXF_40CO_B1S0</a>, 0);
<a name="l03779"></a>03779                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ac57132a07e9f60937a0b38e6b8dc600a">B43_NPHY_TXF_40CO_B32S1</a>, 0);
<a name="l03780"></a>03780         } <span class="keywordflow">else</span> {
<a name="l03781"></a>03781                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ae8a2dcd344b390e0316913ff18e0e7ce">B43_NPHY_RFCTL_OVER</a>, 0);
<a name="l03782"></a>03782         }
<a name="l03783"></a>03783         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7201b938bfaeef7334e4578410cd19b1">B43_NPHY_RFCTL_INTC1</a>, 0);
<a name="l03784"></a>03784         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad10f20304bb18cf943ebdbdc35dd489f">B43_NPHY_RFCTL_INTC2</a>, 0);
<a name="l03785"></a>03785         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 6) {
<a name="l03786"></a>03786                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a41cd7f5f9d5545fcf486eb083f3f2f79">B43_NPHY_RFCTL_INTC3</a>, 0);
<a name="l03787"></a>03787                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9c231cd210c5fcd8ab71612e463a08a2">B43_NPHY_RFCTL_INTC4</a>, 0);
<a name="l03788"></a>03788         }
<a name="l03789"></a>03789         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a960fb268856a68bf51fe28256ff28624">B43_NPHY_RFSEQMODE</a>,
<a name="l03790"></a>03790                      ~(<a class="code" href="phy__n_8h.html#a144db07efc5c82bbeb82a81da8bec682">B43_NPHY_RFSEQMODE_CAOVER</a> |
<a name="l03791"></a>03791                        <a class="code" href="phy__n_8h.html#ac69768a474e6af51fb163bd98e8aab80">B43_NPHY_RFSEQMODE_TROVER</a>));
<a name="l03792"></a>03792         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03793"></a>03793                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, 0);
<a name="l03794"></a>03794         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, 0);
<a name="l03795"></a>03795 
<a name="l03796"></a>03796         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt;= 2) {
<a name="l03797"></a>03797                 tmp = (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 2) ? 0x3B : 0x40;
<a name="l03798"></a>03798                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a11c29f149a34225fa07821dc05499ba4">B43_NPHY_BPHY_CTL3</a>,
<a name="l03799"></a>03799                                 ~<a class="code" href="phy__n_8h.html#a436836b0c6c70530242c85f1fcd4540d">B43_NPHY_BPHY_CTL3_SCALE</a>,
<a name="l03800"></a>03800                                 tmp &lt;&lt; <a class="code" href="phy__n_8h.html#a8fbc13c09309b792f6dcf1e9bb12cc19">B43_NPHY_BPHY_CTL3_SCALE_SHIFT</a>);
<a name="l03801"></a>03801         }
<a name="l03802"></a>03802         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7c3f7c8ec11154f4591a1110e31c25c5">B43_NPHY_AFESEQ_TX2RX_PUD_20M</a>, 0x20);
<a name="l03803"></a>03803         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a7a162b3048c1894acbc424022f9783c2">B43_NPHY_AFESEQ_TX2RX_PUD_40M</a>, 0x20);
<a name="l03804"></a>03804 
<a name="l03805"></a>03805         <span class="keywordflow">if</span> (sprom-&gt;boardflags2_lo &amp; <a class="code" href="b43_8h.html#a64a703575ed8c290a99aa2d8cbe4e50b">B43_BFL2_SKWRKFEM_BRD</a> ||
<a name="l03806"></a>03806             (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a7b61688d8f77fe253308150f344eb259">board_vendor</a> == PCI_VENDOR_ID_APPLE &amp;&amp;
<a name="l03807"></a>03807              dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a8225eee827fd5a0c40849625fbf88330">board_type</a> == 0x8B))
<a name="l03808"></a>03808                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a1027a0a2fc2b43f626b19a64526fdcbf">B43_NPHY_TXREALFD</a>, 0xA0);
<a name="l03809"></a>03809         <span class="keywordflow">else</span>
<a name="l03810"></a>03810                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a1027a0a2fc2b43f626b19a64526fdcbf">B43_NPHY_TXREALFD</a>, 0xB8);
<a name="l03811"></a>03811         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#aec3f258fa64b26a1a0d8a8b7cd90d446">B43_NPHY_MIMO_CRSTXEXT</a>, 0xC8);
<a name="l03812"></a>03812         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a31bb234063c45590cb5b18a744e824e4">B43_NPHY_PLOAD_CSENSE_EXTLEN</a>, 0x50);
<a name="l03813"></a>03813         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a258fedb116a8db1d8f280b49a9a12c41">B43_NPHY_TXRIFS_FRDEL</a>, 0x30);
<a name="l03814"></a>03814 
<a name="l03815"></a>03815         <a class="code" href="phy__n_8c.html#a00be45e897bdb9dcaa6bcb8fdda68ddd">b43_nphy_update_mimo_config</a>(dev, nphy-&gt;<a class="code" href="structb43__phy__n.html#ac51d9293f92d98966b6b1713327a3244">preamble_override</a>);
<a name="l03816"></a>03816         <a class="code" href="phy__n_8c.html#a6777340f0e858303be7efbd3980d7507">b43_nphy_update_txrx_chain</a>(dev);
<a name="l03817"></a>03817 
<a name="l03818"></a>03818         <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l03819"></a>03819                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a91f425c5a8c6cda7fd521c098e27170d">B43_NPHY_DUP40_GFBL</a>, 0xAA8);
<a name="l03820"></a>03820                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#af9d95c9ccdf9a2f0bfb349976120adf8">B43_NPHY_DUP40_BL</a>, 0x9A4);
<a name="l03821"></a>03821         }
<a name="l03822"></a>03822 
<a name="l03823"></a>03823         tmp2 = <a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>);
<a name="l03824"></a>03824         <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a154a00aa1e8e651d2c67b8ab3dbb5c0a">b43_nphy_ipa</a>(dev)) {
<a name="l03825"></a>03825                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a17d8f6b73f9997e2e79021c80e83aaf0">B43_NPHY_PAPD_EN0</a>, 0x1);
<a name="l03826"></a>03826                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#acbd33b7e3e30c5f0a68927cc8a4ac40d">B43_NPHY_EPS_TABLE_ADJ0</a>, 0x007F,
<a name="l03827"></a>03827                                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a4169f5150172403affcd4cb33f1fe1d7">papd_epsilon_offset</a>[0] &lt;&lt; 7);
<a name="l03828"></a>03828                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#acd2ef1d90ea3ffb6316315e6774795d6">B43_NPHY_PAPD_EN1</a>, 0x1);
<a name="l03829"></a>03829                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__n_8h.html#a68780eaf9fd734a44db920665cf36d2e">B43_NPHY_EPS_TABLE_ADJ1</a>, 0x007F,
<a name="l03830"></a>03830                                 nphy-&gt;<a class="code" href="structb43__phy__n.html#a4169f5150172403affcd4cb33f1fe1d7">papd_epsilon_offset</a>[1] &lt;&lt; 7);
<a name="l03831"></a>03831                 <a class="code" href="phy__n_8c.html#a10594fc970e9f17806ae634df9040faa">b43_nphy_int_pa_set_tx_dig_filters</a>(dev);
<a name="l03832"></a>03832         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 5) {
<a name="l03833"></a>03833                 <a class="code" href="phy__n_8c.html#a4fc9d39737c09f40ae3feeaa429a075a">b43_nphy_ext_pa_set_tx_dig_filters</a>(dev);
<a name="l03834"></a>03834         }
<a name="l03835"></a>03835 
<a name="l03836"></a>03836         <a class="code" href="phy__n_8c.html#ac92598032afa700b66c977e9d4d897b5">b43_nphy_workarounds</a>(dev);
<a name="l03837"></a>03837 
<a name="l03838"></a>03838         <span class="comment">/* Reset CCA, in init code it differs a little from standard way */</span>
<a name="l03839"></a>03839         <a class="code" href="phy__common_8c.html#ac6b943b8d455a3d3f136fd79636755b0">b43_phy_force_clock</a>(dev, 1);
<a name="l03840"></a>03840         tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>);
<a name="l03841"></a>03841         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>, tmp | <a class="code" href="phy__n_8h.html#ab1be3e8636909fac2e769d37a806edcb">B43_NPHY_BBCFG_RSTCCA</a>);
<a name="l03842"></a>03842         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad07ae0ad58d8f043268b74b3763bec11">B43_NPHY_BBCFG</a>, tmp &amp; ~<a class="code" href="phy__n_8h.html#ab1be3e8636909fac2e769d37a806edcb">B43_NPHY_BBCFG_RSTCCA</a>);
<a name="l03843"></a>03843         <a class="code" href="phy__common_8c.html#ac6b943b8d455a3d3f136fd79636755b0">b43_phy_force_clock</a>(dev, 0);
<a name="l03844"></a>03844 
<a name="l03845"></a>03845         <a class="code" href="main_8c.html#af4799d32b5a9a83ba1ce2c0a887dca5c">b43_mac_phy_clock_set</a>(dev, <span class="keyword">true</span>);
<a name="l03846"></a>03846 
<a name="l03847"></a>03847         <a class="code" href="phy__n_8c.html#ac0cc3805151589ed885c1942b35faf8d">b43_nphy_pa_override</a>(dev, <span class="keyword">false</span>);
<a name="l03848"></a>03848         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884a687bba92ab195b6597b210d2dab0faca">B43_RFSEQ_RX2TX</a>);
<a name="l03849"></a>03849         <a class="code" href="phy__n_8c.html#afb3e5e29a2aa9f47bf4363fd58946c69">b43_nphy_force_rf_sequence</a>(dev, <a class="code" href="phy__n_8c.html#acc71d9dd4620aa0131e1603fc8d63884ada34850be277d871d1e9b379359fe6a7">B43_RFSEQ_RESET2RX</a>);
<a name="l03850"></a>03850         <a class="code" href="phy__n_8c.html#ac0cc3805151589ed885c1942b35faf8d">b43_nphy_pa_override</a>(dev, <span class="keyword">true</span>);
<a name="l03851"></a>03851 
<a name="l03852"></a>03852         <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 0, 0);
<a name="l03853"></a>03853         <a class="code" href="phy__n_8c.html#a0983793c31f96dd76b680507289a0a2c">b43_nphy_read_clip_detection</a>(dev, clip);
<a name="l03854"></a>03854         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l03855"></a>03855                 <a class="code" href="phy__n_8c.html#add8cb2b248ac9565dd44b37a57c64afe">b43_nphy_bphy_init</a>(dev);
<a name="l03856"></a>03856 
<a name="l03857"></a>03857         tx_pwr_state = nphy-&gt;<a class="code" href="structb43__phy__n.html#ade415910e4417d729e6e95daf8c08f6f">txpwrctrl</a>;
<a name="l03858"></a>03858         <a class="code" href="phy__n_8c.html#ac1c706b04878fc7941ee790a91377c13">b43_nphy_tx_power_ctrl</a>(dev, <span class="keyword">false</span>);
<a name="l03859"></a>03859         <a class="code" href="phy__n_8c.html#a066ab280f4c7812265b2874e4051676c">b43_nphy_tx_power_fix</a>(dev);
<a name="l03860"></a>03860         <span class="comment">/* TODO N PHY TX Power Control Idle TSSI */</span>
<a name="l03861"></a>03861         <span class="comment">/* TODO N PHY TX Power Control Setup */</span>
<a name="l03862"></a>03862         <a class="code" href="phy__n_8c.html#a64d6a4b61bb63123bc20c1b8946e686c">b43_nphy_tx_gain_table_upload</a>(dev);
<a name="l03863"></a>03863 
<a name="l03864"></a>03864         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a1c39895a1fdc8e53e42a01f6492ca397">phyrxchain</a> != 3)
<a name="l03865"></a>03865                 <a class="code" href="phy__n_8c.html#ac42fa11d3629a096464b02a845c8e2f8">b43_nphy_set_rx_core_state</a>(dev, nphy-&gt;<a class="code" href="structb43__phy__n.html#a1c39895a1fdc8e53e42a01f6492ca397">phyrxchain</a>);
<a name="l03866"></a>03866         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a18b2e61ce434d595b80dd648931b42f7">mphase_cal_phase_id</a> &gt; 0)
<a name="l03867"></a>03867                 ;<span class="comment">/* TODO PHY Periodic Calibration Multi-Phase Restart */</span>
<a name="l03868"></a>03868 
<a name="l03869"></a>03869         do_rssi_cal = <span class="keyword">false</span>;
<a name="l03870"></a>03870         <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03871"></a>03871                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l03872"></a>03872                         do_rssi_cal = !nphy-&gt;<a class="code" href="structb43__phy__n.html#a91e3a284dc3a04e75a6822e97e11155a">rssical_chanspec_2G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>;
<a name="l03873"></a>03873                 <span class="keywordflow">else</span>
<a name="l03874"></a>03874                         do_rssi_cal = !nphy-&gt;<a class="code" href="structb43__phy__n.html#a0ca1eb5820f10e0db317b76f22ffc71c">rssical_chanspec_5G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>;
<a name="l03875"></a>03875 
<a name="l03876"></a>03876                 <span class="keywordflow">if</span> (do_rssi_cal)
<a name="l03877"></a>03877                         <a class="code" href="phy__n_8c.html#a9bdd435b8fff6a47e9191795d8a752ee">b43_nphy_rssi_cal</a>(dev);
<a name="l03878"></a>03878                 <span class="keywordflow">else</span>
<a name="l03879"></a>03879                         <a class="code" href="phy__n_8c.html#a71e6561ff9751df6bb4816479832f165">b43_nphy_restore_rssi_cal</a>(dev);
<a name="l03880"></a>03880         } <span class="keywordflow">else</span> {
<a name="l03881"></a>03881                 <a class="code" href="phy__n_8c.html#a9bdd435b8fff6a47e9191795d8a752ee">b43_nphy_rssi_cal</a>(dev);
<a name="l03882"></a>03882         }
<a name="l03883"></a>03883 
<a name="l03884"></a>03884         <span class="keywordflow">if</span> (!((nphy-&gt;<a class="code" href="structb43__phy__n.html#ac090f88dd198c29c2d35a36924ba2446">measure_hold</a> &amp; 0x6) != 0)) {
<a name="l03885"></a>03885                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l03886"></a>03886                         do_cal = !nphy-&gt;<a class="code" href="structb43__phy__n.html#ae55ff2aa0739885791ef955bf754986f">iqcal_chanspec_2G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>;
<a name="l03887"></a>03887                 <span class="keywordflow">else</span>
<a name="l03888"></a>03888                         do_cal = !nphy-&gt;<a class="code" href="structb43__phy__n.html#ad5784cb411a6ff3bcf860909d4596057">iqcal_chanspec_5G</a>.<a class="code" href="structb43__chanspec.html#ab5c43020a8deabc98f3f44b98a8e355d">center_freq</a>;
<a name="l03889"></a>03889 
<a name="l03890"></a>03890                 <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a8fd1989d5d62ab88b1841b131b71a5df">mute</a>)
<a name="l03891"></a>03891                         do_cal = <span class="keyword">false</span>;
<a name="l03892"></a>03892 
<a name="l03893"></a>03893                 <span class="keywordflow">if</span> (do_cal) {
<a name="l03894"></a>03894                         target = <a class="code" href="phy__n_8c.html#a5be8c8872b549c2f1e532cb45e4e8f99">b43_nphy_get_tx_gains</a>(dev);
<a name="l03895"></a>03895 
<a name="l03896"></a>03896                         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#aec3e799702126ce17fa255f0d50c3dab">antsel_type</a> == 2)
<a name="l03897"></a>03897                                 <a class="code" href="phy__n_8c.html#aea9da9c0c084e02347ea120e25bea994">b43_nphy_superswitch_init</a>(dev, <span class="keyword">true</span>);
<a name="l03898"></a>03898                         <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a8eabaf9b04de544689a30040a5f3a8f1">perical</a> != 2) {
<a name="l03899"></a>03899                                 <a class="code" href="phy__n_8c.html#a9bdd435b8fff6a47e9191795d8a752ee">b43_nphy_rssi_cal</a>(dev);
<a name="l03900"></a>03900                                 <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l03901"></a>03901                                         nphy-&gt;<a class="code" href="structb43__phy__n.html#ac121132b4029640629a81f5f5afd855b">cal_orig_pwr_idx</a>[0] =
<a name="l03902"></a>03902                                             nphy-&gt;<a class="code" href="structb43__phy__n.html#adc8352aa4aec570ba2d3091e88d3e427">txpwrindex</a>[0].<a class="code" href="structb43__phy__n__txpwrindex.html#a1c51079c68d82fbd1db0fb19250cc5ad">index_internal</a>;
<a name="l03903"></a>03903                                         nphy-&gt;<a class="code" href="structb43__phy__n.html#ac121132b4029640629a81f5f5afd855b">cal_orig_pwr_idx</a>[1] =
<a name="l03904"></a>03904                                             nphy-&gt;<a class="code" href="structb43__phy__n.html#adc8352aa4aec570ba2d3091e88d3e427">txpwrindex</a>[1].<a class="code" href="structb43__phy__n__txpwrindex.html#a1c51079c68d82fbd1db0fb19250cc5ad">index_internal</a>;
<a name="l03905"></a>03905                                         <span class="comment">/* TODO N PHY Pre Calibrate TX Gain */</span>
<a name="l03906"></a>03906                                         target = <a class="code" href="phy__n_8c.html#a5be8c8872b549c2f1e532cb45e4e8f99">b43_nphy_get_tx_gains</a>(dev);
<a name="l03907"></a>03907                                 }
<a name="l03908"></a>03908                                 <span class="keywordflow">if</span> (!<a class="code" href="phy__n_8c.html#a6da65f8c0878d53f63e804f34c65e796">b43_nphy_cal_tx_iq_lo</a>(dev, target, <span class="keyword">true</span>, <span class="keyword">false</span>))
<a name="l03909"></a>03909                                         <span class="keywordflow">if</span> (<a class="code" href="phy__n_8c.html#a50c1ebf9f10c38162fad689b6373ae83">b43_nphy_cal_rx_iq</a>(dev, target, 2, 0) == 0)
<a name="l03910"></a>03910                                                 <a class="code" href="phy__n_8c.html#aacb2d7aa12e4b923f2e6a07e0df4edd5">b43_nphy_save_cal</a>(dev);
<a name="l03911"></a>03911                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nphy-&gt;<a class="code" href="structb43__phy__n.html#a18b2e61ce434d595b80dd648931b42f7">mphase_cal_phase_id</a> == 0)
<a name="l03912"></a>03912                                 ;<span class="comment">/* N PHY Periodic Calibration with arg 3 */</span>
<a name="l03913"></a>03913                 } <span class="keywordflow">else</span> {
<a name="l03914"></a>03914                         <a class="code" href="phy__n_8c.html#a76427934c7ee26e8fdebe40d63a58fa9">b43_nphy_restore_cal</a>(dev);
<a name="l03915"></a>03915                 }
<a name="l03916"></a>03916         }
<a name="l03917"></a>03917 
<a name="l03918"></a>03918         <a class="code" href="phy__n_8c.html#a6ca84b077cdfbd885a692d440b82b6d4">b43_nphy_tx_pwr_ctrl_coef_setup</a>(dev);
<a name="l03919"></a>03919         <a class="code" href="phy__n_8c.html#ac1c706b04878fc7941ee790a91377c13">b43_nphy_tx_power_ctrl</a>(dev, tx_pwr_state);
<a name="l03920"></a>03920         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a120691941d36b7c43556ea55a8d33a87">B43_NPHY_TXMACIF_HOLDOFF</a>, 0x0015);
<a name="l03921"></a>03921         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#ad5e279a4ee5b38b3f0df03c7655b3b67">B43_NPHY_TXMACDELAY</a>, 0x0320);
<a name="l03922"></a>03922         <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3 &amp;&amp; phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt;= 6)
<a name="l03923"></a>03923                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a31bb234063c45590cb5b18a744e824e4">B43_NPHY_PLOAD_CSENSE_EXTLEN</a>, 0x0014);
<a name="l03924"></a>03924         <a class="code" href="phy__n_8c.html#ae2674d5daf2af56886be83175b3d2612">b43_nphy_tx_lp_fbw</a>(dev);
<a name="l03925"></a>03925         <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03926"></a>03926                 <a class="code" href="phy__n_8c.html#a6342b7c40316db0192a09c3e9cef5997">b43_nphy_spur_workaround</a>(dev);
<a name="l03927"></a>03927 
<a name="l03928"></a>03928         <span class="keywordflow">return</span> 0;
<a name="l03929"></a>03929 }
<a name="l03930"></a>03930 
<a name="l03931"></a>03931 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/ChanspecSetup */</span>
<a name="l03932"></a><a class="code" href="phy__n_8c.html#a26c0cf78a7e9d425bfea6f0c5bcd5602">03932</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a26c0cf78a7e9d425bfea6f0c5bcd5602">b43_nphy_channel_setup</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l03933"></a>03933                                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structb43__phy__n__sfo__cfg.html">b43_phy_n_sfo_cfg</a> *e,
<a name="l03934"></a>03934                                 <span class="keyword">struct</span> ieee80211_channel *new_channel)
<a name="l03935"></a>03935 {
<a name="l03936"></a>03936         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l03937"></a>03937         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l03938"></a>03938 
<a name="l03939"></a>03939         u16 old_band_5ghz;
<a name="l03940"></a>03940         u32 tmp32;
<a name="l03941"></a>03941 
<a name="l03942"></a>03942         old_band_5ghz =
<a name="l03943"></a>03943                 <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__n_8h.html#a4b8bd10881c97f75766db020cbe1b65e">B43_NPHY_BANDCTL</a>) &amp; <a class="code" href="phy__n_8h.html#a671f78da741559b0530d0bea34f19de0">B43_NPHY_BANDCTL_5GHZ</a>;
<a name="l03944"></a>03944         <span class="keywordflow">if</span> (new_channel-&gt;band == IEEE80211_BAND_5GHZ &amp;&amp; !old_band_5ghz) {
<a name="l03945"></a>03945                 tmp32 = <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#aba1b1818db9222fe51e3d418a6063c42">B43_MMIO_PSM_PHY_HDR</a>);
<a name="l03946"></a>03946                 <a class="code" href="b43_8h.html#a44d913e8694345c005f13a9a95040cd9">b43_write32</a>(dev, <a class="code" href="b43_8h.html#aba1b1818db9222fe51e3d418a6063c42">B43_MMIO_PSM_PHY_HDR</a>, tmp32 | 4);
<a name="l03947"></a>03947                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a74e814efd660c1680e8bc8b1411ce105">B43_PHY_B_BBCFG</a>, 0xC000);
<a name="l03948"></a>03948                 <a class="code" href="b43_8h.html#a44d913e8694345c005f13a9a95040cd9">b43_write32</a>(dev, <a class="code" href="b43_8h.html#aba1b1818db9222fe51e3d418a6063c42">B43_MMIO_PSM_PHY_HDR</a>, tmp32);
<a name="l03949"></a>03949                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a4b8bd10881c97f75766db020cbe1b65e">B43_NPHY_BANDCTL</a>, <a class="code" href="phy__n_8h.html#a671f78da741559b0530d0bea34f19de0">B43_NPHY_BANDCTL_5GHZ</a>);
<a name="l03950"></a>03950         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (new_channel-&gt;band == IEEE80211_BAND_2GHZ &amp;&amp; old_band_5ghz) {
<a name="l03951"></a>03951                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a4b8bd10881c97f75766db020cbe1b65e">B43_NPHY_BANDCTL</a>, ~<a class="code" href="phy__n_8h.html#a671f78da741559b0530d0bea34f19de0">B43_NPHY_BANDCTL_5GHZ</a>);
<a name="l03952"></a>03952                 tmp32 = <a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#aba1b1818db9222fe51e3d418a6063c42">B43_MMIO_PSM_PHY_HDR</a>);
<a name="l03953"></a>03953                 <a class="code" href="b43_8h.html#a44d913e8694345c005f13a9a95040cd9">b43_write32</a>(dev, <a class="code" href="b43_8h.html#aba1b1818db9222fe51e3d418a6063c42">B43_MMIO_PSM_PHY_HDR</a>, tmp32 | 4);
<a name="l03954"></a>03954                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a74e814efd660c1680e8bc8b1411ce105">B43_PHY_B_BBCFG</a>, 0x3FFF);
<a name="l03955"></a>03955                 <a class="code" href="b43_8h.html#a44d913e8694345c005f13a9a95040cd9">b43_write32</a>(dev, <a class="code" href="b43_8h.html#aba1b1818db9222fe51e3d418a6063c42">B43_MMIO_PSM_PHY_HDR</a>, tmp32);
<a name="l03956"></a>03956         }
<a name="l03957"></a>03957 
<a name="l03958"></a>03958         <a class="code" href="phy__n_8c.html#a1d0151e58aca856a068d1d5bac20e1ab">b43_chantab_phy_upload</a>(dev, e);
<a name="l03959"></a>03959 
<a name="l03960"></a>03960         <span class="keywordflow">if</span> (new_channel-&gt;hw_value == 14) {
<a name="l03961"></a>03961                 <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 2, 0);
<a name="l03962"></a>03962                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a8647c24090ea653bdb5d9eaae906274d">B43_PHY_B_TEST</a>, 0x0800);
<a name="l03963"></a>03963         } <span class="keywordflow">else</span> {
<a name="l03964"></a>03964                 <a class="code" href="phy__n_8c.html#ae50c3a102ec0d6e6d20c8b448b974dc9">b43_nphy_classifier</a>(dev, 2, 2);
<a name="l03965"></a>03965                 <span class="keywordflow">if</span> (new_channel-&gt;band == IEEE80211_BAND_2GHZ)
<a name="l03966"></a>03966                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a8647c24090ea653bdb5d9eaae906274d">B43_PHY_B_TEST</a>, ~0x840);
<a name="l03967"></a>03967         }
<a name="l03968"></a>03968 
<a name="l03969"></a>03969         <span class="keywordflow">if</span> (!nphy-&gt;<a class="code" href="structb43__phy__n.html#ade415910e4417d729e6e95daf8c08f6f">txpwrctrl</a>)
<a name="l03970"></a>03970                 <a class="code" href="phy__n_8c.html#a066ab280f4c7812265b2874e4051676c">b43_nphy_tx_power_fix</a>(dev);
<a name="l03971"></a>03971 
<a name="l03972"></a>03972         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 3)
<a name="l03973"></a>03973                 <a class="code" href="phy__n_8c.html#aedc9df634a8ab9088ec0e44f05b92036">b43_nphy_adjust_lna_gain_table</a>(dev);
<a name="l03974"></a>03974 
<a name="l03975"></a>03975         <a class="code" href="phy__n_8c.html#ae2674d5daf2af56886be83175b3d2612">b43_nphy_tx_lp_fbw</a>(dev);
<a name="l03976"></a>03976 
<a name="l03977"></a>03977         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3 &amp;&amp; 0) {
<a name="l03978"></a>03978                 <span class="comment">/* TODO */</span>
<a name="l03979"></a>03979         }
<a name="l03980"></a>03980 
<a name="l03981"></a>03981         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a77a6326c830d43a553fe6b8aee390fd6">B43_NPHY_NDATAT_DUP40</a>, 0x3830);
<a name="l03982"></a>03982 
<a name="l03983"></a>03983         <span class="keywordflow">if</span> (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3)
<a name="l03984"></a>03984                 <a class="code" href="phy__n_8c.html#a6342b7c40316db0192a09c3e9cef5997">b43_nphy_spur_workaround</a>(dev);
<a name="l03985"></a>03985 }
<a name="l03986"></a>03986 
<a name="l03987"></a>03987 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/N/SetChanspec */</span>
<a name="l03988"></a><a class="code" href="phy__n_8c.html#a5a37660f60fac02c639a4ab464e7e334">03988</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a5a37660f60fac02c639a4ab464e7e334">b43_nphy_set_channel</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l03989"></a>03989                                 <span class="keyword">struct</span> ieee80211_channel *channel,
<a name="l03990"></a>03990                                 <span class="keyword">enum</span> nl80211_channel_type channel_type)
<a name="l03991"></a>03991 {
<a name="l03992"></a>03992         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l03993"></a>03993 
<a name="l03994"></a>03994         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb43__nphy__channeltab__entry__rev2.html">b43_nphy_channeltab_entry_rev2</a> *tabent_r2 = NULL;
<a name="l03995"></a>03995         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb43__nphy__channeltab__entry__rev3.html">b43_nphy_channeltab_entry_rev3</a> *tabent_r3 = NULL;
<a name="l03996"></a>03996 
<a name="l03997"></a>03997         u8 tmp;
<a name="l03998"></a>03998 
<a name="l03999"></a>03999         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l04000"></a>04000                 tabent_r3 = <a class="code" href="radio__2056_8c.html#a0d2dd148c20010cda6816508bdee015e">b43_nphy_get_chantabent_rev3</a>(dev,
<a name="l04001"></a>04001                                                         channel-&gt;center_freq);
<a name="l04002"></a>04002                 <span class="keywordflow">if</span> (!tabent_r3)
<a name="l04003"></a>04003                         <span class="keywordflow">return</span> -ESRCH;
<a name="l04004"></a>04004         } <span class="keywordflow">else</span> {
<a name="l04005"></a>04005                 tabent_r2 = <a class="code" href="radio__2055_8c.html#a442718596e60f6775480610123f220b7">b43_nphy_get_chantabent_rev2</a>(dev,
<a name="l04006"></a>04006                                                         channel-&gt;hw_value);
<a name="l04007"></a>04007                 <span class="keywordflow">if</span> (!tabent_r2)
<a name="l04008"></a>04008                         <span class="keywordflow">return</span> -ESRCH;
<a name="l04009"></a>04009         }
<a name="l04010"></a>04010 
<a name="l04011"></a>04011         <span class="comment">/* Channel is set later in common code, but we need to set it on our</span>
<a name="l04012"></a>04012 <span class="comment">           own to let this function&#39;s subcalls work properly. */</span>
<a name="l04013"></a>04013         phy-&gt;<a class="code" href="structb43__phy.html#a68e5573cadabc1462bb752eefec9c599">channel</a> = channel-&gt;hw_value;
<a name="l04014"></a>04014         phy-&gt;<a class="code" href="structb43__phy.html#abb1fefe6c1dad17ef8a19818669a1d01">channel_freq</a> = channel-&gt;center_freq;
<a name="l04015"></a>04015 
<a name="l04016"></a>04016         <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a68bf4fddcc04c2f976206b88455d3a61">b43_channel_type_is_40mhz</a>(phy-&gt;<a class="code" href="structb43__phy.html#a82402ff096b084b3602fbc3147cc66f4">channel_type</a>) !=
<a name="l04017"></a>04017                 <a class="code" href="phy__common_8c.html#a68bf4fddcc04c2f976206b88455d3a61">b43_channel_type_is_40mhz</a>(channel_type))
<a name="l04018"></a>04018                 ; <span class="comment">/* TODO: BMAC BW Set (channel_type) */</span>
<a name="l04019"></a>04019 
<a name="l04020"></a>04020         <span class="keywordflow">if</span> (channel_type == NL80211_CHAN_HT40PLUS)
<a name="l04021"></a>04021                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__n_8h.html#a6818054af126c8a2cdac5b45d5d71a8a">B43_NPHY_RXCTL</a>,
<a name="l04022"></a>04022                                 <a class="code" href="phy__n_8h.html#afe0edc8c7e6f2b5c207f5a5e7acb0161">B43_NPHY_RXCTL_BSELU20</a>);
<a name="l04023"></a>04023         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel_type == NL80211_CHAN_HT40MINUS)
<a name="l04024"></a>04024                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a6818054af126c8a2cdac5b45d5d71a8a">B43_NPHY_RXCTL</a>,
<a name="l04025"></a>04025                                 ~<a class="code" href="phy__n_8h.html#afe0edc8c7e6f2b5c207f5a5e7acb0161">B43_NPHY_RXCTL_BSELU20</a>);
<a name="l04026"></a>04026 
<a name="l04027"></a>04027         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l04028"></a>04028                 tmp = (channel-&gt;band == IEEE80211_BAND_5GHZ) ? 4 : 0;
<a name="l04029"></a>04029                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, 0x08, 0xFFFB, tmp);
<a name="l04030"></a>04030                 <a class="code" href="phy__n_8c.html#a2f225716d369af9475fd10796463554b">b43_radio_2056_setup</a>(dev, tabent_r3);
<a name="l04031"></a>04031                 <a class="code" href="phy__n_8c.html#a26c0cf78a7e9d425bfea6f0c5bcd5602">b43_nphy_channel_setup</a>(dev, &amp;(tabent_r3-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev3.html#a907d3db188907c68da90b7633cda4937">phy_regs</a>), channel);
<a name="l04032"></a>04032         } <span class="keywordflow">else</span> {
<a name="l04033"></a>04033                 tmp = (channel-&gt;band == IEEE80211_BAND_5GHZ) ? 0x0020 : 0x0050;
<a name="l04034"></a>04034                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="radio__2055_8h.html#adf217fab896f5f40b6a08e83c887bfdf">B2055_MASTER1</a>, 0xFF8F, tmp);
<a name="l04035"></a>04035                 <a class="code" href="phy__n_8c.html#acf44bb93018579618a7a644c76af4330">b43_radio_2055_setup</a>(dev, tabent_r2);
<a name="l04036"></a>04036                 <a class="code" href="phy__n_8c.html#a26c0cf78a7e9d425bfea6f0c5bcd5602">b43_nphy_channel_setup</a>(dev, &amp;(tabent_r2-&gt;<a class="code" href="structb43__nphy__channeltab__entry__rev2.html#a977c0cca1fc18b75872dd484429456d3">phy_regs</a>), channel);
<a name="l04037"></a>04037         }
<a name="l04038"></a>04038 
<a name="l04039"></a>04039         <span class="keywordflow">return</span> 0;
<a name="l04040"></a>04040 }
<a name="l04041"></a>04041 
<a name="l04042"></a><a class="code" href="phy__n_8c.html#a82b1e6d8dd3fc5b526480c15e1abadcd">04042</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a82b1e6d8dd3fc5b526480c15e1abadcd">b43_nphy_op_allocate</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l04043"></a>04043 {
<a name="l04044"></a>04044         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy;
<a name="l04045"></a>04045 
<a name="l04046"></a>04046         nphy = kzalloc(<span class="keyword">sizeof</span>(*nphy), GFP_KERNEL);
<a name="l04047"></a>04047         <span class="keywordflow">if</span> (!nphy)
<a name="l04048"></a>04048                 <span class="keywordflow">return</span> -ENOMEM;
<a name="l04049"></a>04049         dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a> = nphy;
<a name="l04050"></a>04050 
<a name="l04051"></a>04051         <span class="keywordflow">return</span> 0;
<a name="l04052"></a>04052 }
<a name="l04053"></a>04053 
<a name="l04054"></a><a class="code" href="phy__n_8c.html#a2779e08fba9f88370ee43cdcb80145e2">04054</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a2779e08fba9f88370ee43cdcb80145e2">b43_nphy_op_prepare_structs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l04055"></a>04055 {
<a name="l04056"></a>04056         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l04057"></a>04057         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l04058"></a>04058 
<a name="l04059"></a>04059         memset(nphy, 0, <span class="keyword">sizeof</span>(*nphy));
<a name="l04060"></a>04060 
<a name="l04061"></a>04061         nphy-&gt;<a class="code" href="structb43__phy__n.html#a1781025c4b61e8ed176bb2567522a088">hang_avoid</a> = (phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 3 || phy-&gt;<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 4);
<a name="l04062"></a>04062         nphy-&gt;<a class="code" href="structb43__phy__n.html#aad6f3e9be30a5f527804da2d4d0415a5">gain_boost</a> = <span class="keyword">true</span>; <span class="comment">/* this way we follow wl, assume it is true */</span>
<a name="l04063"></a>04063         nphy-&gt;<a class="code" href="structb43__phy__n.html#abc71488c2bb6e6278f980f9b5a6016f5">txrx_chain</a> = 2; <span class="comment">/* sth different than 0 and 1 for now */</span>
<a name="l04064"></a>04064         nphy-&gt;<a class="code" href="structb43__phy__n.html#a1c39895a1fdc8e53e42a01f6492ca397">phyrxchain</a> = 3; <span class="comment">/* to avoid b43_nphy_set_rx_core_state like wl */</span>
<a name="l04065"></a>04065         nphy-&gt;<a class="code" href="structb43__phy__n.html#a8eabaf9b04de544689a30040a5f3a8f1">perical</a> = 2; <span class="comment">/* avoid additional rssi cal on init (like wl) */</span>
<a name="l04066"></a>04066         <span class="comment">/* 128 can mean disabled-by-default state of TX pwr ctl. Max value is</span>
<a name="l04067"></a>04067 <span class="comment">         * 0x7f == 127 and we check for 128 when restoring TX pwr ctl. */</span>
<a name="l04068"></a>04068         nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[0] = 128;
<a name="l04069"></a>04069         nphy-&gt;<a class="code" href="structb43__phy__n.html#ab7dd0f17db083861d2a77d2723ed1862">tx_pwr_idx</a>[1] = 128;
<a name="l04070"></a>04070 }
<a name="l04071"></a>04071 
<a name="l04072"></a><a class="code" href="phy__n_8c.html#affc6c059d3747c47104297318c1ad4b8">04072</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#affc6c059d3747c47104297318c1ad4b8">b43_nphy_op_free</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l04073"></a>04073 {
<a name="l04074"></a>04074         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l04075"></a>04075         <span class="keyword">struct </span><a class="code" href="structb43__phy__n.html">b43_phy_n</a> *nphy = phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a>;
<a name="l04076"></a>04076 
<a name="l04077"></a>04077         kfree(nphy);
<a name="l04078"></a>04078         phy-&gt;<a class="code" href="structb43__phy.html#a82401e04cdf2f209eb61c6dc52eaeab9">n</a> = NULL;
<a name="l04079"></a>04079 }
<a name="l04080"></a>04080 
<a name="l04081"></a><a class="code" href="phy__n_8c.html#a7e3399457603e58f6943786df529cd5a">04081</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a7e3399457603e58f6943786df529cd5a">b43_nphy_op_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l04082"></a>04082 {
<a name="l04083"></a>04083         <span class="keywordflow">return</span> <a class="code" href="phy__n_8c.html#acd2b4f77da0652a9d605446e65cce61d">b43_phy_initn</a>(dev);
<a name="l04084"></a>04084 }
<a name="l04085"></a>04085 
<a name="l04086"></a><a class="code" href="phy__n_8c.html#ac876d848f035181cc021612d3163f87d">04086</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#ac876d848f035181cc021612d3163f87d">check_phyreg</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 offset)
<a name="l04087"></a>04087 {
<a name="l04088"></a>04088 <span class="preprocessor">#if B43_DEBUG</span>
<a name="l04089"></a>04089 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((offset &amp; <a class="code" href="phy__common_8h.html#a73c5e79c7333beb003136e57ed2b4ea5">B43_PHYROUTE</a>) == <a class="code" href="phy__common_8h.html#ad5fd9d5143454d6fd93b988989abcf64">B43_PHYROUTE_OFDM_GPHY</a>) {
<a name="l04090"></a>04090                 <span class="comment">/* OFDM registers are onnly available on A/G-PHYs */</span>
<a name="l04091"></a>04091                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;Invalid OFDM PHY access at &quot;</span>
<a name="l04092"></a>04092                        <span class="stringliteral">&quot;0x%04X on N-PHY\n&quot;</span>, offset);
<a name="l04093"></a>04093                 dump_stack();
<a name="l04094"></a>04094         }
<a name="l04095"></a>04095         <span class="keywordflow">if</span> ((offset &amp; B43_PHYROUTE) == <a class="code" href="phy__common_8h.html#ae875e73f4f2b455c8b512e086258530f">B43_PHYROUTE_EXT_GPHY</a>) {
<a name="l04096"></a>04096                 <span class="comment">/* Ext-G registers are only available on G-PHYs */</span>
<a name="l04097"></a>04097                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;Invalid EXT-G PHY access at &quot;</span>
<a name="l04098"></a>04098                        <span class="stringliteral">&quot;0x%04X on N-PHY\n&quot;</span>, offset);
<a name="l04099"></a>04099                 dump_stack();
<a name="l04100"></a>04100         }
<a name="l04101"></a>04101 <span class="preprocessor">#endif </span><span class="comment">/* B43_DEBUG */</span>
<a name="l04102"></a>04102 }
<a name="l04103"></a>04103 
<a name="l04104"></a><a class="code" href="phy__n_8c.html#aec74ec0e8b615de353efbf4066a050ee">04104</a> <span class="keyword">static</span> u16 <a class="code" href="phy__n_8c.html#aec74ec0e8b615de353efbf4066a050ee">b43_nphy_op_read</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg)
<a name="l04105"></a>04105 {
<a name="l04106"></a>04106         <a class="code" href="phy__n_8c.html#ac876d848f035181cc021612d3163f87d">check_phyreg</a>(dev, reg);
<a name="l04107"></a>04107         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#ad805fb3c087c3f1c1b6cf172abd82294">B43_MMIO_PHY_CONTROL</a>, reg);
<a name="l04108"></a>04108         <span class="keywordflow">return</span> <a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>);
<a name="l04109"></a>04109 }
<a name="l04110"></a>04110 
<a name="l04111"></a><a class="code" href="phy__n_8c.html#a0bffe334d4e5fa2f1f963d47c9002bdb">04111</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a0bffe334d4e5fa2f1f963d47c9002bdb">b43_nphy_op_write</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg, u16 value)
<a name="l04112"></a>04112 {
<a name="l04113"></a>04113         <a class="code" href="phy__n_8c.html#ac876d848f035181cc021612d3163f87d">check_phyreg</a>(dev, reg);
<a name="l04114"></a>04114         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#ad805fb3c087c3f1c1b6cf172abd82294">B43_MMIO_PHY_CONTROL</a>, reg);
<a name="l04115"></a>04115         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>, value);
<a name="l04116"></a>04116 }
<a name="l04117"></a>04117 
<a name="l04118"></a><a class="code" href="phy__n_8c.html#a3965721e9a57c2afe39e8f2cf020bcdb">04118</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a3965721e9a57c2afe39e8f2cf020bcdb">b43_nphy_op_maskset</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg, u16 mask,
<a name="l04119"></a>04119                                  u16 <span class="keyword">set</span>)
<a name="l04120"></a>04120 {
<a name="l04121"></a>04121         <a class="code" href="phy__n_8c.html#ac876d848f035181cc021612d3163f87d">check_phyreg</a>(dev, reg);
<a name="l04122"></a>04122         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#ad805fb3c087c3f1c1b6cf172abd82294">B43_MMIO_PHY_CONTROL</a>, reg);
<a name="l04123"></a>04123         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>,
<a name="l04124"></a>04124                     (<a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>) &amp; mask) | <span class="keyword">set</span>);
<a name="l04125"></a>04125 }
<a name="l04126"></a>04126 
<a name="l04127"></a><a class="code" href="phy__n_8c.html#acb9573eb4eb9826456e9dff65a1b1c2c">04127</a> <span class="keyword">static</span> u16 <a class="code" href="phy__n_8c.html#acb9573eb4eb9826456e9dff65a1b1c2c">b43_nphy_op_radio_read</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg)
<a name="l04128"></a>04128 {
<a name="l04129"></a>04129         <span class="comment">/* Register 1 is a 32-bit register. */</span>
<a name="l04130"></a>04130         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(reg == 1);
<a name="l04131"></a>04131         <span class="comment">/* N-PHY needs 0x100 for read access */</span>
<a name="l04132"></a>04132         reg |= 0x100;
<a name="l04133"></a>04133 
<a name="l04134"></a>04134         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a4b3e516476d04840cae0ff9c6f34f84f">B43_MMIO_RADIO_CONTROL</a>, reg);
<a name="l04135"></a>04135         <span class="keywordflow">return</span> <a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#aacf09bc03be57d21f37a11d22cca4861">B43_MMIO_RADIO_DATA_LOW</a>);
<a name="l04136"></a>04136 }
<a name="l04137"></a>04137 
<a name="l04138"></a><a class="code" href="phy__n_8c.html#a9925044af789e4a732a48880d0d678d2">04138</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a9925044af789e4a732a48880d0d678d2">b43_nphy_op_radio_write</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg, u16 value)
<a name="l04139"></a>04139 {
<a name="l04140"></a>04140         <span class="comment">/* Register 1 is a 32-bit register. */</span>
<a name="l04141"></a>04141         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(reg == 1);
<a name="l04142"></a>04142 
<a name="l04143"></a>04143         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a4b3e516476d04840cae0ff9c6f34f84f">B43_MMIO_RADIO_CONTROL</a>, reg);
<a name="l04144"></a>04144         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#aacf09bc03be57d21f37a11d22cca4861">B43_MMIO_RADIO_DATA_LOW</a>, value);
<a name="l04145"></a>04145 }
<a name="l04146"></a>04146 
<a name="l04147"></a>04147 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/Radio/Switch%20Radio */</span>
<a name="l04148"></a><a class="code" href="phy__n_8c.html#a4e1e09f73b2e24996739b5991f050e7f">04148</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a4e1e09f73b2e24996739b5991f050e7f">b43_nphy_op_software_rfkill</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l04149"></a>04149                                         <span class="keywordtype">bool</span> blocked)
<a name="l04150"></a>04150 {
<a name="l04151"></a>04151         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#adfd04e75bffd22461c0c7a3eab648ea1">b43_read32</a>(dev, <a class="code" href="b43_8h.html#ae49bbdbfd9ea55e3f0b21578d9e35ec7">B43_MMIO_MACCTL</a>) &amp; <a class="code" href="b43_8h.html#a454a23f84916947aa7f89bd7c37a6112">B43_MACCTL_ENABLED</a>)
<a name="l04152"></a>04152                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;MAC not suspended\n&quot;</span>);
<a name="l04153"></a>04153 
<a name="l04154"></a>04154         <span class="keywordflow">if</span> (blocked) {
<a name="l04155"></a>04155                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__n_8h.html#a4253cd256f7608afec1f88883d1a95eb">B43_NPHY_RFCTL_CMD</a>,
<a name="l04156"></a>04156                                 ~<a class="code" href="phy__n_8h.html#a3bd6cc35e5f020741ff59f50b37cbd4d">B43_NPHY_RFCTL_CMD_CHIP0PU</a>);
<a name="l04157"></a>04157                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l04158"></a>04158                         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, 0x09, ~0x2);
<a name="l04159"></a>04159 
<a name="l04160"></a>04160                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x204D, 0);
<a name="l04161"></a>04161                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x2053, 0);
<a name="l04162"></a>04162                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x2058, 0);
<a name="l04163"></a>04163                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x205E, 0);
<a name="l04164"></a>04164                         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, 0x2062, ~0xF0);
<a name="l04165"></a>04165                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x2064, 0);
<a name="l04166"></a>04166 
<a name="l04167"></a>04167                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x304D, 0);
<a name="l04168"></a>04168                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x3053, 0);
<a name="l04169"></a>04169                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x3058, 0);
<a name="l04170"></a>04170                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x305E, 0);
<a name="l04171"></a>04171                         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, 0x3062, ~0xF0);
<a name="l04172"></a>04172                         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, 0x3064, 0);
<a name="l04173"></a>04173                 }
<a name="l04174"></a>04174         } <span class="keywordflow">else</span> {
<a name="l04175"></a>04175                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l04176"></a>04176                         <a class="code" href="phy__n_8c.html#a40e04897a0dde70374829c1516a01a44">b43_radio_init2056</a>(dev);
<a name="l04177"></a>04177                         <a class="code" href="phy__common_8c.html#a2efed98acfe2e35f6199b0e608e4a18c">b43_switch_channel</a>(dev, dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a68e5573cadabc1462bb752eefec9c599">channel</a>);
<a name="l04178"></a>04178                 } <span class="keywordflow">else</span> {
<a name="l04179"></a>04179                         <a class="code" href="phy__n_8c.html#a7e95ea4378f8442fe75be6c84f502b90">b43_radio_init2055</a>(dev);
<a name="l04180"></a>04180                 }
<a name="l04181"></a>04181         }
<a name="l04182"></a>04182 }
<a name="l04183"></a>04183 
<a name="l04184"></a>04184 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/Anacore */</span>
<a name="l04185"></a><a class="code" href="phy__n_8c.html#a0ec1c2ce221ba9d6815027fe8d7796c2">04185</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__n_8c.html#a0ec1c2ce221ba9d6815027fe8d7796c2">b43_nphy_op_switch_analog</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> on)
<a name="l04186"></a>04186 {
<a name="l04187"></a>04187         u16 <span class="keyword">override</span> = on ? 0x0 : 0x7FFF;
<a name="l04188"></a>04188         u16 core = on ? 0xD : 0x00FD;
<a name="l04189"></a>04189 
<a name="l04190"></a>04190         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 3) {
<a name="l04191"></a>04191                 <span class="keywordflow">if</span> (on) {
<a name="l04192"></a>04192                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, core);
<a name="l04193"></a>04193                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, <span class="keyword">override</span>);
<a name="l04194"></a>04194                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, core);
<a name="l04195"></a>04195                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, <span class="keyword">override</span>);
<a name="l04196"></a>04196                 } <span class="keywordflow">else</span> {
<a name="l04197"></a>04197                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a9086c9ad56c6c96e7852316fcb330173">B43_NPHY_AFECTL_OVER1</a>, <span class="keyword">override</span>);
<a name="l04198"></a>04198                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a61dc69d08e797a77280f49a96834aa74">B43_NPHY_AFECTL_C1</a>, core);
<a name="l04199"></a>04199                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, <span class="keyword">override</span>);
<a name="l04200"></a>04200                         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#adfd80803ab7f92efe9b2c72f695725ef">B43_NPHY_AFECTL_C2</a>, core);
<a name="l04201"></a>04201                 }
<a name="l04202"></a>04202         } <span class="keywordflow">else</span> {
<a name="l04203"></a>04203                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__n_8h.html#a6d243dd45bad082b2839d2a7e0820ce6">B43_NPHY_AFECTL_OVER</a>, <span class="keyword">override</span>);
<a name="l04204"></a>04204         }
<a name="l04205"></a>04205 }
<a name="l04206"></a>04206 
<a name="l04207"></a><a class="code" href="phy__n_8c.html#aebf763674dd5f1e62793dcd95527a92e">04207</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#aebf763674dd5f1e62793dcd95527a92e">b43_nphy_op_switch_channel</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l04208"></a>04208                                       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_channel)
<a name="l04209"></a>04209 {
<a name="l04210"></a>04210         <span class="keyword">struct </span>ieee80211_channel *channel = dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>-&gt;<a class="code" href="structb43__wl.html#a551eff2e1c92bf64bd92e4c1fec5597b">hw</a>-&gt;conf.channel;
<a name="l04211"></a>04211         <span class="keyword">enum</span> nl80211_channel_type channel_type = dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>-&gt;<a class="code" href="structb43__wl.html#a551eff2e1c92bf64bd92e4c1fec5597b">hw</a>-&gt;conf.channel_type;
<a name="l04212"></a>04212 
<a name="l04213"></a>04213         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l04214"></a>04214                 <span class="keywordflow">if</span> ((new_channel &lt; 1) || (new_channel &gt; 14))
<a name="l04215"></a>04215                         <span class="keywordflow">return</span> -EINVAL;
<a name="l04216"></a>04216         } <span class="keywordflow">else</span> {
<a name="l04217"></a>04217                 <span class="keywordflow">if</span> (new_channel &gt; 200)
<a name="l04218"></a>04218                         <span class="keywordflow">return</span> -EINVAL;
<a name="l04219"></a>04219         }
<a name="l04220"></a>04220 
<a name="l04221"></a>04221         <span class="keywordflow">return</span> <a class="code" href="phy__n_8c.html#a5a37660f60fac02c639a4ab464e7e334">b43_nphy_set_channel</a>(dev, channel, channel_type);
<a name="l04222"></a>04222 }
<a name="l04223"></a>04223 
<a name="l04224"></a><a class="code" href="phy__n_8c.html#a7058bc6dd2c9cd8a16f09018776fca33">04224</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="phy__n_8c.html#a7058bc6dd2c9cd8a16f09018776fca33">b43_nphy_op_get_default_chan</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l04225"></a>04225 {
<a name="l04226"></a>04226         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l04227"></a>04227                 <span class="keywordflow">return</span> 1;
<a name="l04228"></a>04228         <span class="keywordflow">return</span> 36;
<a name="l04229"></a>04229 }
<a name="l04230"></a>04230 
<a name="l04231"></a><a class="code" href="phy__n_8h.html#a1b2d907dd3440e218cadebcc13fbda5d">04231</a> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb43__phy__operations.html">b43_phy_operations</a> <a class="code" href="phy__n_8c.html#a1b2d907dd3440e218cadebcc13fbda5d">b43_phyops_n</a> = {
<a name="l04232"></a>04232         .<a class="code" href="structb43__phy__operations.html#a165c4f4148350fc709122de3c7ce3efd">allocate</a>               = <a class="code" href="phy__n_8c.html#a82b1e6d8dd3fc5b526480c15e1abadcd">b43_nphy_op_allocate</a>,
<a name="l04233"></a>04233         .free                   = <a class="code" href="phy__n_8c.html#affc6c059d3747c47104297318c1ad4b8">b43_nphy_op_free</a>,
<a name="l04234"></a>04234         .prepare_structs        = <a class="code" href="phy__n_8c.html#a2779e08fba9f88370ee43cdcb80145e2">b43_nphy_op_prepare_structs</a>,
<a name="l04235"></a>04235         .init                   = <a class="code" href="phy__n_8c.html#a7e3399457603e58f6943786df529cd5a">b43_nphy_op_init</a>,
<a name="l04236"></a>04236         .phy_read               = <a class="code" href="phy__n_8c.html#aec74ec0e8b615de353efbf4066a050ee">b43_nphy_op_read</a>,
<a name="l04237"></a>04237         .phy_write              = <a class="code" href="phy__n_8c.html#a0bffe334d4e5fa2f1f963d47c9002bdb">b43_nphy_op_write</a>,
<a name="l04238"></a>04238         .phy_maskset            = <a class="code" href="phy__n_8c.html#a3965721e9a57c2afe39e8f2cf020bcdb">b43_nphy_op_maskset</a>,
<a name="l04239"></a>04239         .radio_read             = <a class="code" href="phy__n_8c.html#acb9573eb4eb9826456e9dff65a1b1c2c">b43_nphy_op_radio_read</a>,
<a name="l04240"></a>04240         .radio_write            = <a class="code" href="phy__n_8c.html#a9925044af789e4a732a48880d0d678d2">b43_nphy_op_radio_write</a>,
<a name="l04241"></a>04241         .software_rfkill        = <a class="code" href="phy__n_8c.html#a4e1e09f73b2e24996739b5991f050e7f">b43_nphy_op_software_rfkill</a>,
<a name="l04242"></a>04242         .switch_analog          = <a class="code" href="phy__n_8c.html#a0ec1c2ce221ba9d6815027fe8d7796c2">b43_nphy_op_switch_analog</a>,
<a name="l04243"></a>04243         .switch_channel         = <a class="code" href="phy__n_8c.html#aebf763674dd5f1e62793dcd95527a92e">b43_nphy_op_switch_channel</a>,
<a name="l04244"></a>04244         .get_default_chan       = <a class="code" href="phy__n_8c.html#a7058bc6dd2c9cd8a16f09018776fca33">b43_nphy_op_get_default_chan</a>,
<a name="l04245"></a>04245         .recalc_txpower         = <a class="code" href="phy__n_8c.html#a50b46643e30db4e9329d2cf66003d75e">b43_nphy_op_recalc_txpower</a>,
<a name="l04246"></a>04246         .adjust_txpower         = <a class="code" href="phy__n_8c.html#a18ec4af00ace8ee353f36b835b8a4301">b43_nphy_op_adjust_txpower</a>,
<a name="l04247"></a>04247 };
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 11 22:05:16 2013 for CompatWireless3.2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
