<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CompatWireless3.2: drivers/net/wireless/b43/phy_lp.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>drivers/net/wireless/b43/phy_lp.c</h1><a href="phy__lp_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  Broadcom B43 wireless driver</span>
<a name="l00004"></a>00004 <span class="comment">  IEEE 802.11a/g LP-PHY driver</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">  Copyright (c) 2008-2009 Michael Buesch &lt;m@bues.ch&gt;</span>
<a name="l00007"></a>00007 <span class="comment">  Copyright (c) 2009 GÃ¡bor Stefanik &lt;netrolller.3d@gmail.com&gt;</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">  This program is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
<a name="l00011"></a>00011 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00012"></a>00012 <span class="comment">  (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment">  GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">  You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment">  along with this program; see the file COPYING.  If not, write to</span>
<a name="l00021"></a>00021 <span class="comment">  the Free Software Foundation, Inc., 51 Franklin Steet, Fifth Floor,</span>
<a name="l00022"></a>00022 <span class="comment">  Boston, MA 02110-1301, USA.</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">*/</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;linux/slab.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="b43_8h.html">b43.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="main_8h.html">main.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="phy__lp_8h.html">phy_lp.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="phy__common_8h.html">phy_common.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="tables__lpphy_8h.html">tables_lpphy.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="phy__lp_8c.html#a8c683969295ad30dcf3d0795929a2933">00035</a> <span class="keyword">static</span> <span class="keyword">inline</span> u16 <a class="code" href="phy__lp_8c.html#a8c683969295ad30dcf3d0795929a2933">channel2freq_lp</a>(u8 channel)
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037         <span class="keywordflow">if</span> (channel &lt; 14)
<a name="l00038"></a>00038                 <span class="keywordflow">return</span> (2407 + 5 * channel);
<a name="l00039"></a>00039         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel == 14)
<a name="l00040"></a>00040                 <span class="keywordflow">return</span> 2484;
<a name="l00041"></a>00041         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel &lt; 184)
<a name="l00042"></a>00042                 <span class="keywordflow">return</span> (5000 + 5 * channel);
<a name="l00043"></a>00043         <span class="keywordflow">else</span>
<a name="l00044"></a>00044                 <span class="keywordflow">return</span> (4000 + 5 * channel);
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="phy__lp_8c.html#aae3808ca30452758f3c135c36d38d9a4">00047</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#aae3808ca30452758f3c135c36d38d9a4">b43_lpphy_op_get_default_chan</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l00050"></a>00050                 <span class="keywordflow">return</span> 1;
<a name="l00051"></a>00051         <span class="keywordflow">return</span> 36;
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="phy__lp_8c.html#a3da6d1c6bf92af4bda8cb58126b98678">00054</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#a3da6d1c6bf92af4bda8cb58126b98678">b43_lpphy_op_allocate</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         lpphy = kzalloc(<span class="keyword">sizeof</span>(*lpphy), GFP_KERNEL);
<a name="l00059"></a>00059         <span class="keywordflow">if</span> (!lpphy)
<a name="l00060"></a>00060                 <span class="keywordflow">return</span> -ENOMEM;
<a name="l00061"></a>00061         dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a> = lpphy;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063         <span class="keywordflow">return</span> 0;
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="phy__lp_8c.html#afc684bf823dec6fc8f9b6f584e4a6f9a">00066</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#afc684bf823dec6fc8f9b6f584e4a6f9a">b43_lpphy_op_prepare_structs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068         <span class="keyword">struct </span><a class="code" href="structb43__phy.html">b43_phy</a> *phy = &amp;dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>;
<a name="l00069"></a>00069         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = phy-&gt;<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         memset(lpphy, 0, <span class="keyword">sizeof</span>(*lpphy));
<a name="l00072"></a>00072         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a571ca5b4d10b51617b5568b2b263da86">antenna</a> = <a class="code" href="phy__common_8h.html#a385c44f6fb256e5716a2302a5b940388a8bae5257eaae7bebbad9b1f72172336d">B43_ANTENNA_DEFAULT</a>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         <span class="comment">//TODO</span>
<a name="l00075"></a>00075 }
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="phy__lp_8c.html#ab67444039e19a0c70cc681ec24e0103a">00077</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ab67444039e19a0c70cc681ec24e0103a">b43_lpphy_op_free</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         kfree(lpphy);
<a name="l00082"></a>00082         dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a> = NULL;
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">/* http://bcm-v4.sipsolutions.net/802.11/PHY/LP/ReadBandSrom */</span>
<a name="l00086"></a><a class="code" href="phy__lp_8c.html#ad53d68a5a45fbce089adde07319c812b">00086</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ad53d68a5a45fbce089adde07319c812b">lpphy_read_band_sprom</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l00089"></a>00089         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00090"></a>00090         u16 cckpo, maxpwr;
<a name="l00091"></a>00091         u32 ofdmpo;
<a name="l00092"></a>00092         <span class="keywordtype">int</span> i;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l00095"></a>00095                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a80a4a5f085f8e4002ff434967c83c98c">tx_isolation_med_band</a> = sprom-&gt;tri2g;
<a name="l00096"></a>00096                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ae118bf9d1e496d50c585183b4a63e11b">bx_arch</a> = sprom-&gt;bxa2g;
<a name="l00097"></a>00097                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aca97c651c994b9fab19d9a2a7d02f24c">rx_pwr_offset</a> = sprom-&gt;rxpo2g;
<a name="l00098"></a>00098                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a98ebf7e3d0e0a2665ffae50231d15147">rssi_vf</a> = sprom-&gt;rssismf2g;
<a name="l00099"></a>00099                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a735be89f56787b430e86119c12e8d2d6">rssi_vc</a> = sprom-&gt;rssismc2g;
<a name="l00100"></a>00100                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#af248c0f7ad9c57c7f62f3304e55f2467">rssi_gs</a> = sprom-&gt;rssisav2g;
<a name="l00101"></a>00101                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aa5b18f18e4ba3e8fbc62dd4665663981">txpa</a>[0] = sprom-&gt;pa0b0;
<a name="l00102"></a>00102                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aa5b18f18e4ba3e8fbc62dd4665663981">txpa</a>[1] = sprom-&gt;pa0b1;
<a name="l00103"></a>00103                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aa5b18f18e4ba3e8fbc62dd4665663981">txpa</a>[2] = sprom-&gt;pa0b2;
<a name="l00104"></a>00104                 maxpwr = sprom-&gt;maxpwr_bg;
<a name="l00105"></a>00105                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a42097d5aca8a159c9c3144fe9365dcfc">max_tx_pwr_med_band</a> = maxpwr;
<a name="l00106"></a>00106                 cckpo = sprom-&gt;cck2gpo;
<a name="l00107"></a>00107                 <span class="comment">/*</span>
<a name="l00108"></a>00108 <span class="comment">                 * We don&#39;t read SPROM&#39;s opo as specs say. On rev8 SPROMs</span>
<a name="l00109"></a>00109 <span class="comment">                 * opo == ofdm2gpo and we don&#39;t know any SSB with LP-PHY</span>
<a name="l00110"></a>00110 <span class="comment">                 * and SPROM rev below 8.</span>
<a name="l00111"></a>00111 <span class="comment">                 */</span>
<a name="l00112"></a>00112                 <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(sprom-&gt;revision &lt; 8);
<a name="l00113"></a>00113                 ofdmpo = sprom-&gt;ofdm2gpo;
<a name="l00114"></a>00114                 <span class="keywordflow">if</span> (cckpo) {
<a name="l00115"></a>00115                         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l00116"></a>00116                                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aed47db0612432070b825bcf94bdf8aa6">tx_max_rate</a>[i] =
<a name="l00117"></a>00117                                         maxpwr - (ofdmpo &amp; 0xF) * 2;
<a name="l00118"></a>00118                                 ofdmpo &gt;&gt;= 4;
<a name="l00119"></a>00119                         }
<a name="l00120"></a>00120                         ofdmpo = sprom-&gt;ofdm2gpo;
<a name="l00121"></a>00121                         <span class="keywordflow">for</span> (i = 4; i &lt; 15; i++) {
<a name="l00122"></a>00122                                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aed47db0612432070b825bcf94bdf8aa6">tx_max_rate</a>[i] =
<a name="l00123"></a>00123                                         maxpwr - (ofdmpo &amp; 0xF) * 2;
<a name="l00124"></a>00124                                 ofdmpo &gt;&gt;= 4;
<a name="l00125"></a>00125                         }
<a name="l00126"></a>00126                 } <span class="keywordflow">else</span> {
<a name="l00127"></a>00127                         ofdmpo &amp;= 0xFF;
<a name="l00128"></a>00128                         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l00129"></a>00129                                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aed47db0612432070b825bcf94bdf8aa6">tx_max_rate</a>[i] = maxpwr;
<a name="l00130"></a>00130                         for (i = 4; i &lt; 15; i++)
<a name="l00131"></a>00131                                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aed47db0612432070b825bcf94bdf8aa6">tx_max_rate</a>[i] = maxpwr - ofdmpo;
<a name="l00132"></a>00132                 }
<a name="l00133"></a>00133         } <span class="keywordflow">else</span> { <span class="comment">/* 5GHz */</span>
<a name="l00134"></a>00134                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a1cfe36b659584d8486961bd539981a83">tx_isolation_low_band</a> = sprom-&gt;tri5gl;
<a name="l00135"></a>00135                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a80a4a5f085f8e4002ff434967c83c98c">tx_isolation_med_band</a> = sprom-&gt;tri5g;
<a name="l00136"></a>00136                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#add220a331633d71c9054d8e7344afece">tx_isolation_hi_band</a> = sprom-&gt;tri5gh;
<a name="l00137"></a>00137                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ae118bf9d1e496d50c585183b4a63e11b">bx_arch</a> = sprom-&gt;bxa5g;
<a name="l00138"></a>00138                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aca97c651c994b9fab19d9a2a7d02f24c">rx_pwr_offset</a> = sprom-&gt;rxpo5g;
<a name="l00139"></a>00139                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a98ebf7e3d0e0a2665ffae50231d15147">rssi_vf</a> = sprom-&gt;rssismf5g;
<a name="l00140"></a>00140                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a735be89f56787b430e86119c12e8d2d6">rssi_vc</a> = sprom-&gt;rssismc5g;
<a name="l00141"></a>00141                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#af248c0f7ad9c57c7f62f3304e55f2467">rssi_gs</a> = sprom-&gt;rssisav5g;
<a name="l00142"></a>00142                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aa5b18f18e4ba3e8fbc62dd4665663981">txpa</a>[0] = sprom-&gt;pa1b0;
<a name="l00143"></a>00143                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aa5b18f18e4ba3e8fbc62dd4665663981">txpa</a>[1] = sprom-&gt;pa1b1;
<a name="l00144"></a>00144                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aa5b18f18e4ba3e8fbc62dd4665663981">txpa</a>[2] = sprom-&gt;pa1b2;
<a name="l00145"></a>00145                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ab12a1d7dd115a7fcca409254bb93d48e">txpal</a>[0] = sprom-&gt;pa1lob0;
<a name="l00146"></a>00146                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ab12a1d7dd115a7fcca409254bb93d48e">txpal</a>[1] = sprom-&gt;pa1lob1;
<a name="l00147"></a>00147                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ab12a1d7dd115a7fcca409254bb93d48e">txpal</a>[2] = sprom-&gt;pa1lob2;
<a name="l00148"></a>00148                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a0b28440c19949043d16da9eb77a70cc5">txpah</a>[0] = sprom-&gt;pa1hib0;
<a name="l00149"></a>00149                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a0b28440c19949043d16da9eb77a70cc5">txpah</a>[1] = sprom-&gt;pa1hib1;
<a name="l00150"></a>00150                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a0b28440c19949043d16da9eb77a70cc5">txpah</a>[2] = sprom-&gt;pa1hib2;
<a name="l00151"></a>00151                 maxpwr = sprom-&gt;maxpwr_al;
<a name="l00152"></a>00152                 ofdmpo = sprom-&gt;ofdm5glpo;
<a name="l00153"></a>00153                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ae2734dd9974280c5f6359c13a42cb267">max_tx_pwr_low_band</a> = maxpwr;
<a name="l00154"></a>00154                 <span class="keywordflow">for</span> (i = 4; i &lt; 12; i++) {
<a name="l00155"></a>00155                         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ab99b66dc3ad1a0deb493519989d05238">tx_max_ratel</a>[i] = maxpwr - (ofdmpo &amp; 0xF) * 2;
<a name="l00156"></a>00156                         ofdmpo &gt;&gt;= 4;
<a name="l00157"></a>00157                 }
<a name="l00158"></a>00158                 maxpwr = sprom-&gt;maxpwr_a;
<a name="l00159"></a>00159                 ofdmpo = sprom-&gt;ofdm5gpo;
<a name="l00160"></a>00160                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a42097d5aca8a159c9c3144fe9365dcfc">max_tx_pwr_med_band</a> = maxpwr;
<a name="l00161"></a>00161                 <span class="keywordflow">for</span> (i = 4; i &lt; 12; i++) {
<a name="l00162"></a>00162                         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aed47db0612432070b825bcf94bdf8aa6">tx_max_rate</a>[i] = maxpwr - (ofdmpo &amp; 0xF) * 2;
<a name="l00163"></a>00163                         ofdmpo &gt;&gt;= 4;
<a name="l00164"></a>00164                 }
<a name="l00165"></a>00165                 maxpwr = sprom-&gt;maxpwr_ah;
<a name="l00166"></a>00166                 ofdmpo = sprom-&gt;ofdm5ghpo;
<a name="l00167"></a>00167                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ab6852ef8d19bed2f4bea6e6136a0fe4f">max_tx_pwr_hi_band</a> = maxpwr;
<a name="l00168"></a>00168                 <span class="keywordflow">for</span> (i = 4; i &lt; 12; i++) {
<a name="l00169"></a>00169                         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a6da4152703f8887de18ce1c277dfd00a">tx_max_rateh</a>[i] = maxpwr - (ofdmpo &amp; 0xF) * 2;
<a name="l00170"></a>00170                         ofdmpo &gt;&gt;= 4;
<a name="l00171"></a>00171                 }
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="phy__lp_8c.html#ab8cd66489d03da459762fccafbd489cc">00175</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ab8cd66489d03da459762fccafbd489cc">lpphy_adjust_gain_table</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u32 freq)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00178"></a>00178         u16 temp[3];
<a name="l00179"></a>00179         u16 isolation;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l00184"></a>00184                 isolation = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a80a4a5f085f8e4002ff434967c83c98c">tx_isolation_med_band</a>;
<a name="l00185"></a>00185         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freq &lt;= 5320)
<a name="l00186"></a>00186                 isolation = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a1cfe36b659584d8486961bd539981a83">tx_isolation_low_band</a>;
<a name="l00187"></a>00187         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freq &lt;= 5700)
<a name="l00188"></a>00188                 isolation = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a80a4a5f085f8e4002ff434967c83c98c">tx_isolation_med_band</a>;
<a name="l00189"></a>00189         <span class="keywordflow">else</span>
<a name="l00190"></a>00190                 isolation = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#add220a331633d71c9054d8e7344afece">tx_isolation_hi_band</a>;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         temp[0] = ((isolation - 26) / 12) &lt;&lt; 12;
<a name="l00193"></a>00193         temp[1] = temp[0] + 0x1000;
<a name="l00194"></a>00194         temp[2] = temp[0] + 0x2000;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <a class="code" href="tables__lpphy_8c.html#ae6336133eb23c4dd79e732ff2252c603">b43_lptab_write_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(13, 0), 3, temp);
<a name="l00197"></a>00197         <a class="code" href="tables__lpphy_8c.html#ae6336133eb23c4dd79e732ff2252c603">b43_lptab_write_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(12, 0), 3, temp);
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="phy__lp_8c.html#af6014b2353ab5831819938bebce43202">00200</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#af6014b2353ab5831819938bebce43202">lpphy_table_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202         u32 freq = <a class="code" href="phy__lp_8c.html#a8c683969295ad30dcf3d0795929a2933">channel2freq_lp</a>(<a class="code" href="phy__lp_8c.html#aae3808ca30452758f3c135c36d38d9a4">b43_lpphy_op_get_default_chan</a>(dev));
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l00205"></a>00205                 <a class="code" href="tables__lpphy_8c.html#adf4883620fadc8c167e463ba1372379b">lpphy_rev0_1_table_init</a>(dev);
<a name="l00206"></a>00206         <span class="keywordflow">else</span>
<a name="l00207"></a>00207                 <a class="code" href="tables__lpphy_8c.html#a8e89d6bc10e2ef095ed1bb4f22a16441">lpphy_rev2plus_table_init</a>(dev);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <a class="code" href="tables__lpphy_8c.html#ababf6795c48fad00b99e2e5dc554a47b">lpphy_init_tx_gain_table</a>(dev);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l00212"></a>00212                 <a class="code" href="phy__lp_8c.html#ab8cd66489d03da459762fccafbd489cc">lpphy_adjust_gain_table</a>(dev, freq);
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a><a class="code" href="phy__lp_8c.html#ada6fbedb65cde4d7b9994175c7ec8b5e">00215</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ada6fbedb65cde4d7b9994175c7ec8b5e">lpphy_baseband_rev0_1_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217         <span class="keyword">struct </span>ssb_bus *bus = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a68f9a4660126ada1510b28be93e1dd0d">sdev</a>-&gt;bus;
<a name="l00218"></a>00218         <span class="keyword">struct </span>ssb_sprom *sprom = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a656976d02ad07d1f55055256410cb0fd">bus_sprom</a>;
<a name="l00219"></a>00219         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00220"></a>00220         u16 tmp, tmp2;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a1d2d2cede732b9df98e903db6f8febce">B43_LPPHY_AFE_DAC_CTL</a>, 0xF7FF);
<a name="l00223"></a>00223         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1cbeb141c0757c1ee38751e538c9cdb4">B43_LPPHY_AFE_CTL</a>, 0);
<a name="l00224"></a>00224         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0);
<a name="l00225"></a>00225         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0);
<a name="l00226"></a>00226         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0);
<a name="l00227"></a>00227         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a1d2d2cede732b9df98e903db6f8febce">B43_LPPHY_AFE_DAC_CTL</a>, 0x0004);
<a name="l00228"></a>00228         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a48d164f4e365aa6179d39587a752f362">B43_LPPHY_OFDMSYNCTHRESH0</a>, 0xFF00, 0x0078);
<a name="l00229"></a>00229         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>, 0x83FF, 0x5800);
<a name="l00230"></a>00230         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7aa61c58d6a0eb578bb68c9692c25fb9">B43_LPPHY_ADC_COMPENSATION_CTL</a>, 0x0016);
<a name="l00231"></a>00231         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a3fd1328c812134de3fc243ae36d4bf29">B43_LPPHY_AFE_ADC_CTL_0</a>, 0xFFF8, 0x0004);
<a name="l00232"></a>00232         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53f8ab0e087c3595fe0fc30201a0ca67">B43_LPPHY_VERYLOWGAINDB</a>, 0x00FF, 0x5400);
<a name="l00233"></a>00233         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8d70791e078cab68f7bf5cc83a2985b4">B43_LPPHY_HIGAINDB</a>, 0x00FF, 0x2400);
<a name="l00234"></a>00234         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53d2ef71fa09db975967e131b02d107a">B43_LPPHY_LOWGAINDB</a>, 0x00FF, 0x2100);
<a name="l00235"></a>00235         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53f8ab0e087c3595fe0fc30201a0ca67">B43_LPPHY_VERYLOWGAINDB</a>, 0xFF00, 0x0006);
<a name="l00236"></a>00236         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a0ea8f2af26bfbb1f9e5ebae57e98c634">B43_LPPHY_RX_RADIO_CTL</a>, 0xFFFE);
<a name="l00237"></a>00237         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>, 0xFFE0, 0x0005);
<a name="l00238"></a>00238         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>, 0xFC1F, 0x0180);
<a name="l00239"></a>00239         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>, 0x83FF, 0x3C00);
<a name="l00240"></a>00240         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ad949f9a1bdf3ef5c2ce39e0a4e8526cd">B43_LPPHY_GAINDIRECTMISMATCH</a>, 0xFFF0, 0x0005);
<a name="l00241"></a>00241         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac55027075477ddaa5f6a826e1bcd506a">B43_LPPHY_GAIN_MISMATCH_LIMIT</a>, 0xFFC0, 0x001A);
<a name="l00242"></a>00242         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab5354bb28613f2efee6ce2078b62b3ae">B43_LPPHY_CRS_ED_THRESH</a>, 0xFF00, 0x00B3);
<a name="l00243"></a>00243         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab5354bb28613f2efee6ce2078b62b3ae">B43_LPPHY_CRS_ED_THRESH</a>, 0x00FF, 0xAD00);
<a name="l00244"></a>00244         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac35a20aa058aa18df28eea06109b11dd">B43_LPPHY_INPUT_PWRDB</a>,
<a name="l00245"></a>00245                         0xFF00, lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aca97c651c994b9fab19d9a2a7d02f24c">rx_pwr_offset</a>);
<a name="l00246"></a>00246         <span class="keywordflow">if</span> ((sprom-&gt;boardflags_lo &amp; <a class="code" href="b43_8h.html#ad642a17fff65edbb5565f43995fe78ca">B43_BFL_FEM</a>) &amp;&amp;
<a name="l00247"></a>00247            ((<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ) ||
<a name="l00248"></a>00248            (sprom-&gt;boardflags_hi &amp; <a class="code" href="b43_8h.html#a68b570d554e47a62983f201375e82152">B43_BFH_PAREF</a>))) {
<a name="l00249"></a>00249                 ssb_pmu_set_ldo_voltage(&amp;bus-&gt;chipco, LDO_PAREF, 0x28);
<a name="l00250"></a>00250                 ssb_pmu_set_ldo_paref(&amp;bus-&gt;chipco, <span class="keyword">true</span>);
<a name="l00251"></a>00251                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 0) {
<a name="l00252"></a>00252                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#af752a394417d68e191fe91b053f890b8">B43_LPPHY_LP_RF_SIGNAL_LUT</a>,
<a name="l00253"></a>00253                                         0xFFCF, 0x0010);
<a name="l00254"></a>00254                 }
<a name="l00255"></a>00255                 <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(11, 7), 60);
<a name="l00256"></a>00256         } <span class="keywordflow">else</span> {
<a name="l00257"></a>00257                 ssb_pmu_set_ldo_paref(&amp;bus-&gt;chipco, <span class="keyword">false</span>);
<a name="l00258"></a>00258                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#af752a394417d68e191fe91b053f890b8">B43_LPPHY_LP_RF_SIGNAL_LUT</a>,
<a name="l00259"></a>00259                                 0xFFCF, 0x0020);
<a name="l00260"></a>00260                 <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(11, 7), 100);
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         tmp = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a98ebf7e3d0e0a2665ffae50231d15147">rssi_vf</a> | lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a735be89f56787b430e86119c12e8d2d6">rssi_vc</a> &lt;&lt; 4 | 0xA000;
<a name="l00263"></a>00263         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a3688173da898e0383e51a40edb831379">B43_LPPHY_AFE_RSSI_CTL_0</a>, tmp);
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (sprom-&gt;boardflags_hi &amp; <a class="code" href="b43_8h.html#a5e8c8d61dba5744bfcf2e614eb3418cb">B43_BFH_RSSIINV</a>)
<a name="l00265"></a>00265                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8171e79c858e52b59e328f7ba6ce8aa3">B43_LPPHY_AFE_RSSI_CTL_1</a>, 0xF000, 0x0AAA);
<a name="l00266"></a>00266         <span class="keywordflow">else</span>
<a name="l00267"></a>00267                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8171e79c858e52b59e328f7ba6ce8aa3">B43_LPPHY_AFE_RSSI_CTL_1</a>, 0xF000, 0x02AA);
<a name="l00268"></a>00268         <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(11, 1), 24);
<a name="l00269"></a>00269         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a0ea8f2af26bfbb1f9e5ebae57e98c634">B43_LPPHY_RX_RADIO_CTL</a>,
<a name="l00270"></a>00270                         0xFFF9, (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ae118bf9d1e496d50c585183b4a63e11b">bx_arch</a> &lt;&lt; 1));
<a name="l00271"></a>00271         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 1 &amp;&amp;
<a name="l00272"></a>00272            (sprom-&gt;boardflags_hi &amp; <a class="code" href="b43_8h.html#afff688f1996d05e719b2a1a73686d664">B43_BFH_FEM_BT</a>)) {
<a name="l00273"></a>00273                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0xFFC0, 0x000A);
<a name="l00274"></a>00274                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0x3F00, 0x0900);
<a name="l00275"></a>00275                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xFFC0, 0x000A);
<a name="l00276"></a>00276                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xC0FF, 0x0B00);
<a name="l00277"></a>00277                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xFFC0, 0x000A);
<a name="l00278"></a>00278                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xC0FF, 0x0400);
<a name="l00279"></a>00279                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xFFC0, 0x000A);
<a name="l00280"></a>00280                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xC0FF, 0x0B00);
<a name="l00281"></a>00281                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aaaac80157e57083153c09e1f3ad0174d">B43_LPPHY_TR_LOOKUP_5</a>, 0xFFC0, 0x000A);
<a name="l00282"></a>00282                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aaaac80157e57083153c09e1f3ad0174d">B43_LPPHY_TR_LOOKUP_5</a>, 0xC0FF, 0x0900);
<a name="l00283"></a>00283                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#afe3b251d37d7fde29e368cdad2288542">B43_LPPHY_TR_LOOKUP_6</a>, 0xFFC0, 0x000A);
<a name="l00284"></a>00284                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#afe3b251d37d7fde29e368cdad2288542">B43_LPPHY_TR_LOOKUP_6</a>, 0xC0FF, 0x0B00);
<a name="l00285"></a>00285                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a402493512355eece37bc92fdadbc1142">B43_LPPHY_TR_LOOKUP_7</a>, 0xFFC0, 0x000A);
<a name="l00286"></a>00286                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a402493512355eece37bc92fdadbc1142">B43_LPPHY_TR_LOOKUP_7</a>, 0xC0FF, 0x0900);
<a name="l00287"></a>00287                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a368817a6305ecc52f915381f8eab71a2">B43_LPPHY_TR_LOOKUP_8</a>, 0xFFC0, 0x000A);
<a name="l00288"></a>00288                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a368817a6305ecc52f915381f8eab71a2">B43_LPPHY_TR_LOOKUP_8</a>, 0xC0FF, 0x0B00);
<a name="l00289"></a>00289         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_5GHZ ||
<a name="l00290"></a>00290                   (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a8225eee827fd5a0c40849625fbf88330">board_type</a> == 0x048A) || ((dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 0) &amp;&amp;
<a name="l00291"></a>00291                   (sprom-&gt;boardflags_lo &amp; <a class="code" href="b43_8h.html#ad642a17fff65edbb5565f43995fe78ca">B43_BFL_FEM</a>))) {
<a name="l00292"></a>00292                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0xFFC0, 0x0001);
<a name="l00293"></a>00293                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0xC0FF, 0x0400);
<a name="l00294"></a>00294                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xFFC0, 0x0001);
<a name="l00295"></a>00295                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xC0FF, 0x0500);
<a name="l00296"></a>00296                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xFFC0, 0x0002);
<a name="l00297"></a>00297                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xC0FF, 0x0800);
<a name="l00298"></a>00298                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xFFC0, 0x0002);
<a name="l00299"></a>00299                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xC0FF, 0x0A00);
<a name="l00300"></a>00300         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 1 ||
<a name="l00301"></a>00301                   (sprom-&gt;boardflags_lo &amp; <a class="code" href="b43_8h.html#ad642a17fff65edbb5565f43995fe78ca">B43_BFL_FEM</a>)) {
<a name="l00302"></a>00302                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0xFFC0, 0x0004);
<a name="l00303"></a>00303                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0xC0FF, 0x0800);
<a name="l00304"></a>00304                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xFFC0, 0x0004);
<a name="l00305"></a>00305                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xC0FF, 0x0C00);
<a name="l00306"></a>00306                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xFFC0, 0x0002);
<a name="l00307"></a>00307                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xC0FF, 0x0100);
<a name="l00308"></a>00308                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xFFC0, 0x0002);
<a name="l00309"></a>00309                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xC0FF, 0x0300);
<a name="l00310"></a>00310         } <span class="keywordflow">else</span> {
<a name="l00311"></a>00311                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0xFFC0, 0x000A);
<a name="l00312"></a>00312                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0xC0FF, 0x0900);
<a name="l00313"></a>00313                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xFFC0, 0x000A);
<a name="l00314"></a>00314                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>, 0xC0FF, 0x0B00);
<a name="l00315"></a>00315                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xFFC0, 0x0006);
<a name="l00316"></a>00316                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>, 0xC0FF, 0x0500);
<a name="l00317"></a>00317                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xFFC0, 0x0006);
<a name="l00318"></a>00318                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>, 0xC0FF, 0x0700);
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 1 &amp;&amp; (sprom-&gt;boardflags_hi &amp; <a class="code" href="b43_8h.html#a68b570d554e47a62983f201375e82152">B43_BFH_PAREF</a>)) {
<a name="l00321"></a>00321                 <a class="code" href="phy__common_8c.html#a7f6accd2de2c16a2ef2e36e4098c28ce">b43_phy_copy</a>(dev, <a class="code" href="phy__lp_8h.html#aaaac80157e57083153c09e1f3ad0174d">B43_LPPHY_TR_LOOKUP_5</a>, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>);
<a name="l00322"></a>00322                 <a class="code" href="phy__common_8c.html#a7f6accd2de2c16a2ef2e36e4098c28ce">b43_phy_copy</a>(dev, <a class="code" href="phy__lp_8h.html#afe3b251d37d7fde29e368cdad2288542">B43_LPPHY_TR_LOOKUP_6</a>, <a class="code" href="phy__lp_8h.html#aa948cce73955fe9f6e8e70f609062974">B43_LPPHY_TR_LOOKUP_2</a>);
<a name="l00323"></a>00323                 <a class="code" href="phy__common_8c.html#a7f6accd2de2c16a2ef2e36e4098c28ce">b43_phy_copy</a>(dev, <a class="code" href="phy__lp_8h.html#a402493512355eece37bc92fdadbc1142">B43_LPPHY_TR_LOOKUP_7</a>, <a class="code" href="phy__lp_8h.html#a95fbbf19bd11bf7a009303c7e637039a">B43_LPPHY_TR_LOOKUP_3</a>);
<a name="l00324"></a>00324                 <a class="code" href="phy__common_8c.html#a7f6accd2de2c16a2ef2e36e4098c28ce">b43_phy_copy</a>(dev, <a class="code" href="phy__lp_8h.html#a368817a6305ecc52f915381f8eab71a2">B43_LPPHY_TR_LOOKUP_8</a>, <a class="code" href="phy__lp_8h.html#aef159fce1fce330f87d86d6e868e6302">B43_LPPHY_TR_LOOKUP_4</a>);
<a name="l00325"></a>00325         }
<a name="l00326"></a>00326         <span class="keywordflow">if</span> ((sprom-&gt;boardflags_hi &amp; <a class="code" href="b43_8h.html#afff688f1996d05e719b2a1a73686d664">B43_BFH_FEM_BT</a>) &amp;&amp;
<a name="l00327"></a>00327             (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x5354) &amp;&amp;
<a name="l00328"></a>00328             (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a314773125c4f88623863b065bf5f96d8">chip_pkg</a> == SSB_CHIPPACK_BCM4712S)) {
<a name="l00329"></a>00329                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0x0006);
<a name="l00330"></a>00330                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a489b77e9a239b3449630142aff27d86b">B43_LPPHY_GPIO_SELECT</a>, 0x0005);
<a name="l00331"></a>00331                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#ab2e85446c499e1af01241539df339117">B43_LPPHY_GPIO_OUTEN</a>, 0xFFFF);
<a name="l00332"></a>00332                 <span class="comment">//FIXME the Broadcom driver caches &amp; delays this HF write!</span>
<a name="l00333"></a>00333                 <a class="code" href="main_8c.html#abbb7dc97d3d48c3504e1c35b366407ad">b43_hf_write</a>(dev, <a class="code" href="main_8c.html#a3f3a1d36e1882927e495fa890efbbe97">b43_hf_read</a>(dev) | <a class="code" href="b43_8h.html#a277db86aed5508eae47def7663d5e051">B43_HF_PR45960W</a>);
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l00336"></a>00336                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0x8000);
<a name="l00337"></a>00337                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0x0040);
<a name="l00338"></a>00338                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa0b0aa16f29a011440221f9902c95cab">B43_LPPHY_MINPWR_LEVEL</a>, 0x00FF, 0xA400);
<a name="l00339"></a>00339                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0xF0FF, 0x0B00);
<a name="l00340"></a>00340                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a714a5edf7b21283d15fe7f52953d5ab2">B43_LPPHY_SYNCPEAKCNT</a>, 0xFFF8, 0x0007);
<a name="l00341"></a>00341                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8100aad6ee32620dda85f1a8ecc72187">B43_LPPHY_DSSS_CONFIRM_CNT</a>, 0xFFF8, 0x0003);
<a name="l00342"></a>00342                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8100aad6ee32620dda85f1a8ecc72187">B43_LPPHY_DSSS_CONFIRM_CNT</a>, 0xFFC7, 0x0020);
<a name="l00343"></a>00343                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a0d698891252bd50057ee19ab2f6c20ac">B43_LPPHY_IDLEAFTERPKTRXTO</a>, 0x00FF);
<a name="l00344"></a>00344         } <span class="keywordflow">else</span> { <span class="comment">/* 5GHz */</span>
<a name="l00345"></a>00345                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0x7FFF);
<a name="l00346"></a>00346                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0xFFBF);
<a name="l00347"></a>00347         }
<a name="l00348"></a>00348         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 1) {
<a name="l00349"></a>00349                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>);
<a name="l00350"></a>00350                 tmp2 = (tmp &amp; 0x03E0) &gt;&gt; 5;
<a name="l00351"></a>00351                 tmp2 |= tmp2 &lt;&lt; 5;
<a name="l00352"></a>00352                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a4a51ab5c28ac9bae4ea6801c8cc0a5c8">B43_LPPHY_4C3</a>, tmp2);
<a name="l00353"></a>00353                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#ad949f9a1bdf3ef5c2ce39e0a4e8526cd">B43_LPPHY_GAINDIRECTMISMATCH</a>);
<a name="l00354"></a>00354                 tmp2 = (tmp &amp; 0x1F00) &gt;&gt; 8;
<a name="l00355"></a>00355                 tmp2 |= tmp2 &lt;&lt; 5;
<a name="l00356"></a>00356                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a8d8a1999b1768372a1efb120c948cc37">B43_LPPHY_4C4</a>, tmp2);
<a name="l00357"></a>00357                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a53f8ab0e087c3595fe0fc30201a0ca67">B43_LPPHY_VERYLOWGAINDB</a>);
<a name="l00358"></a>00358                 tmp2 = tmp &amp; 0x00FF;
<a name="l00359"></a>00359                 tmp2 |= tmp &lt;&lt; 8;
<a name="l00360"></a>00360                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9cea49c23066f59dd474786a362604e7">B43_LPPHY_4C5</a>, tmp2);
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a><a class="code" href="phy__lp_8c.html#a4c905d90da2dd74c07ca78d6d1db3d9c">00364</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a4c905d90da2dd74c07ca78d6d1db3d9c">lpphy_save_dig_flt_state</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366         <span class="keyword">static</span> <span class="keyword">const</span> u16 addr[] = {
<a name="l00367"></a>00367                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC1),
<a name="l00368"></a>00368                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC2),
<a name="l00369"></a>00369                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC3),
<a name="l00370"></a>00370                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC4),
<a name="l00371"></a>00371                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC5),
<a name="l00372"></a>00372                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC6),
<a name="l00373"></a>00373                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC7),
<a name="l00374"></a>00374                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC8),
<a name="l00375"></a>00375                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xCF),
<a name="l00376"></a>00376         };
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <span class="keyword">static</span> <span class="keyword">const</span> u16 coefs[] = {
<a name="l00379"></a>00379                 0xDE5E, 0xE832, 0xE331, 0x4D26,
<a name="l00380"></a>00380                 0x0026, 0x1420, 0x0020, 0xFE08,
<a name="l00381"></a>00381                 0x0008,
<a name="l00382"></a>00382         };
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00385"></a>00385         <span class="keywordtype">int</span> i;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(addr); i++) {
<a name="l00388"></a>00388                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a8d810786ebaa8000ec0acd9962998054">dig_flt_state</a>[i] = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, addr[i]);
<a name="l00389"></a>00389                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, addr[i], coefs[i]);
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a><a class="code" href="phy__lp_8c.html#a5df91dba978a23a5d1118401cb142b6c">00393</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a5df91dba978a23a5d1118401cb142b6c">lpphy_restore_dig_flt_state</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395         <span class="keyword">static</span> <span class="keyword">const</span> u16 addr[] = {
<a name="l00396"></a>00396                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC1),
<a name="l00397"></a>00397                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC2),
<a name="l00398"></a>00398                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC3),
<a name="l00399"></a>00399                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC4),
<a name="l00400"></a>00400                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC5),
<a name="l00401"></a>00401                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC6),
<a name="l00402"></a>00402                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC7),
<a name="l00403"></a>00403                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xC8),
<a name="l00404"></a>00404                 <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xCF),
<a name="l00405"></a>00405         };
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00408"></a>00408         <span class="keywordtype">int</span> i;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(addr); i++)
<a name="l00411"></a>00411                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, addr[i], lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a8d810786ebaa8000ec0acd9962998054">dig_flt_state</a>[i]);
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a><a class="code" href="phy__lp_8c.html#ac29bd3913ded677d7f44bf4bc512f038">00414</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ac29bd3913ded677d7f44bf4bc512f038">lpphy_baseband_rev2plus_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00415"></a>00415 {
<a name="l00416"></a>00416         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1d2d2cede732b9df98e903db6f8febce">B43_LPPHY_AFE_DAC_CTL</a>, 0x50);
<a name="l00419"></a>00419         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1cbeb141c0757c1ee38751e538c9cdb4">B43_LPPHY_AFE_CTL</a>, 0x8800);
<a name="l00420"></a>00420         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0);
<a name="l00421"></a>00421         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>, 0);
<a name="l00422"></a>00422         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0);
<a name="l00423"></a>00423         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0);
<a name="l00424"></a>00424         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xF9), 0);
<a name="l00425"></a>00425         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a62ad159ded8724f1baa8ed700544e290">B43_LPPHY_TR_LOOKUP_1</a>, 0);
<a name="l00426"></a>00426         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a7aa61c58d6a0eb578bb68c9692c25fb9">B43_LPPHY_ADC_COMPENSATION_CTL</a>, 0x10);
<a name="l00427"></a>00427         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a48d164f4e365aa6179d39587a752f362">B43_LPPHY_OFDMSYNCTHRESH0</a>, 0xFF00, 0xB4);
<a name="l00428"></a>00428         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a79461e93cef99c4f86328e91d4aa7807">B43_LPPHY_DCOFFSETTRANSIENT</a>, 0xF8FF, 0x200);
<a name="l00429"></a>00429         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a79461e93cef99c4f86328e91d4aa7807">B43_LPPHY_DCOFFSETTRANSIENT</a>, 0xFF00, 0x7F);
<a name="l00430"></a>00430         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ad949f9a1bdf3ef5c2ce39e0a4e8526cd">B43_LPPHY_GAINDIRECTMISMATCH</a>, 0xFF0F, 0x40);
<a name="l00431"></a>00431         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a4641ba82aaea08a9c4b0ea84711d211e">B43_LPPHY_PREAMBLECONFIRMTO</a>, 0xFF00, 0x2);
<a name="l00432"></a>00432         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, ~0x4000);
<a name="l00433"></a>00433         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, ~0x2000);
<a name="l00434"></a>00434         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x10A), 0x1);
<a name="l00435"></a>00435         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a88860ae223915f56e0ab6eb933369046">board_rev</a> &gt;= 0x18) {
<a name="l00436"></a>00436                 <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(17, 65), 0xEC);
<a name="l00437"></a>00437                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x10A), 0xFF01, 0x14);
<a name="l00438"></a>00438         } <span class="keywordflow">else</span> {
<a name="l00439"></a>00439                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x10A), 0xFF01, 0x10);
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xDF), 0xFF00, 0xF4);
<a name="l00442"></a>00442         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xDF), 0x00FF, 0xF100);
<a name="l00443"></a>00443         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a8e40c40aa642a1be3c2d70033fb69d69">B43_LPPHY_CLIPTHRESH</a>, 0x48);
<a name="l00444"></a>00444         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8d70791e078cab68f7bf5cc83a2985b4">B43_LPPHY_HIGAINDB</a>, 0xFF00, 0x46);
<a name="l00445"></a>00445         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xE4), 0xFF00, 0x10);
<a name="l00446"></a>00446         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8421caf8449a3b330c46ecc8bc48f6c8">B43_LPPHY_PWR_THRESH1</a>, 0xFFF0, 0x9);
<a name="l00447"></a>00447         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ad949f9a1bdf3ef5c2ce39e0a4e8526cd">B43_LPPHY_GAINDIRECTMISMATCH</a>, ~0xF);
<a name="l00448"></a>00448         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53f8ab0e087c3595fe0fc30201a0ca67">B43_LPPHY_VERYLOWGAINDB</a>, 0x00FF, 0x5500);
<a name="l00449"></a>00449         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>, 0xFC1F, 0xA0);
<a name="l00450"></a>00450         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ad949f9a1bdf3ef5c2ce39e0a4e8526cd">B43_LPPHY_GAINDIRECTMISMATCH</a>, 0xE0FF, 0x300);
<a name="l00451"></a>00451         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8d70791e078cab68f7bf5cc83a2985b4">B43_LPPHY_HIGAINDB</a>, 0x00FF, 0x2A00);
<a name="l00452"></a>00452         <span class="keywordflow">if</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x4325) &amp;&amp; (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a4d3f6ec287090116d644ff47445b3208">chip_rev</a> == 0)) {
<a name="l00453"></a>00453                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53d2ef71fa09db975967e131b02d107a">B43_LPPHY_LOWGAINDB</a>, 0x00FF, 0x2100);
<a name="l00454"></a>00454                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53f8ab0e087c3595fe0fc30201a0ca67">B43_LPPHY_VERYLOWGAINDB</a>, 0xFF00, 0xA);
<a name="l00455"></a>00455         } <span class="keywordflow">else</span> {
<a name="l00456"></a>00456                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53d2ef71fa09db975967e131b02d107a">B43_LPPHY_LOWGAINDB</a>, 0x00FF, 0x1E00);
<a name="l00457"></a>00457                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a53f8ab0e087c3595fe0fc30201a0ca67">B43_LPPHY_VERYLOWGAINDB</a>, 0xFF00, 0xD);
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFE), 0xFFE0, 0x1F);
<a name="l00460"></a>00460         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFF), 0xFFE0, 0xC);
<a name="l00461"></a>00461         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x100), 0xFF00, 0x19);
<a name="l00462"></a>00462         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFF), 0x03FF, 0x3C00);
<a name="l00463"></a>00463         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFE), 0xFC1F, 0x3E0);
<a name="l00464"></a>00464         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFF), 0xFFE0, 0xC);
<a name="l00465"></a>00465         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x100), 0x00FF, 0x1900);
<a name="l00466"></a>00466         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>, 0x83FF, 0x5800);
<a name="l00467"></a>00467         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa57809884f87497e4f4f70a59b57ed9f">B43_LPPHY_CLIPCTRTHRESH</a>, 0xFFE0, 0x12);
<a name="l00468"></a>00468         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a380be63bd6dfadd81bf0da7a1ac45235">B43_LPPHY_GAINMISMATCH</a>, 0x0FFF, 0x9000);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470         <span class="keywordflow">if</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x4325) &amp;&amp; (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a4d3f6ec287090116d644ff47445b3208">chip_rev</a> == 0)) {
<a name="l00471"></a>00471                 <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(0x08, 0x14), 0);
<a name="l00472"></a>00472                 <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(0x08, 0x12), 0x40);
<a name="l00473"></a>00473         }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l00476"></a>00476                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0x40);
<a name="l00477"></a>00477                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0xF0FF, 0xB00);
<a name="l00478"></a>00478                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a714a5edf7b21283d15fe7f52953d5ab2">B43_LPPHY_SYNCPEAKCNT</a>, 0xFFF8, 0x6);
<a name="l00479"></a>00479                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa0b0aa16f29a011440221f9902c95cab">B43_LPPHY_MINPWR_LEVEL</a>, 0x00FF, 0x9D00);
<a name="l00480"></a>00480                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa0b0aa16f29a011440221f9902c95cab">B43_LPPHY_MINPWR_LEVEL</a>, 0xFF00, 0xA1);
<a name="l00481"></a>00481                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a0d698891252bd50057ee19ab2f6c20ac">B43_LPPHY_IDLEAFTERPKTRXTO</a>, 0x00FF);
<a name="l00482"></a>00482         } <span class="keywordflow">else</span> <span class="comment">/* 5GHz */</span>
<a name="l00483"></a>00483                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, ~0x40);
<a name="l00484"></a>00484 
<a name="l00485"></a>00485         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab5354bb28613f2efee6ce2078b62b3ae">B43_LPPHY_CRS_ED_THRESH</a>, 0xFF00, 0xB3);
<a name="l00486"></a>00486         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab5354bb28613f2efee6ce2078b62b3ae">B43_LPPHY_CRS_ED_THRESH</a>, 0x00FF, 0xAD00);
<a name="l00487"></a>00487         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac35a20aa058aa18df28eea06109b11dd">B43_LPPHY_INPUT_PWRDB</a>, 0xFF00, lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aca97c651c994b9fab19d9a2a7d02f24c">rx_pwr_offset</a>);
<a name="l00488"></a>00488         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a9f177bbd2c32adddfd0187ffeecec1bf">B43_LPPHY_RESET_CTL</a>, 0x44);
<a name="l00489"></a>00489         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9f177bbd2c32adddfd0187ffeecec1bf">B43_LPPHY_RESET_CTL</a>, 0x80);
<a name="l00490"></a>00490         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a3688173da898e0383e51a40edb831379">B43_LPPHY_AFE_RSSI_CTL_0</a>, 0xA954);
<a name="l00491"></a>00491         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a8171e79c858e52b59e328f7ba6ce8aa3">B43_LPPHY_AFE_RSSI_CTL_1</a>,
<a name="l00492"></a>00492                       0x2000 | ((u16)lpphy-&gt;<a class="code" href="structb43__phy__lp.html#af248c0f7ad9c57c7f62f3304e55f2467">rssi_gs</a> &lt;&lt; 10) |
<a name="l00493"></a>00493                       ((u16)lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a735be89f56787b430e86119c12e8d2d6">rssi_vc</a> &lt;&lt; 4) | lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a98ebf7e3d0e0a2665ffae50231d15147">rssi_vf</a>);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495         <span class="keywordflow">if</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x4325) &amp;&amp; (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a4d3f6ec287090116d644ff47445b3208">chip_rev</a> == 0)) {
<a name="l00496"></a>00496                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a3fd1328c812134de3fc243ae36d4bf29">B43_LPPHY_AFE_ADC_CTL_0</a>, 0x1C);
<a name="l00497"></a>00497                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a1cbeb141c0757c1ee38751e538c9cdb4">B43_LPPHY_AFE_CTL</a>, 0x00FF, 0x8800);
<a name="l00498"></a>00498                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a878b813c3595c6d07e075f190ede9a72">B43_LPPHY_AFE_ADC_CTL_1</a>, 0xFC3C, 0x0400);
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <a class="code" href="phy__lp_8c.html#a4c905d90da2dd74c07ca78d6d1db3d9c">lpphy_save_dig_flt_state</a>(dev);
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a><a class="code" href="phy__lp_8c.html#a2a19134a4b2f53e365096b848b6443cc">00504</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a2a19134a4b2f53e365096b848b6443cc">lpphy_baseband_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00505"></a>00505 {
<a name="l00506"></a>00506         <a class="code" href="phy__lp_8c.html#af6014b2353ab5831819938bebce43202">lpphy_table_init</a>(dev);
<a name="l00507"></a>00507         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2)
<a name="l00508"></a>00508                 <a class="code" href="phy__lp_8c.html#ac29bd3913ded677d7f44bf4bc512f038">lpphy_baseband_rev2plus_init</a>(dev);
<a name="l00509"></a>00509         <span class="keywordflow">else</span>
<a name="l00510"></a>00510                 <a class="code" href="phy__lp_8c.html#ada6fbedb65cde4d7b9994175c7ec8b5e">lpphy_baseband_rev0_1_init</a>(dev);
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00513"></a><a class="code" href="structb2062__freqdata.html">00513</a> <span class="keyword">struct </span><a class="code" href="structb2062__freqdata.html">b2062_freqdata</a> {
<a name="l00514"></a><a class="code" href="structb2062__freqdata.html#a5fe6d56a4dc0101c3a9ab4e8119ed110">00514</a>         u16 <a class="code" href="structb2062__freqdata.html#a5fe6d56a4dc0101c3a9ab4e8119ed110">freq</a>;
<a name="l00515"></a><a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">00515</a>         u8 <a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">data</a>[6];
<a name="l00516"></a>00516 };
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 <span class="comment">/* Initialize the 2062 radio. */</span>
<a name="l00519"></a><a class="code" href="phy__lp_8c.html#ab17de2bc93181a36cc51bb6dd334369b">00519</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ab17de2bc93181a36cc51bb6dd334369b">lpphy_2062_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00520"></a>00520 {
<a name="l00521"></a>00521         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00522"></a>00522         <span class="keyword">struct </span>ssb_bus *bus = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a68f9a4660126ada1510b28be93e1dd0d">sdev</a>-&gt;bus;
<a name="l00523"></a>00523         u32 crystalfreq, tmp, ref;
<a name="l00524"></a>00524         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00525"></a>00525         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb2062__freqdata.html">b2062_freqdata</a> *fd = NULL;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb2062__freqdata.html">b2062_freqdata</a> freqdata_tab[] = {
<a name="l00528"></a>00528                 { .<a class="code" href="structb2062__freqdata.html#a5fe6d56a4dc0101c3a9ab4e8119ed110">freq</a> = 12000, .data[0] =  6, .data[1] =  6, .data[2] =  6,
<a name="l00529"></a>00529                                  .data[3] =  6, .data[4] = 10, .data[5] =  6, },
<a name="l00530"></a>00530                 { .freq = 13000, .data[0] =  4, .data[1] =  4, .data[2] =  4,
<a name="l00531"></a>00531                                  .data[3] =  4, .data[4] = 11, .data[5] =  7, },
<a name="l00532"></a>00532                 { .freq = 14400, .data[0] =  3, .data[1] =  3, .data[2] =  3,
<a name="l00533"></a>00533                                  .data[3] =  3, .data[4] = 12, .data[5] =  7, },
<a name="l00534"></a>00534                 { .freq = 16200, .data[0] =  3, .data[1] =  3, .data[2] =  3,
<a name="l00535"></a>00535                                  .data[3] =  3, .data[4] = 13, .data[5] =  8, },
<a name="l00536"></a>00536                 { .freq = 18000, .data[0] =  2, .data[1] =  2, .data[2] =  2,
<a name="l00537"></a>00537                                  .data[3] =  2, .data[4] = 14, .data[5] =  8, },
<a name="l00538"></a>00538                 { .freq = 19200, .data[0] =  1, .data[1] =  1, .data[2] =  1,
<a name="l00539"></a>00539                                  .data[3] =  1, .data[4] = 14, .data[5] =  9, },
<a name="l00540"></a>00540         };
<a name="l00541"></a>00541 
<a name="l00542"></a>00542         <a class="code" href="tables__lpphy_8c.html#aad43874b4db6e695298c70e87a5b778a">b2062_upload_init_table</a>(dev);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9051457d1d3276f49e79a02449e21175">B2062_N_TX_CTL3</a>, 0);
<a name="l00545"></a>00545         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a5db6bf02080f4f4598220a739206ace8">B2062_N_TX_CTL4</a>, 0);
<a name="l00546"></a>00546         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a62abf5eb8f60e325aa1b0af8c385b51a">B2062_N_TX_CTL5</a>, 0);
<a name="l00547"></a>00547         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae44c3f8c8a77dd217585f5eac409f715">B2062_N_TX_CTL6</a>, 0);
<a name="l00548"></a>00548         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a146e02372ba83465543128c739f5dc12">B2062_N_PDN_CTL0</a>, 0x40);
<a name="l00549"></a>00549         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a146e02372ba83465543128c739f5dc12">B2062_N_PDN_CTL0</a>, 0);
<a name="l00550"></a>00550         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a8a1e445b18c3b535baf846aee9d69ec3">B2062_N_CALIB_TS</a>, 0x10);
<a name="l00551"></a>00551         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a8a1e445b18c3b535baf846aee9d69ec3">B2062_N_CALIB_TS</a>, 0);
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt; 0) {
<a name="l00553"></a>00553                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa6d15c73e007e11768d27a873ce650fb">B2062_S_BG_CTL1</a>,
<a name="l00554"></a>00554                         (<a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#aa48111a3372e00bb206766b58324bc43">B2062_N_COMM2</a>) &gt;&gt; 1) | 0x80);
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l00557"></a>00557                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a8228682d9566301be2eb2bd0e5396a2c">B2062_N_TSSI_CTL0</a>, 0x1);
<a name="l00558"></a>00558         <span class="keywordflow">else</span>
<a name="l00559"></a>00559                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a8228682d9566301be2eb2bd0e5396a2c">B2062_N_TSSI_CTL0</a>, ~0x1);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         <span class="comment">/* Get the crystal freq, in Hz. */</span>
<a name="l00562"></a>00562         crystalfreq = bus-&gt;chipco.pmu.crystalfreq * 1000;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(!(bus-&gt;chipco.capabilities &amp; SSB_CHIPCO_CAP_PMU));
<a name="l00565"></a>00565         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(crystalfreq == 0);
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         <span class="keywordflow">if</span> (crystalfreq &lt;= 30000000) {
<a name="l00568"></a>00568                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a> = 1;
<a name="l00569"></a>00569                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a21c5126fd22d68b6404123e7b52cd2bb">B2062_S_RFPLL_CTL1</a>, 0xFFFB);
<a name="l00570"></a>00570         } <span class="keywordflow">else</span> {
<a name="l00571"></a>00571                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a> = 2;
<a name="l00572"></a>00572                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a21c5126fd22d68b6404123e7b52cd2bb">B2062_S_RFPLL_CTL1</a>, 0x4);
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         tmp = (((800000000 * lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a> + crystalfreq) /
<a name="l00576"></a>00576               (2 * crystalfreq)) - 8) &amp; 0xFF;
<a name="l00577"></a>00577         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aeee384b564d81d5abd58f079946b903e">B2062_S_RFPLL_CTL7</a>, tmp);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579         tmp = (((100 * crystalfreq + 16000000 * lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a>) /
<a name="l00580"></a>00580               (32000000 * lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a>)) - 1) &amp; 0xFF;
<a name="l00581"></a>00581         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#af310ddbc1f5752dbd558dc410de16fa5">B2062_S_RFPLL_CTL18</a>, tmp);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         tmp = (((2 * crystalfreq + 1000000 * lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a>) /
<a name="l00584"></a>00584               (2000000 * lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a>)) - 1) &amp; 0xFF;
<a name="l00585"></a>00585         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a5631afd5fca8d5dc8ddac2a45b8e706f">B2062_S_RFPLL_CTL19</a>, tmp);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587         ref = (1000 * lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a> + 2 * crystalfreq) / (2000 * lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a>);
<a name="l00588"></a>00588         ref &amp;= 0xFFFF;
<a name="l00589"></a>00589         <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(freqdata_tab); i++) {
<a name="l00590"></a>00590                 <span class="keywordflow">if</span> (ref &lt; freqdata_tab[i].<a class="code" href="structb2062__freqdata.html#a5fe6d56a4dc0101c3a9ab4e8119ed110">freq</a>) {
<a name="l00591"></a>00591                         fd = &amp;freqdata_tab[i];
<a name="l00592"></a>00592                         <span class="keywordflow">break</span>;
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595         <span class="keywordflow">if</span> (!fd)
<a name="l00596"></a>00596                 fd = &amp;freqdata_tab[ARRAY_SIZE(freqdata_tab) - 1];
<a name="l00597"></a>00597         <a class="code" href="main_8c.html#ac3164e7d1ba2fbd05fce755cdb232382">b43dbg</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;b2062: Using crystal tab entry %u kHz.\n&quot;</span>,
<a name="l00598"></a>00598                fd-&gt;<a class="code" href="structb2062__freqdata.html#a5fe6d56a4dc0101c3a9ab4e8119ed110">freq</a>); <span class="comment">/* FIXME: Keep this printk until the code is fully debugged. */</span>
<a name="l00599"></a>00599 
<a name="l00600"></a>00600         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a30a30d33846fa97421e736d6ceaa0216">B2062_S_RFPLL_CTL8</a>,
<a name="l00601"></a>00601                         ((u16)(fd-&gt;<a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">data</a>[1]) &lt;&lt; 4) | fd-&gt;<a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">data</a>[0]);
<a name="l00602"></a>00602         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ad5153eaa19c17814082facfe6c4fd532">B2062_S_RFPLL_CTL9</a>,
<a name="l00603"></a>00603                         ((u16)(fd-&gt;<a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">data</a>[3]) &lt;&lt; 4) | fd-&gt;<a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">data</a>[2]);
<a name="l00604"></a>00604         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac4b3d22750b5a30ff5ce8dd558356736">B2062_S_RFPLL_CTL10</a>, fd-&gt;<a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">data</a>[4]);
<a name="l00605"></a>00605         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a05dff3e972fea1e8d40c17b7230c8c94">B2062_S_RFPLL_CTL11</a>, fd-&gt;<a class="code" href="structb2062__freqdata.html#a0d775c72c76a3bc6dae80c111e89e443">data</a>[5]);
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 <span class="comment">/* Initialize the 2063 radio. */</span>
<a name="l00609"></a><a class="code" href="phy__lp_8c.html#aea1e353fd11b101a957e5620dfdd1565">00609</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aea1e353fd11b101a957e5620dfdd1565">lpphy_2063_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611         <a class="code" href="tables__lpphy_8c.html#aebe2389b52dfb81007feb47df5ca58b7">b2063_upload_init_table</a>(dev);
<a name="l00612"></a>00612         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a21c0a29e03b1865ef2e657643ab49713">B2063_LOGEN_SP5</a>, 0);
<a name="l00613"></a>00613         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a229f3d7ba22953c696c551b68f16a7ad">B2063_COMM8</a>, 0x38);
<a name="l00614"></a>00614         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac0852eccc8b88d3685762a25129907b8">B2063_REG_SP1</a>, 0x56);
<a name="l00615"></a>00615         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#af12348681256d84028977421ea8c85ac">B2063_RX_BB_CTL2</a>, ~0x2);
<a name="l00616"></a>00616         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9d6b6ee9df89b72bbb80d571d3aca1a2">B2063_PA_SP7</a>, 0);
<a name="l00617"></a>00617         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ab4fcf23066f716bd39fc0149f4a87fd2">B2063_TX_RF_SP6</a>, 0x20);
<a name="l00618"></a>00618         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a32e9568d384d14bb171a79f956bba6a9">B2063_TX_RF_SP9</a>, 0x40);
<a name="l00619"></a>00619         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 2) {
<a name="l00620"></a>00620                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#acd1ad105cdf9bdbc77dcf9887a1c2d93">B2063_PA_SP3</a>, 0xa0);
<a name="l00621"></a>00621                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a5abe98682616f85766e8f3721ba5c9e5">B2063_PA_SP4</a>, 0xa0);
<a name="l00622"></a>00622                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a846b9a53a70d12406c5a31e9b76853a4">B2063_PA_SP2</a>, 0x18);
<a name="l00623"></a>00623         } <span class="keywordflow">else</span> {
<a name="l00624"></a>00624                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#acd1ad105cdf9bdbc77dcf9887a1c2d93">B2063_PA_SP3</a>, 0x20);
<a name="l00625"></a>00625                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a846b9a53a70d12406c5a31e9b76853a4">B2063_PA_SP2</a>, 0x20);
<a name="l00626"></a>00626         }
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a><a class="code" href="structlpphy__stx__table__entry.html">00629</a> <span class="keyword">struct </span><a class="code" href="structlpphy__stx__table__entry.html">lpphy_stx_table_entry</a> {
<a name="l00630"></a><a class="code" href="structlpphy__stx__table__entry.html#ae96f3ac8befb1d9ce04f63c03094c007">00630</a>         u16 <a class="code" href="structlpphy__stx__table__entry.html#ae96f3ac8befb1d9ce04f63c03094c007">phy_offset</a>;
<a name="l00631"></a><a class="code" href="structlpphy__stx__table__entry.html#ad56a6de3bbbb24187f22a4ccf2978fb4">00631</a>         u16 <a class="code" href="structlpphy__stx__table__entry.html#ad56a6de3bbbb24187f22a4ccf2978fb4">phy_shift</a>;
<a name="l00632"></a><a class="code" href="structlpphy__stx__table__entry.html#ae2950e764b3e82f7251cb0419506a68c">00632</a>         u16 <a class="code" href="structlpphy__stx__table__entry.html#ae2950e764b3e82f7251cb0419506a68c">rf_addr</a>;
<a name="l00633"></a><a class="code" href="structlpphy__stx__table__entry.html#a5cd8f5869044fc4351df407c2893feca">00633</a>         u16 <a class="code" href="structlpphy__stx__table__entry.html#a5cd8f5869044fc4351df407c2893feca">rf_shift</a>;
<a name="l00634"></a><a class="code" href="structlpphy__stx__table__entry.html#aaaa37ee955f527b1d7c5a338417a28fa">00634</a>         u16 <a class="code" href="structlpphy__stx__table__entry.html#aaaa37ee955f527b1d7c5a338417a28fa">mask</a>;
<a name="l00635"></a>00635 };
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="phy__lp_8c.html#ae8e69b76bbde61d7aea1e51f5e9dee4a">00637</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlpphy__stx__table__entry.html">lpphy_stx_table_entry</a> <a class="code" href="phy__lp_8c.html#ae8e69b76bbde61d7aea1e51f5e9dee4a">lpphy_stx_table</a>[] = {
<a name="l00638"></a>00638         { .<a class="code" href="structlpphy__stx__table__entry.html#ae96f3ac8befb1d9ce04f63c03094c007">phy_offset</a> = 2, .phy_shift = 6, .rf_addr = 0x3d, .rf_shift = 3, .mask = 0x01, },
<a name="l00639"></a>00639         { .phy_offset = 1, .phy_shift = 12, .rf_addr = 0x4c, .rf_shift = 1, .mask = 0x01, },
<a name="l00640"></a>00640         { .phy_offset = 1, .phy_shift = 8, .rf_addr = 0x50, .rf_shift = 0, .mask = 0x7f, },
<a name="l00641"></a>00641         { .phy_offset = 0, .phy_shift = 8, .rf_addr = 0x44, .rf_shift = 0, .mask = 0xff, },
<a name="l00642"></a>00642         { .phy_offset = 1, .phy_shift = 0, .rf_addr = 0x4a, .rf_shift = 0, .mask = 0xff, },
<a name="l00643"></a>00643         { .phy_offset = 0, .phy_shift = 4, .rf_addr = 0x4d, .rf_shift = 0, .mask = 0xff, },
<a name="l00644"></a>00644         { .phy_offset = 1, .phy_shift = 4, .rf_addr = 0x4e, .rf_shift = 0, .mask = 0xff, },
<a name="l00645"></a>00645         { .phy_offset = 0, .phy_shift = 12, .rf_addr = 0x4f, .rf_shift = 0, .mask = 0x0f, },
<a name="l00646"></a>00646         { .phy_offset = 1, .phy_shift = 0, .rf_addr = 0x4f, .rf_shift = 4, .mask = 0x0f, },
<a name="l00647"></a>00647         { .phy_offset = 3, .phy_shift = 0, .rf_addr = 0x49, .rf_shift = 0, .mask = 0x0f, },
<a name="l00648"></a>00648         { .phy_offset = 4, .phy_shift = 3, .rf_addr = 0x46, .rf_shift = 4, .mask = 0x07, },
<a name="l00649"></a>00649         { .phy_offset = 3, .phy_shift = 15, .rf_addr = 0x46, .rf_shift = 0, .mask = 0x01, },
<a name="l00650"></a>00650         { .phy_offset = 4, .phy_shift = 0, .rf_addr = 0x46, .rf_shift = 1, .mask = 0x07, },
<a name="l00651"></a>00651         { .phy_offset = 3, .phy_shift = 8, .rf_addr = 0x48, .rf_shift = 4, .mask = 0x07, },
<a name="l00652"></a>00652         { .phy_offset = 3, .phy_shift = 11, .rf_addr = 0x48, .rf_shift = 0, .mask = 0x0f, },
<a name="l00653"></a>00653         { .phy_offset = 3, .phy_shift = 4, .rf_addr = 0x49, .rf_shift = 4, .mask = 0x0f, },
<a name="l00654"></a>00654         { .phy_offset = 2, .phy_shift = 15, .rf_addr = 0x45, .rf_shift = 0, .mask = 0x01, },
<a name="l00655"></a>00655         { .phy_offset = 5, .phy_shift = 13, .rf_addr = 0x52, .rf_shift = 4, .mask = 0x07, },
<a name="l00656"></a>00656         { .phy_offset = 6, .phy_shift = 0, .rf_addr = 0x52, .rf_shift = 7, .mask = 0x01, },
<a name="l00657"></a>00657         { .phy_offset = 5, .phy_shift = 3, .rf_addr = 0x41, .rf_shift = 5, .mask = 0x07, },
<a name="l00658"></a>00658         { .phy_offset = 5, .phy_shift = 6, .rf_addr = 0x41, .rf_shift = 0, .mask = 0x0f, },
<a name="l00659"></a>00659         { .phy_offset = 5, .phy_shift = 10, .rf_addr = 0x42, .rf_shift = 5, .mask = 0x07, },
<a name="l00660"></a>00660         { .phy_offset = 4, .phy_shift = 15, .rf_addr = 0x42, .rf_shift = 0, .mask = 0x01, },
<a name="l00661"></a>00661         { .phy_offset = 5, .phy_shift = 0, .rf_addr = 0x42, .rf_shift = 1, .mask = 0x07, },
<a name="l00662"></a>00662         { .phy_offset = 4, .phy_shift = 11, .rf_addr = 0x43, .rf_shift = 4, .mask = 0x0f, },
<a name="l00663"></a>00663         { .phy_offset = 4, .phy_shift = 7, .rf_addr = 0x43, .rf_shift = 0, .mask = 0x0f, },
<a name="l00664"></a>00664         { .phy_offset = 4, .phy_shift = 6, .rf_addr = 0x45, .rf_shift = 1, .mask = 0x01, },
<a name="l00665"></a>00665         { .phy_offset = 2, .phy_shift = 7, .rf_addr = 0x40, .rf_shift = 4, .mask = 0x0f, },
<a name="l00666"></a>00666         { .phy_offset = 2, .phy_shift = 11, .rf_addr = 0x40, .rf_shift = 0, .mask = 0x0f, },
<a name="l00667"></a>00667 };
<a name="l00668"></a>00668 
<a name="l00669"></a><a class="code" href="phy__lp_8c.html#aa2308a5d9038876a3ddaedf8b629e247">00669</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aa2308a5d9038876a3ddaedf8b629e247">lpphy_sync_stx</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00670"></a>00670 {
<a name="l00671"></a>00671         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlpphy__stx__table__entry.html">lpphy_stx_table_entry</a> *e;
<a name="l00672"></a>00672         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00673"></a>00673         u16 tmp;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(lpphy_stx_table); i++) {
<a name="l00676"></a>00676                 e = &amp;lpphy_stx_table[i];
<a name="l00677"></a>00677                 tmp = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, e-&gt;<a class="code" href="structlpphy__stx__table__entry.html#ae2950e764b3e82f7251cb0419506a68c">rf_addr</a>);
<a name="l00678"></a>00678                 tmp &gt;&gt;= e-&gt;<a class="code" href="structlpphy__stx__table__entry.html#a5cd8f5869044fc4351df407c2893feca">rf_shift</a>;
<a name="l00679"></a>00679                 tmp &lt;&lt;= e-&gt;<a class="code" href="structlpphy__stx__table__entry.html#ad56a6de3bbbb24187f22a4ccf2978fb4">phy_shift</a>;
<a name="l00680"></a>00680                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xF2 + e-&gt;<a class="code" href="structlpphy__stx__table__entry.html#ae96f3ac8befb1d9ce04f63c03094c007">phy_offset</a>),
<a name="l00681"></a>00681                                 ~(e-&gt;<a class="code" href="structlpphy__stx__table__entry.html#aaaa37ee955f527b1d7c5a338417a28fa">mask</a> &lt;&lt; e-&gt;<a class="code" href="structlpphy__stx__table__entry.html#ad56a6de3bbbb24187f22a4ccf2978fb4">phy_shift</a>), tmp);
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683 }
<a name="l00684"></a>00684 
<a name="l00685"></a><a class="code" href="phy__lp_8c.html#ad61f0d6454a974c8faf98795aaf6688e">00685</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ad61f0d6454a974c8faf98795aaf6688e">lpphy_radio_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00686"></a>00686 {
<a name="l00687"></a>00687         <span class="comment">/* The radio is attached through the 4wire bus. */</span>
<a name="l00688"></a>00688         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a8227bd34a01d5cf282fd788a577abef5">B43_LPPHY_FOURWIRE_CTL</a>, 0x2);
<a name="l00689"></a>00689         udelay(1);
<a name="l00690"></a>00690         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a8227bd34a01d5cf282fd788a577abef5">B43_LPPHY_FOURWIRE_CTL</a>, 0xFFFD);
<a name="l00691"></a>00691         udelay(1);
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a5a8e907e85dbb880185fa6f434075f4b">radio_ver</a> == 0x2062) {
<a name="l00694"></a>00694                 <a class="code" href="phy__lp_8c.html#ab17de2bc93181a36cc51bb6dd334369b">lpphy_2062_init</a>(dev);
<a name="l00695"></a>00695         } <span class="keywordflow">else</span> {
<a name="l00696"></a>00696                 <a class="code" href="phy__lp_8c.html#aea1e353fd11b101a957e5620dfdd1565">lpphy_2063_init</a>(dev);
<a name="l00697"></a>00697                 <a class="code" href="phy__lp_8c.html#aa2308a5d9038876a3ddaedf8b629e247">lpphy_sync_stx</a>(dev);
<a name="l00698"></a>00698                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xF0), 0x5F80);
<a name="l00699"></a>00699                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xF1), 0);
<a name="l00700"></a>00700                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x4325) {
<a name="l00701"></a>00701                         <span class="comment">// TODO SSB PMU recalibration</span>
<a name="l00702"></a>00702                 }
<a name="l00703"></a>00703         }
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">00706</a> <span class="keyword">struct </span><a class="code" href="structlpphy__iq__est.html">lpphy_iq_est</a> { u32 <a class="code" href="structlpphy__iq__est.html#a342f5e522e58dabc1ed7ccd9c3c87ffc">iq_prod</a>, <a class="code" href="structlpphy__iq__est.html#a634a5e365e8c253a564bd732a40cc8f6">i_pwr</a>, <a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">q_pwr</a>; };
<a name="l00707"></a>00707 
<a name="l00708"></a><a class="code" href="phy__lp_8c.html#af36b52560caf8f4b2ef1df59c649f2b3">00708</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#af36b52560caf8f4b2ef1df59c649f2b3">lpphy_set_rc_cap</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00709"></a>00709 {
<a name="l00710"></a>00710         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712         u8 <a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a> = (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a> &amp; 0x1F) &gt;&gt; 1;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 1) <span class="comment">//FIXME check channel 14!</span>
<a name="l00715"></a>00715                 rc_cap = min_t(u8, rc_cap + 5, 15);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a956f7e74f99d2a2abe3bec5556295dfe">B2062_N_RXBB_CALIB2</a>,
<a name="l00718"></a>00718                         max_t(u8, lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a> - 4, 0x80));
<a name="l00719"></a>00719         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a0f5f958bb2546169b64472a98b6dd734">B2062_N_TX_CTL_A</a>, rc_cap | 0x80);
<a name="l00720"></a>00720         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ad3291ace5c9d5b59649fc5efc7f9d40c">B2062_S_RXG_CNT16</a>,
<a name="l00721"></a>00721                         ((lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a> &amp; 0x1F) &gt;&gt; 2) | 0x80);
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a><a class="code" href="phy__lp_8c.html#a71220c70f21317fb3f7e88095d02eb07">00724</a> <span class="keyword">static</span> u8 <a class="code" href="phy__lp_8c.html#a71220c70f21317fb3f7e88095d02eb07">lpphy_get_bb_mult</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00725"></a>00725 {
<a name="l00726"></a>00726         <span class="keywordflow">return</span> (<a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(0, 87)) &amp; 0xFF00) &gt;&gt; 8;
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00729"></a><a class="code" href="phy__lp_8c.html#a5069ae26dc96ec4524716141b3019a7b">00729</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a5069ae26dc96ec4524716141b3019a7b">lpphy_set_bb_mult</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 bb_mult)
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731         <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(0, 87), (u16)bb_mult &lt;&lt; 8);
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00734"></a><a class="code" href="phy__lp_8c.html#a276441f008eade78697f6b0458741d86">00734</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a276441f008eade78697f6b0458741d86">lpphy_set_deaf</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> user)
<a name="l00735"></a>00735 {
<a name="l00736"></a>00736         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         <span class="keywordflow">if</span> (user)
<a name="l00739"></a>00739                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a261bfc72a6ea638a0a27d452072835ca">crs_usr_disable</a> = 1;
<a name="l00740"></a>00740         <span class="keywordflow">else</span>
<a name="l00741"></a>00741                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a46d7df9092ab785672a37749e5ffe711">crs_sys_disable</a> = 1;
<a name="l00742"></a>00742         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0xFF1F, 0x80);
<a name="l00743"></a>00743 }
<a name="l00744"></a>00744 
<a name="l00745"></a><a class="code" href="phy__lp_8c.html#ab2397e586347a11c5ad36f4c387286dc">00745</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ab2397e586347a11c5ad36f4c387286dc">lpphy_clear_deaf</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> user)
<a name="l00746"></a>00746 {
<a name="l00747"></a>00747         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="keywordflow">if</span> (user)
<a name="l00750"></a>00750                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a261bfc72a6ea638a0a27d452072835ca">crs_usr_disable</a> = 0;
<a name="l00751"></a>00751         <span class="keywordflow">else</span>
<a name="l00752"></a>00752                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a46d7df9092ab785672a37749e5ffe711">crs_sys_disable</a> = 0;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754         <span class="keywordflow">if</span> (!lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a261bfc72a6ea638a0a27d452072835ca">crs_usr_disable</a> &amp;&amp; !lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a46d7df9092ab785672a37749e5ffe711">crs_sys_disable</a>) {
<a name="l00755"></a>00755                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l00756"></a>00756                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>,
<a name="l00757"></a>00757                                         0xFF1F, 0x60);
<a name="l00758"></a>00758                 <span class="keywordflow">else</span>
<a name="l00759"></a>00759                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>,
<a name="l00760"></a>00760                                         0xFF1F, 0x20);
<a name="l00761"></a>00761         }
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a><a class="code" href="phy__lp_8c.html#a97091d36b42658f2674024bb0fcad4a5">00764</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a97091d36b42658f2674024bb0fcad4a5">lpphy_set_trsw_over</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> tx, <span class="keywordtype">bool</span> rx)
<a name="l00765"></a>00765 {
<a name="l00766"></a>00766         u16 trsw = (tx &lt;&lt; 1) | rx;
<a name="l00767"></a>00767         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xFFFC, trsw);
<a name="l00768"></a>00768         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x3);
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 
<a name="l00771"></a><a class="code" href="phy__lp_8c.html#a00c66fbbc690126ed467b00bcff40a8f">00771</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a00c66fbbc690126ed467b00bcff40a8f">lpphy_disable_crs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> user)
<a name="l00772"></a>00772 {
<a name="l00773"></a>00773         <a class="code" href="phy__lp_8c.html#a276441f008eade78697f6b0458741d86">lpphy_set_deaf</a>(dev, user);
<a name="l00774"></a>00774         <a class="code" href="phy__lp_8c.html#a97091d36b42658f2674024bb0fcad4a5">lpphy_set_trsw_over</a>(dev, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l00775"></a>00775         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xFFFB);
<a name="l00776"></a>00776         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x4);
<a name="l00777"></a>00777         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xFFF7);
<a name="l00778"></a>00778         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x8);
<a name="l00779"></a>00779         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0x10);
<a name="l00780"></a>00780         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x10);
<a name="l00781"></a>00781         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xFFDF);
<a name="l00782"></a>00782         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x20);
<a name="l00783"></a>00783         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xFFBF);
<a name="l00784"></a>00784         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x40);
<a name="l00785"></a>00785         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0x7);
<a name="l00786"></a>00786         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0x38);
<a name="l00787"></a>00787         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xFF3F);
<a name="l00788"></a>00788         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0x100);
<a name="l00789"></a>00789         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xFDFF);
<a name="l00790"></a>00790         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a5d4eaa8f38199e8032b2e9e8821568e6">B43_LPPHY_PS_CTL_OVERRIDE_VAL0</a>, 0);
<a name="l00791"></a>00791         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac5a0c5949d0044011785a61c57c9ee43">B43_LPPHY_PS_CTL_OVERRIDE_VAL1</a>, 1);
<a name="l00792"></a>00792         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7155c16dafff0fb70867ca9d740f347f">B43_LPPHY_PS_CTL_OVERRIDE_VAL2</a>, 0x20);
<a name="l00793"></a>00793         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xFBFF);
<a name="l00794"></a>00794         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xF7FF);
<a name="l00795"></a>00795         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#abbdb8937c15e58e465445c0dd03db169">B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL</a>, 0);
<a name="l00796"></a>00796         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a115124a8f509d9dcea4054172d596992">B43_LPPHY_RX_GAIN_CTL_OVERRIDE_VAL</a>, 0x45AF);
<a name="l00797"></a>00797         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x3FF);
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a><a class="code" href="phy__lp_8c.html#a51b582ee8a7cf7e0052681692514f779">00800</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a51b582ee8a7cf7e0052681692514f779">lpphy_restore_crs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> user)
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802         <a class="code" href="phy__lp_8c.html#ab2397e586347a11c5ad36f4c387286dc">lpphy_clear_deaf</a>(dev, user);
<a name="l00803"></a>00803         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xFF80);
<a name="l00804"></a>00804         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xFC00);
<a name="l00805"></a>00805 }
<a name="l00806"></a>00806 
<a name="l00807"></a><a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">00807</a> <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> { u16 <a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a>, <a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a>, <a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a>, <a class="code" href="structlpphy__tx__gains.html#ae24fe3164361adc1a072651d8a9fb2e0">dac</a>; };
<a name="l00808"></a>00808 
<a name="l00809"></a><a class="code" href="phy__lp_8c.html#af5abebc5445cfe8e020b72c1f6f915c8">00809</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#af5abebc5445cfe8e020b72c1f6f915c8">lpphy_disable_rx_gain_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00810"></a>00810 {
<a name="l00811"></a>00811         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xFFFE);
<a name="l00812"></a>00812         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xFFEF);
<a name="l00813"></a>00813         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xFFBF);
<a name="l00814"></a>00814         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l00815"></a>00815                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xFEFF);
<a name="l00816"></a>00816                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l00817"></a>00817                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xFBFF);
<a name="l00818"></a>00818                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xE5), 0xFFF7);
<a name="l00819"></a>00819                 }
<a name="l00820"></a>00820         } <span class="keywordflow">else</span> {
<a name="l00821"></a>00821                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xFDFF);
<a name="l00822"></a>00822         }
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00825"></a><a class="code" href="phy__lp_8c.html#a715dcd46ba306a2c2dec0c15afe5fdac">00825</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a715dcd46ba306a2c2dec0c15afe5fdac">lpphy_enable_rx_gain_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x1);
<a name="l00828"></a>00828         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x10);
<a name="l00829"></a>00829         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x40);
<a name="l00830"></a>00830         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l00831"></a>00831                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x100);
<a name="l00832"></a>00832                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l00833"></a>00833                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x400);
<a name="l00834"></a>00834                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xE5), 0x8);
<a name="l00835"></a>00835                 }
<a name="l00836"></a>00836         } <span class="keywordflow">else</span> {
<a name="l00837"></a>00837                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x200);
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839 }
<a name="l00840"></a>00840 
<a name="l00841"></a><a class="code" href="phy__lp_8c.html#ace3faccb5a4efe2cc3e2c36e50628a15">00841</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ace3faccb5a4efe2cc3e2c36e50628a15">lpphy_disable_tx_gain_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00842"></a>00842 {
<a name="l00843"></a>00843         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l00844"></a>00844                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xFEFF);
<a name="l00845"></a>00845         <span class="keywordflow">else</span> {
<a name="l00846"></a>00846                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xFF7F);
<a name="l00847"></a>00847                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xBFFF);
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0xFFBF);
<a name="l00850"></a>00850 }
<a name="l00851"></a>00851 
<a name="l00852"></a><a class="code" href="phy__lp_8c.html#aa2ac46731987d02af3d6dc098aad5c87">00852</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aa2ac46731987d02af3d6dc098aad5c87">lpphy_enable_tx_gain_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00853"></a>00853 {
<a name="l00854"></a>00854         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l00855"></a>00855                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x100);
<a name="l00856"></a>00856         <span class="keywordflow">else</span> {
<a name="l00857"></a>00857                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x80);
<a name="l00858"></a>00858                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x4000);
<a name="l00859"></a>00859         }
<a name="l00860"></a>00860         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0x40);
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a><a class="code" href="phy__lp_8c.html#a523b8ce697e693bd0b9f4fc12499cd2f">00863</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> <a class="code" href="phy__lp_8c.html#a523b8ce697e693bd0b9f4fc12499cd2f">lpphy_get_tx_gains</a>(struct <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865         <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> gains;
<a name="l00866"></a>00866         u16 tmp;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868         gains.<a class="code" href="structlpphy__tx__gains.html#ae24fe3164361adc1a072651d8a9fb2e0">dac</a> = (<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a1d2d2cede732b9df98e903db6f8febce">B43_LPPHY_AFE_DAC_CTL</a>) &amp; 0x380) &gt;&gt; 7;
<a name="l00869"></a>00869         <span class="keywordflow">if</span> (dev-&gt;phy.rev &lt; 2) {
<a name="l00870"></a>00870                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l00871"></a>00871                                    <a class="code" href="phy__lp_8h.html#abbdb8937c15e58e465445c0dd03db169">B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL</a>) &amp; 0x7FF;
<a name="l00872"></a>00872                 gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a> = tmp &amp; 0x0007;
<a name="l00873"></a>00873                 gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> = (tmp &amp; 0x0078) &gt;&gt; 3;
<a name="l00874"></a>00874                 gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> = (tmp &amp; 0x780) &gt;&gt; 7;
<a name="l00875"></a>00875         } <span class="keywordflow">else</span> {
<a name="l00876"></a>00876                 tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#abbdb8937c15e58e465445c0dd03db169">B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL</a>);
<a name="l00877"></a>00877                 gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFB)) &amp; 0xFF;
<a name="l00878"></a>00878                 gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a> = tmp &amp; 0xFF;
<a name="l00879"></a>00879                 gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> = (tmp &gt;&gt; 8) &amp; 0xFF;
<a name="l00880"></a>00880         }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882         <span class="keywordflow">return</span> gains;
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="phy__lp_8c.html#a0f57ad6207dc6441ec6ec28465680527">00885</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a0f57ad6207dc6441ec6ec28465680527">lpphy_set_dac_gain</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 <a class="code" href="structlpphy__tx__gains.html#ae24fe3164361adc1a072651d8a9fb2e0">dac</a>)
<a name="l00886"></a>00886 {
<a name="l00887"></a>00887         u16 ctl = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a1d2d2cede732b9df98e903db6f8febce">B43_LPPHY_AFE_DAC_CTL</a>) &amp; 0xC7F;
<a name="l00888"></a>00888         ctl |= dac &lt;&lt; 7;
<a name="l00889"></a>00889         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a1d2d2cede732b9df98e903db6f8febce">B43_LPPHY_AFE_DAC_CTL</a>, 0xF000, ctl);
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00892"></a><a class="code" href="phy__lp_8c.html#a23bf41fc13e0a112c7cd989627c2e3a6">00892</a> <span class="keyword">static</span> u16 <a class="code" href="phy__lp_8c.html#a23bf41fc13e0a112c7cd989627c2e3a6">lpphy_get_pa_gain</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00893"></a>00893 {
<a name="l00894"></a>00894         <span class="keywordflow">return</span> <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFB)) &amp; 0x7F;
<a name="l00895"></a>00895 }
<a name="l00896"></a>00896 
<a name="l00897"></a><a class="code" href="phy__lp_8c.html#a91da2881cd6bc2f111b9056df00a9dd2">00897</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a91da2881cd6bc2f111b9056df00a9dd2">lpphy_set_pa_gain</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 gain)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFB), 0xE03F, gain &lt;&lt; 6);
<a name="l00900"></a>00900         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFD), 0x80FF, gain &lt;&lt; 8);
<a name="l00901"></a>00901 }
<a name="l00902"></a>00902 
<a name="l00903"></a><a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">00903</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">lpphy_set_tx_gains</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l00904"></a>00904                                <span class="keyword">struct</span> <a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> gains)
<a name="l00905"></a>00905 {
<a name="l00906"></a>00906         u16 rf_gain, pa_gain;
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l00909"></a>00909                 rf_gain = (gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> &lt;&lt; 7) | (gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> &lt;&lt; 3) | gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a>;
<a name="l00910"></a>00910                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#abbdb8937c15e58e465445c0dd03db169">B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL</a>,
<a name="l00911"></a>00911                                 0xF800, rf_gain);
<a name="l00912"></a>00912         } <span class="keywordflow">else</span> {
<a name="l00913"></a>00913                 pa_gain = <a class="code" href="phy__lp_8c.html#a23bf41fc13e0a112c7cd989627c2e3a6">lpphy_get_pa_gain</a>(dev);
<a name="l00914"></a>00914                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#abbdb8937c15e58e465445c0dd03db169">B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL</a>,
<a name="l00915"></a>00915                               (gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> &lt;&lt; 8) | gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a>);
<a name="l00916"></a>00916                 <span class="comment">/*</span>
<a name="l00917"></a>00917 <span class="comment">                 * SPEC FIXME The spec calls for (pa_gain &lt;&lt; 8) here, but that</span>
<a name="l00918"></a>00918 <span class="comment">                 * conflicts with the spec for set_pa_gain! Vendor driver bug?</span>
<a name="l00919"></a>00919 <span class="comment">                 */</span>
<a name="l00920"></a>00920                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFB),
<a name="l00921"></a>00921                                 0x8000, gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> | (pa_gain &lt;&lt; 6));
<a name="l00922"></a>00922                 <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFC),
<a name="l00923"></a>00923                               (gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> &lt;&lt; 8) | gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a>);
<a name="l00924"></a>00924                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xFD),
<a name="l00925"></a>00925                                 0x8000, gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> | (pa_gain &lt;&lt; 8));
<a name="l00926"></a>00926         }
<a name="l00927"></a>00927         <a class="code" href="phy__lp_8c.html#a0f57ad6207dc6441ec6ec28465680527">lpphy_set_dac_gain</a>(dev, gains.<a class="code" href="structlpphy__tx__gains.html#ae24fe3164361adc1a072651d8a9fb2e0">dac</a>);
<a name="l00928"></a>00928         <a class="code" href="phy__lp_8c.html#aa2ac46731987d02af3d6dc098aad5c87">lpphy_enable_tx_gain_override</a>(dev);
<a name="l00929"></a>00929 }
<a name="l00930"></a>00930 
<a name="l00931"></a><a class="code" href="phy__lp_8c.html#a5114148010c414889909f91e0419ae98">00931</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a5114148010c414889909f91e0419ae98">lpphy_rev0_1_set_rx_gain</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u32 gain)
<a name="l00932"></a>00932 {
<a name="l00933"></a>00933         u16 trsw = gain &amp; 0x1;
<a name="l00934"></a>00934         u16 lna = (gain &amp; 0xFFFC) | ((gain &amp; 0xC) &gt;&gt; 2);
<a name="l00935"></a>00935         u16 ext_lna = (gain &amp; 2) &gt;&gt; 1;
<a name="l00936"></a>00936 
<a name="l00937"></a>00937         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xFFFE, trsw);
<a name="l00938"></a>00938         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>,
<a name="l00939"></a>00939                         0xFBFF, ext_lna &lt;&lt; 10);
<a name="l00940"></a>00940         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>,
<a name="l00941"></a>00941                         0xF7FF, ext_lna &lt;&lt; 11);
<a name="l00942"></a>00942         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a115124a8f509d9dcea4054172d596992">B43_LPPHY_RX_GAIN_CTL_OVERRIDE_VAL</a>, lna);
<a name="l00943"></a>00943 }
<a name="l00944"></a>00944 
<a name="l00945"></a><a class="code" href="phy__lp_8c.html#ac7cc00eb7f3dc8dcc5673dfc5402f00d">00945</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ac7cc00eb7f3dc8dcc5673dfc5402f00d">lpphy_rev2plus_set_rx_gain</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u32 gain)
<a name="l00946"></a>00946 {
<a name="l00947"></a>00947         u16 low_gain = gain &amp; 0xFFFF;
<a name="l00948"></a>00948         u16 high_gain = (gain &gt;&gt; 16) &amp; 0xF;
<a name="l00949"></a>00949         u16 ext_lna = (gain &gt;&gt; 21) &amp; 0x1;
<a name="l00950"></a>00950         u16 trsw = ~(gain &gt;&gt; 20) &amp; 0x1;
<a name="l00951"></a>00951         u16 tmp;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xFFFE, trsw);
<a name="l00954"></a>00954         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>,
<a name="l00955"></a>00955                         0xFDFF, ext_lna &lt;&lt; 9);
<a name="l00956"></a>00956         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>,
<a name="l00957"></a>00957                         0xFBFF, ext_lna &lt;&lt; 10);
<a name="l00958"></a>00958         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a115124a8f509d9dcea4054172d596992">B43_LPPHY_RX_GAIN_CTL_OVERRIDE_VAL</a>, low_gain);
<a name="l00959"></a>00959         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0xFFF0, high_gain);
<a name="l00960"></a>00960         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l00961"></a>00961                 tmp = (gain &gt;&gt; 2) &amp; 0x3;
<a name="l00962"></a>00962                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>,
<a name="l00963"></a>00963                                 0xE7FF, tmp&lt;&lt;11);
<a name="l00964"></a>00964                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xE6), 0xFFE7, tmp &lt;&lt; 3);
<a name="l00965"></a>00965         }
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 
<a name="l00968"></a><a class="code" href="phy__lp_8c.html#a8b65be93c48d8f8bbf45618554ce223f">00968</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a8b65be93c48d8f8bbf45618554ce223f">lpphy_set_rx_gain</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u32 gain)
<a name="l00969"></a>00969 {
<a name="l00970"></a>00970         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2)
<a name="l00971"></a>00971                 <a class="code" href="phy__lp_8c.html#a5114148010c414889909f91e0419ae98">lpphy_rev0_1_set_rx_gain</a>(dev, gain);
<a name="l00972"></a>00972         <span class="keywordflow">else</span>
<a name="l00973"></a>00973                 <a class="code" href="phy__lp_8c.html#ac7cc00eb7f3dc8dcc5673dfc5402f00d">lpphy_rev2plus_set_rx_gain</a>(dev, gain);
<a name="l00974"></a>00974         <a class="code" href="phy__lp_8c.html#a715dcd46ba306a2c2dec0c15afe5fdac">lpphy_enable_rx_gain_override</a>(dev);
<a name="l00975"></a>00975 }
<a name="l00976"></a>00976 
<a name="l00977"></a><a class="code" href="phy__lp_8c.html#ac67dfcff2113871619a532fce4952f17">00977</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ac67dfcff2113871619a532fce4952f17">lpphy_set_rx_gain_by_index</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 idx)
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979         u32 gain = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(12, idx));
<a name="l00980"></a>00980         <a class="code" href="phy__lp_8c.html#a8b65be93c48d8f8bbf45618554ce223f">lpphy_set_rx_gain</a>(dev, gain);
<a name="l00981"></a>00981 }
<a name="l00982"></a>00982 
<a name="l00983"></a><a class="code" href="phy__lp_8c.html#abff9da1c95fc62941dc8b0d89ebcfeae">00983</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#abff9da1c95fc62941dc8b0d89ebcfeae">lpphy_stop_ddfs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l00984"></a>00984 {
<a name="l00985"></a>00985         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0xFFFD);
<a name="l00986"></a>00986         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0xFFDF);
<a name="l00987"></a>00987 }
<a name="l00988"></a>00988 
<a name="l00989"></a><a class="code" href="phy__lp_8c.html#af1ea4f2bb06a68089d45338c2b0baf2a">00989</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#af1ea4f2bb06a68089d45338c2b0baf2a">lpphy_run_ddfs</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">int</span> i_on, <span class="keywordtype">int</span> q_on,
<a name="l00990"></a>00990                            <span class="keywordtype">int</span> incr1, <span class="keywordtype">int</span> incr2, <span class="keywordtype">int</span> scale_idx)
<a name="l00991"></a>00991 {
<a name="l00992"></a>00992         <a class="code" href="phy__lp_8c.html#abff9da1c95fc62941dc8b0d89ebcfeae">lpphy_stop_ddfs</a>(dev);
<a name="l00993"></a>00993         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a5bd281d28f25307c9b81dea85f6e1017">B43_LPPHY_AFE_DDFS_POINTER_INIT</a>, 0xFF80);
<a name="l00994"></a>00994         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a5bd281d28f25307c9b81dea85f6e1017">B43_LPPHY_AFE_DDFS_POINTER_INIT</a>, 0x80FF);
<a name="l00995"></a>00995         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ae9172fca6fc243d7c388a725e611017a">B43_LPPHY_AFE_DDFS_INCR_INIT</a>, 0xFF80, incr1);
<a name="l00996"></a>00996         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ae9172fca6fc243d7c388a725e611017a">B43_LPPHY_AFE_DDFS_INCR_INIT</a>, 0x80FF, incr2 &lt;&lt; 8);
<a name="l00997"></a>00997         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0xFFF7, i_on &lt;&lt; 3);
<a name="l00998"></a>00998         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0xFFEF, q_on &lt;&lt; 4);
<a name="l00999"></a>00999         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0xFF9F, scale_idx &lt;&lt; 5);
<a name="l01000"></a>01000         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0xFFFB);
<a name="l01001"></a>01001         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0x2);
<a name="l01002"></a>01002         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0x20);
<a name="l01003"></a>01003 }
<a name="l01004"></a>01004 
<a name="l01005"></a><a class="code" href="phy__lp_8c.html#a8c7ce50541c71fbc6ad25cc996dff383">01005</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="phy__lp_8c.html#a8c7ce50541c71fbc6ad25cc996dff383">lpphy_rx_iq_est</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 samples, u8 time,
<a name="l01006"></a>01006                            <span class="keyword">struct</span> <a class="code" href="structlpphy__iq__est.html">lpphy_iq_est</a> *iq_est)
<a name="l01007"></a>01007 {
<a name="l01008"></a>01008         <span class="keywordtype">int</span> i;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0xFFF7);
<a name="l01011"></a>01011         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a3c908f5f535dceee693e860c2c92437f">B43_LPPHY_IQ_NUM_SMPLS_ADDR</a>, samples);
<a name="l01012"></a>01012         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a014896792e80ee2eb3b096ceb6f9f7ae">B43_LPPHY_IQ_ENABLE_WAIT_TIME_ADDR</a>, 0xFF00, time);
<a name="l01013"></a>01013         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a014896792e80ee2eb3b096ceb6f9f7ae">B43_LPPHY_IQ_ENABLE_WAIT_TIME_ADDR</a>, 0xFEFF);
<a name="l01014"></a>01014         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a014896792e80ee2eb3b096ceb6f9f7ae">B43_LPPHY_IQ_ENABLE_WAIT_TIME_ADDR</a>, 0x200);
<a name="l01015"></a>01015 
<a name="l01016"></a>01016         <span class="keywordflow">for</span> (i = 0; i &lt; 500; i++) {
<a name="l01017"></a>01017                 <span class="keywordflow">if</span> (!(<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev,
<a name="l01018"></a>01018                                 <a class="code" href="phy__lp_8h.html#a014896792e80ee2eb3b096ceb6f9f7ae">B43_LPPHY_IQ_ENABLE_WAIT_TIME_ADDR</a>) &amp; 0x200))
<a name="l01019"></a>01019                         <span class="keywordflow">break</span>;
<a name="l01020"></a>01020                 msleep(1);
<a name="l01021"></a>01021         }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023         <span class="keywordflow">if</span> ((<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a014896792e80ee2eb3b096ceb6f9f7ae">B43_LPPHY_IQ_ENABLE_WAIT_TIME_ADDR</a>) &amp; 0x200)) {
<a name="l01024"></a>01024                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0x8);
<a name="l01025"></a>01025                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01026"></a>01026         }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a342f5e522e58dabc1ed7ccd9c3c87ffc">iq_prod</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a0dbf7974dd4b5e57489fb1553ebf8064">B43_LPPHY_IQ_ACC_HI_ADDR</a>);
<a name="l01029"></a>01029         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a342f5e522e58dabc1ed7ccd9c3c87ffc">iq_prod</a> &lt;&lt;= 16;
<a name="l01030"></a>01030         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a342f5e522e58dabc1ed7ccd9c3c87ffc">iq_prod</a> |= <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a07c6a931263e6975b92ebea6972c63fa">B43_LPPHY_IQ_ACC_LO_ADDR</a>);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a634a5e365e8c253a564bd732a40cc8f6">i_pwr</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#aa72b33c067f3bb4a5ade7e233ee91d5d">B43_LPPHY_IQ_I_PWR_ACC_HI_ADDR</a>);
<a name="l01033"></a>01033         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a634a5e365e8c253a564bd732a40cc8f6">i_pwr</a> &lt;&lt;= 16;
<a name="l01034"></a>01034         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a634a5e365e8c253a564bd732a40cc8f6">i_pwr</a> |= <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a5e8b9eafa11db1a806f0d45d11dc3b12">B43_LPPHY_IQ_I_PWR_ACC_LO_ADDR</a>);
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">q_pwr</a> = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a73ea88ea2a1859068fa1c9d185a17321">B43_LPPHY_IQ_Q_PWR_ACC_HI_ADDR</a>);
<a name="l01037"></a>01037         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">q_pwr</a> &lt;&lt;= 16;
<a name="l01038"></a>01038         iq_est-&gt;<a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">q_pwr</a> |= <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#aa5f95620e34b5deb5d4d1606e2428932">B43_LPPHY_IQ_Q_PWR_ACC_LO_ADDR</a>);
<a name="l01039"></a>01039 
<a name="l01040"></a>01040         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0x8);
<a name="l01041"></a>01041         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01042"></a>01042 }
<a name="l01043"></a>01043 
<a name="l01044"></a><a class="code" href="phy__lp_8c.html#a21cca291eb80bc9707f6686f0617f995">01044</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#a21cca291eb80bc9707f6686f0617f995">lpphy_loopback</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01045"></a>01045 {
<a name="l01046"></a>01046         <span class="keyword">struct </span><a class="code" href="structlpphy__iq__est.html">lpphy_iq_est</a> iq_est;
<a name="l01047"></a>01047         <span class="keywordtype">int</span> i, index = -1;
<a name="l01048"></a>01048         u32 tmp;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050         memset(&amp;iq_est, 0, <span class="keyword">sizeof</span>(iq_est));
<a name="l01051"></a>01051 
<a name="l01052"></a>01052         <a class="code" href="phy__lp_8c.html#a97091d36b42658f2674024bb0fcad4a5">lpphy_set_trsw_over</a>(dev, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01053"></a>01053         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 1);
<a name="l01054"></a>01054         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>, 0xFFFE);
<a name="l01055"></a>01055         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x800);
<a name="l01056"></a>01056         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0x800);
<a name="l01057"></a>01057         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x8);
<a name="l01058"></a>01058         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0x8);
<a name="l01059"></a>01059         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a0f5f958bb2546169b64472a98b6dd734">B2062_N_TX_CTL_A</a>, 0x80);
<a name="l01060"></a>01060         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x80);
<a name="l01061"></a>01061         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0x80);
<a name="l01062"></a>01062         <span class="keywordflow">for</span> (i = 0; i &lt; 32; i++) {
<a name="l01063"></a>01063                 <a class="code" href="phy__lp_8c.html#ac67dfcff2113871619a532fce4952f17">lpphy_set_rx_gain_by_index</a>(dev, i);
<a name="l01064"></a>01064                 <a class="code" href="phy__lp_8c.html#af1ea4f2bb06a68089d45338c2b0baf2a">lpphy_run_ddfs</a>(dev, 1, 1, 5, 5, 0);
<a name="l01065"></a>01065                 <span class="keywordflow">if</span> (!(<a class="code" href="phy__lp_8c.html#a8c7ce50541c71fbc6ad25cc996dff383">lpphy_rx_iq_est</a>(dev, 1000, 32, &amp;iq_est)))
<a name="l01066"></a>01066                         <span class="keywordflow">continue</span>;
<a name="l01067"></a>01067                 tmp = (iq_est.<a class="code" href="structlpphy__iq__est.html#a634a5e365e8c253a564bd732a40cc8f6">i_pwr</a> + iq_est.<a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">q_pwr</a>) / 1000;
<a name="l01068"></a>01068                 <span class="keywordflow">if</span> ((tmp &gt; 4000) &amp;&amp; (tmp &lt; 10000)) {
<a name="l01069"></a>01069                         index = i;
<a name="l01070"></a>01070                         <span class="keywordflow">break</span>;
<a name="l01071"></a>01071                 }
<a name="l01072"></a>01072         }
<a name="l01073"></a>01073         <a class="code" href="phy__lp_8c.html#abff9da1c95fc62941dc8b0d89ebcfeae">lpphy_stop_ddfs</a>(dev);
<a name="l01074"></a>01074         <span class="keywordflow">return</span> index;
<a name="l01075"></a>01075 }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 <span class="comment">/* Fixed-point division algorithm using only integer math. */</span>
<a name="l01078"></a><a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">01078</a> <span class="keyword">static</span> u32 <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(u32 dividend, u32 divisor, u8 precision)
<a name="l01079"></a>01079 {
<a name="l01080"></a>01080         u32 quotient, remainder;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082         <span class="keywordflow">if</span> (divisor == 0)
<a name="l01083"></a>01083                 <span class="keywordflow">return</span> 0;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085         quotient = dividend / divisor;
<a name="l01086"></a>01086         remainder = dividend % divisor;
<a name="l01087"></a>01087 
<a name="l01088"></a>01088         <span class="keywordflow">while</span> (precision &gt; 0) {
<a name="l01089"></a>01089                 quotient &lt;&lt;= 1;
<a name="l01090"></a>01090                 <span class="keywordflow">if</span> (remainder &lt;&lt; 1 &gt;= divisor) {
<a name="l01091"></a>01091                         quotient++;
<a name="l01092"></a>01092                         remainder = (remainder &lt;&lt; 1) - divisor;
<a name="l01093"></a>01093                 }
<a name="l01094"></a>01094                 precision--;
<a name="l01095"></a>01095         }
<a name="l01096"></a>01096 
<a name="l01097"></a>01097         <span class="keywordflow">if</span> (remainder &lt;&lt; 1 &gt;= divisor)
<a name="l01098"></a>01098                 quotient++;
<a name="l01099"></a>01099 
<a name="l01100"></a>01100         <span class="keywordflow">return</span> quotient;
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">/* Read the TX power control mode from hardware. */</span>
<a name="l01104"></a><a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">01104</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">lpphy_read_tx_pctl_mode_from_hardware</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01105"></a>01105 {
<a name="l01106"></a>01106         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01107"></a>01107         u16 ctl;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109         ctl = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#aa2a554afb2021cefbcd25729aa57e35a">B43_LPPHY_TX_PWR_CTL_CMD</a>);
<a name="l01110"></a>01110         <span class="keywordflow">switch</span> (ctl &amp; <a class="code" href="phy__lp_8h.html#ad43a88aae489138904658ac43493e223">B43_LPPHY_TX_PWR_CTL_CMD_MODE</a>) {
<a name="l01111"></a>01111         <span class="keywordflow">case</span> <a class="code" href="phy__lp_8h.html#a3dc72c024b5f99a1c43aee05c4c27d07">B43_LPPHY_TX_PWR_CTL_CMD_MODE_OFF</a>:
<a name="l01112"></a>01112                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a> = <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>;
<a name="l01113"></a>01113                 <span class="keywordflow">break</span>;
<a name="l01114"></a>01114         <span class="keywordflow">case</span> <a class="code" href="phy__lp_8h.html#afed4f74b4882a1c46041d12a378aa8b4">B43_LPPHY_TX_PWR_CTL_CMD_MODE_SW</a>:
<a name="l01115"></a>01115                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a> = <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a79f603739fdd05bd4639603ffacb1011">B43_LPPHY_TXPCTL_SW</a>;
<a name="l01116"></a>01116                 <span class="keywordflow">break</span>;
<a name="l01117"></a>01117         <span class="keywordflow">case</span> <a class="code" href="phy__lp_8h.html#a3dffc78376b7b03f13660444b536abc0">B43_LPPHY_TX_PWR_CTL_CMD_MODE_HW</a>:
<a name="l01118"></a>01118                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a> = <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a6883f53ca0d7c044fceda7eb17ea00cf">B43_LPPHY_TXPCTL_HW</a>;
<a name="l01119"></a>01119                 <span class="keywordflow">break</span>;
<a name="l01120"></a>01120         <span class="keywordflow">default</span>:
<a name="l01121"></a>01121                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a> = <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a582ea7e8745949d2ed5992a1a7673f76">B43_LPPHY_TXPCTL_UNKNOWN</a>;
<a name="l01122"></a>01122                 <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(1);
<a name="l01123"></a>01123                 <span class="keywordflow">break</span>;
<a name="l01124"></a>01124         }
<a name="l01125"></a>01125 }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 <span class="comment">/* Set the TX power control mode in hardware. */</span>
<a name="l01128"></a><a class="code" href="phy__lp_8c.html#a653ad8404c35e7ccdd5223d8d3ece066">01128</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a653ad8404c35e7ccdd5223d8d3ece066">lpphy_write_tx_pctl_mode_to_hardware</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01129"></a>01129 {
<a name="l01130"></a>01130         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01131"></a>01131         u16 ctl;
<a name="l01132"></a>01132 
<a name="l01133"></a>01133         <span class="keywordflow">switch</span> (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a>) {
<a name="l01134"></a>01134         <span class="keywordflow">case</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>:
<a name="l01135"></a>01135                 ctl = <a class="code" href="phy__lp_8h.html#a3dc72c024b5f99a1c43aee05c4c27d07">B43_LPPHY_TX_PWR_CTL_CMD_MODE_OFF</a>;
<a name="l01136"></a>01136                 <span class="keywordflow">break</span>;
<a name="l01137"></a>01137         <span class="keywordflow">case</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a6883f53ca0d7c044fceda7eb17ea00cf">B43_LPPHY_TXPCTL_HW</a>:
<a name="l01138"></a>01138                 ctl = <a class="code" href="phy__lp_8h.html#a3dffc78376b7b03f13660444b536abc0">B43_LPPHY_TX_PWR_CTL_CMD_MODE_HW</a>;
<a name="l01139"></a>01139                 <span class="keywordflow">break</span>;
<a name="l01140"></a>01140         <span class="keywordflow">case</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a79f603739fdd05bd4639603ffacb1011">B43_LPPHY_TXPCTL_SW</a>:
<a name="l01141"></a>01141                 ctl = <a class="code" href="phy__lp_8h.html#afed4f74b4882a1c46041d12a378aa8b4">B43_LPPHY_TX_PWR_CTL_CMD_MODE_SW</a>;
<a name="l01142"></a>01142                 <span class="keywordflow">break</span>;
<a name="l01143"></a>01143         <span class="keywordflow">default</span>:
<a name="l01144"></a>01144                 ctl = 0;
<a name="l01145"></a>01145                 <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(1);
<a name="l01146"></a>01146         }
<a name="l01147"></a>01147         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa2a554afb2021cefbcd25729aa57e35a">B43_LPPHY_TX_PWR_CTL_CMD</a>,
<a name="l01148"></a>01148                         ~<a class="code" href="phy__lp_8h.html#ad43a88aae489138904658ac43493e223">B43_LPPHY_TX_PWR_CTL_CMD_MODE</a> &amp; 0xFFFF, ctl);
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a><a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">01151</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l01152"></a>01152                                        <span class="keyword">enum</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63">b43_lpphy_txpctl_mode</a> mode)
<a name="l01153"></a>01153 {
<a name="l01154"></a>01154         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01155"></a>01155         <span class="keyword">enum</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63">b43_lpphy_txpctl_mode</a> oldmode;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157         <a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">lpphy_read_tx_pctl_mode_from_hardware</a>(dev);
<a name="l01158"></a>01158         oldmode = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a>;
<a name="l01159"></a>01159         <span class="keywordflow">if</span> (oldmode == mode)
<a name="l01160"></a>01160                 <span class="keywordflow">return</span>;
<a name="l01161"></a>01161         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a> = mode;
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         <span class="keywordflow">if</span> (oldmode == <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a6883f53ca0d7c044fceda7eb17ea00cf">B43_LPPHY_TXPCTL_HW</a>) {
<a name="l01164"></a>01164                 <span class="comment">//TODO Update TX Power NPT</span>
<a name="l01165"></a>01165                 <span class="comment">//TODO Clear all TX Power offsets</span>
<a name="l01166"></a>01166         } <span class="keywordflow">else</span> {
<a name="l01167"></a>01167                 <span class="keywordflow">if</span> (mode == <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a6883f53ca0d7c044fceda7eb17ea00cf">B43_LPPHY_TXPCTL_HW</a>) {
<a name="l01168"></a>01168                         <span class="comment">//TODO Recalculate target TX power</span>
<a name="l01169"></a>01169                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa2a554afb2021cefbcd25729aa57e35a">B43_LPPHY_TX_PWR_CTL_CMD</a>,
<a name="l01170"></a>01170                                         0xFF80, lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a1ff53c263a8536031c6d535261fc43aa">tssi_idx</a>);
<a name="l01171"></a>01171                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa010480c453bbd5b6030c57f20a28a7f">B43_LPPHY_TX_PWR_CTL_NNUM</a>,
<a name="l01172"></a>01172                                         0x8FFF, ((u16)lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aaf2e87462346d06d5d0d937ac1a5851a">tssi_npt</a> &lt;&lt; 16));
<a name="l01173"></a>01173                         <span class="comment">//TODO Set &quot;TSSI Transmit Count&quot; variable to total transmitted frame count</span>
<a name="l01174"></a>01174                         <a class="code" href="phy__lp_8c.html#ace3faccb5a4efe2cc3e2c36e50628a15">lpphy_disable_tx_gain_override</a>(dev);
<a name="l01175"></a>01175                         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ac2d7e31de9e3d4022ef992043ab56ada">tx_pwr_idx_over</a> = -1;
<a name="l01176"></a>01176                 }
<a name="l01177"></a>01177         }
<a name="l01178"></a>01178         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l01179"></a>01179                 <span class="keywordflow">if</span> (mode == <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a6883f53ca0d7c044fceda7eb17ea00cf">B43_LPPHY_TXPCTL_HW</a>)
<a name="l01180"></a>01180                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xD0), 0x2);
<a name="l01181"></a>01181                 <span class="keywordflow">else</span>
<a name="l01182"></a>01182                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xD0), 0xFFFD);
<a name="l01183"></a>01183         }
<a name="l01184"></a>01184         <a class="code" href="phy__lp_8c.html#a653ad8404c35e7ccdd5223d8d3ece066">lpphy_write_tx_pctl_mode_to_hardware</a>(dev);
<a name="l01185"></a>01185 }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#ab6d19054c5c137f1de186b0d9157da5b">b43_lpphy_op_switch_channel</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l01188"></a>01188                                        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_channel);
<a name="l01189"></a>01189 
<a name="l01190"></a><a class="code" href="phy__lp_8c.html#afbba6f34d246674b1ed0d717674436a6">01190</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#afbba6f34d246674b1ed0d717674436a6">lpphy_rev0_1_rc_calib</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01191"></a>01191 {
<a name="l01192"></a>01192         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01193"></a>01193         <span class="keyword">struct </span><a class="code" href="structlpphy__iq__est.html">lpphy_iq_est</a> iq_est;
<a name="l01194"></a>01194         <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> tx_gains;
<a name="l01195"></a>01195         <span class="keyword">static</span> <span class="keyword">const</span> u32 ideal_pwr_table[21] = {
<a name="l01196"></a>01196                 0x10000, 0x10557, 0x10e2d, 0x113e0, 0x10f22, 0x0ff64,
<a name="l01197"></a>01197                 0x0eda2, 0x0e5d4, 0x0efd1, 0x0fbe8, 0x0b7b8, 0x04b35,
<a name="l01198"></a>01198                 0x01a5e, 0x00a0b, 0x00444, 0x001fd, 0x000ff, 0x00088,
<a name="l01199"></a>01199                 0x0004c, 0x0002c, 0x0001a,
<a name="l01200"></a>01200         };
<a name="l01201"></a>01201         <span class="keywordtype">bool</span> old_txg_ovr;
<a name="l01202"></a>01202         u8 old_bbmult;
<a name="l01203"></a>01203         u16 old_rf_ovr, old_rf_ovrval, old_afe_ovr, old_afe_ovrval,
<a name="l01204"></a>01204             old_rf2_ovr, old_rf2_ovrval, old_phy_ctl;
<a name="l01205"></a>01205         <span class="keyword">enum</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63">b43_lpphy_txpctl_mode</a> old_txpctl;
<a name="l01206"></a>01206         u32 normal_pwr, ideal_pwr, mean_sq_pwr, tmp = 0, mean_sq_pwr_min = 0;
<a name="l01207"></a>01207         <span class="keywordtype">int</span> loopback, i, j, inner_sum, err;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209         memset(&amp;iq_est, 0, <span class="keyword">sizeof</span>(iq_est));
<a name="l01210"></a>01210 
<a name="l01211"></a>01211         err = <a class="code" href="phy__lp_8c.html#ab6d19054c5c137f1de186b0d9157da5b">b43_lpphy_op_switch_channel</a>(dev, 7);
<a name="l01212"></a>01212         <span class="keywordflow">if</span> (err) {
<a name="l01213"></a>01213                 <a class="code" href="main_8c.html#ac3164e7d1ba2fbd05fce755cdb232382">b43dbg</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>,
<a name="l01214"></a>01214                        <span class="stringliteral">&quot;RC calib: Failed to switch to channel 7, error = %d\n&quot;</span>,
<a name="l01215"></a>01215                        err);
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217         old_txg_ovr = !!(<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>) &amp; 0x40);
<a name="l01218"></a>01218         old_bbmult = <a class="code" href="phy__lp_8c.html#a71220c70f21317fb3f7e88095d02eb07">lpphy_get_bb_mult</a>(dev);
<a name="l01219"></a>01219         <span class="keywordflow">if</span> (old_txg_ovr)
<a name="l01220"></a>01220                 tx_gains = <a class="code" href="phy__lp_8c.html#a523b8ce697e693bd0b9f4fc12499cd2f">lpphy_get_tx_gains</a>(dev);
<a name="l01221"></a>01221         old_rf_ovr = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>);
<a name="l01222"></a>01222         old_rf_ovrval = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>);
<a name="l01223"></a>01223         old_afe_ovr = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>);
<a name="l01224"></a>01224         old_afe_ovrval = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>);
<a name="l01225"></a>01225         old_rf2_ovr = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>);
<a name="l01226"></a>01226         old_rf2_ovrval = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>);
<a name="l01227"></a>01227         old_phy_ctl = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>);
<a name="l01228"></a>01228         <a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">lpphy_read_tx_pctl_mode_from_hardware</a>(dev);
<a name="l01229"></a>01229         old_txpctl = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a>;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>);
<a name="l01232"></a>01232         <a class="code" href="phy__lp_8c.html#a00c66fbbc690126ed467b00bcff40a8f">lpphy_disable_crs</a>(dev, <span class="keyword">true</span>);
<a name="l01233"></a>01233         loopback = <a class="code" href="phy__lp_8c.html#a21cca291eb80bc9707f6686f0617f995">lpphy_loopback</a>(dev);
<a name="l01234"></a>01234         <span class="keywordflow">if</span> (loopback == -1)
<a name="l01235"></a>01235                 <span class="keywordflow">goto</span> finish;
<a name="l01236"></a>01236         <a class="code" href="phy__lp_8c.html#ac67dfcff2113871619a532fce4952f17">lpphy_set_rx_gain_by_index</a>(dev, loopback);
<a name="l01237"></a>01237         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0xFFBF, 0x40);
<a name="l01238"></a>01238         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xFFF8, 0x1);
<a name="l01239"></a>01239         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xFFC7, 0x8);
<a name="l01240"></a>01240         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xFF3F, 0xC0);
<a name="l01241"></a>01241         <span class="keywordflow">for</span> (i = 128; i &lt;= 159; i++) {
<a name="l01242"></a>01242                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a956f7e74f99d2a2abe3bec5556295dfe">B2062_N_RXBB_CALIB2</a>, i);
<a name="l01243"></a>01243                 inner_sum = 0;
<a name="l01244"></a>01244                 <span class="keywordflow">for</span> (j = 5; j &lt;= 25; j++) {
<a name="l01245"></a>01245                         <a class="code" href="phy__lp_8c.html#af1ea4f2bb06a68089d45338c2b0baf2a">lpphy_run_ddfs</a>(dev, 1, 1, j, j, 0);
<a name="l01246"></a>01246                         <span class="keywordflow">if</span> (!(<a class="code" href="phy__lp_8c.html#a8c7ce50541c71fbc6ad25cc996dff383">lpphy_rx_iq_est</a>(dev, 1000, 32, &amp;iq_est)))
<a name="l01247"></a>01247                                 <span class="keywordflow">goto</span> finish;
<a name="l01248"></a>01248                         mean_sq_pwr = iq_est.<a class="code" href="structlpphy__iq__est.html#a634a5e365e8c253a564bd732a40cc8f6">i_pwr</a> + iq_est.<a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">q_pwr</a>;
<a name="l01249"></a>01249                         <span class="keywordflow">if</span> (j == 5)
<a name="l01250"></a>01250                                 tmp = mean_sq_pwr;
<a name="l01251"></a>01251                         ideal_pwr = ((ideal_pwr_table[j-5] &gt;&gt; 3) + 1) &gt;&gt; 1;
<a name="l01252"></a>01252                         normal_pwr = <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(mean_sq_pwr, tmp, 12);
<a name="l01253"></a>01253                         mean_sq_pwr = ideal_pwr - normal_pwr;
<a name="l01254"></a>01254                         mean_sq_pwr *= mean_sq_pwr;
<a name="l01255"></a>01255                         inner_sum += mean_sq_pwr;
<a name="l01256"></a>01256                         <span class="keywordflow">if</span> ((i == 128) || (inner_sum &lt; mean_sq_pwr_min)) {
<a name="l01257"></a>01257                                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a> = i;
<a name="l01258"></a>01258                                 mean_sq_pwr_min = inner_sum;
<a name="l01259"></a>01259                         }
<a name="l01260"></a>01260                 }
<a name="l01261"></a>01261         }
<a name="l01262"></a>01262         <a class="code" href="phy__lp_8c.html#abff9da1c95fc62941dc8b0d89ebcfeae">lpphy_stop_ddfs</a>(dev);
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 finish:
<a name="l01265"></a>01265         <a class="code" href="phy__lp_8c.html#a51b582ee8a7cf7e0052681692514f779">lpphy_restore_crs</a>(dev, <span class="keyword">true</span>);
<a name="l01266"></a>01266         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, old_rf_ovrval);
<a name="l01267"></a>01267         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, old_rf_ovr);
<a name="l01268"></a>01268         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>, old_afe_ovrval);
<a name="l01269"></a>01269         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, old_afe_ovr);
<a name="l01270"></a>01270         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, old_rf2_ovrval);
<a name="l01271"></a>01271         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, old_rf2_ovr);
<a name="l01272"></a>01272         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, old_phy_ctl);
<a name="l01273"></a>01273 
<a name="l01274"></a>01274         <a class="code" href="phy__lp_8c.html#a5069ae26dc96ec4524716141b3019a7b">lpphy_set_bb_mult</a>(dev, old_bbmult);
<a name="l01275"></a>01275         <span class="keywordflow">if</span> (old_txg_ovr) {
<a name="l01276"></a>01276                 <span class="comment">/*</span>
<a name="l01277"></a>01277 <span class="comment">                 * SPEC FIXME: The specs say &quot;get_tx_gains&quot; here, which is</span>
<a name="l01278"></a>01278 <span class="comment">                 * illogical. According to lwfinger, vendor driver v4.150.10.5</span>
<a name="l01279"></a>01279 <span class="comment">                 * has a Set here, while v4.174.64.19 has a Get - regression in</span>
<a name="l01280"></a>01280 <span class="comment">                 * the vendor driver? This should be tested this once the code</span>
<a name="l01281"></a>01281 <span class="comment">                 * is testable.</span>
<a name="l01282"></a>01282 <span class="comment">                 */</span>
<a name="l01283"></a>01283                 <a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">lpphy_set_tx_gains</a>(dev, tx_gains);
<a name="l01284"></a>01284         }
<a name="l01285"></a>01285         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, old_txpctl);
<a name="l01286"></a>01286         <span class="keywordflow">if</span> (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a>)
<a name="l01287"></a>01287                 <a class="code" href="phy__lp_8c.html#af36b52560caf8f4b2ef1df59c649f2b3">lpphy_set_rc_cap</a>(dev);
<a name="l01288"></a>01288 }
<a name="l01289"></a>01289 
<a name="l01290"></a><a class="code" href="phy__lp_8c.html#a8c6d4264726ee94dddc2394d51d2aae0">01290</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a8c6d4264726ee94dddc2394d51d2aae0">lpphy_rev2plus_rc_calib</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01291"></a>01291 {
<a name="l01292"></a>01292         <span class="keyword">struct </span>ssb_bus *bus = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a68f9a4660126ada1510b28be93e1dd0d">sdev</a>-&gt;bus;
<a name="l01293"></a>01293         u32 crystal_freq = bus-&gt;chipco.pmu.crystalfreq * 1000;
<a name="l01294"></a>01294         u8 tmp = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a7f54cf3b691511be8adf4406c8f6b5ca">B2063_RX_BB_SP8</a>) &amp; 0xFF;
<a name="l01295"></a>01295         <span class="keywordtype">int</span> i;
<a name="l01296"></a>01296 
<a name="l01297"></a>01297         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7f54cf3b691511be8adf4406c8f6b5ca">B2063_RX_BB_SP8</a>, 0x0);
<a name="l01298"></a>01298         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa6bea2105626d8b5832117a056350e82">B2063_RC_CALIB_CTL1</a>, 0x7E);
<a name="l01299"></a>01299         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a52cd89a8f0e024a8e741b4a1db2b2839">B2063_PLL_SP1</a>, 0xF7);
<a name="l01300"></a>01300         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa6bea2105626d8b5832117a056350e82">B2063_RC_CALIB_CTL1</a>, 0x7C);
<a name="l01301"></a>01301         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a893f5479bcb6614c9f5b2c169abbf393">B2063_RC_CALIB_CTL2</a>, 0x15);
<a name="l01302"></a>01302         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aaddb90081771bfcb13bba092aa6f4191">B2063_RC_CALIB_CTL3</a>, 0x70);
<a name="l01303"></a>01303         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1913d40a05972a1d21017cb00ec54fc7">B2063_RC_CALIB_CTL4</a>, 0x52);
<a name="l01304"></a>01304         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae6ed82a200b298710abf2a3fb16b279b">B2063_RC_CALIB_CTL5</a>, 0x1);
<a name="l01305"></a>01305         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa6bea2105626d8b5832117a056350e82">B2063_RC_CALIB_CTL1</a>, 0x7D);
<a name="l01306"></a>01306 
<a name="l01307"></a>01307         <span class="keywordflow">for</span> (i = 0; i &lt; 10000; i++) {
<a name="l01308"></a>01308                 <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a98f171e2cef820010c8cb0f38659a08c">B2063_RC_CALIB_CTL6</a>) &amp; 0x2)
<a name="l01309"></a>01309                         <span class="keywordflow">break</span>;
<a name="l01310"></a>01310                 msleep(1);
<a name="l01311"></a>01311         }
<a name="l01312"></a>01312 
<a name="l01313"></a>01313         <span class="keywordflow">if</span> (!(<a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a98f171e2cef820010c8cb0f38659a08c">B2063_RC_CALIB_CTL6</a>) &amp; 0x2))
<a name="l01314"></a>01314                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7f54cf3b691511be8adf4406c8f6b5ca">B2063_RX_BB_SP8</a>, tmp);
<a name="l01315"></a>01315 
<a name="l01316"></a>01316         tmp = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#ab6f6ad638776ca6d6bbdee52f1b4d51e">B2063_TX_BB_SP3</a>) &amp; 0xFF;
<a name="l01317"></a>01317 
<a name="l01318"></a>01318         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ab6f6ad638776ca6d6bbdee52f1b4d51e">B2063_TX_BB_SP3</a>, 0x0);
<a name="l01319"></a>01319         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa6bea2105626d8b5832117a056350e82">B2063_RC_CALIB_CTL1</a>, 0x7E);
<a name="l01320"></a>01320         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa6bea2105626d8b5832117a056350e82">B2063_RC_CALIB_CTL1</a>, 0x7C);
<a name="l01321"></a>01321         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a893f5479bcb6614c9f5b2c169abbf393">B2063_RC_CALIB_CTL2</a>, 0x55);
<a name="l01322"></a>01322         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aaddb90081771bfcb13bba092aa6f4191">B2063_RC_CALIB_CTL3</a>, 0x76);
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         <span class="keywordflow">if</span> (crystal_freq == 24000000) {
<a name="l01325"></a>01325                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1913d40a05972a1d21017cb00ec54fc7">B2063_RC_CALIB_CTL4</a>, 0xFC);
<a name="l01326"></a>01326                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae6ed82a200b298710abf2a3fb16b279b">B2063_RC_CALIB_CTL5</a>, 0x0);
<a name="l01327"></a>01327         } <span class="keywordflow">else</span> {
<a name="l01328"></a>01328                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1913d40a05972a1d21017cb00ec54fc7">B2063_RC_CALIB_CTL4</a>, 0x13);
<a name="l01329"></a>01329                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae6ed82a200b298710abf2a3fb16b279b">B2063_RC_CALIB_CTL5</a>, 0x1);
<a name="l01330"></a>01330         }
<a name="l01331"></a>01331 
<a name="l01332"></a>01332         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9d6b6ee9df89b72bbb80d571d3aca1a2">B2063_PA_SP7</a>, 0x7D);
<a name="l01333"></a>01333 
<a name="l01334"></a>01334         <span class="keywordflow">for</span> (i = 0; i &lt; 10000; i++) {
<a name="l01335"></a>01335                 <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a98f171e2cef820010c8cb0f38659a08c">B2063_RC_CALIB_CTL6</a>) &amp; 0x2)
<a name="l01336"></a>01336                         <span class="keywordflow">break</span>;
<a name="l01337"></a>01337                 msleep(1);
<a name="l01338"></a>01338         }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340         <span class="keywordflow">if</span> (!(<a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a98f171e2cef820010c8cb0f38659a08c">B2063_RC_CALIB_CTL6</a>) &amp; 0x2))
<a name="l01341"></a>01341                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ab6f6ad638776ca6d6bbdee52f1b4d51e">B2063_TX_BB_SP3</a>, tmp);
<a name="l01342"></a>01342 
<a name="l01343"></a>01343         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa6bea2105626d8b5832117a056350e82">B2063_RC_CALIB_CTL1</a>, 0x7E);
<a name="l01344"></a>01344 }
<a name="l01345"></a>01345 
<a name="l01346"></a><a class="code" href="phy__lp_8c.html#a854737878e955b4dbbdd8b79c519ed3d">01346</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a854737878e955b4dbbdd8b79c519ed3d">lpphy_calibrate_rc</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01347"></a>01347 {
<a name="l01348"></a>01348         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01349"></a>01349 
<a name="l01350"></a>01350         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l01351"></a>01351                 <a class="code" href="phy__lp_8c.html#a8c6d4264726ee94dddc2394d51d2aae0">lpphy_rev2plus_rc_calib</a>(dev);
<a name="l01352"></a>01352         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a>) {
<a name="l01353"></a>01353                 <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ)
<a name="l01354"></a>01354                         <a class="code" href="phy__lp_8c.html#afbba6f34d246674b1ed0d717674436a6">lpphy_rev0_1_rc_calib</a>(dev);
<a name="l01355"></a>01355         } <span class="keywordflow">else</span> {
<a name="l01356"></a>01356                 <a class="code" href="phy__lp_8c.html#af36b52560caf8f4b2ef1df59c649f2b3">lpphy_set_rc_cap</a>(dev);
<a name="l01357"></a>01357         }
<a name="l01358"></a>01358 }
<a name="l01359"></a>01359 
<a name="l01360"></a><a class="code" href="phy__lp_8c.html#a9b923d1221a20e16fc08bdab51a812ab">01360</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a9b923d1221a20e16fc08bdab51a812ab">b43_lpphy_op_set_rx_antenna</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">int</span> <a class="code" href="structb43__phy__lp.html#a571ca5b4d10b51617b5568b2b263da86">antenna</a>)
<a name="l01361"></a>01361 {
<a name="l01362"></a>01362         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2)
<a name="l01363"></a>01363                 <span class="keywordflow">return</span>; <span class="comment">// rev2+ doesn&#39;t support antenna diversity</span>
<a name="l01364"></a>01364 
<a name="l01365"></a>01365         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(antenna &gt; <a class="code" href="phy__common_8h.html#a385c44f6fb256e5716a2302a5b940388a8589abedca2bbccd414664343e7e07e4">B43_ANTENNA_AUTO1</a>))
<a name="l01366"></a>01366                 <span class="keywordflow">return</span>;
<a name="l01367"></a>01367 
<a name="l01368"></a>01368         <a class="code" href="main_8c.html#abbb7dc97d3d48c3504e1c35b366407ad">b43_hf_write</a>(dev, <a class="code" href="main_8c.html#a3f3a1d36e1882927e495fa890efbbe97">b43_hf_read</a>(dev) &amp; ~<a class="code" href="b43_8h.html#a641194b823a700dea1d991ccf3cb1e28">B43_HF_ANTDIVHELP</a>);
<a name="l01369"></a>01369 
<a name="l01370"></a>01370         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0xFFFD, antenna &amp; 0x2);
<a name="l01371"></a>01371         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a323a013d422c64e79b135e268fe9ef96">B43_LPPHY_CRSGAIN_CTL</a>, 0xFFFE, antenna &amp; 0x1);
<a name="l01372"></a>01372 
<a name="l01373"></a>01373         <a class="code" href="main_8c.html#abbb7dc97d3d48c3504e1c35b366407ad">b43_hf_write</a>(dev, <a class="code" href="main_8c.html#a3f3a1d36e1882927e495fa890efbbe97">b43_hf_read</a>(dev) | <a class="code" href="b43_8h.html#a641194b823a700dea1d991ccf3cb1e28">B43_HF_ANTDIVHELP</a>);
<a name="l01374"></a>01374 
<a name="l01375"></a>01375         dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>-&gt;<a class="code" href="structb43__phy__lp.html#a571ca5b4d10b51617b5568b2b263da86">antenna</a> = antenna;
<a name="l01376"></a>01376 }
<a name="l01377"></a>01377 
<a name="l01378"></a><a class="code" href="phy__lp_8c.html#af9101acde47f6153aa0b25119cdbef2a">01378</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#af9101acde47f6153aa0b25119cdbef2a">lpphy_set_tx_iqcc</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 a, u16 b)
<a name="l01379"></a>01379 {
<a name="l01380"></a>01380         u16 tmp[2];
<a name="l01381"></a>01381 
<a name="l01382"></a>01382         tmp[0] = a;
<a name="l01383"></a>01383         tmp[1] = b;
<a name="l01384"></a>01384         <a class="code" href="tables__lpphy_8c.html#ae6336133eb23c4dd79e732ff2252c603">b43_lptab_write_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(0, 80), 2, tmp);
<a name="l01385"></a>01385 }
<a name="l01386"></a>01386 
<a name="l01387"></a><a class="code" href="phy__lp_8c.html#a5062911000771e4100071e4ba4012f50">01387</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a5062911000771e4100071e4ba4012f50">lpphy_set_tx_power_by_index</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u8 index)
<a name="l01388"></a>01388 {
<a name="l01389"></a>01389         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01390"></a>01390         <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> gains;
<a name="l01391"></a>01391         u32 iq_comp, tx_gain, coeff, rf_power;
<a name="l01392"></a>01392 
<a name="l01393"></a>01393         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ac2d7e31de9e3d4022ef992043ab56ada">tx_pwr_idx_over</a> = index;
<a name="l01394"></a>01394         <a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">lpphy_read_tx_pctl_mode_from_hardware</a>(dev);
<a name="l01395"></a>01395         <span class="keywordflow">if</span> (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a> != <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>)
<a name="l01396"></a>01396                 <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a79f603739fdd05bd4639603ffacb1011">B43_LPPHY_TXPCTL_SW</a>);
<a name="l01397"></a>01397         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l01398"></a>01398                 iq_comp = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(7, index + 320));
<a name="l01399"></a>01399                 tx_gain = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(7, index + 192));
<a name="l01400"></a>01400                 gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> = (tx_gain &gt;&gt; 16) &amp; 0xFF;
<a name="l01401"></a>01401                 gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a> = tx_gain &amp; 0xFF;
<a name="l01402"></a>01402                 gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> = (tx_gain &gt;&gt; 8) &amp; 0xFF;
<a name="l01403"></a>01403                 gains.<a class="code" href="structlpphy__tx__gains.html#ae24fe3164361adc1a072651d8a9fb2e0">dac</a> = (iq_comp &gt;&gt; 28) &amp; 0xFF;
<a name="l01404"></a>01404                 <a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">lpphy_set_tx_gains</a>(dev, gains);
<a name="l01405"></a>01405         } <span class="keywordflow">else</span> {
<a name="l01406"></a>01406                 iq_comp = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(10, index + 320));
<a name="l01407"></a>01407                 tx_gain = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(10, index + 192));
<a name="l01408"></a>01408                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#abbdb8937c15e58e465445c0dd03db169">B43_LPPHY_TX_GAIN_CTL_OVERRIDE_VAL</a>,
<a name="l01409"></a>01409                                 0xF800, (tx_gain &gt;&gt; 4) &amp; 0x7FFF);
<a name="l01410"></a>01410                 <a class="code" href="phy__lp_8c.html#a0f57ad6207dc6441ec6ec28465680527">lpphy_set_dac_gain</a>(dev, tx_gain &amp; 0x7);
<a name="l01411"></a>01411                 <a class="code" href="phy__lp_8c.html#a91da2881cd6bc2f111b9056df00a9dd2">lpphy_set_pa_gain</a>(dev, (tx_gain &gt;&gt; 24) &amp; 0x7F);
<a name="l01412"></a>01412         }
<a name="l01413"></a>01413         <a class="code" href="phy__lp_8c.html#a5069ae26dc96ec4524716141b3019a7b">lpphy_set_bb_mult</a>(dev, (iq_comp &gt;&gt; 20) &amp; 0xFF);
<a name="l01414"></a>01414         <a class="code" href="phy__lp_8c.html#af9101acde47f6153aa0b25119cdbef2a">lpphy_set_tx_iqcc</a>(dev, (iq_comp &gt;&gt; 10) &amp; 0x3FF, iq_comp &amp; 0x3FF);
<a name="l01415"></a>01415         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l01416"></a>01416                 coeff = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(7, index + 448));
<a name="l01417"></a>01417         } <span class="keywordflow">else</span> {
<a name="l01418"></a>01418                 coeff = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(10, index + 448));
<a name="l01419"></a>01419         }
<a name="l01420"></a>01420         <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(0, 85), coeff &amp; 0xFFFF);
<a name="l01421"></a>01421         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l01422"></a>01422                 rf_power = <a class="code" href="tables__lpphy_8c.html#ae2c6277ed827dccee78fa9410e50d09f">b43_lptab_read</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(7, index + 576));
<a name="l01423"></a>01423                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a64d9083ab2084dd424eec73a94d8a876">B43_LPPHY_RF_PWR_OVERRIDE</a>, 0xFF00,
<a name="l01424"></a>01424                                 rf_power &amp; 0xFFFF);<span class="comment">//SPEC FIXME mask &amp; set != 0</span>
<a name="l01425"></a>01425         }
<a name="l01426"></a>01426         <a class="code" href="phy__lp_8c.html#aa2ac46731987d02af3d6dc098aad5c87">lpphy_enable_tx_gain_override</a>(dev);
<a name="l01427"></a>01427 }
<a name="l01428"></a>01428 
<a name="l01429"></a><a class="code" href="phy__lp_8c.html#aa87d256740b46f98a929731dfa37b3ff">01429</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aa87d256740b46f98a929731dfa37b3ff">lpphy_btcoex_override</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01430"></a>01430 {
<a name="l01431"></a>01431         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a9af40546dff030145a1787e772b0faad">B43_MMIO_BTCOEX_CTL</a>, 0x3);
<a name="l01432"></a>01432         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a37e829ef979cd6f4279ed7d87e59c4b2">B43_MMIO_BTCOEX_TXCTL</a>, 0xFF);
<a name="l01433"></a>01433 }
<a name="l01434"></a>01434 
<a name="l01435"></a><a class="code" href="phy__lp_8c.html#a22cd2ad69d93f1bb299f16f071681455">01435</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a22cd2ad69d93f1bb299f16f071681455">b43_lpphy_op_software_rfkill</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l01436"></a>01436                                          <span class="keywordtype">bool</span> blocked)
<a name="l01437"></a>01437 {
<a name="l01438"></a>01438         <span class="comment">//TODO check MAC control register</span>
<a name="l01439"></a>01439         <span class="keywordflow">if</span> (blocked) {
<a name="l01440"></a>01440                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l01441"></a>01441                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0x83FF);
<a name="l01442"></a>01442                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x1F00);
<a name="l01443"></a>01443                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ab0eb09d94ea952de5b1010450d5c6950">B43_LPPHY_AFE_DDFS</a>, 0x80FF);
<a name="l01444"></a>01444                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xDFFF);
<a name="l01445"></a>01445                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x0808);
<a name="l01446"></a>01446                 } <span class="keywordflow">else</span> {
<a name="l01447"></a>01447                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xE0FF);
<a name="l01448"></a>01448                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x1F00);
<a name="l01449"></a>01449                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a7da2d35ca492e40d41fc727c29c39458">B43_LPPHY_RF_OVERRIDE_2_VAL</a>, 0xFCFF);
<a name="l01450"></a>01450                         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0x0018);
<a name="l01451"></a>01451                 }
<a name="l01452"></a>01452         } <span class="keywordflow">else</span> {
<a name="l01453"></a>01453                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xE0FF);
<a name="l01454"></a>01454                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2)
<a name="l01455"></a>01455                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xF7F7);
<a name="l01456"></a>01456                 <span class="keywordflow">else</span>
<a name="l01457"></a>01457                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac89a11f8472696005205e087b6ae17cb">B43_LPPHY_RF_OVERRIDE_2</a>, 0xFFE7);
<a name="l01458"></a>01458         }
<a name="l01459"></a>01459 }
<a name="l01460"></a>01460 
<a name="l01461"></a>01461 <span class="comment">/* This was previously called lpphy_japan_filter */</span>
<a name="l01462"></a><a class="code" href="phy__lp_8c.html#a910915d83f25e0d777567299f5af3ab8">01462</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a910915d83f25e0d777567299f5af3ab8">lpphy_set_analog_filter</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">int</span> channel)
<a name="l01463"></a>01463 {
<a name="l01464"></a>01464         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01465"></a>01465         u16 tmp = (channel == 14); <span class="comment">//SPEC FIXME check japanwidefilter!</span>
<a name="l01466"></a>01466 
<a name="l01467"></a>01467         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) { <span class="comment">//SPEC FIXME Isn&#39;t this rev0/1-specific?</span>
<a name="l01468"></a>01468                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0xFCFF, tmp &lt;&lt; 9);
<a name="l01469"></a>01469                 <span class="keywordflow">if</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 1) &amp;&amp; (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a>))
<a name="l01470"></a>01470                         <a class="code" href="phy__lp_8c.html#af36b52560caf8f4b2ef1df59c649f2b3">lpphy_set_rc_cap</a>(dev);
<a name="l01471"></a>01471         } <span class="keywordflow">else</span> {
<a name="l01472"></a>01472                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ab6f6ad638776ca6d6bbdee52f1b4d51e">B2063_TX_BB_SP3</a>, 0x3F);
<a name="l01473"></a>01473         }
<a name="l01474"></a>01474 }
<a name="l01475"></a>01475 
<a name="l01476"></a><a class="code" href="phy__lp_8c.html#a238dd2f3bbc3d6393ff5f993572c6c27">01476</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a238dd2f3bbc3d6393ff5f993572c6c27">lpphy_set_tssi_mux</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keyword">enum</span> <a class="code" href="phy__lp_8h.html#aad718d14bc75296b6f9bf45eae3ab74f">tssi_mux_mode</a> mode)
<a name="l01477"></a>01477 {
<a name="l01478"></a>01478         <span class="keywordflow">if</span> (mode != <a class="code" href="phy__lp_8h.html#aad718d14bc75296b6f9bf45eae3ab74fa6922c8741a237e8f01362129a9cbcef8">TSSI_MUX_EXT</a>) {
<a name="l01479"></a>01479                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a8c55bf36f210f860724152040adedcf3">B2063_PA_SP1</a>, 0x2);
<a name="l01480"></a>01480                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0xF3), 0x1000);
<a name="l01481"></a>01481                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7bbfc10b422ef590290ee9fe9c37a659">B2063_PA_CTL10</a>, 0x51);
<a name="l01482"></a>01482                 <span class="keywordflow">if</span> (mode == <a class="code" href="phy__lp_8h.html#aad718d14bc75296b6f9bf45eae3ab74fa500914fe00d8352e73b85ef148df2fe5">TSSI_MUX_POSTPA</a>) {
<a name="l01483"></a>01483                         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a8c55bf36f210f860724152040adedcf3">B2063_PA_SP1</a>, 0xFFFE);
<a name="l01484"></a>01484                         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>, 0xFFC7);
<a name="l01485"></a>01485                 } <span class="keywordflow">else</span> {
<a name="l01486"></a>01486                         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8c55bf36f210f860724152040adedcf3">B2063_PA_SP1</a>, 0xFFFE, 0x1);
<a name="l01487"></a>01487                         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>,
<a name="l01488"></a>01488                                         0xFFC7, 0x20);
<a name="l01489"></a>01489                 }
<a name="l01490"></a>01490         } <span class="keywordflow">else</span> {
<a name="l01491"></a>01491                 <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(1);
<a name="l01492"></a>01492         }
<a name="l01493"></a>01493 }
<a name="l01494"></a>01494 
<a name="l01495"></a><a class="code" href="phy__lp_8c.html#a41379f9c3a909ba0a951fb8a2f7e8eb7">01495</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a41379f9c3a909ba0a951fb8a2f7e8eb7">lpphy_tx_pctl_init_hw</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01496"></a>01496 {
<a name="l01497"></a>01497         u16 tmp;
<a name="l01498"></a>01498         <span class="keywordtype">int</span> i;
<a name="l01499"></a>01499 
<a name="l01500"></a>01500         <span class="comment">//SPEC TODO Call LP PHY Clear TX Power offsets</span>
<a name="l01501"></a>01501         <span class="keywordflow">for</span> (i = 0; i &lt; 64; i++) {
<a name="l01502"></a>01502                 <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2)
<a name="l01503"></a>01503                         <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(7, i + 1), i);
<a name="l01504"></a>01504                 <span class="keywordflow">else</span>
<a name="l01505"></a>01505                         <a class="code" href="tables__lpphy_8c.html#a4510b42ad9b05b874ec0bb516cfb1fe2">b43_lptab_write</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(10, i + 1), i);
<a name="l01506"></a>01506         }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa010480c453bbd5b6030c57f20a28a7f">B43_LPPHY_TX_PWR_CTL_NNUM</a>, 0xFF00, 0xFF);
<a name="l01509"></a>01509         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa010480c453bbd5b6030c57f20a28a7f">B43_LPPHY_TX_PWR_CTL_NNUM</a>, 0x8FFF, 0x5000);
<a name="l01510"></a>01510         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab6db0e36b3ee284e18c4a55e1fede73e">B43_LPPHY_TX_PWR_CTL_IDLETSSI</a>, 0xFFC0, 0x1F);
<a name="l01511"></a>01511         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l01512"></a>01512                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0xEFFF);
<a name="l01513"></a>01513                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a89eb1e727246c1572c9e261985a3fa8a">B43_LPPHY_LP_PHY_CTL</a>, 0xDFFF, 0x2000);
<a name="l01514"></a>01514         } <span class="keywordflow">else</span> {
<a name="l01515"></a>01515                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x103), 0xFFFE);
<a name="l01516"></a>01516                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x103), 0xFFFB, 0x4);
<a name="l01517"></a>01517                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__common_8h.html#aa78dbabac223e0ea84f02dbf2c15d2b6">B43_PHY_OFDM</a>(0x103), 0xFFEF, 0x10);
<a name="l01518"></a>01518                 <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aac95fd72e3639bfb7afecb19006e3c24">B2063_IQ_CALIB_CTL2</a>, 0xF3, 0x1);
<a name="l01519"></a>01519                 <a class="code" href="phy__lp_8c.html#a238dd2f3bbc3d6393ff5f993572c6c27">lpphy_set_tssi_mux</a>(dev, <a class="code" href="phy__lp_8h.html#aad718d14bc75296b6f9bf45eae3ab74fa500914fe00d8352e73b85ef148df2fe5">TSSI_MUX_POSTPA</a>);
<a name="l01520"></a>01520         }
<a name="l01521"></a>01521         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab6db0e36b3ee284e18c4a55e1fede73e">B43_LPPHY_TX_PWR_CTL_IDLETSSI</a>, 0x7FFF, 0x8000);
<a name="l01522"></a>01522         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#abb71ae075f5d13ef24f7d6e8beca0496">B43_LPPHY_TX_PWR_CTL_DELTAPWR_LIMIT</a>, 0xFF);
<a name="l01523"></a>01523         <a class="code" href="phy__common_8c.html#a771be8516fddf5dd3f42196ba536739e">b43_phy_write</a>(dev, <a class="code" href="phy__lp_8h.html#abb71ae075f5d13ef24f7d6e8beca0496">B43_LPPHY_TX_PWR_CTL_DELTAPWR_LIMIT</a>, 0xA);
<a name="l01524"></a>01524         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa2a554afb2021cefbcd25729aa57e35a">B43_LPPHY_TX_PWR_CTL_CMD</a>,
<a name="l01525"></a>01525                         ~<a class="code" href="phy__lp_8h.html#ad43a88aae489138904658ac43493e223">B43_LPPHY_TX_PWR_CTL_CMD_MODE</a> &amp; 0xFFFF,
<a name="l01526"></a>01526                         <a class="code" href="phy__lp_8h.html#a3dc72c024b5f99a1c43aee05c4c27d07">B43_LPPHY_TX_PWR_CTL_CMD_MODE_OFF</a>);
<a name="l01527"></a>01527         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#aa010480c453bbd5b6030c57f20a28a7f">B43_LPPHY_TX_PWR_CTL_NNUM</a>, 0xF8FF);
<a name="l01528"></a>01528         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa2a554afb2021cefbcd25729aa57e35a">B43_LPPHY_TX_PWR_CTL_CMD</a>,
<a name="l01529"></a>01529                         ~<a class="code" href="phy__lp_8h.html#ad43a88aae489138904658ac43493e223">B43_LPPHY_TX_PWR_CTL_CMD_MODE</a> &amp; 0xFFFF,
<a name="l01530"></a>01530                         <a class="code" href="phy__lp_8h.html#afed4f74b4882a1c46041d12a378aa8b4">B43_LPPHY_TX_PWR_CTL_CMD_MODE_SW</a>);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l01533"></a>01533                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xEFFF, 0x1000);
<a name="l01534"></a>01534                 <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0xEFFF);
<a name="l01535"></a>01535         } <span class="keywordflow">else</span> {
<a name="l01536"></a>01536                 <a class="code" href="phy__lp_8c.html#a5062911000771e4100071e4ba4012f50">lpphy_set_tx_power_by_index</a>(dev, 0x7F);
<a name="l01537"></a>01537         }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539         <a class="code" href="main_8c.html#a81f3a88ca0158a67ecadf6f38d9f6c4c">b43_dummy_transmission</a>(dev, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l01540"></a>01540 
<a name="l01541"></a>01541         tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#aae088f24b246e8d834d22adb6173bbdc">B43_LPPHY_TX_PWR_CTL_STAT</a>);
<a name="l01542"></a>01542         <span class="keywordflow">if</span> (tmp &amp; 0x8000) {
<a name="l01543"></a>01543                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ab6db0e36b3ee284e18c4a55e1fede73e">B43_LPPHY_TX_PWR_CTL_IDLETSSI</a>,
<a name="l01544"></a>01544                                 0xFFC0, (tmp &amp; 0xFF) - 32);
<a name="l01545"></a>01545         }
<a name="l01546"></a>01546 
<a name="l01547"></a>01547         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xEFFF);
<a name="l01548"></a>01548 
<a name="l01549"></a>01549         <span class="comment">// (SPEC?) TODO Set &quot;Target TX frequency&quot; variable to 0</span>
<a name="l01550"></a>01550         <span class="comment">// SPEC FIXME &quot;Set BB Multiplier to 0xE000&quot; impossible - bb_mult is u8!</span>
<a name="l01551"></a>01551 }
<a name="l01552"></a>01552 
<a name="l01553"></a><a class="code" href="phy__lp_8c.html#a337a9837023a0200df8d8f3907fb9a6f">01553</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a337a9837023a0200df8d8f3907fb9a6f">lpphy_tx_pctl_init_sw</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01554"></a>01554 {
<a name="l01555"></a>01555         <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> gains;
<a name="l01556"></a>01556 
<a name="l01557"></a>01557         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l01558"></a>01558                 gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a> = 4;
<a name="l01559"></a>01559                 gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> = 12;
<a name="l01560"></a>01560                 gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> = 12;
<a name="l01561"></a>01561                 gains.<a class="code" href="structlpphy__tx__gains.html#ae24fe3164361adc1a072651d8a9fb2e0">dac</a> = 0;
<a name="l01562"></a>01562         } <span class="keywordflow">else</span> {
<a name="l01563"></a>01563                 gains.<a class="code" href="structlpphy__tx__gains.html#acf42adc6b651e4d05f7538ccddd7d4de">gm</a> = 7;
<a name="l01564"></a>01564                 gains.<a class="code" href="structlpphy__tx__gains.html#af8a3f8480f5df29b014bcfaacee3330b">pad</a> = 14;
<a name="l01565"></a>01565                 gains.<a class="code" href="structlpphy__tx__gains.html#af8e0ae410683a7319a7a038cda1a4f28">pga</a> = 15;
<a name="l01566"></a>01566                 gains.<a class="code" href="structlpphy__tx__gains.html#ae24fe3164361adc1a072651d8a9fb2e0">dac</a> = 0;
<a name="l01567"></a>01567         }
<a name="l01568"></a>01568         <a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">lpphy_set_tx_gains</a>(dev, gains);
<a name="l01569"></a>01569         <a class="code" href="phy__lp_8c.html#a5069ae26dc96ec4524716141b3019a7b">lpphy_set_bb_mult</a>(dev, 150);
<a name="l01570"></a>01570 }
<a name="l01571"></a>01571 
<a name="l01572"></a>01572 <span class="comment">/* Initialize TX power control */</span>
<a name="l01573"></a><a class="code" href="phy__lp_8c.html#a9c5c889bb22d55992545ca5e8c7fbcf6">01573</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a9c5c889bb22d55992545ca5e8c7fbcf6">lpphy_tx_pctl_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01574"></a>01574 {
<a name="l01575"></a>01575         <span class="keywordflow">if</span> (0<span class="comment">/*FIXME HWPCTL capable */</span>) {
<a name="l01576"></a>01576                 <a class="code" href="phy__lp_8c.html#a41379f9c3a909ba0a951fb8a2f7e8eb7">lpphy_tx_pctl_init_hw</a>(dev);
<a name="l01577"></a>01577         } <span class="keywordflow">else</span> { <span class="comment">/* This device is only software TX power control capable. */</span>
<a name="l01578"></a>01578                 <a class="code" href="phy__lp_8c.html#a337a9837023a0200df8d8f3907fb9a6f">lpphy_tx_pctl_init_sw</a>(dev);
<a name="l01579"></a>01579         }
<a name="l01580"></a>01580 }
<a name="l01581"></a>01581 
<a name="l01582"></a><a class="code" href="phy__lp_8c.html#ad9ff06fe849062b35ab2d37742049a9a">01582</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ad9ff06fe849062b35ab2d37742049a9a">lpphy_pr41573_workaround</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01583"></a>01583 {
<a name="l01584"></a>01584         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01585"></a>01585         u32 *saved_tab;
<a name="l01586"></a>01586         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> saved_tab_size = 256;
<a name="l01587"></a>01587         <span class="keyword">enum</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63">b43_lpphy_txpctl_mode</a> <a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a>;
<a name="l01588"></a>01588         s8 <a class="code" href="structb43__phy__lp.html#ac2d7e31de9e3d4022ef992043ab56ada">tx_pwr_idx_over</a>;
<a name="l01589"></a>01589         u16 <a class="code" href="structb43__phy__lp.html#aaf2e87462346d06d5d0d937ac1a5851a">tssi_npt</a>, <a class="code" href="structb43__phy__lp.html#a1ff53c263a8536031c6d535261fc43aa">tssi_idx</a>;
<a name="l01590"></a>01590 
<a name="l01591"></a>01591         saved_tab = kcalloc(saved_tab_size, <span class="keyword">sizeof</span>(saved_tab[0]), GFP_KERNEL);
<a name="l01592"></a>01592         <span class="keywordflow">if</span> (!saved_tab) {
<a name="l01593"></a>01593                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;PR41573 failed. Out of memory!\n&quot;</span>);
<a name="l01594"></a>01594                 <span class="keywordflow">return</span>;
<a name="l01595"></a>01595         }
<a name="l01596"></a>01596 
<a name="l01597"></a>01597         <a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">lpphy_read_tx_pctl_mode_from_hardware</a>(dev);
<a name="l01598"></a>01598         txpctl_mode = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a>;
<a name="l01599"></a>01599         tx_pwr_idx_over = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ac2d7e31de9e3d4022ef992043ab56ada">tx_pwr_idx_over</a>;
<a name="l01600"></a>01600         tssi_npt = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aaf2e87462346d06d5d0d937ac1a5851a">tssi_npt</a>;
<a name="l01601"></a>01601         tssi_idx = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a1ff53c263a8536031c6d535261fc43aa">tssi_idx</a>;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l01604"></a>01604                 <a class="code" href="tables__lpphy_8c.html#a321c479ddb114e012cb8036c5dd12a54">b43_lptab_read_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(10, 0x140),
<a name="l01605"></a>01605                                     saved_tab_size, saved_tab);
<a name="l01606"></a>01606         } <span class="keywordflow">else</span> {
<a name="l01607"></a>01607                 <a class="code" href="tables__lpphy_8c.html#a321c479ddb114e012cb8036c5dd12a54">b43_lptab_read_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(7, 0x140),
<a name="l01608"></a>01608                                     saved_tab_size, saved_tab);
<a name="l01609"></a>01609         }
<a name="l01610"></a>01610         <span class="comment">//FIXME PHY reset</span>
<a name="l01611"></a>01611         <a class="code" href="phy__lp_8c.html#af6014b2353ab5831819938bebce43202">lpphy_table_init</a>(dev); <span class="comment">//FIXME is table init needed?</span>
<a name="l01612"></a>01612         <a class="code" href="phy__lp_8c.html#a2a19134a4b2f53e365096b848b6443cc">lpphy_baseband_init</a>(dev);
<a name="l01613"></a>01613         <a class="code" href="phy__lp_8c.html#a9c5c889bb22d55992545ca5e8c7fbcf6">lpphy_tx_pctl_init</a>(dev);
<a name="l01614"></a>01614         <a class="code" href="phy__lp_8c.html#a22cd2ad69d93f1bb299f16f071681455">b43_lpphy_op_software_rfkill</a>(dev, <span class="keyword">false</span>);
<a name="l01615"></a>01615         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>);
<a name="l01616"></a>01616         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l01617"></a>01617                 <a class="code" href="tables__lpphy_8c.html#ae6336133eb23c4dd79e732ff2252c603">b43_lptab_write_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(10, 0x140),
<a name="l01618"></a>01618                                      saved_tab_size, saved_tab);
<a name="l01619"></a>01619         } <span class="keywordflow">else</span> {
<a name="l01620"></a>01620                 <a class="code" href="tables__lpphy_8c.html#ae6336133eb23c4dd79e732ff2252c603">b43_lptab_write_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#ae08cac9706de5a88768d55846fbd9f39">B43_LPTAB32</a>(7, 0x140),
<a name="l01621"></a>01621                                      saved_tab_size, saved_tab);
<a name="l01622"></a>01622         }
<a name="l01623"></a>01623         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a881966bd6256b2cdcbdf5c76e2249456">B43_MMIO_CHANNEL</a>, lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a63338f72f7dbd0e371d7a86a8aa02aa2">channel</a>);
<a name="l01624"></a>01624         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#aaf2e87462346d06d5d0d937ac1a5851a">tssi_npt</a> = tssi_npt;
<a name="l01625"></a>01625         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a1ff53c263a8536031c6d535261fc43aa">tssi_idx</a> = tssi_idx;
<a name="l01626"></a>01626         <a class="code" href="phy__lp_8c.html#a910915d83f25e0d777567299f5af3ab8">lpphy_set_analog_filter</a>(dev, lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a63338f72f7dbd0e371d7a86a8aa02aa2">channel</a>);
<a name="l01627"></a>01627         <span class="keywordflow">if</span> (tx_pwr_idx_over != -1)
<a name="l01628"></a>01628                 <a class="code" href="phy__lp_8c.html#a5062911000771e4100071e4ba4012f50">lpphy_set_tx_power_by_index</a>(dev, tx_pwr_idx_over);
<a name="l01629"></a>01629         <span class="keywordflow">if</span> (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a79d8604adb8efa7f96d416a950b24b27">rc_cap</a>)
<a name="l01630"></a>01630                 <a class="code" href="phy__lp_8c.html#af36b52560caf8f4b2ef1df59c649f2b3">lpphy_set_rc_cap</a>(dev);
<a name="l01631"></a>01631         <a class="code" href="phy__lp_8c.html#a9b923d1221a20e16fc08bdab51a812ab">b43_lpphy_op_set_rx_antenna</a>(dev, lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a571ca5b4d10b51617b5568b2b263da86">antenna</a>);
<a name="l01632"></a>01632         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, txpctl_mode);
<a name="l01633"></a>01633         kfree(saved_tab);
<a name="l01634"></a>01634 }
<a name="l01635"></a>01635 
<a name="l01636"></a><a class="code" href="structlpphy__rx__iq__comp.html#a5c65a6e6d0b627613f34e87250697e53">01636</a> <span class="keyword">struct </span><a class="code" href="structlpphy__rx__iq__comp.html">lpphy_rx_iq_comp</a> { u8 <a class="code" href="structlpphy__rx__iq__comp.html#a5c65a6e6d0b627613f34e87250697e53">chan</a>; s8 <a class="code" href="structlpphy__rx__iq__comp.html#afda98ab55977cfa8119b56b6c4a254b9">c1</a>, <a class="code" href="structlpphy__rx__iq__comp.html#a07eea42a5e191902042ee0f9127d0aec">c0</a>; };
<a name="l01637"></a>01637 
<a name="l01638"></a><a class="code" href="phy__lp_8c.html#ab1703b9c5ec38363a837a40ea05efda9">01638</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlpphy__rx__iq__comp.html">lpphy_rx_iq_comp</a> <a class="code" href="phy__lp_8c.html#ab1703b9c5ec38363a837a40ea05efda9">lpphy_5354_iq_table</a>[] = {
<a name="l01639"></a>01639         { .<a class="code" href="structlpphy__rx__iq__comp.html#a5c65a6e6d0b627613f34e87250697e53">chan</a> = 1, .c1 = -66, .c0 = 15, },
<a name="l01640"></a>01640         { .chan = 2, .c1 = -66, .c0 = 15, },
<a name="l01641"></a>01641         { .chan = 3, .c1 = -66, .c0 = 15, },
<a name="l01642"></a>01642         { .chan = 4, .c1 = -66, .c0 = 15, },
<a name="l01643"></a>01643         { .chan = 5, .c1 = -66, .c0 = 15, },
<a name="l01644"></a>01644         { .chan = 6, .c1 = -66, .c0 = 15, },
<a name="l01645"></a>01645         { .chan = 7, .c1 = -66, .c0 = 14, },
<a name="l01646"></a>01646         { .chan = 8, .c1 = -66, .c0 = 14, },
<a name="l01647"></a>01647         { .chan = 9, .c1 = -66, .c0 = 14, },
<a name="l01648"></a>01648         { .chan = 10, .c1 = -66, .c0 = 14, },
<a name="l01649"></a>01649         { .chan = 11, .c1 = -66, .c0 = 14, },
<a name="l01650"></a>01650         { .chan = 12, .c1 = -66, .c0 = 13, },
<a name="l01651"></a>01651         { .chan = 13, .c1 = -66, .c0 = 13, },
<a name="l01652"></a>01652         { .chan = 14, .c1 = -66, .c0 = 13, },
<a name="l01653"></a>01653 };
<a name="l01654"></a>01654 
<a name="l01655"></a><a class="code" href="phy__lp_8c.html#a7936e2a9987115669b634dde70cd20d2">01655</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlpphy__rx__iq__comp.html">lpphy_rx_iq_comp</a> <a class="code" href="phy__lp_8c.html#a7936e2a9987115669b634dde70cd20d2">lpphy_rev0_1_iq_table</a>[] = {
<a name="l01656"></a>01656         { .<a class="code" href="structlpphy__rx__iq__comp.html#a5c65a6e6d0b627613f34e87250697e53">chan</a> = 1, .c1 = -64, .c0 = 13, },
<a name="l01657"></a>01657         { .chan = 2, .c1 = -64, .c0 = 13, },
<a name="l01658"></a>01658         { .chan = 3, .c1 = -64, .c0 = 13, },
<a name="l01659"></a>01659         { .chan = 4, .c1 = -64, .c0 = 13, },
<a name="l01660"></a>01660         { .chan = 5, .c1 = -64, .c0 = 12, },
<a name="l01661"></a>01661         { .chan = 6, .c1 = -64, .c0 = 12, },
<a name="l01662"></a>01662         { .chan = 7, .c1 = -64, .c0 = 12, },
<a name="l01663"></a>01663         { .chan = 8, .c1 = -64, .c0 = 12, },
<a name="l01664"></a>01664         { .chan = 9, .c1 = -64, .c0 = 12, },
<a name="l01665"></a>01665         { .chan = 10, .c1 = -64, .c0 = 11, },
<a name="l01666"></a>01666         { .chan = 11, .c1 = -64, .c0 = 11, },
<a name="l01667"></a>01667         { .chan = 12, .c1 = -64, .c0 = 11, },
<a name="l01668"></a>01668         { .chan = 13, .c1 = -64, .c0 = 11, },
<a name="l01669"></a>01669         { .chan = 14, .c1 = -64, .c0 = 10, },
<a name="l01670"></a>01670         { .chan = 34, .c1 = -62, .c0 = 24, },
<a name="l01671"></a>01671         { .chan = 38, .c1 = -62, .c0 = 24, },
<a name="l01672"></a>01672         { .chan = 42, .c1 = -62, .c0 = 24, },
<a name="l01673"></a>01673         { .chan = 46, .c1 = -62, .c0 = 23, },
<a name="l01674"></a>01674         { .chan = 36, .c1 = -62, .c0 = 24, },
<a name="l01675"></a>01675         { .chan = 40, .c1 = -62, .c0 = 24, },
<a name="l01676"></a>01676         { .chan = 44, .c1 = -62, .c0 = 23, },
<a name="l01677"></a>01677         { .chan = 48, .c1 = -62, .c0 = 23, },
<a name="l01678"></a>01678         { .chan = 52, .c1 = -62, .c0 = 23, },
<a name="l01679"></a>01679         { .chan = 56, .c1 = -62, .c0 = 22, },
<a name="l01680"></a>01680         { .chan = 60, .c1 = -62, .c0 = 22, },
<a name="l01681"></a>01681         { .chan = 64, .c1 = -62, .c0 = 22, },
<a name="l01682"></a>01682         { .chan = 100, .c1 = -62, .c0 = 16, },
<a name="l01683"></a>01683         { .chan = 104, .c1 = -62, .c0 = 16, },
<a name="l01684"></a>01684         { .chan = 108, .c1 = -62, .c0 = 15, },
<a name="l01685"></a>01685         { .chan = 112, .c1 = -62, .c0 = 14, },
<a name="l01686"></a>01686         { .chan = 116, .c1 = -62, .c0 = 14, },
<a name="l01687"></a>01687         { .chan = 120, .c1 = -62, .c0 = 13, },
<a name="l01688"></a>01688         { .chan = 124, .c1 = -62, .c0 = 12, },
<a name="l01689"></a>01689         { .chan = 128, .c1 = -62, .c0 = 12, },
<a name="l01690"></a>01690         { .chan = 132, .c1 = -62, .c0 = 12, },
<a name="l01691"></a>01691         { .chan = 136, .c1 = -62, .c0 = 11, },
<a name="l01692"></a>01692         { .chan = 140, .c1 = -62, .c0 = 10, },
<a name="l01693"></a>01693         { .chan = 149, .c1 = -61, .c0 = 9, },
<a name="l01694"></a>01694         { .chan = 153, .c1 = -61, .c0 = 9, },
<a name="l01695"></a>01695         { .chan = 157, .c1 = -61, .c0 = 9, },
<a name="l01696"></a>01696         { .chan = 161, .c1 = -61, .c0 = 8, },
<a name="l01697"></a>01697         { .chan = 165, .c1 = -61, .c0 = 8, },
<a name="l01698"></a>01698         { .chan = 184, .c1 = -62, .c0 = 25, },
<a name="l01699"></a>01699         { .chan = 188, .c1 = -62, .c0 = 25, },
<a name="l01700"></a>01700         { .chan = 192, .c1 = -62, .c0 = 25, },
<a name="l01701"></a>01701         { .chan = 196, .c1 = -62, .c0 = 25, },
<a name="l01702"></a>01702         { .chan = 200, .c1 = -62, .c0 = 25, },
<a name="l01703"></a>01703         { .chan = 204, .c1 = -62, .c0 = 25, },
<a name="l01704"></a>01704         { .chan = 208, .c1 = -62, .c0 = 25, },
<a name="l01705"></a>01705         { .chan = 212, .c1 = -62, .c0 = 25, },
<a name="l01706"></a>01706         { .chan = 216, .c1 = -62, .c0 = 26, },
<a name="l01707"></a>01707 };
<a name="l01708"></a>01708 
<a name="l01709"></a><a class="code" href="phy__lp_8c.html#a3fdeb454e583ec4635a0aaca69fac7ef">01709</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlpphy__rx__iq__comp.html">lpphy_rx_iq_comp</a> <a class="code" href="phy__lp_8c.html#a3fdeb454e583ec4635a0aaca69fac7ef">lpphy_rev2plus_iq_comp</a> = {
<a name="l01710"></a>01710         .<a class="code" href="structlpphy__rx__iq__comp.html#a5c65a6e6d0b627613f34e87250697e53">chan</a> = 0,
<a name="l01711"></a>01711         .c1 = -64,
<a name="l01712"></a>01712         .c0 = 0,
<a name="l01713"></a>01713 };
<a name="l01714"></a>01714 
<a name="l01715"></a><a class="code" href="phy__lp_8c.html#a53fc8deb9a68e287dcaa477d5199d22b">01715</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#a53fc8deb9a68e287dcaa477d5199d22b">lpphy_calc_rx_iq_comp</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 samples)
<a name="l01716"></a>01716 {
<a name="l01717"></a>01717         <span class="keyword">struct </span><a class="code" href="structlpphy__iq__est.html">lpphy_iq_est</a> iq_est;
<a name="l01718"></a>01718         u16 c0, c1;
<a name="l01719"></a>01719         <span class="keywordtype">int</span> prod, ipwr, qpwr, prod_msb, q_msb, tmp1, tmp2, tmp3, tmp4, ret;
<a name="l01720"></a>01720 
<a name="l01721"></a>01721         c1 = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#aebb262caa9ad00052b93950383d804c6">B43_LPPHY_RX_COMP_COEFF_S</a>);
<a name="l01722"></a>01722         c0 = c1 &gt;&gt; 8;
<a name="l01723"></a>01723         c1 |= 0xFF;
<a name="l01724"></a>01724 
<a name="l01725"></a>01725         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aebb262caa9ad00052b93950383d804c6">B43_LPPHY_RX_COMP_COEFF_S</a>, 0xFF00, 0x00C0);
<a name="l01726"></a>01726         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#aebb262caa9ad00052b93950383d804c6">B43_LPPHY_RX_COMP_COEFF_S</a>, 0x00FF);
<a name="l01727"></a>01727 
<a name="l01728"></a>01728         ret = <a class="code" href="phy__lp_8c.html#a8c7ce50541c71fbc6ad25cc996dff383">lpphy_rx_iq_est</a>(dev, samples, 32, &amp;iq_est);
<a name="l01729"></a>01729         <span class="keywordflow">if</span> (!ret)
<a name="l01730"></a>01730                 <span class="keywordflow">goto</span> out;
<a name="l01731"></a>01731 
<a name="l01732"></a>01732         prod = iq_est.<a class="code" href="structlpphy__iq__est.html#a342f5e522e58dabc1ed7ccd9c3c87ffc">iq_prod</a>;
<a name="l01733"></a>01733         ipwr = iq_est.<a class="code" href="structlpphy__iq__est.html#a634a5e365e8c253a564bd732a40cc8f6">i_pwr</a>;
<a name="l01734"></a>01734         qpwr = iq_est.<a class="code" href="structlpphy__iq__est.html#a2dc18b87021d5ee805573dcf8785baf2">q_pwr</a>;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736         <span class="keywordflow">if</span> (ipwr + qpwr &lt; 2) {
<a name="l01737"></a>01737                 ret = 0;
<a name="l01738"></a>01738                 <span class="keywordflow">goto</span> out;
<a name="l01739"></a>01739         }
<a name="l01740"></a>01740 
<a name="l01741"></a>01741         prod_msb = fls(abs(prod));
<a name="l01742"></a>01742         q_msb = fls(abs(qpwr));
<a name="l01743"></a>01743         tmp1 = prod_msb - 20;
<a name="l01744"></a>01744 
<a name="l01745"></a>01745         <span class="keywordflow">if</span> (tmp1 &gt;= 0) {
<a name="l01746"></a>01746                 tmp3 = ((prod &lt;&lt; (30 - prod_msb)) + (ipwr &gt;&gt; (1 + tmp1))) /
<a name="l01747"></a>01747                         (ipwr &gt;&gt; tmp1);
<a name="l01748"></a>01748         } <span class="keywordflow">else</span> {
<a name="l01749"></a>01749                 tmp3 = ((prod &lt;&lt; (30 - prod_msb)) + (ipwr &lt;&lt; (-1 - tmp1))) /
<a name="l01750"></a>01750                         (ipwr &lt;&lt; -tmp1);
<a name="l01751"></a>01751         }
<a name="l01752"></a>01752 
<a name="l01753"></a>01753         tmp2 = q_msb - 11;
<a name="l01754"></a>01754 
<a name="l01755"></a>01755         <span class="keywordflow">if</span> (tmp2 &gt;= 0)
<a name="l01756"></a>01756                 tmp4 = (qpwr &lt;&lt; (31 - q_msb)) / (ipwr &gt;&gt; tmp2);
<a name="l01757"></a>01757         <span class="keywordflow">else</span>
<a name="l01758"></a>01758                 tmp4 = (qpwr &lt;&lt; (31 - q_msb)) / (ipwr &lt;&lt; -tmp2);
<a name="l01759"></a>01759 
<a name="l01760"></a>01760         tmp4 -= tmp3 * tmp3;
<a name="l01761"></a>01761         tmp4 = -int_sqrt(tmp4);
<a name="l01762"></a>01762 
<a name="l01763"></a>01763         c0 = tmp3 &gt;&gt; 3;
<a name="l01764"></a>01764         c1 = tmp4 &gt;&gt; 4;
<a name="l01765"></a>01765 
<a name="l01766"></a>01766 out:
<a name="l01767"></a>01767         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aebb262caa9ad00052b93950383d804c6">B43_LPPHY_RX_COMP_COEFF_S</a>, 0xFF00, c1);
<a name="l01768"></a>01768         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aebb262caa9ad00052b93950383d804c6">B43_LPPHY_RX_COMP_COEFF_S</a>, 0x00FF, c0 &lt;&lt; 8);
<a name="l01769"></a>01769         <span class="keywordflow">return</span> ret;
<a name="l01770"></a>01770 }
<a name="l01771"></a>01771 
<a name="l01772"></a><a class="code" href="phy__lp_8c.html#aafdb9e3360e4d144043128831d407ad5">01772</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aafdb9e3360e4d144043128831d407ad5">lpphy_run_samples</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 samples, u16 loops,
<a name="l01773"></a>01773                               u16 wait)
<a name="l01774"></a>01774 {
<a name="l01775"></a>01775         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a2a442b3326f8edd958bae9a8bb47c9ea">B43_LPPHY_SMPL_PLAY_BUFFER_CTL</a>,
<a name="l01776"></a>01776                         0xFFC0, samples - 1);
<a name="l01777"></a>01777         <span class="keywordflow">if</span> (loops != 0xFFFF)
<a name="l01778"></a>01778                 loops--;
<a name="l01779"></a>01779         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a90c19f97aeee493c1df5200c43a3859e">B43_LPPHY_SMPL_PLAY_COUNT</a>, 0xF000, loops);
<a name="l01780"></a>01780         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a2a442b3326f8edd958bae9a8bb47c9ea">B43_LPPHY_SMPL_PLAY_BUFFER_CTL</a>, 0x3F, wait &lt;&lt; 6);
<a name="l01781"></a>01781         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#adeefb5a2b143dbcb5a795a72ca6d1690">B43_LPPHY_A_PHY_CTL_ADDR</a>, 0x1);
<a name="l01782"></a>01782 }
<a name="l01783"></a>01783 
<a name="l01784"></a>01784 <span class="comment">//SPEC FIXME what does a negative freq mean?</span>
<a name="l01785"></a><a class="code" href="phy__lp_8c.html#a27a3abac20547b0acfc668870e10e9c8">01785</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a27a3abac20547b0acfc668870e10e9c8">lpphy_start_tx_tone</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, s32 freq, u16 max)
<a name="l01786"></a>01786 {
<a name="l01787"></a>01787         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01788"></a>01788         u16 buf[64];
<a name="l01789"></a>01789         <span class="keywordtype">int</span> i, samples = 0, angle = 0;
<a name="l01790"></a>01790         <span class="keywordtype">int</span> rotation = (((36 * freq) / 20) &lt;&lt; 16) / 100;
<a name="l01791"></a>01791         <span class="keyword">struct </span><a class="code" href="structb43__c32.html">b43_c32</a> sample;
<a name="l01792"></a>01792 
<a name="l01793"></a>01793         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a07377321eddd2c793c7d897525b6a635">tx_tone_freq</a> = freq;
<a name="l01794"></a>01794 
<a name="l01795"></a>01795         <span class="keywordflow">if</span> (freq) {
<a name="l01796"></a>01796                 <span class="comment">/* Find i for which abs(freq) integrally divides 20000 * i */</span>
<a name="l01797"></a>01797                 <span class="keywordflow">for</span> (i = 1; samples * abs(freq) != 20000 * i; i++) {
<a name="l01798"></a>01798                         samples = (20000 * i) / abs(freq);
<a name="l01799"></a>01799                         <span class="keywordflow">if</span>(<a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(samples &gt; 63))
<a name="l01800"></a>01800                                 <span class="keywordflow">return</span>;
<a name="l01801"></a>01801                 }
<a name="l01802"></a>01802         } <span class="keywordflow">else</span> {
<a name="l01803"></a>01803                 samples = 2;
<a name="l01804"></a>01804         }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806         <span class="keywordflow">for</span> (i = 0; i &lt; samples; i++) {
<a name="l01807"></a>01807                 sample = <a class="code" href="phy__common_8c.html#a8928a3e5490bd5d09726a0498fcd04a2">b43_cordic</a>(angle);
<a name="l01808"></a>01808                 angle += rotation;
<a name="l01809"></a>01809                 buf[i] = <a class="code" href="phy__common_8h.html#afe132d9e607d2c95173c76dc66603691">CORDIC_CONVERT</a>((sample.<a class="code" href="structb43__c32.html#ab47f254a0fc1ee38b6d118738077138e">i</a> * max) &amp; 0xFF) &lt;&lt; 8;
<a name="l01810"></a>01810                 buf[i] |= <a class="code" href="phy__common_8h.html#afe132d9e607d2c95173c76dc66603691">CORDIC_CONVERT</a>((sample.<a class="code" href="structb43__c32.html#ac21b7ccdee5b9384f710601c7df89714">q</a> * max) &amp; 0xFF);
<a name="l01811"></a>01811         }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813         <a class="code" href="tables__lpphy_8c.html#ae6336133eb23c4dd79e732ff2252c603">b43_lptab_write_bulk</a>(dev, <a class="code" href="tables__lpphy_8h.html#a9bd5f52f37f929153a82f72dfbcf6a40">B43_LPTAB16</a>(5, 0), samples, buf);
<a name="l01814"></a>01814 
<a name="l01815"></a>01815         <a class="code" href="phy__lp_8c.html#aafdb9e3360e4d144043128831d407ad5">lpphy_run_samples</a>(dev, samples, 0xFFFF, 0);
<a name="l01816"></a>01816 }
<a name="l01817"></a>01817 
<a name="l01818"></a><a class="code" href="phy__lp_8c.html#a6e9eddc7f44ed44b64af5ddd80d4c13b">01818</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a6e9eddc7f44ed44b64af5ddd80d4c13b">lpphy_stop_tx_tone</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01819"></a>01819 {
<a name="l01820"></a>01820         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01821"></a>01821         <span class="keywordtype">int</span> i;
<a name="l01822"></a>01822 
<a name="l01823"></a>01823         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a07377321eddd2c793c7d897525b6a635">tx_tone_freq</a> = 0;
<a name="l01824"></a>01824 
<a name="l01825"></a>01825         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a90c19f97aeee493c1df5200c43a3859e">B43_LPPHY_SMPL_PLAY_COUNT</a>, 0xF000);
<a name="l01826"></a>01826         <span class="keywordflow">for</span> (i = 0; i &lt; 31; i++) {
<a name="l01827"></a>01827                 <span class="keywordflow">if</span> (!(<a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#adeefb5a2b143dbcb5a795a72ca6d1690">B43_LPPHY_A_PHY_CTL_ADDR</a>) &amp; 0x1))
<a name="l01828"></a>01828                         <span class="keywordflow">break</span>;
<a name="l01829"></a>01829                 udelay(100);
<a name="l01830"></a>01830         }
<a name="l01831"></a>01831 }
<a name="l01832"></a>01832 
<a name="l01833"></a>01833 
<a name="l01834"></a><a class="code" href="phy__lp_8c.html#ac1bbaab508e73a8d02a4df84b55922c7">01834</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ac1bbaab508e73a8d02a4df84b55922c7">lpphy_papd_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keyword">struct</span> <a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> gains,
<a name="l01835"></a>01835                            <span class="keywordtype">int</span> mode, <span class="keywordtype">bool</span> useindex, u8 index)
<a name="l01836"></a>01836 {
<a name="l01837"></a>01837         <span class="comment">//TODO</span>
<a name="l01838"></a>01838 }
<a name="l01839"></a>01839 
<a name="l01840"></a><a class="code" href="phy__lp_8c.html#af41cd10d62aafd8c7e9a02f04f4cd2f6">01840</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#af41cd10d62aafd8c7e9a02f04f4cd2f6">lpphy_papd_cal_txpwr</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01841"></a>01841 {
<a name="l01842"></a>01842         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01843"></a>01843         <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> gains, oldgains;
<a name="l01844"></a>01844         <span class="keywordtype">int</span> old_txpctl, old_afe_ovr, old_rf, old_bbmult;
<a name="l01845"></a>01845 
<a name="l01846"></a>01846         <a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">lpphy_read_tx_pctl_mode_from_hardware</a>(dev);
<a name="l01847"></a>01847         old_txpctl = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a>;
<a name="l01848"></a>01848         old_afe_ovr = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>) &amp; 0x40;
<a name="l01849"></a>01849         <span class="keywordflow">if</span> (old_afe_ovr)
<a name="l01850"></a>01850                 oldgains = <a class="code" href="phy__lp_8c.html#a523b8ce697e693bd0b9f4fc12499cd2f">lpphy_get_tx_gains</a>(dev);
<a name="l01851"></a>01851         old_rf = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a64d9083ab2084dd424eec73a94d8a876">B43_LPPHY_RF_PWR_OVERRIDE</a>) &amp; 0xFF;
<a name="l01852"></a>01852         old_bbmult = <a class="code" href="phy__lp_8c.html#a71220c70f21317fb3f7e88095d02eb07">lpphy_get_bb_mult</a>(dev);
<a name="l01853"></a>01853 
<a name="l01854"></a>01854         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>);
<a name="l01855"></a>01855 
<a name="l01856"></a>01856         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x4325 &amp;&amp; dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a4d3f6ec287090116d644ff47445b3208">chip_rev</a> == 0)
<a name="l01857"></a>01857                 <a class="code" href="phy__lp_8c.html#ac1bbaab508e73a8d02a4df84b55922c7">lpphy_papd_cal</a>(dev, gains, 0, 1, 30);
<a name="l01858"></a>01858         <span class="keywordflow">else</span>
<a name="l01859"></a>01859                 <a class="code" href="phy__lp_8c.html#ac1bbaab508e73a8d02a4df84b55922c7">lpphy_papd_cal</a>(dev, gains, 0, 1, 65);
<a name="l01860"></a>01860 
<a name="l01861"></a>01861         <span class="keywordflow">if</span> (old_afe_ovr)
<a name="l01862"></a>01862                 <a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">lpphy_set_tx_gains</a>(dev, oldgains);
<a name="l01863"></a>01863         <a class="code" href="phy__lp_8c.html#a5069ae26dc96ec4524716141b3019a7b">lpphy_set_bb_mult</a>(dev, old_bbmult);
<a name="l01864"></a>01864         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, old_txpctl);
<a name="l01865"></a>01865         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a64d9083ab2084dd424eec73a94d8a876">B43_LPPHY_RF_PWR_OVERRIDE</a>, 0xFF00, old_rf);
<a name="l01866"></a>01866 }
<a name="l01867"></a>01867 
<a name="l01868"></a><a class="code" href="phy__lp_8c.html#a0c77a96d80f835d403a5e4a3c10d4c8e">01868</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#a0c77a96d80f835d403a5e4a3c10d4c8e">lpphy_rx_iq_cal</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> noise, <span class="keywordtype">bool</span> tx,
<a name="l01869"></a>01869                             <span class="keywordtype">bool</span> rx, <span class="keywordtype">bool</span> pa, <span class="keyword">struct</span> <a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> *gains)
<a name="l01870"></a>01870 {
<a name="l01871"></a>01871         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01872"></a>01872         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlpphy__rx__iq__comp.html">lpphy_rx_iq_comp</a> *iqcomp = NULL;
<a name="l01873"></a>01873         <span class="keyword">struct </span><a class="code" href="structlpphy__tx__gains.html">lpphy_tx_gains</a> nogains, oldgains;
<a name="l01874"></a>01874         u16 tmp;
<a name="l01875"></a>01875         <span class="keywordtype">int</span> i, ret;
<a name="l01876"></a>01876 
<a name="l01877"></a>01877         memset(&amp;nogains, 0, <span class="keyword">sizeof</span>(nogains));
<a name="l01878"></a>01878         memset(&amp;oldgains, 0, <span class="keyword">sizeof</span>(oldgains));
<a name="l01879"></a>01879 
<a name="l01880"></a>01880         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x5354) {
<a name="l01881"></a>01881                 <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(lpphy_5354_iq_table); i++) {
<a name="l01882"></a>01882                         <span class="keywordflow">if</span> (lpphy_5354_iq_table[i].chan == lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a63338f72f7dbd0e371d7a86a8aa02aa2">channel</a>) {
<a name="l01883"></a>01883                                 iqcomp = &amp;lpphy_5354_iq_table[i];
<a name="l01884"></a>01884                         }
<a name="l01885"></a>01885                 }
<a name="l01886"></a>01886         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) {
<a name="l01887"></a>01887                 iqcomp = &amp;lpphy_rev2plus_iq_comp;
<a name="l01888"></a>01888         } <span class="keywordflow">else</span> {
<a name="l01889"></a>01889                 <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(lpphy_rev0_1_iq_table); i++) {
<a name="l01890"></a>01890                         <span class="keywordflow">if</span> (lpphy_rev0_1_iq_table[i].chan == lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a63338f72f7dbd0e371d7a86a8aa02aa2">channel</a>) {
<a name="l01891"></a>01891                                 iqcomp = &amp;lpphy_rev0_1_iq_table[i];
<a name="l01892"></a>01892                         }
<a name="l01893"></a>01893                 }
<a name="l01894"></a>01894         }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(!iqcomp))
<a name="l01897"></a>01897                 <span class="keywordflow">return</span> 0;
<a name="l01898"></a>01898 
<a name="l01899"></a>01899         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aebb262caa9ad00052b93950383d804c6">B43_LPPHY_RX_COMP_COEFF_S</a>, 0xFF00, iqcomp-&gt;<a class="code" href="structlpphy__rx__iq__comp.html#afda98ab55977cfa8119b56b6c4a254b9">c1</a>);
<a name="l01900"></a>01900         <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aebb262caa9ad00052b93950383d804c6">B43_LPPHY_RX_COMP_COEFF_S</a>,
<a name="l01901"></a>01901                         0x00FF, iqcomp-&gt;<a class="code" href="structlpphy__rx__iq__comp.html#a07eea42a5e191902042ee0f9127d0aec">c0</a> &lt;&lt; 8);
<a name="l01902"></a>01902 
<a name="l01903"></a>01903         <span class="keywordflow">if</span> (noise) {
<a name="l01904"></a>01904                 tx = <span class="keyword">true</span>;
<a name="l01905"></a>01905                 rx = <span class="keyword">false</span>;
<a name="l01906"></a>01906                 pa = <span class="keyword">false</span>;
<a name="l01907"></a>01907         }
<a name="l01908"></a>01908 
<a name="l01909"></a>01909         <a class="code" href="phy__lp_8c.html#a97091d36b42658f2674024bb0fcad4a5">lpphy_set_trsw_over</a>(dev, tx, rx);
<a name="l01910"></a>01910 
<a name="l01911"></a>01911         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#aaea9136ad670401f899f2ea0a5288bf5">b43_current_band</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>) == IEEE80211_BAND_2GHZ) {
<a name="l01912"></a>01912                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x8);
<a name="l01913"></a>01913                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>,
<a name="l01914"></a>01914                                 0xFFF7, pa &lt;&lt; 3);
<a name="l01915"></a>01915         } <span class="keywordflow">else</span> {
<a name="l01916"></a>01916                 <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x20);
<a name="l01917"></a>01917                 <a class="code" href="phy__common_8c.html#aabba815f5765fe05a552c6c0cdf1e69b">b43_phy_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>,
<a name="l01918"></a>01918                                 0xFFDF, pa &lt;&lt; 5);
<a name="l01919"></a>01919         }
<a name="l01920"></a>01920 
<a name="l01921"></a>01921         tmp = <a class="code" href="phy__common_8c.html#a03304a9babb3f6bd671e7675168c6f06">b43_phy_read</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>) &amp; 0x40;
<a name="l01922"></a>01922 
<a name="l01923"></a>01923         <span class="keywordflow">if</span> (noise)
<a name="l01924"></a>01924                 <a class="code" href="phy__lp_8c.html#a8b65be93c48d8f8bbf45618554ce223f">lpphy_set_rx_gain</a>(dev, 0x2D5D);
<a name="l01925"></a>01925         <span class="keywordflow">else</span> {
<a name="l01926"></a>01926                 <span class="keywordflow">if</span> (tmp)
<a name="l01927"></a>01927                         oldgains = <a class="code" href="phy__lp_8c.html#a523b8ce697e693bd0b9f4fc12499cd2f">lpphy_get_tx_gains</a>(dev);
<a name="l01928"></a>01928                 <span class="keywordflow">if</span> (!gains)
<a name="l01929"></a>01929                         gains = &amp;nogains;
<a name="l01930"></a>01930                 <a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">lpphy_set_tx_gains</a>(dev, *gains);
<a name="l01931"></a>01931         }
<a name="l01932"></a>01932 
<a name="l01933"></a>01933         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0xFFFE);
<a name="l01934"></a>01934         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>, 0xFFFE);
<a name="l01935"></a>01935         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0x800);
<a name="l01936"></a>01936         <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#ac8430e4fd1a08ba3bf5c86dac4ca4278">B43_LPPHY_RF_OVERRIDE_VAL_0</a>, 0x800);
<a name="l01937"></a>01937         <a class="code" href="phy__lp_8c.html#a276441f008eade78697f6b0458741d86">lpphy_set_deaf</a>(dev, <span class="keyword">false</span>);
<a name="l01938"></a>01938         <span class="keywordflow">if</span> (noise)
<a name="l01939"></a>01939                 ret = <a class="code" href="phy__lp_8c.html#a53fc8deb9a68e287dcaa477d5199d22b">lpphy_calc_rx_iq_comp</a>(dev, 0xFFF0);
<a name="l01940"></a>01940         <span class="keywordflow">else</span> {
<a name="l01941"></a>01941                 <a class="code" href="phy__lp_8c.html#a27a3abac20547b0acfc668870e10e9c8">lpphy_start_tx_tone</a>(dev, 4000, 100);
<a name="l01942"></a>01942                 ret = <a class="code" href="phy__lp_8c.html#a53fc8deb9a68e287dcaa477d5199d22b">lpphy_calc_rx_iq_comp</a>(dev, 0x4000);
<a name="l01943"></a>01943                 <a class="code" href="phy__lp_8c.html#a6e9eddc7f44ed44b64af5ddd80d4c13b">lpphy_stop_tx_tone</a>(dev);
<a name="l01944"></a>01944         }
<a name="l01945"></a>01945         <a class="code" href="phy__lp_8c.html#ab2397e586347a11c5ad36f4c387286dc">lpphy_clear_deaf</a>(dev, <span class="keyword">false</span>);
<a name="l01946"></a>01946         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xFFFC);
<a name="l01947"></a>01947         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xFFF7);
<a name="l01948"></a>01948         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a711164dfafc6b1e5f820f2f6e87757c7">B43_LPPHY_RF_OVERRIDE_0</a>, 0xFFDF);
<a name="l01949"></a>01949         <span class="keywordflow">if</span> (!noise) {
<a name="l01950"></a>01950                 <span class="keywordflow">if</span> (tmp)
<a name="l01951"></a>01951                         <a class="code" href="phy__lp_8c.html#a66654a1a95f3d9d1c33bbb56a33b2238">lpphy_set_tx_gains</a>(dev, oldgains);
<a name="l01952"></a>01952                 <span class="keywordflow">else</span>
<a name="l01953"></a>01953                         <a class="code" href="phy__lp_8c.html#ace3faccb5a4efe2cc3e2c36e50628a15">lpphy_disable_tx_gain_override</a>(dev);
<a name="l01954"></a>01954         }
<a name="l01955"></a>01955         <a class="code" href="phy__lp_8c.html#af5abebc5445cfe8e020b72c1f6f915c8">lpphy_disable_rx_gain_override</a>(dev);
<a name="l01956"></a>01956         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0xFFFE);
<a name="l01957"></a>01957         <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>, 0xF7FF);
<a name="l01958"></a>01958         <span class="keywordflow">return</span> ret;
<a name="l01959"></a>01959 }
<a name="l01960"></a>01960 
<a name="l01961"></a><a class="code" href="phy__lp_8c.html#a43ec6b70764ef6256f94a929db3d3eee">01961</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a43ec6b70764ef6256f94a929db3d3eee">lpphy_calibration</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l01962"></a>01962 {
<a name="l01963"></a>01963         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l01964"></a>01964         <span class="keyword">enum</span> <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63">b43_lpphy_txpctl_mode</a> saved_pctl_mode;
<a name="l01965"></a>01965         <span class="keywordtype">bool</span> full_cal = <span class="keyword">false</span>;
<a name="l01966"></a>01966 
<a name="l01967"></a>01967         <span class="keywordflow">if</span> (lpphy-&gt;<a class="code" href="structb43__phy__lp.html#afb1ed984d63c3080a0175383d03ba1a7">full_calib_chan</a> != lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a63338f72f7dbd0e371d7a86a8aa02aa2">channel</a>) {
<a name="l01968"></a>01968                 full_cal = <span class="keyword">true</span>;
<a name="l01969"></a>01969                 lpphy-&gt;<a class="code" href="structb43__phy__lp.html#afb1ed984d63c3080a0175383d03ba1a7">full_calib_chan</a> = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a63338f72f7dbd0e371d7a86a8aa02aa2">channel</a>;
<a name="l01970"></a>01970         }
<a name="l01971"></a>01971 
<a name="l01972"></a>01972         <a class="code" href="main_8c.html#a555504fbafc3537b275e563515f7f6d4">b43_mac_suspend</a>(dev);
<a name="l01973"></a>01973 
<a name="l01974"></a>01974         <a class="code" href="phy__lp_8c.html#aa87d256740b46f98a929731dfa37b3ff">lpphy_btcoex_override</a>(dev);
<a name="l01975"></a>01975         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2)
<a name="l01976"></a>01976                 <a class="code" href="phy__lp_8c.html#a4c905d90da2dd74c07ca78d6d1db3d9c">lpphy_save_dig_flt_state</a>(dev);
<a name="l01977"></a>01977         <a class="code" href="phy__lp_8c.html#adfed08e910abd9739908748eca172bb5">lpphy_read_tx_pctl_mode_from_hardware</a>(dev);
<a name="l01978"></a>01978         saved_pctl_mode = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a87d301add3204c2e931b3da3199e07c3">txpctl_mode</a>;
<a name="l01979"></a>01979         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>);
<a name="l01980"></a>01980         <span class="comment">//TODO Perform transmit power table I/Q LO calibration</span>
<a name="l01981"></a>01981         <span class="keywordflow">if</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> == 0) &amp;&amp; (saved_pctl_mode != <a class="code" href="phy__lp_8h.html#a0ec8f2debbf006b7e36b045cb58ead63a00e54dc60c1488e20bf66c0bff827813">B43_LPPHY_TXPCTL_OFF</a>))
<a name="l01982"></a>01982                 <a class="code" href="phy__lp_8c.html#ad9ff06fe849062b35ab2d37742049a9a">lpphy_pr41573_workaround</a>(dev);
<a name="l01983"></a>01983         <span class="keywordflow">if</span> ((dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2) &amp;&amp; full_cal) {
<a name="l01984"></a>01984                 <a class="code" href="phy__lp_8c.html#af41cd10d62aafd8c7e9a02f04f4cd2f6">lpphy_papd_cal_txpwr</a>(dev);
<a name="l01985"></a>01985         }
<a name="l01986"></a>01986         <a class="code" href="phy__lp_8c.html#ab1d7556f530a3d8553b3c0304de55cae">lpphy_set_tx_power_control</a>(dev, saved_pctl_mode);
<a name="l01987"></a>01987         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &gt;= 2)
<a name="l01988"></a>01988                 <a class="code" href="phy__lp_8c.html#a5df91dba978a23a5d1118401cb142b6c">lpphy_restore_dig_flt_state</a>(dev);
<a name="l01989"></a>01989         <a class="code" href="phy__lp_8c.html#a0c77a96d80f835d403a5e4a3c10d4c8e">lpphy_rx_iq_cal</a>(dev, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, NULL);
<a name="l01990"></a>01990 
<a name="l01991"></a>01991         <a class="code" href="main_8c.html#a9078cc08815f04ffb2ca7d5e7eaf071c">b43_mac_enable</a>(dev);
<a name="l01992"></a>01992 }
<a name="l01993"></a>01993 
<a name="l01994"></a><a class="code" href="phy__lp_8c.html#ab251280ae5f0ef3e347a42bb738fc941">01994</a> <span class="keyword">static</span> u16 <a class="code" href="phy__lp_8c.html#ab251280ae5f0ef3e347a42bb738fc941">b43_lpphy_op_read</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg)
<a name="l01995"></a>01995 {
<a name="l01996"></a>01996         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#ad805fb3c087c3f1c1b6cf172abd82294">B43_MMIO_PHY_CONTROL</a>, reg);
<a name="l01997"></a>01997         <span class="keywordflow">return</span> <a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>);
<a name="l01998"></a>01998 }
<a name="l01999"></a>01999 
<a name="l02000"></a><a class="code" href="phy__lp_8c.html#ab6a5cfd77afff66fc2721908a54ae5c4">02000</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ab6a5cfd77afff66fc2721908a54ae5c4">b43_lpphy_op_write</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg, u16 value)
<a name="l02001"></a>02001 {
<a name="l02002"></a>02002         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#ad805fb3c087c3f1c1b6cf172abd82294">B43_MMIO_PHY_CONTROL</a>, reg);
<a name="l02003"></a>02003         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>, value);
<a name="l02004"></a>02004 }
<a name="l02005"></a>02005 
<a name="l02006"></a><a class="code" href="phy__lp_8c.html#acca707555f147ca30c49dc9d7065c5e2">02006</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#acca707555f147ca30c49dc9d7065c5e2">b43_lpphy_op_maskset</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg, u16 mask,
<a name="l02007"></a>02007                                  u16 <span class="keyword">set</span>)
<a name="l02008"></a>02008 {
<a name="l02009"></a>02009         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#ad805fb3c087c3f1c1b6cf172abd82294">B43_MMIO_PHY_CONTROL</a>, reg);
<a name="l02010"></a>02010         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>,
<a name="l02011"></a>02011                     (<a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#a8d03499ec93eea6e77034e1eb793790f">B43_MMIO_PHY_DATA</a>) &amp; mask) | <span class="keyword">set</span>);
<a name="l02012"></a>02012 }
<a name="l02013"></a>02013 
<a name="l02014"></a><a class="code" href="phy__lp_8c.html#a678b8712380e9c63acfa3ea52481404d">02014</a> <span class="keyword">static</span> u16 <a class="code" href="phy__lp_8c.html#a678b8712380e9c63acfa3ea52481404d">b43_lpphy_op_radio_read</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg)
<a name="l02015"></a>02015 {
<a name="l02016"></a>02016         <span class="comment">/* Register 1 is a 32-bit register. */</span>
<a name="l02017"></a>02017         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(reg == 1);
<a name="l02018"></a>02018         <span class="comment">/* LP-PHY needs a special bit set for read access */</span>
<a name="l02019"></a>02019         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a371754dd59262cfc358aeea094ec9e67">rev</a> &lt; 2) {
<a name="l02020"></a>02020                 <span class="keywordflow">if</span> (reg != 0x4001)
<a name="l02021"></a>02021                         reg |= 0x100;
<a name="l02022"></a>02022         } <span class="keywordflow">else</span>
<a name="l02023"></a>02023                 reg |= 0x200;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a4b3e516476d04840cae0ff9c6f34f84f">B43_MMIO_RADIO_CONTROL</a>, reg);
<a name="l02026"></a>02026         <span class="keywordflow">return</span> <a class="code" href="b43_8h.html#aa2589a579b35b2c67a04ce6c6673e241">b43_read16</a>(dev, <a class="code" href="b43_8h.html#aacf09bc03be57d21f37a11d22cca4861">B43_MMIO_RADIO_DATA_LOW</a>);
<a name="l02027"></a>02027 }
<a name="l02028"></a>02028 
<a name="l02029"></a><a class="code" href="phy__lp_8c.html#aadc90940facdb90a2fed22b448e7d17a">02029</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aadc90940facdb90a2fed22b448e7d17a">b43_lpphy_op_radio_write</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, u16 reg, u16 value)
<a name="l02030"></a>02030 {
<a name="l02031"></a>02031         <span class="comment">/* Register 1 is a 32-bit register. */</span>
<a name="l02032"></a>02032         <a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(reg == 1);
<a name="l02033"></a>02033 
<a name="l02034"></a>02034         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a4b3e516476d04840cae0ff9c6f34f84f">B43_MMIO_RADIO_CONTROL</a>, reg);
<a name="l02035"></a>02035         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#aacf09bc03be57d21f37a11d22cca4861">B43_MMIO_RADIO_DATA_LOW</a>, value);
<a name="l02036"></a>02036 }
<a name="l02037"></a>02037 
<a name="l02038"></a><a class="code" href="structb206x__channel.html">02038</a> <span class="keyword">struct </span><a class="code" href="structb206x__channel.html">b206x_channel</a> {
<a name="l02039"></a><a class="code" href="structb206x__channel.html#a4053bec95bf0eaeacf4ae49e0a8efa67">02039</a>         u8 <a class="code" href="structb206x__channel.html#a4053bec95bf0eaeacf4ae49e0a8efa67">channel</a>;
<a name="l02040"></a><a class="code" href="structb206x__channel.html#ab0708dae70f9af431b2254cdcd2ae2cd">02040</a>         u16 <a class="code" href="structb206x__channel.html#ab0708dae70f9af431b2254cdcd2ae2cd">freq</a>;
<a name="l02041"></a><a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">02041</a>         u8 <a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[12];
<a name="l02042"></a>02042 };
<a name="l02043"></a>02043 
<a name="l02044"></a><a class="code" href="phy__lp_8c.html#abfebe8f5e8ac5d9bb9018a0bec8716c7">02044</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb206x__channel.html">b206x_channel</a> <a class="code" href="phy__lp_8c.html#abfebe8f5e8ac5d9bb9018a0bec8716c7">b2062_chantbl</a>[] = {
<a name="l02045"></a>02045         { .<a class="code" href="structb206x__channel.html#a4053bec95bf0eaeacf4ae49e0a8efa67">channel</a> = 1, .freq = 2412, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02046"></a>02046           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02047"></a>02047           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02048"></a>02048         { .channel = 2, .freq = 2417, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02049"></a>02049           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02050"></a>02050           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02051"></a>02051         { .channel = 3, .freq = 2422, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02052"></a>02052           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02053"></a>02053           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02054"></a>02054         { .channel = 4, .freq = 2427, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02055"></a>02055           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02056"></a>02056           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02057"></a>02057         { .channel = 5, .freq = 2432, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02058"></a>02058           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02059"></a>02059           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02060"></a>02060         { .channel = 6, .freq = 2437, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02061"></a>02061           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02062"></a>02062           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02063"></a>02063         { .channel = 7, .freq = 2442, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02064"></a>02064           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02065"></a>02065           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02066"></a>02066         { .channel = 8, .freq = 2447, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02067"></a>02067           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02068"></a>02068           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02069"></a>02069         { .channel = 9, .freq = 2452, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02070"></a>02070           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02071"></a>02071           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02072"></a>02072         { .channel = 10, .freq = 2457, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02073"></a>02073           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02074"></a>02074           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02075"></a>02075         { .channel = 11, .freq = 2462, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02076"></a>02076           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02077"></a>02077           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02078"></a>02078         { .channel = 12, .freq = 2467, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02079"></a>02079           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02080"></a>02080           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02081"></a>02081         { .channel = 13, .freq = 2472, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02082"></a>02082           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02083"></a>02083           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02084"></a>02084         { .channel = 14, .freq = 2484, .data[0] = 0xFF, .data[1] = 0xFF,
<a name="l02085"></a>02085           .data[2] = 0xB5, .data[3] = 0x1B, .data[4] = 0x24, .data[5] = 0x32,
<a name="l02086"></a>02086           .data[6] = 0x32, .data[7] = 0x88, .data[8] = 0x88, },
<a name="l02087"></a>02087         { .channel = 34, .freq = 5170, .data[0] = 0x00, .data[1] = 0x22,
<a name="l02088"></a>02088           .data[2] = 0x20, .data[3] = 0x84, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02089"></a>02089           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02090"></a>02090         { .channel = 38, .freq = 5190, .data[0] = 0x00, .data[1] = 0x11,
<a name="l02091"></a>02091           .data[2] = 0x10, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02092"></a>02092           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02093"></a>02093         { .channel = 42, .freq = 5210, .data[0] = 0x00, .data[1] = 0x11,
<a name="l02094"></a>02094           .data[2] = 0x10, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02095"></a>02095           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02096"></a>02096         { .channel = 46, .freq = 5230, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02097"></a>02097           .data[2] = 0x00, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02098"></a>02098           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02099"></a>02099         { .channel = 36, .freq = 5180, .data[0] = 0x00, .data[1] = 0x11,
<a name="l02100"></a>02100           .data[2] = 0x20, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02101"></a>02101           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02102"></a>02102         { .channel = 40, .freq = 5200, .data[0] = 0x00, .data[1] = 0x11,
<a name="l02103"></a>02103           .data[2] = 0x10, .data[3] = 0x84, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02104"></a>02104           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02105"></a>02105         { .channel = 44, .freq = 5220, .data[0] = 0x00, .data[1] = 0x11,
<a name="l02106"></a>02106           .data[2] = 0x00, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02107"></a>02107           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02108"></a>02108         { .channel = 48, .freq = 5240, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02109"></a>02109           .data[2] = 0x00, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02110"></a>02110           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02111"></a>02111         { .channel = 52, .freq = 5260, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02112"></a>02112           .data[2] = 0x00, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02113"></a>02113           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02114"></a>02114         { .channel = 56, .freq = 5280, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02115"></a>02115           .data[2] = 0x00, .data[3] = 0x83, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02116"></a>02116           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02117"></a>02117         { .channel = 60, .freq = 5300, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02118"></a>02118           .data[2] = 0x00, .data[3] = 0x63, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02119"></a>02119           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02120"></a>02120         { .channel = 64, .freq = 5320, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02121"></a>02121           .data[2] = 0x00, .data[3] = 0x62, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02122"></a>02122           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02123"></a>02123         { .channel = 100, .freq = 5500, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02124"></a>02124           .data[2] = 0x00, .data[3] = 0x30, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02125"></a>02125           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02126"></a>02126         { .channel = 104, .freq = 5520, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02127"></a>02127           .data[2] = 0x00, .data[3] = 0x20, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02128"></a>02128           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02129"></a>02129         { .channel = 108, .freq = 5540, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02130"></a>02130           .data[2] = 0x00, .data[3] = 0x20, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02131"></a>02131           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02132"></a>02132         { .channel = 112, .freq = 5560, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02133"></a>02133           .data[2] = 0x00, .data[3] = 0x20, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02134"></a>02134           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02135"></a>02135         { .channel = 116, .freq = 5580, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02136"></a>02136           .data[2] = 0x00, .data[3] = 0x10, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02137"></a>02137           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02138"></a>02138         { .channel = 120, .freq = 5600, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02139"></a>02139           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02140"></a>02140           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02141"></a>02141         { .channel = 124, .freq = 5620, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02142"></a>02142           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02143"></a>02143           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02144"></a>02144         { .channel = 128, .freq = 5640, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02145"></a>02145           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02146"></a>02146           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02147"></a>02147         { .channel = 132, .freq = 5660, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02148"></a>02148           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02149"></a>02149           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02150"></a>02150         { .channel = 136, .freq = 5680, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02151"></a>02151           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02152"></a>02152           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02153"></a>02153         { .channel = 140, .freq = 5700, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02154"></a>02154           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02155"></a>02155           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02156"></a>02156         { .channel = 149, .freq = 5745, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02157"></a>02157           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02158"></a>02158           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02159"></a>02159         { .channel = 153, .freq = 5765, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02160"></a>02160           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02161"></a>02161           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02162"></a>02162         { .channel = 157, .freq = 5785, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02163"></a>02163           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02164"></a>02164           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02165"></a>02165         { .channel = 161, .freq = 5805, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02166"></a>02166           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02167"></a>02167           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02168"></a>02168         { .channel = 165, .freq = 5825, .data[0] = 0x00, .data[1] = 0x00,
<a name="l02169"></a>02169           .data[2] = 0x00, .data[3] = 0x00, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02170"></a>02170           .data[6] = 0x37, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02171"></a>02171         { .channel = 184, .freq = 4920, .data[0] = 0x55, .data[1] = 0x77,
<a name="l02172"></a>02172           .data[2] = 0x90, .data[3] = 0xF7, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02173"></a>02173           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0xFF, },
<a name="l02174"></a>02174         { .channel = 188, .freq = 4940, .data[0] = 0x44, .data[1] = 0x77,
<a name="l02175"></a>02175           .data[2] = 0x80, .data[3] = 0xE7, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02176"></a>02176           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0xFF, },
<a name="l02177"></a>02177         { .channel = 192, .freq = 4960, .data[0] = 0x44, .data[1] = 0x66,
<a name="l02178"></a>02178           .data[2] = 0x80, .data[3] = 0xE7, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02179"></a>02179           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0xFF, },
<a name="l02180"></a>02180         { .channel = 196, .freq = 4980, .data[0] = 0x33, .data[1] = 0x66,
<a name="l02181"></a>02181           .data[2] = 0x70, .data[3] = 0xC7, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02182"></a>02182           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0xFF, },
<a name="l02183"></a>02183         { .channel = 200, .freq = 5000, .data[0] = 0x22, .data[1] = 0x55,
<a name="l02184"></a>02184           .data[2] = 0x60, .data[3] = 0xD7, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02185"></a>02185           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0xFF, },
<a name="l02186"></a>02186         { .channel = 204, .freq = 5020, .data[0] = 0x22, .data[1] = 0x55,
<a name="l02187"></a>02187           .data[2] = 0x60, .data[3] = 0xC7, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02188"></a>02188           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0xFF, },
<a name="l02189"></a>02189         { .channel = 208, .freq = 5040, .data[0] = 0x22, .data[1] = 0x44,
<a name="l02190"></a>02190           .data[2] = 0x50, .data[3] = 0xC7, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02191"></a>02191           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0xFF, },
<a name="l02192"></a>02192         { .channel = 212, .freq = 5060, .data[0] = 0x11, .data[1] = 0x44,
<a name="l02193"></a>02193           .data[2] = 0x50, .data[3] = 0xA5, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02194"></a>02194           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02195"></a>02195         { .channel = 216, .freq = 5080, .data[0] = 0x00, .data[1] = 0x44,
<a name="l02196"></a>02196           .data[2] = 0x40, .data[3] = 0xB6, .data[4] = 0x3C, .data[5] = 0x77,
<a name="l02197"></a>02197           .data[6] = 0x35, .data[7] = 0xFF, .data[8] = 0x88, },
<a name="l02198"></a>02198 };
<a name="l02199"></a>02199 
<a name="l02200"></a><a class="code" href="phy__lp_8c.html#a9c9ddc69a13565017d22c7ff3afacf70">02200</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb206x__channel.html">b206x_channel</a> <a class="code" href="phy__lp_8c.html#a9c9ddc69a13565017d22c7ff3afacf70">b2063_chantbl</a>[] = {
<a name="l02201"></a>02201         { .<a class="code" href="structb206x__channel.html#a4053bec95bf0eaeacf4ae49e0a8efa67">channel</a> = 1, .freq = 2412, .data[0] = 0x6F, .data[1] = 0x3C,
<a name="l02202"></a>02202           .data[2] = 0x3C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02203"></a>02203           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02204"></a>02204           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02205"></a>02205         { .channel = 2, .freq = 2417, .data[0] = 0x6F, .data[1] = 0x3C,
<a name="l02206"></a>02206           .data[2] = 0x3C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02207"></a>02207           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02208"></a>02208           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02209"></a>02209         { .channel = 3, .freq = 2422, .data[0] = 0x6F, .data[1] = 0x3C,
<a name="l02210"></a>02210           .data[2] = 0x3C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02211"></a>02211           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02212"></a>02212           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02213"></a>02213         { .channel = 4, .freq = 2427, .data[0] = 0x6F, .data[1] = 0x2C,
<a name="l02214"></a>02214           .data[2] = 0x2C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02215"></a>02215           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02216"></a>02216           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02217"></a>02217         { .channel = 5, .freq = 2432, .data[0] = 0x6F, .data[1] = 0x2C,
<a name="l02218"></a>02218           .data[2] = 0x2C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02219"></a>02219           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02220"></a>02220           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02221"></a>02221         { .channel = 6, .freq = 2437, .data[0] = 0x6F, .data[1] = 0x2C,
<a name="l02222"></a>02222           .data[2] = 0x2C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02223"></a>02223           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02224"></a>02224           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02225"></a>02225         { .channel = 7, .freq = 2442, .data[0] = 0x6F, .data[1] = 0x2C,
<a name="l02226"></a>02226           .data[2] = 0x2C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02227"></a>02227           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02228"></a>02228           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02229"></a>02229         { .channel = 8, .freq = 2447, .data[0] = 0x6F, .data[1] = 0x2C,
<a name="l02230"></a>02230           .data[2] = 0x2C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02231"></a>02231           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02232"></a>02232           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02233"></a>02233         { .channel = 9, .freq = 2452, .data[0] = 0x6F, .data[1] = 0x1C,
<a name="l02234"></a>02234           .data[2] = 0x1C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02235"></a>02235           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02236"></a>02236           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02237"></a>02237         { .channel = 10, .freq = 2457, .data[0] = 0x6F, .data[1] = 0x1C,
<a name="l02238"></a>02238           .data[2] = 0x1C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02239"></a>02239           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02240"></a>02240           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02241"></a>02241         { .channel = 11, .freq = 2462, .data[0] = 0x6E, .data[1] = 0x1C,
<a name="l02242"></a>02242           .data[2] = 0x1C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02243"></a>02243           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02244"></a>02244           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02245"></a>02245         { .channel = 12, .freq = 2467, .data[0] = 0x6E, .data[1] = 0x1C,
<a name="l02246"></a>02246           .data[2] = 0x1C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02247"></a>02247           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02248"></a>02248           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02249"></a>02249         { .channel = 13, .freq = 2472, .data[0] = 0x6E, .data[1] = 0x1C,
<a name="l02250"></a>02250           .data[2] = 0x1C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02251"></a>02251           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02252"></a>02252           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02253"></a>02253         { .channel = 14, .freq = 2484, .data[0] = 0x6E, .data[1] = 0x0C,
<a name="l02254"></a>02254           .data[2] = 0x0C, .data[3] = 0x04, .data[4] = 0x05, .data[5] = 0x05,
<a name="l02255"></a>02255           .data[6] = 0x05, .data[7] = 0x05, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02256"></a>02256           .data[10] = 0x80, .data[11] = 0x70, },
<a name="l02257"></a>02257         { .channel = 34, .freq = 5170, .data[0] = 0x6A, .data[1] = 0x0C,
<a name="l02258"></a>02258           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x02, .data[5] = 0x05,
<a name="l02259"></a>02259           .data[6] = 0x0D, .data[7] = 0x0D, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02260"></a>02260           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02261"></a>02261         { .channel = 36, .freq = 5180, .data[0] = 0x6A, .data[1] = 0x0C,
<a name="l02262"></a>02262           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x01, .data[5] = 0x05,
<a name="l02263"></a>02263           .data[6] = 0x0D, .data[7] = 0x0C, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02264"></a>02264           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02265"></a>02265         { .channel = 38, .freq = 5190, .data[0] = 0x6A, .data[1] = 0x0C,
<a name="l02266"></a>02266           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x01, .data[5] = 0x04,
<a name="l02267"></a>02267           .data[6] = 0x0C, .data[7] = 0x0C, .data[8] = 0x77, .data[9] = 0x80,
<a name="l02268"></a>02268           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02269"></a>02269         { .channel = 40, .freq = 5200, .data[0] = 0x69, .data[1] = 0x0C,
<a name="l02270"></a>02270           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x01, .data[5] = 0x04,
<a name="l02271"></a>02271           .data[6] = 0x0C, .data[7] = 0x0C, .data[8] = 0x77, .data[9] = 0x70,
<a name="l02272"></a>02272           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02273"></a>02273         { .channel = 42, .freq = 5210, .data[0] = 0x69, .data[1] = 0x0C,
<a name="l02274"></a>02274           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x01, .data[5] = 0x04,
<a name="l02275"></a>02275           .data[6] = 0x0B, .data[7] = 0x0C, .data[8] = 0x77, .data[9] = 0x70,
<a name="l02276"></a>02276           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02277"></a>02277         { .channel = 44, .freq = 5220, .data[0] = 0x69, .data[1] = 0x0C,
<a name="l02278"></a>02278           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x04,
<a name="l02279"></a>02279           .data[6] = 0x0B, .data[7] = 0x0B, .data[8] = 0x77, .data[9] = 0x60,
<a name="l02280"></a>02280           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02281"></a>02281         { .channel = 46, .freq = 5230, .data[0] = 0x69, .data[1] = 0x0C,
<a name="l02282"></a>02282           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x03,
<a name="l02283"></a>02283           .data[6] = 0x0A, .data[7] = 0x0B, .data[8] = 0x77, .data[9] = 0x60,
<a name="l02284"></a>02284           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02285"></a>02285         { .channel = 48, .freq = 5240, .data[0] = 0x69, .data[1] = 0x0C,
<a name="l02286"></a>02286           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x03,
<a name="l02287"></a>02287           .data[6] = 0x0A, .data[7] = 0x0A, .data[8] = 0x77, .data[9] = 0x60,
<a name="l02288"></a>02288           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02289"></a>02289         { .channel = 52, .freq = 5260, .data[0] = 0x68, .data[1] = 0x0C,
<a name="l02290"></a>02290           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x02,
<a name="l02291"></a>02291           .data[6] = 0x09, .data[7] = 0x09, .data[8] = 0x77, .data[9] = 0x60,
<a name="l02292"></a>02292           .data[10] = 0x20, .data[11] = 0x00, },
<a name="l02293"></a>02293         { .channel = 56, .freq = 5280, .data[0] = 0x68, .data[1] = 0x0C,
<a name="l02294"></a>02294           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x01,
<a name="l02295"></a>02295           .data[6] = 0x08, .data[7] = 0x08, .data[8] = 0x77, .data[9] = 0x50,
<a name="l02296"></a>02296           .data[10] = 0x10, .data[11] = 0x00, },
<a name="l02297"></a>02297         { .channel = 60, .freq = 5300, .data[0] = 0x68, .data[1] = 0x0C,
<a name="l02298"></a>02298           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x01,
<a name="l02299"></a>02299           .data[6] = 0x08, .data[7] = 0x08, .data[8] = 0x77, .data[9] = 0x50,
<a name="l02300"></a>02300           .data[10] = 0x10, .data[11] = 0x00, },
<a name="l02301"></a>02301         { .channel = 64, .freq = 5320, .data[0] = 0x67, .data[1] = 0x0C,
<a name="l02302"></a>02302           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02303"></a>02303           .data[6] = 0x08, .data[7] = 0x08, .data[8] = 0x77, .data[9] = 0x50,
<a name="l02304"></a>02304           .data[10] = 0x10, .data[11] = 0x00, },
<a name="l02305"></a>02305         { .channel = 100, .freq = 5500, .data[0] = 0x64, .data[1] = 0x0C,
<a name="l02306"></a>02306           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02307"></a>02307           .data[6] = 0x02, .data[7] = 0x01, .data[8] = 0x77, .data[9] = 0x20,
<a name="l02308"></a>02308           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02309"></a>02309         { .channel = 104, .freq = 5520, .data[0] = 0x64, .data[1] = 0x0C,
<a name="l02310"></a>02310           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02311"></a>02311           .data[6] = 0x01, .data[7] = 0x01, .data[8] = 0x77, .data[9] = 0x20,
<a name="l02312"></a>02312           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02313"></a>02313         { .channel = 108, .freq = 5540, .data[0] = 0x63, .data[1] = 0x0C,
<a name="l02314"></a>02314           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02315"></a>02315           .data[6] = 0x01, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x10,
<a name="l02316"></a>02316           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02317"></a>02317         { .channel = 112, .freq = 5560, .data[0] = 0x63, .data[1] = 0x0C,
<a name="l02318"></a>02318           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02319"></a>02319           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x10,
<a name="l02320"></a>02320           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02321"></a>02321         { .channel = 116, .freq = 5580, .data[0] = 0x62, .data[1] = 0x0C,
<a name="l02322"></a>02322           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02323"></a>02323           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x10,
<a name="l02324"></a>02324           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02325"></a>02325         { .channel = 120, .freq = 5600, .data[0] = 0x62, .data[1] = 0x0C,
<a name="l02326"></a>02326           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02327"></a>02327           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02328"></a>02328           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02329"></a>02329         { .channel = 124, .freq = 5620, .data[0] = 0x62, .data[1] = 0x0C,
<a name="l02330"></a>02330           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02331"></a>02331           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02332"></a>02332           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02333"></a>02333         { .channel = 128, .freq = 5640, .data[0] = 0x61, .data[1] = 0x0C,
<a name="l02334"></a>02334           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02335"></a>02335           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02336"></a>02336           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02337"></a>02337         { .channel = 132, .freq = 5660, .data[0] = 0x61, .data[1] = 0x0C,
<a name="l02338"></a>02338           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02339"></a>02339           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02340"></a>02340           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02341"></a>02341         { .channel = 136, .freq = 5680, .data[0] = 0x61, .data[1] = 0x0C,
<a name="l02342"></a>02342           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02343"></a>02343           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02344"></a>02344           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02345"></a>02345         { .channel = 140, .freq = 5700, .data[0] = 0x60, .data[1] = 0x0C,
<a name="l02346"></a>02346           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02347"></a>02347           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02348"></a>02348           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02349"></a>02349         { .channel = 149, .freq = 5745, .data[0] = 0x60, .data[1] = 0x0C,
<a name="l02350"></a>02350           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02351"></a>02351           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02352"></a>02352           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02353"></a>02353         { .channel = 153, .freq = 5765, .data[0] = 0x60, .data[1] = 0x0C,
<a name="l02354"></a>02354           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02355"></a>02355           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02356"></a>02356           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02357"></a>02357         { .channel = 157, .freq = 5785, .data[0] = 0x60, .data[1] = 0x0C,
<a name="l02358"></a>02358           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02359"></a>02359           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02360"></a>02360           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02361"></a>02361         { .channel = 161, .freq = 5805, .data[0] = 0x60, .data[1] = 0x0C,
<a name="l02362"></a>02362           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02363"></a>02363           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02364"></a>02364           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02365"></a>02365         { .channel = 165, .freq = 5825, .data[0] = 0x60, .data[1] = 0x0C,
<a name="l02366"></a>02366           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x00, .data[5] = 0x00,
<a name="l02367"></a>02367           .data[6] = 0x00, .data[7] = 0x00, .data[8] = 0x77, .data[9] = 0x00,
<a name="l02368"></a>02368           .data[10] = 0x00, .data[11] = 0x00, },
<a name="l02369"></a>02369         { .channel = 184, .freq = 4920, .data[0] = 0x6E, .data[1] = 0x0C,
<a name="l02370"></a>02370           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x09, .data[5] = 0x0E,
<a name="l02371"></a>02371           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0xC0,
<a name="l02372"></a>02372           .data[10] = 0x50, .data[11] = 0x00, },
<a name="l02373"></a>02373         { .channel = 188, .freq = 4940, .data[0] = 0x6E, .data[1] = 0x0C,
<a name="l02374"></a>02374           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x09, .data[5] = 0x0D,
<a name="l02375"></a>02375           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0xB0,
<a name="l02376"></a>02376           .data[10] = 0x50, .data[11] = 0x00, },
<a name="l02377"></a>02377         { .channel = 192, .freq = 4960, .data[0] = 0x6E, .data[1] = 0x0C,
<a name="l02378"></a>02378           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x08, .data[5] = 0x0C,
<a name="l02379"></a>02379           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0xB0,
<a name="l02380"></a>02380           .data[10] = 0x50, .data[11] = 0x00, },
<a name="l02381"></a>02381         { .channel = 196, .freq = 4980, .data[0] = 0x6D, .data[1] = 0x0C,
<a name="l02382"></a>02382           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x08, .data[5] = 0x0C,
<a name="l02383"></a>02383           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0xA0,
<a name="l02384"></a>02384           .data[10] = 0x40, .data[11] = 0x00, },
<a name="l02385"></a>02385         { .channel = 200, .freq = 5000, .data[0] = 0x6D, .data[1] = 0x0C,
<a name="l02386"></a>02386           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x08, .data[5] = 0x0B,
<a name="l02387"></a>02387           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0xA0,
<a name="l02388"></a>02388           .data[10] = 0x40, .data[11] = 0x00, },
<a name="l02389"></a>02389         { .channel = 204, .freq = 5020, .data[0] = 0x6D, .data[1] = 0x0C,
<a name="l02390"></a>02390           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x08, .data[5] = 0x0A,
<a name="l02391"></a>02391           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0xA0,
<a name="l02392"></a>02392           .data[10] = 0x40, .data[11] = 0x00, },
<a name="l02393"></a>02393         { .channel = 208, .freq = 5040, .data[0] = 0x6C, .data[1] = 0x0C,
<a name="l02394"></a>02394           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x07, .data[5] = 0x09,
<a name="l02395"></a>02395           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0x90,
<a name="l02396"></a>02396           .data[10] = 0x40, .data[11] = 0x00, },
<a name="l02397"></a>02397         { .channel = 212, .freq = 5060, .data[0] = 0x6C, .data[1] = 0x0C,
<a name="l02398"></a>02398           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x06, .data[5] = 0x08,
<a name="l02399"></a>02399           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0x90,
<a name="l02400"></a>02400           .data[10] = 0x40, .data[11] = 0x00, },
<a name="l02401"></a>02401         { .channel = 216, .freq = 5080, .data[0] = 0x6C, .data[1] = 0x0C,
<a name="l02402"></a>02402           .data[2] = 0x0C, .data[3] = 0x00, .data[4] = 0x05, .data[5] = 0x08,
<a name="l02403"></a>02403           .data[6] = 0x0F, .data[7] = 0x0F, .data[8] = 0x77, .data[9] = 0x90,
<a name="l02404"></a>02404           .data[10] = 0x40, .data[11] = 0x00, },
<a name="l02405"></a>02405 };
<a name="l02406"></a>02406 
<a name="l02407"></a><a class="code" href="phy__lp_8c.html#aa7a4adebc4eb32b93d60be43caf5bc5e">02407</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aa7a4adebc4eb32b93d60be43caf5bc5e">lpphy_b2062_reset_pll_bias</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02408"></a>02408 {
<a name="l02409"></a>02409         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#afd4d23ca351205c09e5d7de2ca840b5f">B2062_S_RFPLL_CTL2</a>, 0xFF);
<a name="l02410"></a>02410         udelay(20);
<a name="l02411"></a>02411         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#ae94b6ea704b3bbbc1a516badebe3d6b7">chip_id</a> == 0x5354) {
<a name="l02412"></a>02412                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ac882ada1c102a549fcb9168990e2940f">B2062_N_COMM1</a>, 4);
<a name="l02413"></a>02413                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#afd4d23ca351205c09e5d7de2ca840b5f">B2062_S_RFPLL_CTL2</a>, 4);
<a name="l02414"></a>02414         } <span class="keywordflow">else</span> {
<a name="l02415"></a>02415                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#afd4d23ca351205c09e5d7de2ca840b5f">B2062_S_RFPLL_CTL2</a>, 0);
<a name="l02416"></a>02416         }
<a name="l02417"></a>02417         udelay(5);
<a name="l02418"></a>02418 }
<a name="l02419"></a>02419 
<a name="l02420"></a><a class="code" href="phy__lp_8c.html#ab0845b5c923149c4ca8aeba8a79c6c31">02420</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#ab0845b5c923149c4ca8aeba8a79c6c31">lpphy_b2062_vco_calib</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02421"></a>02421 {
<a name="l02422"></a>02422         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aabc9a70c329f5b2f4859193dddf309bd">B2062_S_RFPLL_CTL21</a>, 0x42);
<a name="l02423"></a>02423         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aabc9a70c329f5b2f4859193dddf309bd">B2062_S_RFPLL_CTL21</a>, 0x62);
<a name="l02424"></a>02424         udelay(200);
<a name="l02425"></a>02425 }
<a name="l02426"></a>02426 
<a name="l02427"></a><a class="code" href="phy__lp_8c.html#a70fc3e4f53dedaa3d72dc7e005a0e3c1">02427</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#a70fc3e4f53dedaa3d72dc7e005a0e3c1">lpphy_b2062_tune</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l02428"></a>02428                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structb206x__channel.html#a4053bec95bf0eaeacf4ae49e0a8efa67">channel</a>)
<a name="l02429"></a>02429 {
<a name="l02430"></a>02430         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l02431"></a>02431         <span class="keyword">struct </span>ssb_bus *bus = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a68f9a4660126ada1510b28be93e1dd0d">sdev</a>-&gt;bus;
<a name="l02432"></a>02432         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb206x__channel.html">b206x_channel</a> *chandata = NULL;
<a name="l02433"></a>02433         u32 crystal_freq = bus-&gt;chipco.pmu.crystalfreq * 1000;
<a name="l02434"></a>02434         u32 tmp1, tmp2, tmp3, tmp4, tmp5, tmp6, tmp7, tmp8, tmp9;
<a name="l02435"></a>02435         <span class="keywordtype">int</span> i, err = 0;
<a name="l02436"></a>02436 
<a name="l02437"></a>02437         <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(b2062_chantbl); i++) {
<a name="l02438"></a>02438                 <span class="keywordflow">if</span> (b2062_chantbl[i].channel == channel) {
<a name="l02439"></a>02439                         chandata = &amp;b2062_chantbl[i];
<a name="l02440"></a>02440                         <span class="keywordflow">break</span>;
<a name="l02441"></a>02441                 }
<a name="l02442"></a>02442         }
<a name="l02443"></a>02443 
<a name="l02444"></a>02444         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(!chandata))
<a name="l02445"></a>02445                 <span class="keywordflow">return</span> -EINVAL;
<a name="l02446"></a>02446 
<a name="l02447"></a>02447         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#af0af7549db84f28bd68b14b70c48257a">B2062_S_RFPLL_CTL14</a>, 0x04);
<a name="l02448"></a>02448         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a3882639a0d0d810b4e44260751d9e054">B2062_N_LGENA_TUNE0</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[0]);
<a name="l02449"></a>02449         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a5d99e8c24d2fdd7bfdce8c7d0f69eaa4">B2062_N_LGENA_TUNE2</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[1]);
<a name="l02450"></a>02450         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a6c665919f6083012a3e1cf87ba971814">B2062_N_LGENA_TUNE3</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[2]);
<a name="l02451"></a>02451         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a29b4359174303c28e707c40aad5e04cf">B2062_N_TX_TUNE</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[3]);
<a name="l02452"></a>02452         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a41de650b552c65993496f0683d66ae01">B2062_S_LGENG_CTL1</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[4]);
<a name="l02453"></a>02453         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a5d8c0d39c4a19b1bb6b519312629f9c7">B2062_N_LGENA_CTL5</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[5]);
<a name="l02454"></a>02454         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a2e0f214c5c84eb237004952f5c1d347f">B2062_N_LGENA_CTL6</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[6]);
<a name="l02455"></a>02455         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a3276f2bb420a3dfbbaaa42dc1bf71938">B2062_N_TX_PGA</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[7]);
<a name="l02456"></a>02456         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a375f1d91bff283bdd3af3288bd81d356">B2062_N_TX_PAD</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[8]);
<a name="l02457"></a>02457 
<a name="l02458"></a>02458         tmp1 = crystal_freq / 1000;
<a name="l02459"></a>02459         tmp2 = lpphy-&gt;<a class="code" href="structb43__phy__lp.html#ad13efc99d479762d3d20140bca2729b6">pdiv</a> * 1000;
<a name="l02460"></a>02460         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a2cc8ad8d9812446f3f9b00f21145a8eb">B2062_S_RFPLL_CTL33</a>, 0xCC);
<a name="l02461"></a>02461         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae5e5421f3d78d47331fb57293b666f3d">B2062_S_RFPLL_CTL34</a>, 0x07);
<a name="l02462"></a>02462         <a class="code" href="phy__lp_8c.html#aa7a4adebc4eb32b93d60be43caf5bc5e">lpphy_b2062_reset_pll_bias</a>(dev);
<a name="l02463"></a>02463         tmp3 = tmp2 * <a class="code" href="phy__lp_8c.html#a8c683969295ad30dcf3d0795929a2933">channel2freq_lp</a>(channel);
<a name="l02464"></a>02464         <span class="keywordflow">if</span> (<a class="code" href="phy__lp_8c.html#a8c683969295ad30dcf3d0795929a2933">channel2freq_lp</a>(channel) &lt; 4000)
<a name="l02465"></a>02465                 tmp3 *= 2;
<a name="l02466"></a>02466         tmp4 = 48 * tmp1;
<a name="l02467"></a>02467         tmp6 = tmp3 / tmp4;
<a name="l02468"></a>02468         tmp7 = tmp3 % tmp4;
<a name="l02469"></a>02469         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a64580b54a7b1a0cbcdd9f5a11280cda3">B2062_S_RFPLL_CTL26</a>, tmp6);
<a name="l02470"></a>02470         tmp5 = tmp7 * 0x100;
<a name="l02471"></a>02471         tmp6 = tmp5 / tmp4;
<a name="l02472"></a>02472         tmp7 = tmp5 % tmp4;
<a name="l02473"></a>02473         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae94d6cadead9a2d7073bba643ba05f87">B2062_S_RFPLL_CTL27</a>, tmp6);
<a name="l02474"></a>02474         tmp5 = tmp7 * 0x100;
<a name="l02475"></a>02475         tmp6 = tmp5 / tmp4;
<a name="l02476"></a>02476         tmp7 = tmp5 % tmp4;
<a name="l02477"></a>02477         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a065e3a90c1ff68c4b6023cc98415ead5">B2062_S_RFPLL_CTL28</a>, tmp6);
<a name="l02478"></a>02478         tmp5 = tmp7 * 0x100;
<a name="l02479"></a>02479         tmp6 = tmp5 / tmp4;
<a name="l02480"></a>02480         tmp7 = tmp5 % tmp4;
<a name="l02481"></a>02481         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1a72bb178785c41fd1ab68345108d3a6">B2062_S_RFPLL_CTL29</a>, tmp6 + ((2 * tmp7) / tmp4));
<a name="l02482"></a>02482         tmp8 = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a5631afd5fca8d5dc8ddac2a45b8e706f">B2062_S_RFPLL_CTL19</a>);
<a name="l02483"></a>02483         tmp9 = ((2 * tmp3 * (tmp8 + 1)) + (3 * tmp1)) / (6 * tmp1);
<a name="l02484"></a>02484         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7f375dab8ae3e7a00e936dbbac137cc0">B2062_S_RFPLL_CTL23</a>, (tmp9 &gt;&gt; 8) + 16);
<a name="l02485"></a>02485         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae1e84f451c8eabc65b4a2cce91bcaaf9">B2062_S_RFPLL_CTL24</a>, tmp9 &amp; 0xFF);
<a name="l02486"></a>02486 
<a name="l02487"></a>02487         <a class="code" href="phy__lp_8c.html#ab0845b5c923149c4ca8aeba8a79c6c31">lpphy_b2062_vco_calib</a>(dev);
<a name="l02488"></a>02488         <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a4a4cf069471ca1e3bb21d83179d51919">B2062_S_RFPLL_CTL3</a>) &amp; 0x10) {
<a name="l02489"></a>02489                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a2cc8ad8d9812446f3f9b00f21145a8eb">B2062_S_RFPLL_CTL33</a>, 0xFC);
<a name="l02490"></a>02490                 <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ae5e5421f3d78d47331fb57293b666f3d">B2062_S_RFPLL_CTL34</a>, 0);
<a name="l02491"></a>02491                 <a class="code" href="phy__lp_8c.html#aa7a4adebc4eb32b93d60be43caf5bc5e">lpphy_b2062_reset_pll_bias</a>(dev);
<a name="l02492"></a>02492                 <a class="code" href="phy__lp_8c.html#ab0845b5c923149c4ca8aeba8a79c6c31">lpphy_b2062_vco_calib</a>(dev);
<a name="l02493"></a>02493                 <span class="keywordflow">if</span> (<a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a4a4cf069471ca1e3bb21d83179d51919">B2062_S_RFPLL_CTL3</a>) &amp; 0x10)
<a name="l02494"></a>02494                         err = -EIO;
<a name="l02495"></a>02495         }
<a name="l02496"></a>02496 
<a name="l02497"></a>02497         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#af0af7549db84f28bd68b14b70c48257a">B2062_S_RFPLL_CTL14</a>, ~0x04);
<a name="l02498"></a>02498         <span class="keywordflow">return</span> err;
<a name="l02499"></a>02499 }
<a name="l02500"></a>02500 
<a name="l02501"></a><a class="code" href="phy__lp_8c.html#a477127e527a11161ce9cc6473321f6d9">02501</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a477127e527a11161ce9cc6473321f6d9">lpphy_b2063_vco_calib</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02502"></a>02502 {
<a name="l02503"></a>02503         u16 tmp;
<a name="l02504"></a>02504 
<a name="l02505"></a>02505         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a52cd89a8f0e024a8e741b4a1db2b2839">B2063_PLL_SP1</a>, ~0x40);
<a name="l02506"></a>02506         tmp = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#abca076ad862ad214e7c9bdba0894904c">B2063_PLL_JTAG_CALNRST</a>) &amp; 0xF8;
<a name="l02507"></a>02507         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#abca076ad862ad214e7c9bdba0894904c">B2063_PLL_JTAG_CALNRST</a>, tmp);
<a name="l02508"></a>02508         udelay(1);
<a name="l02509"></a>02509         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#abca076ad862ad214e7c9bdba0894904c">B2063_PLL_JTAG_CALNRST</a>, tmp | 0x4);
<a name="l02510"></a>02510         udelay(1);
<a name="l02511"></a>02511         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#abca076ad862ad214e7c9bdba0894904c">B2063_PLL_JTAG_CALNRST</a>, tmp | 0x6);
<a name="l02512"></a>02512         udelay(1);
<a name="l02513"></a>02513         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#abca076ad862ad214e7c9bdba0894904c">B2063_PLL_JTAG_CALNRST</a>, tmp | 0x7);
<a name="l02514"></a>02514         udelay(300);
<a name="l02515"></a>02515         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a52cd89a8f0e024a8e741b4a1db2b2839">B2063_PLL_SP1</a>, 0x40);
<a name="l02516"></a>02516 }
<a name="l02517"></a>02517 
<a name="l02518"></a><a class="code" href="phy__lp_8c.html#a8b2928aba80f75fa7d3dd85eb1d80132">02518</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#a8b2928aba80f75fa7d3dd85eb1d80132">lpphy_b2063_tune</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l02519"></a>02519                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structb206x__channel.html#a4053bec95bf0eaeacf4ae49e0a8efa67">channel</a>)
<a name="l02520"></a>02520 {
<a name="l02521"></a>02521         <span class="keyword">struct </span>ssb_bus *bus = dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a68f9a4660126ada1510b28be93e1dd0d">sdev</a>-&gt;bus;
<a name="l02522"></a>02522 
<a name="l02523"></a>02523         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb206x__channel.html">b206x_channel</a> *chandata = NULL;
<a name="l02524"></a>02524         u32 crystal_freq = bus-&gt;chipco.pmu.crystalfreq * 1000;
<a name="l02525"></a>02525         u32 freqref, vco_freq, val1, val2, val3, timeout, timeoutref, count;
<a name="l02526"></a>02526         u16 old_comm15, scale;
<a name="l02527"></a>02527         u32 tmp1, tmp2, tmp3, tmp4, tmp5, tmp6;
<a name="l02528"></a>02528         <span class="keywordtype">int</span> i, div = (crystal_freq &lt;= 26000000 ? 1 : 2);
<a name="l02529"></a>02529 
<a name="l02530"></a>02530         <span class="keywordflow">for</span> (i = 0; i &lt; ARRAY_SIZE(b2063_chantbl); i++) {
<a name="l02531"></a>02531                 <span class="keywordflow">if</span> (b2063_chantbl[i].channel == channel) {
<a name="l02532"></a>02532                         chandata = &amp;b2063_chantbl[i];
<a name="l02533"></a>02533                         <span class="keywordflow">break</span>;
<a name="l02534"></a>02534                 }
<a name="l02535"></a>02535         }
<a name="l02536"></a>02536 
<a name="l02537"></a>02537         <span class="keywordflow">if</span> (<a class="code" href="b43_8h.html#a5e31a99344a0d0ea6d63fa726710556e">B43_WARN_ON</a>(!chandata))
<a name="l02538"></a>02538                 <span class="keywordflow">return</span> -EINVAL;
<a name="l02539"></a>02539 
<a name="l02540"></a>02540         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#aa385cbaf606691789e7b5e6a7eb16405">B2063_LOGEN_VCOBUF1</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[0]);
<a name="l02541"></a>02541         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a85389081bab4bde8cff8a009bb295be5">B2063_LOGEN_MIXER2</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[1]);
<a name="l02542"></a>02542         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a140f8fc3713951453133d3960c222e7a">B2063_LOGEN_BUF2</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[2]);
<a name="l02543"></a>02543         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1e425f3c6376a4b46c13785326c21ad1">B2063_LOGEN_RCCR1</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[3]);
<a name="l02544"></a>02544         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a8023c432cbc3f2d44ccf27b5206a43a7">B2063_A_RX_1ST3</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[4]);
<a name="l02545"></a>02545         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a1b1978b482af6bbb22ef51f3e6c7869a">B2063_A_RX_2ND1</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[5]);
<a name="l02546"></a>02546         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a72a5f563117bb3e889ab874f2a6c099e">B2063_A_RX_2ND4</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[6]);
<a name="l02547"></a>02547         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#abd1780eb48f29b286809a1854c20a046">B2063_A_RX_2ND7</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[7]);
<a name="l02548"></a>02548         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a0112eafa8de4a44a747be25833042b05">B2063_A_RX_PS6</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[8]);
<a name="l02549"></a>02549         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a8d04caed8dfb02eb286530794aaf126f">B2063_TX_RF_CTL2</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[9]);
<a name="l02550"></a>02550         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a3fe3404fab75232156fca68e04a3b748">B2063_TX_RF_CTL5</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[10]);
<a name="l02551"></a>02551         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a589e02240486bfb4720240d6bdb69707">B2063_PA_CTL11</a>, chandata-&gt;<a class="code" href="structb206x__channel.html#ae0974c4309fd2c2a804507637f661185">data</a>[11]);
<a name="l02552"></a>02552 
<a name="l02553"></a>02553         old_comm15 = <a class="code" href="phy__common_8c.html#a5b0ff7aded31f6b198da210e42aa4cf2">b43_radio_read</a>(dev, <a class="code" href="phy__lp_8h.html#a7414cb4b02a9f18ecf3b4190d5f7ca28">B2063_COMM15</a>);
<a name="l02554"></a>02554         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a7414cb4b02a9f18ecf3b4190d5f7ca28">B2063_COMM15</a>, 0x1E);
<a name="l02555"></a>02555 
<a name="l02556"></a>02556         <span class="keywordflow">if</span> (chandata-&gt;<a class="code" href="structb206x__channel.html#ab0708dae70f9af431b2254cdcd2ae2cd">freq</a> &gt; 4000) <span class="comment">/* spec says 2484, but 4000 is safer */</span>
<a name="l02557"></a>02557                 vco_freq = chandata-&gt;<a class="code" href="structb206x__channel.html#ab0708dae70f9af431b2254cdcd2ae2cd">freq</a> &lt;&lt; 1;
<a name="l02558"></a>02558         <span class="keywordflow">else</span>
<a name="l02559"></a>02559                 vco_freq = chandata-&gt;<a class="code" href="structb206x__channel.html#ab0708dae70f9af431b2254cdcd2ae2cd">freq</a> &lt;&lt; 2;
<a name="l02560"></a>02560 
<a name="l02561"></a>02561         freqref = crystal_freq * 3;
<a name="l02562"></a>02562         val1 = <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(crystal_freq, 1000000, 16);
<a name="l02563"></a>02563         val2 = <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(crystal_freq, 1000000 * div, 16);
<a name="l02564"></a>02564         val3 = <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(vco_freq, 3, 16);
<a name="l02565"></a>02565         timeout = ((((8 * crystal_freq) / (div * 5000000)) + 1) &gt;&gt; 1) - 1;
<a name="l02566"></a>02566         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#adab4e3bb2996f5443c7aff277bb5af37">B2063_PLL_JTAG_PLL_VCO_CALIB3</a>, 0x2);
<a name="l02567"></a>02567         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a2ee6525b7e74b0327ed9d96810056ef1">B2063_PLL_JTAG_PLL_VCO_CALIB6</a>,
<a name="l02568"></a>02568                           0xFFF8, timeout &gt;&gt; 2);
<a name="l02569"></a>02569         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aaf2e5f59c71d8ffde5451bcfda4c19d3">B2063_PLL_JTAG_PLL_VCO_CALIB7</a>,
<a name="l02570"></a>02570                           0xFF9F,timeout &lt;&lt; 5);
<a name="l02571"></a>02571 
<a name="l02572"></a>02572         timeoutref = ((((8 * crystal_freq) / (div * (timeout + 1))) +
<a name="l02573"></a>02573                                                 999999) / 1000000) + 1;
<a name="l02574"></a>02574         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a17338128df4ca5ff86145086bdb9d737">B2063_PLL_JTAG_PLL_VCO_CALIB5</a>, timeoutref);
<a name="l02575"></a>02575 
<a name="l02576"></a>02576         count = <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(val3, val2 + 16, 16);
<a name="l02577"></a>02577         count *= (timeout + 1) * (timeoutref + 1);
<a name="l02578"></a>02578         count--;
<a name="l02579"></a>02579         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aaf2e5f59c71d8ffde5451bcfda4c19d3">B2063_PLL_JTAG_PLL_VCO_CALIB7</a>,
<a name="l02580"></a>02580                                                 0xF0, count &gt;&gt; 8);
<a name="l02581"></a>02581         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#acc8bcee0747e2bbfb42e954bb17b508d">B2063_PLL_JTAG_PLL_VCO_CALIB8</a>, count &amp; 0xFF);
<a name="l02582"></a>02582 
<a name="l02583"></a>02583         tmp1 = ((val3 * 62500) / freqref) &lt;&lt; 4;
<a name="l02584"></a>02584         tmp2 = ((val3 * 62500) % freqref) &lt;&lt; 4;
<a name="l02585"></a>02585         <span class="keywordflow">while</span> (tmp2 &gt;= freqref) {
<a name="l02586"></a>02586                 tmp1++;
<a name="l02587"></a>02587                 tmp2 -= freqref;
<a name="l02588"></a>02588         }
<a name="l02589"></a>02589         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a768e888df9fad631ea2f8ef64e24b5ad">B2063_PLL_JTAG_PLL_SG1</a>, 0xFFE0, tmp1 &gt;&gt; 4);
<a name="l02590"></a>02590         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7cc9564c868d54afe66ce71ac2df8d51">B2063_PLL_JTAG_PLL_SG2</a>, 0xFE0F, tmp1 &lt;&lt; 4);
<a name="l02591"></a>02591         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a7cc9564c868d54afe66ce71ac2df8d51">B2063_PLL_JTAG_PLL_SG2</a>, 0xFFF0, tmp1 &gt;&gt; 16);
<a name="l02592"></a>02592         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a0955b4427b4b1d690a5f255f0882a0ac">B2063_PLL_JTAG_PLL_SG3</a>, (tmp2 &gt;&gt; 8) &amp; 0xFF);
<a name="l02593"></a>02593         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#ace11f33e4f00935a65b1f86c32c35891">B2063_PLL_JTAG_PLL_SG4</a>, tmp2 &amp; 0xFF);
<a name="l02594"></a>02594 
<a name="l02595"></a>02595         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a33e951c167fe502b9642937524c24e54">B2063_PLL_JTAG_PLL_LF1</a>, 0xB9);
<a name="l02596"></a>02596         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a9cba45860f92ed3a1f6834f510c7b7bd">B2063_PLL_JTAG_PLL_LF2</a>, 0x88);
<a name="l02597"></a>02597         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a5dd4fa02afd409ca4971a67e427bc3ee">B2063_PLL_JTAG_PLL_LF3</a>, 0x28);
<a name="l02598"></a>02598         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a0bd4d350dd7f169a76ebc3c13070204e">B2063_PLL_JTAG_PLL_LF4</a>, 0x63);
<a name="l02599"></a>02599 
<a name="l02600"></a>02600         tmp3 = ((41 * (val3 - 3000)) /1200) + 27;
<a name="l02601"></a>02601         tmp4 = <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(132000 * tmp1, 8451, 16);
<a name="l02602"></a>02602 
<a name="l02603"></a>02603         <span class="keywordflow">if</span> ((tmp4 + tmp3 - 1) / tmp3 &gt; 60) {
<a name="l02604"></a>02604                 scale = 1;
<a name="l02605"></a>02605                 tmp5 = ((tmp4 + tmp3) / (tmp3 &lt;&lt; 1)) - 8;
<a name="l02606"></a>02606         } <span class="keywordflow">else</span> {
<a name="l02607"></a>02607                 scale = 0;
<a name="l02608"></a>02608                 tmp5 = ((tmp4 + (tmp3 &gt;&gt; 1)) / tmp3) - 8;
<a name="l02609"></a>02609         }
<a name="l02610"></a>02610         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa34b39ac18739932e440cca5d62a30a3">B2063_PLL_JTAG_PLL_CP2</a>, 0xFFC0, tmp5);
<a name="l02611"></a>02611         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#aa34b39ac18739932e440cca5d62a30a3">B2063_PLL_JTAG_PLL_CP2</a>, 0xFFBF, scale &lt;&lt; 6);
<a name="l02612"></a>02612 
<a name="l02613"></a>02613         tmp6 = <a class="code" href="phy__lp_8c.html#aaecac966b13a60ebf9ec78b284474d41">lpphy_qdiv_roundup</a>(100 * val1, val3, 16);
<a name="l02614"></a>02614         tmp6 *= (tmp5 * 8) * (scale + 1);
<a name="l02615"></a>02615         <span class="keywordflow">if</span> (tmp6 &gt; 150)
<a name="l02616"></a>02616                 tmp6 = 0;
<a name="l02617"></a>02617 
<a name="l02618"></a>02618         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8f03cfff38485a5525b8799c92c45570">B2063_PLL_JTAG_PLL_CP3</a>, 0xFFE0, tmp6);
<a name="l02619"></a>02619         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a8f03cfff38485a5525b8799c92c45570">B2063_PLL_JTAG_PLL_CP3</a>, 0xFFDF, scale &lt;&lt; 5);
<a name="l02620"></a>02620 
<a name="l02621"></a>02621         <a class="code" href="phy__common_8c.html#a977aa8411429bf4468cff41f6020ea02">b43_radio_maskset</a>(dev, <a class="code" href="phy__lp_8h.html#a166f346ca3856a38d3f74de6c20664ed">B2063_PLL_JTAG_PLL_XTAL_12</a>, 0xFFFB, 0x4);
<a name="l02622"></a>02622         <span class="keywordflow">if</span> (crystal_freq &gt; 26000000)
<a name="l02623"></a>02623                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a166f346ca3856a38d3f74de6c20664ed">B2063_PLL_JTAG_PLL_XTAL_12</a>, 0x2);
<a name="l02624"></a>02624         <span class="keywordflow">else</span>
<a name="l02625"></a>02625                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a166f346ca3856a38d3f74de6c20664ed">B2063_PLL_JTAG_PLL_XTAL_12</a>, 0xFD);
<a name="l02626"></a>02626 
<a name="l02627"></a>02627         <span class="keywordflow">if</span> (val1 == 45)
<a name="l02628"></a>02628                 <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#a53d9399a05e018b3123fc59e2926e67d">B2063_PLL_JTAG_PLL_VCO1</a>, 0x2);
<a name="l02629"></a>02629         <span class="keywordflow">else</span>
<a name="l02630"></a>02630                 <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a53d9399a05e018b3123fc59e2926e67d">B2063_PLL_JTAG_PLL_VCO1</a>, 0xFD);
<a name="l02631"></a>02631 
<a name="l02632"></a>02632         <a class="code" href="phy__common_8c.html#a2d71a0cd69c04c73275668125a89651e">b43_radio_set</a>(dev, <a class="code" href="phy__lp_8h.html#aa9651b5cb59e439bce0ae9869a92a78b">B2063_PLL_SP2</a>, 0x3);
<a name="l02633"></a>02633         udelay(1);
<a name="l02634"></a>02634         <a class="code" href="phy__common_8c.html#aa0d4025c0760e0d0bd1529c62d1fff87">b43_radio_mask</a>(dev, <a class="code" href="phy__lp_8h.html#aa9651b5cb59e439bce0ae9869a92a78b">B2063_PLL_SP2</a>, 0xFFFC);
<a name="l02635"></a>02635         <a class="code" href="phy__lp_8c.html#a477127e527a11161ce9cc6473321f6d9">lpphy_b2063_vco_calib</a>(dev);
<a name="l02636"></a>02636         <a class="code" href="phy__common_8c.html#ac00fdf75c09fab7057076c10253170b0">b43_radio_write</a>(dev, <a class="code" href="phy__lp_8h.html#a7414cb4b02a9f18ecf3b4190d5f7ca28">B2063_COMM15</a>, old_comm15);
<a name="l02637"></a>02637 
<a name="l02638"></a>02638         <span class="keywordflow">return</span> 0;
<a name="l02639"></a>02639 }
<a name="l02640"></a>02640 
<a name="l02641"></a><a class="code" href="phy__lp_8c.html#ab6d19054c5c137f1de186b0d9157da5b">02641</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#ab6d19054c5c137f1de186b0d9157da5b">b43_lpphy_op_switch_channel</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l02642"></a>02642                                        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_channel)
<a name="l02643"></a>02643 {
<a name="l02644"></a>02644         <span class="keyword">struct </span><a class="code" href="structb43__phy__lp.html">b43_phy_lp</a> *lpphy = dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a19a360cf44850abb10ff473361661c90">lp</a>;
<a name="l02645"></a>02645         <span class="keywordtype">int</span> err;
<a name="l02646"></a>02646 
<a name="l02647"></a>02647         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#a8ed5d507cf1c689276669ce8935e2a7c">phy</a>.<a class="code" href="structb43__phy.html#a5a8e907e85dbb880185fa6f434075f4b">radio_ver</a> == 0x2063) {
<a name="l02648"></a>02648                 err = <a class="code" href="phy__lp_8c.html#a8b2928aba80f75fa7d3dd85eb1d80132">lpphy_b2063_tune</a>(dev, new_channel);
<a name="l02649"></a>02649                 <span class="keywordflow">if</span> (err)
<a name="l02650"></a>02650                         <span class="keywordflow">return</span> err;
<a name="l02651"></a>02651         } <span class="keywordflow">else</span> {
<a name="l02652"></a>02652                 err = <a class="code" href="phy__lp_8c.html#a70fc3e4f53dedaa3d72dc7e005a0e3c1">lpphy_b2062_tune</a>(dev, new_channel);
<a name="l02653"></a>02653                 <span class="keywordflow">if</span> (err)
<a name="l02654"></a>02654                         <span class="keywordflow">return</span> err;
<a name="l02655"></a>02655                 <a class="code" href="phy__lp_8c.html#a910915d83f25e0d777567299f5af3ab8">lpphy_set_analog_filter</a>(dev, new_channel);
<a name="l02656"></a>02656                 <a class="code" href="phy__lp_8c.html#ab8cd66489d03da459762fccafbd489cc">lpphy_adjust_gain_table</a>(dev, <a class="code" href="phy__lp_8c.html#a8c683969295ad30dcf3d0795929a2933">channel2freq_lp</a>(new_channel));
<a name="l02657"></a>02657         }
<a name="l02658"></a>02658 
<a name="l02659"></a>02659         lpphy-&gt;<a class="code" href="structb43__phy__lp.html#a63338f72f7dbd0e371d7a86a8aa02aa2">channel</a> = new_channel;
<a name="l02660"></a>02660         <a class="code" href="b43_8h.html#a0c967641dd56d28ccd302efe6751e037">b43_write16</a>(dev, <a class="code" href="b43_8h.html#a881966bd6256b2cdcbdf5c76e2249456">B43_MMIO_CHANNEL</a>, new_channel);
<a name="l02661"></a>02661 
<a name="l02662"></a>02662         <span class="keywordflow">return</span> 0;
<a name="l02663"></a>02663 }
<a name="l02664"></a>02664 
<a name="l02665"></a><a class="code" href="phy__lp_8c.html#a161e995efdc5483a934c828d3d49d2cb">02665</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="phy__lp_8c.html#a161e995efdc5483a934c828d3d49d2cb">b43_lpphy_op_init</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02666"></a>02666 {
<a name="l02667"></a>02667         <span class="keywordtype">int</span> err;
<a name="l02668"></a>02668 
<a name="l02669"></a>02669         <span class="keywordflow">if</span> (dev-&gt;<a class="code" href="structb43__wldev.html#afd2240bbde9b9c300e8817aa90e1580b">dev</a>-&gt;<a class="code" href="structb43__bus__dev.html#a880bb9d651e18b4cc58ff060ae06b131">bus_type</a> != <a class="code" href="bus_8h.html#a7d9e1f255fdc367cca560f2be24647f5a6e49471bf473723b618718b72a3dbc91">B43_BUS_SSB</a>) {
<a name="l02670"></a>02670                 <a class="code" href="main_8c.html#ae7d6323280005f3298ddcf79752f1e77">b43err</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;LP-PHY is supported only on SSB!\n&quot;</span>);
<a name="l02671"></a>02671                 <span class="keywordflow">return</span> -EOPNOTSUPP;
<a name="l02672"></a>02672         }
<a name="l02673"></a>02673 
<a name="l02674"></a>02674         <a class="code" href="phy__lp_8c.html#ad53d68a5a45fbce089adde07319c812b">lpphy_read_band_sprom</a>(dev); <span class="comment">//FIXME should this be in prepare_structs?</span>
<a name="l02675"></a>02675         <a class="code" href="phy__lp_8c.html#a2a19134a4b2f53e365096b848b6443cc">lpphy_baseband_init</a>(dev);
<a name="l02676"></a>02676         <a class="code" href="phy__lp_8c.html#ad61f0d6454a974c8faf98795aaf6688e">lpphy_radio_init</a>(dev);
<a name="l02677"></a>02677         <a class="code" href="phy__lp_8c.html#a854737878e955b4dbbdd8b79c519ed3d">lpphy_calibrate_rc</a>(dev);
<a name="l02678"></a>02678         err = <a class="code" href="phy__lp_8c.html#ab6d19054c5c137f1de186b0d9157da5b">b43_lpphy_op_switch_channel</a>(dev, 7);
<a name="l02679"></a>02679         <span class="keywordflow">if</span> (err) {
<a name="l02680"></a>02680                 <a class="code" href="main_8c.html#ac3164e7d1ba2fbd05fce755cdb232382">b43dbg</a>(dev-&gt;<a class="code" href="structb43__wldev.html#a98ac28e92a25ddf850259bdf6211ae4b">wl</a>, <span class="stringliteral">&quot;Switch to channel 7 failed, error = %d.\n&quot;</span>,
<a name="l02681"></a>02681                        err);
<a name="l02682"></a>02682         }
<a name="l02683"></a>02683         <a class="code" href="phy__lp_8c.html#a9c5c889bb22d55992545ca5e8c7fbcf6">lpphy_tx_pctl_init</a>(dev);
<a name="l02684"></a>02684         <a class="code" href="phy__lp_8c.html#a43ec6b70764ef6256f94a929db3d3eee">lpphy_calibration</a>(dev);
<a name="l02685"></a>02685         <span class="comment">//TODO ACI init</span>
<a name="l02686"></a>02686 
<a name="l02687"></a>02687         <span class="keywordflow">return</span> 0;
<a name="l02688"></a>02688 }
<a name="l02689"></a>02689 
<a name="l02690"></a><a class="code" href="phy__lp_8c.html#a30e4753f0a73935d430c793422e33d93">02690</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#a30e4753f0a73935d430c793422e33d93">b43_lpphy_op_adjust_txpower</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02691"></a>02691 {
<a name="l02692"></a>02692         <span class="comment">//TODO</span>
<a name="l02693"></a>02693 }
<a name="l02694"></a>02694 
<a name="l02695"></a><a class="code" href="phy__lp_8c.html#a885f6209c39c4c13e866084cbad6c795">02695</a> <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="phy__common_8h.html#a6db3c97c17dd2ad5300b634b7526fd03">b43_txpwr_result</a> <a class="code" href="phy__lp_8c.html#a885f6209c39c4c13e866084cbad6c795">b43_lpphy_op_recalc_txpower</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev,
<a name="l02696"></a>02696                                                          <span class="keywordtype">bool</span> ignore_tssi)
<a name="l02697"></a>02697 {
<a name="l02698"></a>02698         <span class="comment">//TODO</span>
<a name="l02699"></a>02699         <span class="keywordflow">return</span> <a class="code" href="phy__common_8h.html#a6db3c97c17dd2ad5300b634b7526fd03ac688dafff0513e979c11092e64ba76fa">B43_TXPWR_RES_DONE</a>;
<a name="l02700"></a>02700 }
<a name="l02701"></a>02701 
<a name="l02702"></a><a class="code" href="phy__lp_8c.html#afb0588f7ea024879ccdec2bb425edca2">02702</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#afb0588f7ea024879ccdec2bb425edca2">b43_lpphy_op_switch_analog</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev, <span class="keywordtype">bool</span> on)
<a name="l02703"></a>02703 {
<a name="l02704"></a>02704        <span class="keywordflow">if</span> (on) {
<a name="l02705"></a>02705                <a class="code" href="phy__common_8c.html#af989c6b9b6c21865492deca5a70754d4">b43_phy_mask</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0xfff8);
<a name="l02706"></a>02706        } <span class="keywordflow">else</span> {
<a name="l02707"></a>02707                <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a9352c2dd9cc75ab942f049e907420c36">B43_LPPHY_AFE_CTL_OVRVAL</a>, 0x0007);
<a name="l02708"></a>02708                <a class="code" href="phy__common_8c.html#ac1f1488d81fb9ba843ec6c2995958452">b43_phy_set</a>(dev, <a class="code" href="phy__lp_8h.html#a515975e0891a18ee8d6ab8d72e5ba5f9">B43_LPPHY_AFE_CTL_OVR</a>, 0x0007);
<a name="l02709"></a>02709        }
<a name="l02710"></a>02710 }
<a name="l02711"></a>02711 
<a name="l02712"></a><a class="code" href="phy__lp_8c.html#aff57087be8b8efb469740a8fc7797a04">02712</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="phy__lp_8c.html#aff57087be8b8efb469740a8fc7797a04">b43_lpphy_op_pwork_15sec</a>(<span class="keyword">struct</span> <a class="code" href="structb43__wldev.html">b43_wldev</a> *dev)
<a name="l02713"></a>02713 {
<a name="l02714"></a>02714         <span class="comment">//TODO</span>
<a name="l02715"></a>02715 }
<a name="l02716"></a>02716 
<a name="l02717"></a><a class="code" href="phy__lp_8h.html#aff941e0d990f2c7725bfee8a36b718c8">02717</a> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structb43__phy__operations.html">b43_phy_operations</a> <a class="code" href="phy__lp_8c.html#aff941e0d990f2c7725bfee8a36b718c8">b43_phyops_lp</a> = {
<a name="l02718"></a>02718         .<a class="code" href="structb43__phy__operations.html#a165c4f4148350fc709122de3c7ce3efd">allocate</a>               = <a class="code" href="phy__lp_8c.html#a3da6d1c6bf92af4bda8cb58126b98678">b43_lpphy_op_allocate</a>,
<a name="l02719"></a>02719         .free                   = <a class="code" href="phy__lp_8c.html#ab67444039e19a0c70cc681ec24e0103a">b43_lpphy_op_free</a>,
<a name="l02720"></a>02720         .prepare_structs        = <a class="code" href="phy__lp_8c.html#afc684bf823dec6fc8f9b6f584e4a6f9a">b43_lpphy_op_prepare_structs</a>,
<a name="l02721"></a>02721         .init                   = <a class="code" href="phy__lp_8c.html#a161e995efdc5483a934c828d3d49d2cb">b43_lpphy_op_init</a>,
<a name="l02722"></a>02722         .phy_read               = <a class="code" href="phy__lp_8c.html#ab251280ae5f0ef3e347a42bb738fc941">b43_lpphy_op_read</a>,
<a name="l02723"></a>02723         .phy_write              = <a class="code" href="phy__lp_8c.html#ab6a5cfd77afff66fc2721908a54ae5c4">b43_lpphy_op_write</a>,
<a name="l02724"></a>02724         .phy_maskset            = <a class="code" href="phy__lp_8c.html#acca707555f147ca30c49dc9d7065c5e2">b43_lpphy_op_maskset</a>,
<a name="l02725"></a>02725         .radio_read             = <a class="code" href="phy__lp_8c.html#a678b8712380e9c63acfa3ea52481404d">b43_lpphy_op_radio_read</a>,
<a name="l02726"></a>02726         .radio_write            = <a class="code" href="phy__lp_8c.html#aadc90940facdb90a2fed22b448e7d17a">b43_lpphy_op_radio_write</a>,
<a name="l02727"></a>02727         .software_rfkill        = <a class="code" href="phy__lp_8c.html#a22cd2ad69d93f1bb299f16f071681455">b43_lpphy_op_software_rfkill</a>,
<a name="l02728"></a>02728         .switch_analog          = <a class="code" href="phy__lp_8c.html#afb0588f7ea024879ccdec2bb425edca2">b43_lpphy_op_switch_analog</a>,
<a name="l02729"></a>02729         .switch_channel         = <a class="code" href="phy__lp_8c.html#ab6d19054c5c137f1de186b0d9157da5b">b43_lpphy_op_switch_channel</a>,
<a name="l02730"></a>02730         .get_default_chan       = <a class="code" href="phy__lp_8c.html#aae3808ca30452758f3c135c36d38d9a4">b43_lpphy_op_get_default_chan</a>,
<a name="l02731"></a>02731         .set_rx_antenna         = <a class="code" href="phy__lp_8c.html#a9b923d1221a20e16fc08bdab51a812ab">b43_lpphy_op_set_rx_antenna</a>,
<a name="l02732"></a>02732         .recalc_txpower         = <a class="code" href="phy__lp_8c.html#a885f6209c39c4c13e866084cbad6c795">b43_lpphy_op_recalc_txpower</a>,
<a name="l02733"></a>02733         .adjust_txpower         = <a class="code" href="phy__lp_8c.html#a30e4753f0a73935d430c793422e33d93">b43_lpphy_op_adjust_txpower</a>,
<a name="l02734"></a>02734         .pwork_15sec            = <a class="code" href="phy__lp_8c.html#aff57087be8b8efb469740a8fc7797a04">b43_lpphy_op_pwork_15sec</a>,
<a name="l02735"></a>02735         .pwork_60sec            = <a class="code" href="phy__lp_8c.html#a43ec6b70764ef6256f94a929db3d3eee">lpphy_calibration</a>,
<a name="l02736"></a>02736 };
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 11 22:05:16 2013 for CompatWireless3.2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
